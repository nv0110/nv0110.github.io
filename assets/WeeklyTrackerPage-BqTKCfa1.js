const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CnSjvSrJ.js","assets/vendor-ui-aK89YfOw.js","assets/vendor-router-Cg8TMqY4.js","assets/vendor-react-eWEExxYH.js","assets/vendor-supabase-B7S7y5aO.js","assets/index-RHCjBdfQ.css","assets/userWeeklyDataService-CnD16_tc.js","assets/mapleWeekUtils-Bm65Nri8.js","assets/bossRegistryService-D89mOkSS.js","assets/bossCodeMapping-BCZH3EaK.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-aK89YfOw.js";import{r as n,c as Ge}from"./vendor-router-Cg8TMqY4.js";import{s as le,c as de,g as Ye,d as Ce,p as Ue,e as De,f as we,l as h,h as Se,i as ve,M as Ve,u as Pe,b as We,S as ue,j as Ee,a as ze,N as Le,V as qe,H as Ze,W as Je,D as Xe}from"./index-CnSjvSrJ.js";import{_ as J}from"./vendor-supabase-B7S7y5aO.js";import{C as Qe}from"./CustomCheckbox-C2-rm8qf.js";import{getBossPitchedItems as be}from"./bossRegistryService-D89mOkSS.js";import{getCharacterHistoricalWeekAnalysis as et,getHistoricalWeekAnalysis as tt,purgeAllStatsData as st,clearCharacterPitchedUI as rt,purgePitchedRecords as at,getPitchedResetAuditHistory as it}from"./utilityService-BSrTZLXk.js";import{getBossRegistryId as ot}from"./bossCodeMapping-BCZH3EaK.js";import{getCurrentMapleWeekStartDate as nt}from"./mapleWeekUtils-Bm65Nri8.js";import{fetchCurrentWeekData as Ie,addCharacterToWeeklySetup as ct,removeCharacterFromWeeklySetup as lt,updateCharacterNameInWeeklySetup as dt,updateCharacterBossConfigInWeeklySetup as ht,saveOrUpdateUserWeeklyData as mt,fetchUserWeeklyData as ut}from"./userWeeklyDataService-CnD16_tc.js";import"./vendor-react-eWEExxYH.js";async function Te(t,i){try{if(!t||!i)return{success:!1,error:"Missing required parameters: userId and pitchedItemData"};const{charId:r,bossName:s,item:l}=i;if(!r||!s||!l)return{success:!1,error:"Missing required fields: charId, bossName, item"};const{data:m,error:v}=await le.from("user_data").select("pitched_items").eq("id",t).single();if(v)return console.error("Error fetching user data for pitched items:",v),{success:!1,error:"Failed to fetch user data"};if(!m)return{success:!1,error:"User not found"};const f={charId:r.trim(),bossName:s.trim(),item:l.trim(),date:i.date||new Date().toISOString().split("T")[0]},c=[...m.pitched_items||[],f],{error:p}=await le.from("user_data").update({pitched_items:c}).eq("id",t);return p?(console.error("Error adding pitched item:",p),{success:!1,error:"Failed to add pitched item"}):{success:!0,pitchedItem:f}}catch(r){return console.error("Error in addPitchedItem:",r),{success:!1,error:r.message}}}async function $e(t,i,r,s,l=null){try{if(!t||!i||!r||!s)return{success:!1,error:"Missing required parameters: userId, charId, bossName, and item"};const{data:m,error:v}=await le.from("user_data").select("pitched_items").eq("id",t).single();if(v)return console.error("Error fetching user data for pitched item removal:",v),{success:!1,error:"Failed to fetch user data"};if(!m)return{success:!1,error:"User not found"};const f=m.pitched_items||[];let C;if(l)C=f.filter(p=>!(p.charId===i&&p.bossName===r&&p.item===s&&p.date===l));else{const p=f.findLastIndex(k=>k.charId===i&&k.bossName===r&&k.item===s);if(p===-1)return{success:!1,error:"Pitched item not found"};C=f.filter((k,L)=>L!==p)}if(C.length===f.length)return{success:!1,error:"Pitched item not found"};const{error:c}=await le.from("user_data").update({pitched_items:C}).eq("id",t);return c?(console.error("Error removing pitched item:",c),{success:!1,error:"Failed to remove pitched item"}):{success:!0}}catch(m){return console.error("Error in removePitchedItem:",m),{success:!1,error:m.message}}}async function Me(t,i){try{if(!t||!Array.isArray(i)||i.length===0)return{success:!1,error:"Missing required parameters or empty items array"};const{data:r,error:s}=await le.from("user_data").select("pitched_items").eq("id",t).single();if(s)return console.error("Error fetching user data for bulk removal:",s),{success:!1,error:"Failed to fetch user data"};if(!r)return{success:!1,error:"User not found"};const l=r.pitched_items||[];let m=[...l];i.forEach(({charId:C,item:c,date:p})=>{if(p)m=m.filter(k=>!(k.charId===C&&k.item===c&&k.date===p));else{const k=m.findLastIndex(L=>L.charId===C&&L.item===c);k!==-1&&m.splice(k,1)}});const v=l.length-m.length;if(v===0)return{success:!1,error:"No matching pitched items found"};const{error:f}=await le.from("user_data").update({pitched_items:m}).eq("id",t);return f?(console.error("Error removing multiple pitched items:",f),{success:!1,error:"Failed to remove pitched items"}):{success:!0,removedCount:v}}catch(r){return console.error("Error in removeManyPitchedItems:",r),{success:!1,error:r.message}}}async function Ne(t,i={}){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const{weekKey:r,charId:s,year:l}=i,{data:m,error:v}=await le.from("user_data").select("pitched_items").eq("id",t).single();if(v)return console.error("Error fetching pitched items:",v),{success:!1,error:"Failed to fetch pitched items"};if(!m)return{success:!1,error:"User not found"};let f=m.pitched_items||[];return r&&(f=f.filter(C=>de(C.date)===r)),s&&(f=f.filter(C=>C.charId===s)),l&&(f=f.filter(C=>new Date(C.date).getFullYear()===l)),{success:!0,items:f}}catch(r){return console.error("Error in getPitchedItems:",r),{success:!1,error:r.message}}}async function Re(t,i){try{if(!t||!i)return{success:!1,error:"Missing required parameters: userId and weekKey"};const{data:r,error:s}=await le.from("user_data").select("pitched_items").eq("id",t).single();if(s)return console.error("Error fetching user data for week clear:",s),{success:!1,error:"Failed to fetch user data"};if(!r)return{success:!1,error:"User not found"};const l=r.pitched_items||[],m=l.filter(C=>de(C.date)!==i),v=l.length-m.length;if(v===0)return{success:!0,removedCount:0};const{error:f}=await le.from("user_data").update({pitched_items:m}).eq("id",t);return f?(console.error("Error clearing week pitched items:",f),{success:!1,error:"Failed to clear week pitched items"}):{success:!0,removedCount:v}}catch(r){return console.error("Error in clearPitchedItemsForWeek:",r),{success:!1,error:r.message}}}async function je(t,i=null){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const r=i?parseInt(i,10):new Date().getFullYear(),s=await Ne(t,{year:r});if(!s.success)return s;const l=s.items,m={total:l.length,characters:new Set,items:[]};return l.forEach(f=>{m.characters.add(f.charId),m.items.push({charId:f.charId,item:f.item,date:f.date})}),{success:!0,stats:{year:r,total:m.total,characters:Array.from(m.characters),items:m.items}}}catch(r){return console.error("Error in getYearlyPitchedStats:",r),{success:!1,error:r.message}}}async function He(t){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const i=await Ne(t,{});if(!i.success)return i;const r=i.items.length;if(r===0)return{success:!0,removedCount:0};const{error:s}=await le.from("user_data").update({pitched_items:[]}).eq("id",t);return s?(console.error("Error purging all pitched items:",s),{success:!1,error:"Failed to purge pitched items"}):{success:!0,removedCount:r}}catch(i){return console.error("Error in purgeAllPitchedItems:",i),{success:!1,error:i.message}}}const xe=Object.freeze(Object.defineProperty({__proto__:null,addPitchedItem:Te,clearPitchedItemsForWeek:Re,getPitchedItems:Ne,getYearlyPitchedStats:je,purgeAllPitchedItems:He,removeManyPitchedItems:Me,removePitchedItem:$e},Symbol.toStringTag,{value:"Module"}));function ft({appWeekKey:t,selectedWeekKey:i,onWeekChange:r,historicalAnalysis:s={hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[]}}){const[l,m]=n.useState(!1);n.useEffect(()=>{const a=()=>{m(window.innerWidth<=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const v=n.useMemo(()=>{const o=(s==null?void 0:s.adaptiveWeekLimit)||8;return{min:-o,max:0,current:0,adaptiveLimit:o}},[s,t]),f=n.useMemo(()=>Ye(i,t),[i,t]),C=n.useCallback(a=>{a!==i&&r(a)},[i,r]),c=()=>{const a=f-1;if(a>=v.min){const o=Ce(a,t);C(o)}},p=()=>{const a=f+1;if(a<=v.max){const o=Ce(a,t);C(o)}},k=n.useCallback(()=>{if(s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek))C(s.oldestHistoricalWeek);else{const a=Ce(-v.adaptiveLimit,t);C(a)}},[s,v.adaptiveLimit,t,C]),L=()=>{C(t)},E=f>v.min,j=f<v.max,S=(s==null?void 0:s.hasHistoricalData)||f>-v.adaptiveLimit,I=i===t,b=n.useMemo(()=>{const a=Ue(i),o=De(i);return{label:we(i,t),parsed:a,dateRange:o,isSelectedWeekTheCurrentAppWeek:I,offset:f}},[i,t,I,f]);return n.useEffect(()=>{const a=!I,o=(s==null?void 0:s.hasHistoricalData)&&(s==null?void 0:s.oldestHistoricalWeek)&&i!==s.oldestHistoricalWeek&&!I;h.debug("WeekNavigator: Button visibility debug",{selectedWeekKey:i,appWeekKey:t,isSelectedWeekTheCurrentAppWeek:I,currentBtnVisible:a,oldestBtnVisible:o,historicalAnalysis:{hasHistoricalData:s==null?void 0:s.hasHistoricalData,oldestHistoricalWeek:s==null?void 0:s.oldestHistoricalWeek,userType:s==null?void 0:s.userType,adaptiveWeekLimit:s==null?void 0:s.adaptiveWeekLimit}})},[i,t,I,s]),e.jsx("div",{className:"week-navigator-wrapper",children:e.jsxs("div",{className:"week-navigator-container",children:[e.jsx("div",{className:"week-navigator-header",children:e.jsxs("div",{className:`week-navigator-title ${I?"current-week":"historical-week"}`,children:[e.jsx("span",{className:"week-title-text",children:b.label.replace(/\s*\(Current\)/i,"")}),I&&e.jsx("span",{className:"week-navigator-current-dot",children:e.jsx("span",{className:"week-navigator-current-dot-inner"})})]})}),e.jsxs("div",{className:"week-navigator-navigation",children:[e.jsx("div",{className:`week-navigator-arrow-container ${E?"enabled arrow-left":"disabled"}`,onClick:E?c:void 0,title:E?"Previous Week":`Already at oldest allowed week (${v.adaptiveLimit} weeks back from current)`,children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`week-navigator-arrow arrow-left ${E?"enabled":"disabled"}`,children:e.jsx("path",{d:"M20.3284 11.0001V13.0001L7.50011 13.0001L10.7426 16.2426L9.32842 17.6568L3.67157 12L9.32842 6.34314L10.7426 7.75735L7.49988 11.0001L20.3284 11.0001Z",fill:"currentColor"})})}),e.jsxs("div",{className:"week-navigator-center-content",children:[b.dateRange&&e.jsxs("div",{className:"week-navigator-date-range",children:[b.dateRange.start.toLocaleDateString()," - ",b.dateRange.end.toLocaleDateString()]}),e.jsxs("div",{className:"week-navigator-integrated-buttons",children:[e.jsxs("button",{onClick:L,className:`week-navigator-integrated-btn current-week-btn ${I?"hidden":"visible"}`,title:"Jump to current application week",disabled:I,children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})}),"Current"]}),e.jsxs("button",{onClick:k,className:`week-navigator-integrated-btn oldest-data-btn ${s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)&&i!==s.oldestHistoricalWeek&&!I?"visible":"hidden"}`,title:`Jump to oldest recorded data (${s!=null&&s.oldestHistoricalWeek?we(s.oldestHistoricalWeek,t):"oldest data"})`,disabled:!(s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)&&i!==s.oldestHistoricalWeek&&!I),children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Oldest"]})]})]}),e.jsx("div",{className:`week-navigator-arrow-container ${I?S?"enabled arrow-right":"disabled":j?"enabled arrow-right":"disabled"}`,onClick:I?S?k:void 0:j?p:void 0,title:I?S?s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)?`Jump to oldest data (${we(s.oldestHistoricalWeek,t)})`:`Jump to ${v.adaptiveLimit} weeks back`:"No older data available to jump to":j?"Next Week":"Already at current application week",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`week-navigator-arrow arrow-right ${I?S?"enabled":"disabled":j?"enabled":"disabled"}`,children:e.jsx("path",{d:"M15.0378 6.34317L13.6269 7.76069L16.8972 11.0157L3.29211 11.0293L3.29413 13.0293L16.8619 13.0157L13.6467 16.2459L15.0643 17.6568L20.7079 11.9868L15.0378 6.34317Z",fill:"currentColor"})})})]}),!I&&e.jsx("div",{className:"week-navigator-floating-actions week-navigator-floating-left",children:e.jsx("button",{onClick:L,className:"week-navigator-floating-btn",title:"Jump to current week",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})})})}),(s==null?void 0:s.hasHistoricalData)&&(s==null?void 0:s.oldestHistoricalWeek)&&i!==s.oldestHistoricalWeek&&e.jsx("div",{className:"week-navigator-floating-actions week-navigator-floating-right",children:e.jsx("button",{onClick:k,className:"week-navigator-floating-btn",title:`Jump to oldest data (${we(s.oldestHistoricalWeek,t)})`,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})})]},i)})}function gt({startPosition:t,endPosition:i,onComplete:r}){const[s,l]=n.useState(t),[m,v]=n.useState(1);return n.useEffect(()=>{const f=Date.now(),C=1e3,c=()=>{const p=Date.now()-f,k=Math.min(p/C,1),L=1-Math.pow(1-k,3),E=t.x+(i.x-t.x)*L,j=t.y+(i.y-t.y)*L;l({x:E,y:j}),v(1-k),k<1?requestAnimationFrame(c):r()};requestAnimationFrame(c)},[t,i,r]),e.jsx("div",{style:{position:"fixed",left:s.x,top:s.y,transform:"translate(-50%, -50%)",opacity:m,pointerEvents:"none",zIndex:1e3,transition:"transform 0.1s ease"},children:e.jsx("img",{src:"/bosses/crystal.png",alt:"Crystal",style:{width:24,height:24,transform:`rotate(${s.x*.1}deg)`,filter:"drop-shadow(0 0 4px rgba(162, 89, 247, 0.6))"}})})}function ke(t){if(t===0)return"0";if(t<1e9){const r=t/1e6;if(r<1){const s=t/1e3;return s<1?t.toString():`${s.toFixed(1)}K`}return`${r.toFixed(1)}M`}return`${(t/1e9).toFixed(1)}B`}const pt=(t=[])=>{const[i,r]=n.useState(!1),s=n.useRef(null);return n.useEffect(()=>{const l=s.current;if(!l)return;const m=()=>{const f=l.scrollHeight>l.clientHeight,C=l.scrollTop<=5;r(f&&C)},v=()=>{m()};return m(),l.addEventListener("scroll",v),()=>{l.removeEventListener("scroll",v)}},t),{showIndicator:i,elementRef:s}},kt=({show:t,className:i=""})=>e.jsx("div",{className:`scroll-indicator ${t?"visible":"hidden"} ${i}`,children:e.jsx("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M7 10L12 15L17 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),xt=Ge.memo(function({sidebarVisible:i,setSidebarVisible:r,isHistoricalWeek:s,totalMeso:l,obtainableMeso:m,selectedWeekKey:v,hideCompleted:f,setHideCompleted:C,visibleCharSummaries:c,selectedCharIdx:p,setSelectedCharIdx:k,setPurgeTargetCharacter:L,setShowCharacterPurgeConfirm:E,setShowCharacterPitchedModal:j,onShowTreasureAnalytics:S,characterBossSelections:I,showOnboardingIndicators:b}){const[a,o]=n.useState(!1),[g,x]=n.useState(!1),[d,u]=n.useState(!1),{showIndicator:w,elementRef:N}=pt([c,i]);n.useEffect(()=>{const y=()=>{const _=window.innerWidth;o(_<=768),x(_<=480)};return y(),window.addEventListener("resize",y),()=>window.removeEventListener("resize",y)},[]),n.useEffect(()=>{if(!a)return;const y=_=>{i&&!_.target.closest(".sidebar-scroll")&&!_.target.closest(".sidebar-toggle")&&!_.target.closest(".sidebar-mobile-fab")&&r&&r(!1)};return document.addEventListener("click",y),()=>document.removeEventListener("click",y)},[a,i,r]);const D=n.useCallback((y,_)=>{y.stopPropagation(),k(_.idx),j&&j(!0)},[k,j]),H=n.useCallback(y=>{k(y),g&&i&&r&&setTimeout(()=>r(!1),300)},[k,g,i,r]),P=n.useCallback((y,_)=>{y.preventDefault(),L({name:_.name,idx:_.idx}),E(!0)},[L,E]),B=n.useCallback(()=>{u(y=>!y)},[]);return e.jsxs(e.Fragment,{children:[a&&i&&e.jsx("div",{className:"sidebar-mobile-overlay",onClick:()=>r&&r(!1)}),g&&!i&&e.jsxs("button",{className:"sidebar-mobile-fab",onClick:()=>r&&r(!0),title:"Open character sidebar",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7.75735 13.2574L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})}),e.jsx("span",{className:"sidebar-mobile-fab-badge",children:c.length})]}),e.jsx("div",{className:`sidebar-scroll fade-in-no-slide ${i?"visible":"hidden"} ${a?"mobile":"desktop"} ${g?"very-small":""}`,children:e.jsxs("div",{className:"sidebar-content",children:[a&&e.jsx("button",{className:"sidebar-mobile-close",onClick:()=>r&&r(!1),title:"Close sidebar",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 18L18 6M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),e.jsx("div",{className:"sidebar-header",children:e.jsx("h3",{className:`sidebar-title ${b?"onboarding-highlight":""}`,onClick:S,title:"View logged item analytics across all characters",children:"Characters"})}),!s&&e.jsx("div",{className:`sidebar-progress-section premium-progress ${b?"onboarding-highlight":""}`,onClick:B,children:d?c[p]&&e.jsxs("div",{className:"sidebar-progress-container sidebar-progress-character",children:[e.jsxs("div",{className:"sidebar-progress-title",children:[c[p].name,"'s Weekly"]}),e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${(()=>{const y=c[p];if(!y)return 0;`${y.name}${y.idx}`;const _=I[y.idx];if(!_)return 0;const G=_.bosses.reduce((X,V)=>X+Math.ceil((V.price||0)/(V.partySize||1)),0);return G>0?Math.min(y.totalMeso/G*100,100):0})()}%`},children:c[p].totalMeso>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:ke(c[p].totalMeso)}),e.jsx("span",{children:ke((()=>{const y=c[p];if(!y)return 0;const _=I[y.idx];return _?_.bosses.reduce((G,X)=>G+Math.ceil((X.price||0)/(X.partySize||1)),0):0})())})]})]}):e.jsxs("div",{className:"sidebar-progress-container sidebar-progress-weekly",children:[e.jsx("div",{className:"sidebar-progress-title",children:"Weekly Progress"}),e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${m>0?Math.min(l/m*100,100):0}%`},children:m>0&&l>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:ke(l)}),e.jsx("span",{children:ke(m)})]})]})}),s&&e.jsxs("div",{className:"sidebar-historical-section",children:[e.jsxs("div",{className:"sidebar-historical-title",children:["Week ",v.split("-").slice(1).join("-")]}),e.jsx("div",{className:"sidebar-historical-subtitle",children:"Historical Data"})]}),e.jsxs("div",{className:"sidebar-character-list-container",children:[e.jsx("div",{className:"sidebar-character-list",ref:N,children:c.length===0?e.jsx("div",{className:"sidebar-empty-state",children:f?"No characters with bosses left to clear.":"No characters found."}):c.map(y=>e.jsxs("div",{onClick:()=>H(y.idx),onContextMenu:_=>P(_,y),className:`sidebar-character-card ${p===y.idx?`selected ${s?"historical-week":"current-week"}`:"default"}`,children:[e.jsxs("div",{className:"sidebar-character-header",children:[e.jsx("span",{className:`sidebar-character-name ${p===y.idx?"selected":"default"}`,children:y.name}),e.jsxs("div",{className:"sidebar-character-actions",children:[y.allCleared&&e.jsxs("svg",{className:"sidebar-character-checkmark",width:"16",height:"16",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("button",{className:"sidebar-character-pitched-btn",onClick:_=>D(_,y),title:"View pitched items",children:e.jsxs("div",{className:"pitched-btn-content",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7.75735 13.2574L2 9.27L8.91 8.26L12 2Z",fill:"url(#starGradient)",stroke:"url(#starStrokeGradient)",strokeWidth:"1.5"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"starGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]}),e.jsxs("linearGradient",{id:"starStrokeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#d6b4ff"}),e.jsx("stop",{offset:"1",stopColor:"#a259f7"})]})]})]}),e.jsx("span",{className:"pitched-btn-glow"})]})})]})]}),e.jsx("div",{className:"sidebar-character-stats",children:y.total===0?e.jsx("div",{className:"sidebar-character-no-bosses",children:"No bosses configured"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-character-completion",children:[y.cleared," / ",y.total," bosses cleared"]}),e.jsxs("div",{className:"sidebar-character-meso",children:[ke(y.totalMeso)," meso"]})]})})]},y.name+"-"+y.idx))}),e.jsx(kt,{show:w})]})]})})]})});function wt({sidebarVisible:t,setSidebarVisible:i}){const[r,s]=n.useState(!1),[l,m]=n.useState(!1);return n.useEffect(()=>{const v=()=>{const f=window.innerWidth;s(f<=768),m(f<=480)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]),l?null:e.jsx("div",{className:`sidebar-toggle ${t?"visible":"hidden"} ${r?"mobile":"desktop"}`,onClick:()=>i(!t),title:t?"Hide sidebar":"Show sidebar",children:t?e.jsxs("svg",{className:"sidebar-toggle-close-icon",width:r?"20":"24",height:r?"20":"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"crossGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff"}),e.jsx("stop",{offset:"50%",stopColor:"#e6e0ff"}),e.jsx("stop",{offset:"100%",stopColor:"#d6b4ff"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#crossGradient)"})]}):e.jsx("div",{className:"sidebar-toggle-hamburger",children:[0,1,2].map(v=>e.jsx("span",{className:"sidebar-toggle-hamburger-line",style:{width:r?"18px":"22px",height:r?"2px":"3px"}},v))})})}function ye(t,i,r,s){return`${t}__${i}__${r}__${s}`}function vt({bosses:t=[],bossData:i=[],checked:r={},characterKey:s="",onBossCheck:l=()=>{},getBossPrice:m=()=>0,showTickAll:v=!1,onTickAll:f=()=>{},allTicked:C=!1,pitchedChecked:c={},onPitchedItemClick:p=()=>{},isHistoricalWeek:k=!1,userCode:L="",selectedWeekKey:E="",selectedCharIdx:j=0,userInteractionRef:S=null,cloudPitchedItems:I=[],characterBossSelections:b=[]}){const[a,o]=n.useState(new Set);if(!t.length||!i.length)return e.jsx("div",{className:"boss-table-container",children:e.jsx("div",{className:"boss-table-loading",children:e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"#e6e0ff"},children:"Loading boss data..."})})});const g=P=>i.find(B=>B.name===P)||{},x=P=>new Intl.NumberFormat().format(P),d=n.useMemo(()=>s.split("-").slice(0,-1).join("-"),[s]),u=(P,B)=>(be(P)||[]).filter(_=>_.difficulty?_.difficulty===B:_.difficulties&&Array.isArray(_.difficulties)?_.difficulties.includes(B):!0),w=(P,B,y)=>{if(!d)return!1;const _=ye(d,P,B,y);return!!c[_]},N=(P,B,y,_)=>{var V;const G=((V=b[j])==null?void 0:V.name)||P,X=ye(G,B,y,_);return a.has(X)},D=async(P,B,y,_)=>{var te;P.stopPropagation(),S&&(S.current=!0);const G=((te=b[j])==null?void 0:te.name)||_,X=ye(G,B.name,y.name,E),V=w(B.name,y.name,E);if(!a.has(X)){if(k){if(V){o(O=>new Set([...O,X]));try{await p({bossName:B.name,itemName:y.name,characterName:G,weekKey:E,isChecked:V,isHistorical:!0})}finally{o(O=>{const T=new Set(O);return T.delete(X),T})}}return}o(O=>new Set([...O,X]));try{await p({bossName:B.name,itemName:y.name,characterName:G,weekKey:E,isChecked:V,isHistorical:!1,itemImage:y.image})}finally{o(O=>{const T=new Set(O);return T.delete(X),T})}}},H=(P,B,y)=>{y.target.closest(".boss-pitched-items")||l(P,!B,y)};return e.jsx("div",{className:"boss-table-container",children:e.jsxs("div",{className:"boss-table-grid",children:[e.jsxs("div",{className:"boss-table-header",children:[e.jsx("div",{className:"header-boss",children:"Boss"}),e.jsx("div",{className:"header-difficulty",children:"Difficulty"}),e.jsx("div",{className:"header-mesos",children:"Mesos"}),e.jsxs("div",{className:"header-cleared",children:[v&&e.jsx("button",{onClick:f,className:"header-tick-all-button",title:C?"Clear all boss completions":"Mark all bosses as completed",children:C?"Clear All":"Complete All"}),!v&&"Cleared"]})]}),t.map((P,B)=>{var O;const y=g(P.name),_=`${P.name}-${P.difficulty}`,G=!!((O=r[s])!=null&&O[_]),X=m(P.name,P.difficulty)/(P.partySize||1),V=u(P.name,P.difficulty),te=d;return e.jsxs("div",{className:`boss-table-row ${B%2===0?"even":"odd"}`,onClick:T=>H(P,G,T),children:[e.jsxs("div",{className:"cell-boss",children:[e.jsxs("div",{className:"boss-info-section",children:[y.image&&e.jsx("img",{src:y.image,alt:P.name,className:"boss-image"}),e.jsxs("div",{className:"boss-details",children:[e.jsx("span",{className:"boss-name",children:P.name}),P.partySize&&P.partySize>1&&e.jsxs("span",{className:"boss-party-size",children:["Party: ",P.partySize]})]})]}),V.length>0&&e.jsx("div",{className:"boss-pitched-items",onClick:T=>T.stopPropagation(),children:V.map((T,ie)=>{const Y=w(P.name,T.name,E),Q=N(te,P.name,T.name,E);return e.jsx("div",{className:`pitched-item-icon ${Y?"checked":"unchecked"} ${k?"historical":""} ${Q?"loading":""}`,onClick:M=>!Q&&D(M,P,T,te),title:Q?"Processing...":`${T.name} ${Y?"(Obtained)":"(Click to mark as obtained)"}`,style:{cursor:Q?"not-allowed":"pointer",opacity:Q?.7:1},children:Q?e.jsx("div",{className:"pitched-item-loading",children:e.jsx("div",{className:"loading-spinner-small"})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:T.image,alt:T.name,className:"pitched-item-image"}),Y&&e.jsx("div",{className:"pitched-item-checkmark",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},`${T.name}-${ie}`)})})]}),e.jsx("div",{className:"cell-difficulty",children:P.difficulty}),e.jsx("div",{className:"cell-mesos",children:x(Math.ceil(X))}),e.jsx("div",{className:"cell-cleared",onClick:T=>T.stopPropagation(),children:e.jsx(Qe,{checked:G,onChange:T=>l(P,T.target.checked,T)})})]},_)})]})})}function yt({bossData:t=[],characterKey:i="",selectedWeekKey:r="",selectedCharIdx:s=0,pitchedChecked:l={},onPitchedItemClick:m=()=>{},userCode:v="",cloudPitchedItems:f=[],characterBossSelections:C=[]}){const[c,p]=n.useState([]),k=n.useMemo(()=>i.split("-").slice(0,-1).join("-"),[i]),L=S=>t.find(I=>I.name===S)||{};n.useEffect(()=>{(async()=>{h.info("HistoricalWeekCards: Loading all bosses with pitched items from registry");const I=[],b=[{boss_name:"Lotus",difficulty:"Hard",drops_pitched:["Black Heart","Berserked"]},{boss_name:"Lotus",difficulty:"Extreme",drops_pitched:["Total Control","Black Heart","Berserked"]},{boss_name:"Damien",difficulty:"Hard",drops_pitched:["Magic Eyepatch"]},{boss_name:"Lucid",difficulty:"Hard",drops_pitched:["Dreamy Belt"]},{boss_name:"Will",difficulty:"Hard",drops_pitched:["Cursed Spellbook"]},{boss_name:"Gloom",difficulty:"Chaos",drops_pitched:["Endless Terror"]},{boss_name:"Darknell",difficulty:"Hard",drops_pitched:["Commanding Force Earring"]},{boss_name:"Verus Hilla",difficulty:"Hard",drops_pitched:["Source of Suffering"]},{boss_name:"Chosen Seren",difficulty:"Hard",drops_pitched:["Mitra's Rage"]},{boss_name:"Chosen Seren",difficulty:"Extreme",drops_pitched:["Mitra's Rage","Gravity Module"]},{boss_name:"Watcher Kalos",difficulty:"Easy",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Normal",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Chaos",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Extreme",drops_pitched:["Grindstone of Life","Mark of Destruction"]},{boss_name:"Kaling",difficulty:"Easy",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Normal",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Hard",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Extreme",drops_pitched:["Grindstone of Life","Helmet of Loyalty"]},{boss_name:"Limbo",difficulty:"Hard",drops_pitched:["Whisper of the Source"]}],a={};for(const o of b)if(o.drops_pitched.length>0){a[o.boss_name]||(a[o.boss_name]={name:o.boss_name,difficulties:[],itemMap:{}}),a[o.boss_name].difficulties.push(o.difficulty);for(const g of o.drops_pitched)a[o.boss_name].itemMap[g]||(a[o.boss_name].itemMap[g]=[]),a[o.boss_name].itemMap[g].push(o.difficulty)}for(const[o,g]of Object.entries(a)){const x=[...new Set(g.difficulties)].sort(),d=[];for(const[u,w]of Object.entries(g.itemMap)){const D=(be(o)||[]).find(H=>H.name===u)||{};d.push({name:u,image:D.image||"/images/items/default.png",droppingDifficulties:w.sort()})}d.length>0&&(I.push({name:o,items:d,difficultiesThatDropItems:x}),h.info("HistoricalWeekCards: Added boss with registry items",{bossName:o,itemCount:d.length,difficultiesThatDropItems:x,items:d.map(u=>`${u.name} (${u.droppingDifficulties.join(", ")})`)}))}p(I),h.info("HistoricalWeekCards: Total bosses with pitched items loaded from registry:",I.length)})()},[]);const E=(S,I,b)=>{if(!k)return!1;const a=ye(k,S,I,b);return!!l[a]},j=async(S,I,b)=>{var g;S.stopPropagation();const a=((g=C[s])==null?void 0:g.name)||k,o=E(I.name,b.name,r);h.debug("HistoricalWeekCards: Pitched item clicked",{bossName:I.name,itemName:b.name,character:a,weekKey:r,isChecked:o}),await m({bossName:I.name,itemName:b.name,characterName:a,weekKey:r,isChecked:o,isHistorical:!0,itemImage:b.image})};return h.info("HistoricalWeekCards: Rendering with data",{bossesWithItemsCount:c.length,weekKey:r,characterName:k}),c.length?e.jsxs("div",{className:"historical-week-cards",children:[e.jsxs("div",{className:"historical-cards-header",children:[e.jsx("h3",{children:"Historical Week Overview"}),e.jsx("p",{children:"All bosses with droppable items - click on pitched items to add/remove historical drops"})]}),e.jsx("div",{className:"historical-cards-grid",children:c.map((S,I)=>{const b=L(S.name),a=S.name;return e.jsxs("div",{className:"historical-boss-card",children:[e.jsxs("div",{className:"historical-boss-header",children:[b.image&&e.jsx("img",{src:b.image,alt:S.name,className:"historical-boss-image"}),e.jsxs("div",{className:"historical-boss-details",children:[e.jsx("h4",{className:"historical-boss-name",children:S.name}),e.jsxs("span",{className:"historical-boss-difficulties",children:["Available in: ",S.difficultiesThatDropItems.join(", ")]})]})]}),e.jsxs("div",{className:"historical-pitched-section",children:[e.jsxs("div",{className:"historical-pitched-header",children:[e.jsx("span",{children:"Dropped Items"}),e.jsxs("span",{className:"historical-pitched-count",children:[S.items.filter(o=>E(S.name,o.name,r)).length," / ",S.items.length]})]}),e.jsx("div",{className:"historical-pitched-grid",children:S.items.map((o,g)=>{const x=E(S.name,o.name,r);return e.jsxs("div",{className:`historical-pitched-item ${x?"checked":"unchecked"}`,onClick:d=>j(d,S,o),title:`${o.name} - Drops from: ${o.droppingDifficulties.join(", ")} ${x?"(Obtained)":"(Click to mark as obtained)"}`,children:[e.jsx("img",{src:o.image,alt:o.name,className:"historical-pitched-image"}),e.jsxs("div",{className:"historical-pitched-info",children:[e.jsx("span",{className:"historical-pitched-name",children:o.name}),e.jsx("span",{className:"historical-pitched-difficulties",children:o.droppingDifficulties.join(", ")})]}),x&&e.jsx("div",{className:"historical-pitched-checkmark",children:"✓"})]},`${o.name}-${g}`)})})]})]},a)})})]}):e.jsxs("div",{className:"historical-cards-empty",children:[e.jsx("div",{className:"historical-cards-empty-icon",children:"🎁"}),e.jsx("h3",{children:"No Droppable Items"}),e.jsx("p",{children:"No bosses with droppable pitched items found."})]})}function jt({showStats:t,setShowStats:i,allYears:r,selectedYear:s,setSelectedYear:l,groupedYearlyPitchedItems:m,isLoadingCloudStats:v,setShowStatsResetConfirm:f,handleItemDetailClick:C}){if(!t)return null;const c=m.reduce((p,k)=>p+k.count,0);return e.jsx("div",{className:"modal-backdrop stats-modal-backdrop",onClick:()=>i(!1),children:e.jsxs("div",{className:"modern-stats-modal",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"modern-stats-header",children:[e.jsxs("div",{className:"modern-stats-title-section",children:[e.jsx("h2",{className:"modern-stats-title",children:"Pitched Items Statistics"}),e.jsx("div",{className:"modern-stats-subtitle",children:s})]}),e.jsx("button",{onClick:()=>i(!1),className:"modern-stats-close",title:"Close",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"modern-stats-controls",children:[e.jsxs("div",{className:"modern-year-selector",children:[e.jsx("label",{className:"modern-year-label",children:"Year:"}),e.jsx("select",{value:s,onChange:p=>l(p.target.value),className:"modern-year-select",children:r.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{className:"modern-stats-summary",children:[e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:m.length}),e.jsx("div",{className:"modern-stat-label",children:"Unique Items"})]}),e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:c}),e.jsx("div",{className:"modern-stat-label",children:"Total Obtained"})]})]})]}),e.jsx("div",{className:"modern-stats-content",children:v?e.jsxs("div",{className:"modern-stats-loading",children:[e.jsx("div",{className:"modern-loading-spinner"}),e.jsx("span",{children:"Loading statistics..."})]}):m.length===0?e.jsxs("div",{className:"modern-stats-empty",children:[e.jsx("div",{className:"modern-empty-icon",children:"📊"}),e.jsx("div",{className:"modern-empty-title",children:"No Data Yet"}),e.jsx("div",{className:"modern-empty-text",children:"Start clearing bosses to see your pitched item statistics!"})]}):e.jsx("div",{className:"modern-items-grid",children:m.map((p,k)=>e.jsxs("div",{className:"modern-item-card",onClick:()=>C(p),children:[e.jsxs("div",{className:"modern-item-image-container",children:[e.jsx("img",{src:p.itemImage,alt:p.itemName,className:"modern-item-image"}),e.jsx("div",{className:"modern-item-count-badge",children:p.count})]}),e.jsxs("div",{className:"modern-item-info",children:[e.jsx("div",{className:"modern-item-name",children:p.itemName}),e.jsx("div",{className:"modern-item-meta",children:p.count===1?"1 time":`${p.count} times`})]}),e.jsx("div",{className:"modern-item-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]},`${p.itemName}-${k}`))})}),e.jsx("div",{className:"modern-stats-footer",children:e.jsxs("button",{className:"modern-reset-button",onClick:()=>f(!0),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"})}),"Reset All Statistics"]})})]})})}function bt({showItemDetailModal:t,setShowItemDetailModal:i,selectedItemDetail:r}){if(!t||!r)return null;const{itemName:s,itemImage:l,count:m,instances:v}=r,f=v.reduce((c,p)=>(c[p.charId]||(c[p.charId]=[]),c[p.charId].push(p),c),{}),C=Object.keys(f).sort();return e.jsx("div",{className:"modal-backdrop item-detail-backdrop",onClick:()=>i(!1),children:e.jsxs("div",{className:"modern-item-detail-modal",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modern-item-detail-header",children:[e.jsxs("div",{className:"modern-item-detail-title-section",children:[e.jsx("div",{className:"modern-item-detail-icon",children:e.jsx("img",{src:l,alt:s,className:"modern-item-detail-image"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"modern-item-detail-title",children:s}),e.jsxs("div",{className:"modern-item-detail-subtitle",children:["Obtained ",m," time",m!==1?"s":""]})]})]}),e.jsx("button",{onClick:()=>i(!1),className:"modern-item-detail-close",title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsx("div",{className:"modern-item-detail-content",children:C.map(c=>e.jsxs("div",{className:"modern-character-section",children:[e.jsxs("div",{className:"modern-character-header",children:[e.jsx("div",{className:"modern-character-name",children:c}),e.jsxs("div",{className:"modern-character-count",children:[f[c].length," time",f[c].length!==1?"s":""]})]}),e.jsx("div",{className:"modern-dates-grid",children:f[c].map((p,k)=>e.jsxs("div",{className:"modern-date-chip",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"modern-date-icon",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),p.displayDate]},`${c}-${p.fullDate}-${k}`))})]},c))}),e.jsx("div",{className:"modern-item-detail-footer",children:e.jsxs("div",{className:"modern-detail-stats",children:[e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:C.length}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Character",C.length!==1?"s":""]})]}),e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:m}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Total Drop",m!==1?"s":""]})]})]})})]})})}function Nt({data:t,characterBossSelections:i,onClose:r,onConfirm:s,pitchedChecked:l}){const[m,v]=n.useState(""),[f,C]=n.useState(!1),[c,p]=n.useState(""),k=n.useMemo(()=>t.weekKey?De(t.weekKey):{start:null,end:null},[t.weekKey]),L=n.useCallback(b=>b.toISOString().split("T")[0],[]),E=n.useMemo(()=>{var b;return t.character||((b=i[0])==null?void 0:b.name)||""},[t.character,i]);n.useEffect(()=>{k.start&&!m&&v(L(k.start))},[k,m,L]);const j=async()=>{if(!m||!E){p("Please select a valid date and character.");return}C(!0),p("");try{const b=new Date(m+"T12:00:00.000Z").toISOString();h.info("HistoricalPitchedModal: Confirming historical drop",{bossName:t.bossName,itemName:t.itemName,character:E,weekKey:t.weekKey,date:b}),await s(b,E),C(!1)}catch(b){h.error("HistoricalPitchedModal: Error confirming historical drop",b),p("Failed to add historical drop. Please try again."),C(!1)}},S=n.useMemo(()=>{if(!k.start||!k.end)return"";const b=k.start.toLocaleDateString("en-US",{month:"short"}),a=k.end.toLocaleDateString("en-US",{month:"short"}),o=k.start.getDate(),g=k.end.getDate(),x=k.start.getFullYear();return b===a?`${b} ${o}-${g}, ${x}`:`${b} ${o} - ${a} ${g}, ${x}`},[k]),I=n.useMemo(()=>{if(!k.start||!k.end)return[];const b=[],a=new Date(k.start);for(;a<=k.end;){const o=L(a),g=a.toLocaleDateString("en-US",{weekday:"long"}),x=a.toLocaleDateString("en-US",{month:"short",day:"numeric"});b.push({value:o,label:`${g}, ${x}`,date:new Date(a)}),a.setDate(a.getDate()+1)}return b},[k,L]);return e.jsx("div",{className:"historical-modal-overlay",onClick:r,children:e.jsxs("div",{className:"historical-modal-container",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"historical-modal-header",children:[e.jsx("div",{className:"historical-modal-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2v20l-7-7h14l-7 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"historical-modal-title",children:"Add Historical Drop"}),e.jsx("button",{className:"historical-modal-close",onClick:r,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{className:"historical-modal-showcase",children:[e.jsxs("div",{className:"historical-modal-item-container",children:[e.jsx("div",{className:"historical-modal-item-glow"}),e.jsx("img",{src:t.itemImage,alt:t.itemName,className:"historical-modal-item-image"})]}),e.jsxs("div",{className:"historical-modal-item-details",children:[e.jsx("h3",{className:"historical-modal-item-name",children:t.itemName}),e.jsxs("p",{className:"historical-modal-boss-name",children:["from ",t.bossName]})]})]}),e.jsx("div",{className:"historical-modal-details",children:e.jsxs("div",{className:"historical-modal-detail-group",children:[e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Character:"}),e.jsx("span",{className:"detail-value character-name",children:E})]}),e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Week Range:"}),e.jsx("span",{className:"detail-value",children:S})]})]})}),e.jsxs("div",{className:"historical-modal-date-section",children:[e.jsx("label",{className:"historical-modal-section-title",children:"Select the day you obtained this item:"}),e.jsx("div",{className:"historical-modal-date-options",children:I.map(b=>e.jsxs("button",{className:`historical-modal-date-option ${m===b.value?"selected":""}`,onClick:()=>v(b.value),disabled:f,children:[e.jsx("span",{className:"date-option-day",children:b.label.split(",")[0]}),e.jsx("span",{className:"date-option-date",children:b.label.split(",")[1]})]},b.value))}),e.jsxs("div",{className:"historical-modal-date-input-wrapper",children:[e.jsx("label",{className:"historical-modal-date-input-label",children:"Or select date manually:"}),e.jsx("input",{type:"date",value:m,onChange:b=>v(b.target.value),min:k.start?L(k.start):"",max:k.end?L(k.end):"",className:"historical-modal-date-input",disabled:f})]})]}),c&&e.jsxs("div",{className:"historical-modal-error",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),c]}),e.jsxs("div",{className:"historical-modal-actions",children:[e.jsx("button",{onClick:r,disabled:f,className:"historical-modal-btn historical-modal-btn-cancel",children:"Cancel"}),e.jsxs("button",{onClick:j,disabled:f||!m||!E,className:"historical-modal-btn historical-modal-btn-confirm",children:[f&&e.jsx("div",{className:"historical-modal-spinner"}),f?"Adding Drop...":"Confirm Drop"]})]})]})})}function Ct({isOpen:t,onClose:i,characterName:r,cloudPitchedItems:s=[],setPitchedModalItem:l,setShowPitchedModal:m}){const[v,f]=n.useState([]);n.useEffect(()=>{if(!t||!r)return;const c=s.filter(L=>L.charId===r),p=new Map;c.forEach(L=>{const E=L.item;if(!p.has(E)){let S="/items/crystal.png";const I=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling","Limbo"];for(const b of I){const o=be(b).find(g=>g.name===L.item);if(o){S=o.image;break}}p.set(E,{name:L.item,image:S,count:0,history:[]})}const j=p.get(E);j.count+=1,j.history.push({date:L.date})});const k=Array.from(p.values()).sort((L,E)=>E.count-L.count);f(k)},[t,r,s]);const C=c=>{if(!l||!m)return;const p=c.history.map(k=>({char:r,date:new Date(k.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}));l({name:c.name,image:c.image,history:p}),m(!0)};return t?e.jsx("div",{className:"pitched-modal-backdrop",onClick:i,children:e.jsxs("div",{className:`pitched-modal ${v.length===0?"pitched-modal-no-scroll":""}`,onClick:c=>c.stopPropagation(),children:[e.jsx("button",{className:"pitched-modal-close",onClick:i,"aria-label":"Close modal",children:e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"closeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#closeGradient)"})]})}),e.jsx("h2",{className:"pitched-modal-title",children:r?`${r}'s Pitched Items`:"Pitched Items"}),v.length>0?e.jsx("div",{className:"pitched-modal-list-container",children:e.jsx("div",{className:"pitched-modal-list",children:v.map(c=>e.jsxs("div",{className:"pitched-modal-item",onClick:()=>C(c),style:{cursor:"pointer"},children:[e.jsx("div",{className:"pitched-modal-item-glow"}),e.jsx("img",{src:c.image,alt:c.name,className:"pitched-modal-item-img"}),e.jsx("div",{className:"pitched-modal-item-name",children:c.name}),e.jsx("div",{className:"pitched-modal-item-count",children:c.count})]},c.name))})}):e.jsxs("div",{className:"pitched-modal-empty",children:[e.jsx("div",{className:"empty-star-container",children:e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 24 24",fill:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"emptyStarGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#6a11cb"})]}),e.jsxs("filter",{id:"starGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),e.jsx("feFlood",{floodColor:"#a259f7",floodOpacity:"0.5",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"glow",operator:"over"})]})]}),e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"url(#emptyStarGradient)",stroke:"#e6e0ff",strokeWidth:"1.5",filter:"url(#starGlow)",className:"empty-star-path"})]})}),e.jsx("h3",{className:"empty-title",children:"No pitched items yet"}),e.jsxs("p",{className:"empty-desc",children:[r?`${r} hasn't`:"You haven't"," obtained any pitched items yet"]})]})]})}):null}function St({showStatsResetConfirm:t,setShowStatsResetConfirm:i,onConfirm:r}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-small",children:[e.jsx("h3",{className:"stats-reset-title",children:"Are you sure?"}),e.jsx("p",{className:"stats-reset-message",children:"This will permanently erase all stats. This cannot be undone."}),e.jsxs("div",{className:"stats-reset-buttons",children:[e.jsx("button",{onClick:()=>i(!1),className:"stats-reset-button stats-reset-button-cancel",children:"Cancel"}),e.jsx("button",{onClick:r,className:"stats-reset-button stats-reset-button-confirm",children:"Reset"})]})]})}):null}function _t({showCharacterPurgeConfirm:t,setShowCharacterPurgeConfirm:i,purgeTargetCharacter:r,purgeInProgress:s,onConfirm:l}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-medium character-purge-container",children:[e.jsx("div",{className:"character-purge-icon",children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"character-purge-title",children:"Purge Character Data"}),e.jsxs("div",{className:"character-purge-warning",children:[e.jsx("p",{className:"character-purge-warning-title",children:e.jsx("strong",{children:"This will permanently delete all pitched items and boss runs for:"})}),e.jsx("p",{className:"character-purge-character-name",children:r==null?void 0:r.name}),e.jsx("p",{className:"character-purge-warning-note",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"character-purge-buttons",children:[e.jsx("button",{onClick:()=>i(!1),disabled:s,className:"character-purge-button character-purge-button-cancel",children:"Cancel"}),e.jsxs("button",{onClick:l,disabled:s,className:"character-purge-button character-purge-button-confirm",children:[s&&e.jsx("div",{className:"character-purge-spinner"}),s?"Purging...":"Purge Data"]})]})]})}):null}function Et({resetSuccessVisible:t,closeResetSuccess:i,purgeSuccess:r,setPurgeSuccess:s}){return!t&&!r?null:e.jsx("div",{className:"modal-backdrop modal-backdrop-high",children:e.jsxs("div",{className:"modal-container modal-container-small",onClick:l=>l.stopPropagation(),children:[e.jsx("h3",{className:"success-title",children:t?"Stats reset!":"Character purged!"}),e.jsx("p",{className:"success-message",children:t?"Your stats have been cleared.":"Character data has been purged."}),e.jsx("button",{onClick:t?i:()=>s(!1),className:"success-button",children:"Close"})]})})}function Lt({showPitchedModal:t,setShowPitchedModal:i,pitchedModalItem:r,pitchedModalDetails:s}){return!t||!r?null:e.jsx("div",{className:"pitched-details-modal-backdrop",onClick:()=>i(!1),style:{zIndex:9999},children:e.jsxs("div",{className:"pitched-details-modal pitched-details-modal-visible",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"pitched-details-modal-header",children:[e.jsx("button",{className:"pitched-details-modal-close",onClick:()=>i(!1),title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"currentColor"})})}),e.jsxs("div",{className:"pitched-details-modal-item-showcase",children:[e.jsx("img",{src:r.image,alt:r.name,className:"pitched-details-modal-item-img"}),e.jsxs("div",{className:"pitched-details-modal-item-info",children:[e.jsx("h2",{className:"pitched-details-modal-title",children:r.name}),e.jsxs("div",{className:"pitched-details-modal-subtitle",children:[e.jsx("span",{className:"pitched-details-modal-count",children:s.length}),e.jsx("span",{className:"pitched-details-modal-acquired",children:s.length===1?"time obtained":"times obtained"})]})]})]})]}),e.jsxs("div",{className:"pitched-details-modal-content",children:[e.jsxs("div",{className:"pitched-details-section-header",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})}),e.jsx("h3",{children:"Acquisition History"})]}),e.jsx("div",{className:"pitched-details-acquisition",children:s.length===0?e.jsx("div",{className:"empty-state",children:"None this year."}):e.jsx("div",{className:"pitched-details-table-container",children:e.jsxs("table",{className:"pitched-details-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Character"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:s.map((l,m)=>e.jsxs("tr",{className:`pitched-details-row ${m%2===0?"even-row":"odd-row"}`,children:[e.jsx("td",{children:l.char}),e.jsx("td",{children:e.jsx("span",{className:"date-value",children:l.date})})]},m))})]})})})]})]})})}function It({statsManagement:t,weekNavigation:i,pitchedChecked:r,setPitchedChecked:s,userInteractionRef:l,setError:m,characterBossSelections:v,selectedCharIdx:f,cloudPitchedItems:C}){var c;return e.jsxs(e.Fragment,{children:[e.jsx(jt,{showStats:t.showStats,setShowStats:t.setShowStats,allYears:t.allYears,selectedYear:t.selectedYear,setSelectedYear:t.setSelectedYear,groupedYearlyPitchedItems:t.groupedYearlyPitchedItems,isLoadingCloudStats:t.isLoadingCloudStats,setShowStatsResetConfirm:t.setShowStatsResetConfirm,handleItemDetailClick:t.handleItemDetailClick}),e.jsx(bt,{showItemDetailModal:t.showItemDetailModal,setShowItemDetailModal:t.setShowItemDetailModal,selectedItemDetail:t.selectedItemDetail}),e.jsx(St,{showStatsResetConfirm:t.showStatsResetConfirm,setShowStatsResetConfirm:t.setShowStatsResetConfirm,onConfirm:()=>t.handleStatsReset(m)}),e.jsx(_t,{showCharacterPurgeConfirm:t.showCharacterPurgeConfirm,setShowCharacterPurgeConfirm:t.setShowCharacterPurgeConfirm,purgeTargetCharacter:t.purgeTargetCharacter,purgeInProgress:t.purgeInProgress,onConfirm:()=>t.handleCharacterPurge(r,s,i.selectedWeekKey,l,m)}),e.jsx(Et,{resetSuccessVisible:t.resetSuccessVisible,closeResetSuccess:t.closeResetSuccess,purgeSuccess:t.purgeSuccess,setPurgeSuccess:t.setPurgeSuccess}),t.showHistoricalPitchedModal&&e.jsx("div",{className:"modal-backdrop",onClick:()=>t.setShowHistoricalPitchedModal(!1),children:e.jsx(Nt,{data:t.historicalPitchedData,characterBossSelections:v,onClose:()=>t.setShowHistoricalPitchedModal(!1),onConfirm:t.handleHistoricalPitchedConfirm,pitchedChecked:r})}),e.jsx(Ct,{isOpen:t.showCharacterPitchedModal,onClose:()=>t.setShowCharacterPitchedModal(!1),characterName:((c=v[f])==null?void 0:c.name)||"",cloudPitchedItems:C,setPitchedModalItem:t.setPitchedModalItem,setShowPitchedModal:t.setShowPitchedModal}),e.jsx(Lt,{showPitchedModal:t.showPitchedModal,setShowPitchedModal:t.setShowPitchedModal,pitchedModalItem:t.pitchedModalItem,pitchedModalDetails:t.pitchedModalDetails})]})}function Dt(t,i,r=null){const[s,l]=n.useState(i||Se()),[m,v]=n.useState({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[],analysis:null}),[f,C]=n.useState(!1);n.useEffect(()=>{i&&i!==s&&(h.info("useWeekNavigation: App week key differs from selected, updating",{appWeekKey:i,selectedWeekKey:s}),l(i))},[i]);const c=s!==(i||Se()),p=n.useCallback(async()=>{var E;if(!t||f)return;try{const{STORAGE_KEYS:j}=await J(async()=>{const{STORAGE_KEYS:I}=await import("./index-CnSjvSrJ.js").then(b=>b.k);return{STORAGE_KEYS:I}},__vite__mapDeps([0,1,2,3,4,5])),S=localStorage.getItem(j.USER_CODE);if(!S||S!==t){h.debug("useWeekNavigation: Skipping analysis refresh - logout in progress",{userCode:t,storedCode:S});return}}catch(j){h.error("useWeekNavigation: Error checking auth state for analysis",{error:j});return}const L=Se();try{C(!0),h.debug("useWeekNavigation: Refreshing historical analysis",{userCode:t,realCurrentWeek:L,selectedCharacterName:r});const j=r?await et(t,r):await tt(t);j.success?(v({hasHistoricalData:j.hasHistoricalData,oldestHistoricalWeek:j.oldestHistoricalWeek,userType:j.userType,adaptiveWeekLimit:j.adaptiveWeekLimit,historicalWeeks:j.historicalWeeks,analysis:j.analysis}),h.debug("useWeekNavigation: Historical analysis refreshed",{userType:j.userType,hasData:j.hasHistoricalData,oldestWeek:j.oldestHistoricalWeek,adaptiveLimit:j.adaptiveWeekLimit,historicalWeeksCount:((E=j.historicalWeeks)==null?void 0:E.length)||0,characterSpecific:!!r})):h.error("useWeekNavigation: Error in historical analysis result",j.error)}catch(j){h.error("useWeekNavigation: Error refreshing historical analysis",j)}finally{C(!1)}},[t,f,r]),k=n.useCallback(L=>{L!==s&&(h.info("useWeekNavigation: Week changed",{from:s,to:L}),l(L),t&&(async()=>{try{const{STORAGE_KEYS:j}=await J(async()=>{const{STORAGE_KEYS:I}=await import("./index-CnSjvSrJ.js").then(b=>b.k);return{STORAGE_KEYS:I}},__vite__mapDeps([0,1,2,3,4,5])),S=localStorage.getItem(j.USER_CODE);S&&S===t?setTimeout(()=>{p()},100):h.debug("useWeekNavigation: Skipping week change analysis - logout in progress")}catch(j){h.error("useWeekNavigation: Error checking auth for week change",{error:j})}})())},[s,t,p]);return n.useEffect(()=>{t?(async()=>{try{const{STORAGE_KEYS:E}=await J(async()=>{const{STORAGE_KEYS:S}=await import("./index-CnSjvSrJ.js").then(I=>I.k);return{STORAGE_KEYS:S}},__vite__mapDeps([0,1,2,3,4,5])),j=localStorage.getItem(E.USER_CODE);if(j&&j===t){h.debug("useWeekNavigation: Loading historical analysis for user",{userCode:t});const S=setTimeout(()=>{t&&localStorage.getItem(E.USER_CODE)===t&&p()},150);return()=>clearTimeout(S)}else h.debug("useWeekNavigation: Skipping load - logout in progress or userCode mismatch",{userCode:t,storedCode:j})}catch(E){h.error("useWeekNavigation: Error checking auth state",{error:E})}})():(h.debug("useWeekNavigation: Clearing analysis state for logout"),v({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[],analysis:null}),C(!1))},[t,r,p]),{selectedWeekKey:s,isHistoricalWeek:c,handleWeekChange:k,historicalAnalysis:m,refreshHistoricalAnalysis:p,isLoadingAnalysis:f}}function Pt(t,i=null){const[r,s]=n.useState({}),[l,m]=n.useState([]),[v,f]=n.useState({}),[C,c]=n.useState(!1),p=n.useRef(!1),k=n.useCallback(async()=>{if(t)try{c(!0);const a=await Ne(t,{});if(a.success){m(a.items);const{getCurrentWeekKey:o}=await J(async()=>{const{getCurrentWeekKey:u}=await import("./index-CnSjvSrJ.js").then(w=>w.w);return{getCurrentWeekKey:u}},__vite__mapDeps([0,1,2,3,4,5])),g=o(),x=i||g;h.debug("usePitchedItems: Current week info",{currentAppWeekKey:g,currentViewingWeekKey:x,selectedWeekKey:i,totalItems:a.items.length});const d={};a.items.forEach(u=>{const w=de(u.date);if(w===x){const N=`${u.charId}__${u.bossName}__${u.item}__${w}`;d[N]=!0}}),h.debug("usePitchedItems: Loaded pitched items with week filtering",{totalItemsInDatabase:a.items.length,checkedKeysForCurrentWeek:Object.keys(d).length,currentViewingWeekKey:x,sampleCheckedKeys:Object.keys(d).slice(0,3),itemsInCurrentWeek:a.items.filter(u=>de(u.date)===x).length,itemsInOtherWeeks:a.items.filter(u=>de(u.date)!==x).length}),s(d)}else h.error("usePitchedItems: Failed to refresh pitched items",a.error)}catch(a){h.error("usePitchedItems: Error refreshing pitched items",a)}finally{c(!1)}},[t,i]),L=n.useCallback(async(a,o,g,x=null)=>{if(!t)return h.warn("usePitchedItems: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};const d=x||new Date().toISOString().split("T")[0],u=de(d),w=`${a}__${o}__${g}__${u}`;if(r[w])return h.info("usePitchedItems: Item already exists, skipping add",{key:w,existingChecked:!!r[w],charId:a,bossName:o,item:g,itemWeekKey:u}),{success:!0,message:"Item already exists"};h.debug("usePitchedItems: Adding new pitched item",{key:w,charId:a,bossName:o,item:g,itemWeekKey:u,pitchedCheckedKeys:Object.keys(r).length});const D=await Te(t,{charId:a,bossName:o,item:g,date:d});if(D.success){const H=D.pitchedItem;return m(P=>[...P,H]),s(P=>({...P,[w]:!0})),{success:!0}}else throw new Error(D.error)},[t,r]),E=n.useCallback(async(a,o,g,x=null)=>{if(!t)return h.warn("usePitchedItems: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};h.debug("usePitchedItems: Attempting to remove pitched item",{charId:a,bossName:o,item:g,providedDate:x,cloudItemsCount:l.length});let d=x;if(d){if(!l.find(N=>N.charId===a&&N.bossName===o&&N.item===g&&N.date===x)){h.warn("usePitchedItems: Exact date match not found",{charId:a,bossName:o,item:g,targetDate:x,availableItemsForCharacter:l.filter(D=>D.charId===a).map(D=>({bossName:D.bossName,item:D.item,date:D.date}))});const N=l.filter(D=>D.charId===a&&D.bossName===o&&D.item===g);if(N.length>0)h.info("usePitchedItems: Found alternative matches, using most recent",{alternativeCount:N.length,alternatives:N.map(D=>D.date)}),N.sort((D,H)=>new Date(H.date)-new Date(D.date)),d=N[0].date;else throw h.error("usePitchedItems: No alternative matches found"),new Error("Pitched item not found")}}else{const w=l.filter(N=>N.charId===a&&N.bossName===o&&N.item===g);if(h.debug("usePitchedItems: Searching for matching items without date",{matchingItemsCount:w.length,matchingItems:w.map(N=>({charId:N.charId,bossName:N.bossName,item:N.item,date:N.date}))}),w.length>0)w.sort((N,D)=>new Date(D.date)-new Date(N.date)),d=w[0].date,h.debug("usePitchedItems: Found most recent item",{targetDate:d});else return h.info("usePitchedItems: No matching items found to remove",{charId:a,bossName:o,item:g,availableItems:l.map(N=>({charId:N.charId,bossName:N.bossName,item:N.item,date:N.date})).slice(0,5)}),{success:!0,message:"No items to remove"}}h.debug("usePitchedItems: Proceeding with removal",{charId:a,bossName:o,item:g,targetDate:d});const u=await $e(t,a,o,g,d);if(u.success){m(D=>D.filter(H=>!(H.charId===a&&H.bossName===o&&H.item===g&&H.date===d)));const w=de(d),N=`${a}__${o}__${g}__${w}`;return s(D=>{const H={...D};return delete H[N],H}),h.info("usePitchedItems: Successfully removed pitched item",{charId:a,bossName:o,item:g,targetDate:d,removedKey:N}),{success:!0}}else throw new Error(u.error)},[t,l]),j=n.useCallback(async a=>{if(!t)throw new Error("No user ID provided");const o=await Me(t,a);if(o.success)return m(g=>{let x=[...g];return a.forEach(({charId:d,bossName:u,item:w,date:N})=>{if(N)x=x.filter(D=>!(D.charId===d&&D.bossName===u&&D.item===w&&D.date===N));else{const D=x.findLastIndex(H=>H.charId===d&&H.bossName===u&&H.item===w);D!==-1&&x.splice(D,1)}}),x}),s(g=>{const x={...g};return a.forEach(({charId:d,bossName:u,item:w,date:N})=>{if(N){const D=de(N),H=`${d}__${u}__${w}__${D}`;delete x[H]}else Object.keys(x).forEach(D=>{D.startsWith(`${d}__${u}__${w}__`)&&delete x[D]})}),x}),{success:!0,removedCount:o.removedCount};throw new Error(o.error)},[t]),S=n.useCallback(async a=>{if(!t)throw new Error("No user ID provided");const o=await Re(t,a);if(o.success)return m(g=>g.filter(x=>de(x.date)!==a)),s(g=>{const x={...g};return Object.keys(x).forEach(d=>{d.endsWith(`__${a}`)&&delete x[d]}),x}),{success:!0,removedCount:o.removedCount};throw new Error(o.error)},[t]),I=n.useCallback(async(a=null)=>{if(!t)throw new Error("No user ID provided");const o=await je(t,a);if(o.success)return{success:!0,stats:o.stats};throw new Error(o.error)},[t]),b=n.useCallback(async()=>{if(!t)throw new Error("No user ID provided");const a=await He(t);if(a.success)return m([]),s({}),{success:!0,removedCount:a.removedCount};throw new Error(a.error)},[t]);return n.useEffect(()=>{t?(async()=>{try{const{STORAGE_KEYS:o}=await J(async()=>{const{STORAGE_KEYS:x}=await import("./index-CnSjvSrJ.js").then(d=>d.k);return{STORAGE_KEYS:x}},__vite__mapDeps([0,1,2,3,4,5])),g=localStorage.getItem(o.USER_CODE);g&&g===t?(h.debug("usePitchedItems: Loading pitched items for user",{userId:t}),k()):h.debug("usePitchedItems: Skipping load - logout in progress or userId mismatch",{userId:t,storedCode:g})}catch(o){h.error("usePitchedItems: Error checking auth state",{error:o})}})():(h.debug("usePitchedItems: Clearing state for logout"),m([]),s({}),c(!1))},[t,k]),{pitchedChecked:r,setPitchedChecked:s,cloudPitchedItems:l,setCloudPitchedItems:m,userInteractionRef:p,refreshPitchedItems:k,loadingPitchedItems:v,setLoadingPitchedItems:f,isRefreshingPitchedItems:C,addNewPitchedItem:L,removePitchedItemByDetails:E,removeManyPitchedItemsByDetails:j,clearWeekPitchedItems:S,getYearlyStats:I,purgeAllItems:b}}function Wt({userId:t=null,characterBossSelections:i=[],selectedCharIdx:r=0,checked:s={},setChecked:l=()=>{},setCrystalAnimation:m=()=>{},setError:v=()=>{},onDataChange:f=()=>{},isHistoricalWeek:C=!1,onBossUncheckStart:c=()=>{},onBossUncheckEnd:p=()=>{}}){const[k,L]=n.useState(!1),E=n.useRef(!1),j=n.useRef(0),S=n.useCallback(async(a,o,g)=>{if(k||!t){h.info("useBossActions: Boss check skipped",{isUpdating:k,hasUserId:!!t});return}if(r==null){h.debug("useBossActions: Boss check skipped",{reason:"No character selected",characterIdx:r,bossName:a.name,difficulty:a.difficulty});return}if(C){h.debug("useBossActions: Boss check skipped for historical week");return}L(!0),E.current=!0;try{h.debug("useBossActions: Boss check initiated",{bossName:a.name,difficulty:a.difficulty,isChecked:o,characterIdx:r});const x=i[r];if(!x)throw new Error("No character selected");const d=`${x.name}-${r}`,u=`${a.name}-${a.difficulty}`;l(y=>{const _={...y};return _[d]||(_[d]={}),_[d]={..._[d]},o?_[d][u]=!0:delete _[d][u],_}),h.debug("useBossActions: Boss check details",{charName:x.name,charIdx:r,bossName:a.name,difficulty:a.difficulty}),h.debug("useBossActions: Converting boss to registry ID",{bossName:a.name,difficulty:a.difficulty});const w=await ot(a.name,a.difficulty);h.debug("useBossActions: Boss registry ID obtained",w);const{toggleBossClearStatus:N}=await J(async()=>{const{toggleBossClearStatus:y}=await import("./userWeeklyDataService-CnD16_tc.js");return{toggleBossClearStatus:y}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:D}=await J(async()=>{const{getCurrentMapleWeekStartDate:y}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:y}},[]),H=D(),P={userId:t,characterName:x.name,characterIndex:x.index.toString(),bossRegistryId:w,isCompleted:o,weekKey:H};h.debug("useBossActions: Updating database",{userId:t,characterName:x.name,characterIndex:x.index.toString(),bossRegistryId:w,isCompleted:o,weekKey:H});const B=await N(t,H,x.index.toString(),w,o);if(h.debug("useBossActions: Database update result",B),!B.success)throw new Error(B.error||"Failed to update boss completion");if(!o){c();try{h.info("useBossActions: Boss unchecked - removing associated pitched items",{characterName:x.name,bossName:a.name,difficulty:a.difficulty});const{removeManyPitchedItems:y}=await J(async()=>{const{removeManyPitchedItems:Q}=await Promise.resolve().then(()=>xe);return{removeManyPitchedItems:Q}},void 0),{getCurrentWeekKey:_,convertWeekKeyToDate:G,getWeekDateRange:X}=await J(async()=>{const{getCurrentWeekKey:Q,convertWeekKeyToDate:M,getWeekDateRange:ne}=await import("./index-CnSjvSrJ.js").then(ce=>ce.w);return{getCurrentWeekKey:Q,convertWeekKeyToDate:M,getWeekDateRange:ne}},__vite__mapDeps([0,1,2,3,4,5])),V=_(),te=G(V),O=X(V);h.info("useBossActions: Week date analysis",{currentWeek:V,currentWeekDate:te,currentWeekRange:{start:O.start,end:O.end}});const T=[],{getPitchedItems:ie}=await J(async()=>{const{getPitchedItems:Q}=await Promise.resolve().then(()=>xe);return{getPitchedItems:Q}},void 0),Y=await ie(t,{});if(h.info("useBossActions: Retrieved pitched items for removal check",{success:Y.success,totalItems:Y.success?Y.items.length:0,userId:t,currentWeekDate:te}),Y.success){Y.items.forEach((M,ne)=>{const ce=M.date?new Date(M.date):null,he=M.date===null||ce&&ce>=O.start&&ce<=O.end;h.info(`useBossActions: Item ${ne} - Character comparison: "${M.charId}" === "${x.name}" = ${M.charId===x.name}`),h.info(`useBossActions: Item ${ne} - Boss comparison: "${M.bossName}" === "${a.name}" = ${M.bossName===a.name}`),h.info(`useBossActions: Item ${ne} - Date analysis: ${M.date} (as Date: ${ce}) in range ${O.start} to ${O.end} OR null = ${he}`),h.info(`useBossActions: Item ${ne} - Overall match: ${M.charId===x.name&&M.bossName===a.name&&he}`)});const Q=Y.items.filter(M=>{const ne=M.date?new Date(M.date):null,ce=M.date===null||ne&&ne>=O.start&&ne<=O.end;return M.charId===x.name&&M.bossName===a.name&&ce});if(h.info("useBossActions: Filtered items for removal",{totalItemsFromDB:Y.items.length,filteredItems:Q.length,filterCriteria:{charId:x.name,bossName:a.name,date:te,alsoMatchingNull:!0},allItemsFromDB:Y.items.map(M=>({charId:M.charId,bossName:M.bossName,item:M.item,date:M.date})),filteredItemDetails:Q.map(M=>({charId:M.charId,bossName:M.bossName,item:M.item,date:M.date}))}),Q.forEach(M=>{T.push({charId:M.charId,bossName:M.bossName,item:M.item,date:M.date})}),T.length>0){h.info("useBossActions: Removing pitched items for unchecked boss",{characterName:x.name,bossName:a.name,itemsToRemove:T.length,itemDetails:T});const M=await y(t,T);h.info("useBossActions: Pitched items removal result",{success:M.success,error:M.error,removedCount:M.removedCount,attemptedRemovalCount:T.length}),M.success?(h.info("useBossActions: Successfully removed pitched items",{removedCount:M.removedCount,originalCount:T.length}),f&&f()):h.warn("useBossActions: Failed to remove some pitched items",{error:M.error,itemsToRemove:T})}else h.info("useBossActions: No pitched items found to remove",{characterName:x.name,bossName:a.name,currentWeekDate:te,totalItemsInDB:Y.items.length})}}catch(y){h.warn("useBossActions: Failed to remove pitched items for unchecked boss",{error:y,characterName:x.name,bossName:a.name})}finally{p()}}l(y=>{const _={...y};return _[d]||(_[d]={}),_[d]={..._[d]},o?_[d][u]=!0:delete _[d][u],_}),h.debug("useBossActions: Boss check completed successfully"),j.current=Date.now()}catch(x){h.error("useBossActions: Error handling boss check",x),v(x.message),l(d=>{const u={...d},w=i[r];if(w){const N=`${w.name}-${r}`,D=`${a.name}-${a.difficulty}`;u[N]||(u[N]={}),u[N]={...u[N]},o?delete u[N][D]:u[N][D]=!0}return u})}finally{L(!1)}},[t,i,r,s,l,m,v,f,k,C,c,p]),I=n.useCallback(async()=>{if(!(!t||C||k)){L(!0),E.current=!0;try{const a=i[r];if(!a)throw new Error("No character selected");const o=`${a.name}-${r}`,g=a.bosses||[],d=!g.every(B=>{var y;return(y=s[o])==null?void 0:y[`${B.name}-${B.difficulty}`]}),u={...s};l(B=>{const y={...B};y[o]||(y[o]={}),y[o]={...y[o]};for(const _ of g){const G=`${_.name}-${_.difficulty}`;d?y[o][G]=!0:delete y[o][G]}return y});const{clearAllBossesForCharacter:w,markAllBossesForCharacter:N}=await J(async()=>{const{clearAllBossesForCharacter:B,markAllBossesForCharacter:y}=await import("./userWeeklyDataService-CnD16_tc.js");return{clearAllBossesForCharacter:B,markAllBossesForCharacter:y}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:D}=await J(async()=>{const{getCurrentMapleWeekStartDate:B}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:B}},[]),H=D();let P;if(d?(h.debug("useBossActions: Marking all bosses as cleared",{characterIdx:a.index,bossCount:g.length,weekKey:H}),P=await N(t,H,a.index.toString())):(h.debug("useBossActions: Clearing all bosses",{characterIdx:a.index,bossCount:g.length,weekKey:H}),P=await w(t,H,a.index.toString())),!P.success)h.error("useBossActions: Bulk operation failed",{action:d?"markAll":"clearAll",error:P.error}),l(u),v(`Failed to ${d?"mark all bosses as completed":"clear all boss completions"}. Please try again.`);else{if(!d){c();try{h.info("useBossActions: All bosses cleared - removing all pitched items for character",{characterName:a.name,bossCount:g.length});const{getPitchedItems:B,removeManyPitchedItems:y}=await J(async()=>{const{getPitchedItems:O,removeManyPitchedItems:T}=await Promise.resolve().then(()=>xe);return{getPitchedItems:O,removeManyPitchedItems:T}},void 0),{getCurrentWeekKey:_}=await J(async()=>{const{getCurrentWeekKey:O}=await import("./index-CnSjvSrJ.js").then(T=>T.w);return{getCurrentWeekKey:O}},__vite__mapDeps([0,1,2,3,4,5])),{convertWeekKeyToDate:G}=await J(async()=>{const{convertWeekKeyToDate:O}=await import("./index-CnSjvSrJ.js").then(T=>T.w);return{convertWeekKeyToDate:O}},__vite__mapDeps([0,1,2,3,4,5])),X=_(),V=G(X),te=await B(t,{});if(te.success){const O=te.items.filter(T=>T.charId===a.name&&T.date===V);if(O.length>0){const T=O.map(Y=>({charId:Y.charId,bossName:Y.bossName,item:Y.item,date:Y.date}));h.info("useBossActions: Removing all pitched items for character",{characterName:a.name,itemsToRemove:T.length});const ie=await y(t,T);ie.success?h.info("useBossActions: Successfully removed all pitched items for character",{removedCount:ie.removedCount}):h.warn("useBossActions: Failed to remove some pitched items during clear all",{error:ie.error})}}}catch(B){h.warn("useBossActions: Failed to remove pitched items during clear all",{error:B,characterName:a.name})}finally{p()}}await f(),h.debug("useBossActions: Tick all completed successfully",{characterIdx:a.index,allTicked:d,processedBosses:g.length})}}catch(a){h.error("useBossActions: Error handling tick all",a),v(a.message),l(o=>{const g=i[r];if(!g)return o;const x=`${g.name}-${r}`,d=o[x]||{};return{...o,[x]:{...d}}})}finally{L(!1)}}},[t,i,r,s,l,v,f,k,C,c,p]);return{handleCheck:S,handleTickAll:I,refreshCheckedStateFromDatabase:async()=>{try{return t?(f&&f(),!0):null}catch(a){return console.error("Error refreshing checked state:",a),null}},isUpdating:k,userInteractionRef:E,lastUpdate:j.current}}const Tt=t=>{const i=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling","Limbo"];for(const r of i){const l=be(r).find(m=>m.name===t);if(l)return l.image}return"/items/crystal.png"};function $t(t,i){const[r,s]=n.useState(!1),[l,m]=n.useState(!1),[v,f]=n.useState({monthly:[],yearly:[]}),[C,c]=n.useState(!1),[p,k]=n.useState(null),[L,E]=n.useState(!1),[j,S]=n.useState(!1),[I,b]=n.useState([]),[a,o]=n.useState(!1),[g,x]=n.useState({}),[d,u]=n.useState(!1),[w,N]=n.useState(null),[D,H]=n.useState(!1),[P,B]=n.useState(!1),[y,_]=n.useState(!1),[G,X]=n.useState(null),[V,te]=n.useState(!1),[O,T]=n.useState(null),ie=n.useMemo(()=>{const $=ve(),A=new Set([$]);return v!=null&&v.yearly&&Array.isArray(v.yearly)&&v.yearly.forEach(F=>A.add(F.yearKey)),g&&Object.keys(g).forEach(F=>A.add(F)),Array.from(A).sort((F,W)=>W.localeCompare(F))},[v==null?void 0:v.yearly,g]),[Y,Q]=n.useState(()=>ve());n.useEffect(()=>{(ie==null?void 0:ie.length)>0&&!ie.includes(Y)&&Q(ie[0])},[ie,Y]),n.useEffect(()=>{if(!r||!t)return;(async()=>{try{const{STORAGE_KEYS:A}=await J(async()=>{const{STORAGE_KEYS:W}=await import("./index-CnSjvSrJ.js").then(K=>K.k);return{STORAGE_KEYS:W}},__vite__mapDeps([0,1,2,3,4,5])),F=localStorage.getItem(A.USER_CODE);if(!F||F!==t){h.debug("useStatsManagement: Skipping cloud stats fetch - logout in progress",{userCode:t,storedCode:F});return}}catch(A){console.error("useStatsManagement: Error checking auth state for stats fetch",{error:A});return}try{u(!0);const A=parseInt(Y,10),F=await je(t,A),{STORAGE_KEYS:W}=await J(async()=>{const{STORAGE_KEYS:ee}=await import("./index-CnSjvSrJ.js").then(Z=>Z.k);return{STORAGE_KEYS:ee}},__vite__mapDeps([0,1,2,3,4,5])),K=localStorage.getItem(W.USER_CODE);if(!K||K!==t){h.debug("useStatsManagement: Skipping result processing - logout occurred during fetch");return}F.success&&x(ee=>({...ee,[Y]:F.stats}))}catch(A){console.error("Error fetching cloud pitched stats:",A)}finally{const{STORAGE_KEYS:A}=await J(async()=>{const{STORAGE_KEYS:W}=await import("./index-CnSjvSrJ.js").then(K=>K.k);return{STORAGE_KEYS:W}},__vite__mapDeps([0,1,2,3,4,5])),F=localStorage.getItem(A.USER_CODE);F&&F===t&&u(!1)}})()},[r,t,Y]);const M=n.useMemo(()=>{if(!Y||!g)return[];const $=g[Y];if(!($!=null&&$.items)||!Array.isArray($.items))return[];const A=new Map;return $.items.filter(W=>(W==null?void 0:W.item)&&(W==null?void 0:W.charId)&&(W==null?void 0:W.date)).forEach(W=>{const K=W.item;A.has(K)||A.set(K,{itemName:K,itemImage:Tt(K),count:0,instances:[]});const ee=A.get(K);ee.count+=1;const Z=new Date(W.date),oe=Ve[Z.getUTCMonth()],q=Z.getUTCDate();ee.instances.push({charId:W.charId,fullDate:W.date,displayDate:`${oe} ${q}`,sortDate:Z.getTime()})}),Array.from(A.values()).map(W=>({...W,instances:W.instances.sort((K,ee)=>ee.sortDate-K.sortDate)})).sort((W,K)=>K.count!==W.count?K.count-W.count:W.itemName.localeCompare(K.itemName))},[Y,g]),ne=async($,A,F,W,K)=>{if(p)try{E(!0);const{name:ee,idx:Z}=p;W.current=!0;const oe=rt($,ee,Z,F);if(A(oe),(await at(t,ee,Z)).success){x({}),await i(t);const re=await je(t);if(re.success){const pe=ve();x({[pe]:re.stats})}S(!0),c(!1);const fe=await it(t);fe.success&&b(fe.history),setTimeout(()=>{S(!1)},3e3)}else K("Failed to purge character data. Please try again.")}catch(ee){console.error("Error in handleCharacterPurge:",ee),K("Failed to purge character data. Please try again.")}finally{E(!1),setTimeout(()=>{W.current=!1},1e3)}},ce=async $=>{try{if(f({monthly:[],yearly:[]}),Q(ve()),t)if((await st(t)).success)x({}),await i(t);else{$("Failed to reset stats data. Please try again.");return}m(!1),o(!0),setTimeout(()=>{o(!1),s(!1)},3400)}catch(A){console.error("Error in stats reset:",A),$("Failed to reset stats data. Please try again.")}},he=()=>{o(!1),s(!1)},R=n.useMemo(()=>w?w.history||[]:[],[w]);function z(){h.silence("Stats tracking is now cloud-based - no action needed")}return{showStats:r,setShowStats:s,showStatsResetConfirm:l,setShowStatsResetConfirm:m,statsPanel:v,setStatsPanel:f,showCharacterPurgeConfirm:C,setShowCharacterPurgeConfirm:c,purgeTargetCharacter:p,setPurgeTargetCharacter:k,purgeInProgress:L,purgeSuccess:j,setPurgeSuccess:S,auditHistory:I,resetSuccessVisible:a,closeResetSuccess:he,cloudPitchedStats:g,setCloudPitchedStats:x,isLoadingCloudStats:d,pitchedModalItem:w,setPitchedModalItem:N,showPitchedModal:D,setShowPitchedModal:H,showCharacterPitchedModal:P,setShowCharacterPitchedModal:B,pitchedModalDetails:R,showItemDetailModal:y,setShowItemDetailModal:_,selectedItemDetail:G,setSelectedItemDetail:X,showHistoricalPitchedModal:V,setShowHistoricalPitchedModal:te,historicalPitchedData:O,setHistoricalPitchedData:T,allYears:ie,selectedYear:Y,setSelectedYear:Q,groupedYearlyPitchedItems:M,handleCharacterPurge:ne,handleStatsReset:ce,startStatsTrackingIfNeeded:z,handleHistoricalPitchedConfirm:async($,A)=>{try{if(!O)throw new Error("No historical pitched data available");const{itemName:F,bossName:W,weekKey:K}=O;h.userAction("Adding historical pitched item",`${F} for ${W} by ${A}`);const{addPitchedItem:ee}=await J(async()=>{const{addPitchedItem:q}=await Promise.resolve().then(()=>xe);return{addPitchedItem:q}},void 0),Z={charId:A,bossName:W,item:F,date:$.split("T")[0]},oe=await ee(t,Z);if(oe.success)return h.silence("Historical pitched item added successfully"),te(!1),T(null),i&&await i(),{success:!0};throw new Error(oe.error||"Failed to add historical pitched item")}catch(F){throw h.error("Error handling historical pitched confirmation:",F),F}},handleHistoricalPitchedRemove:async($,A,F,W=null)=>{try{let K=W,ee=A;if(!K&&O&&(K=O.weekKey,ee||(ee=O.bossName)),!K)throw new Error("Week key not available for historical pitched item removal");if(!ee)throw new Error("Boss name not available for historical pitched item removal");h.userAction("Removing historical pitched item",`${F} from ${ee} by ${$}`);const{removePitchedItem:Z}=await J(async()=>{const{removePitchedItem:q}=await Promise.resolve().then(()=>xe);return{removePitchedItem:q}},void 0),oe=await Z(t,$,ee,F,null);if(oe.success)return h.silence("Historical pitched item removed successfully"),O&&(te(!1),T(null)),i&&await i(),{success:!0};throw new Error(oe.error||"Failed to remove historical pitched item")}catch(K){throw h.error("Error handling historical pitched removal:",K),K}},handleItemDetailClick:$=>{X($),_(!0)}}}function Mt(){const{userCode:t,isLoggedIn:i}=Pe(),[r,s]=n.useState(null),[l,m]=n.useState(()=>nt()),[v,f]=n.useState(!1),[C,c]=n.useState(""),[p,k]=n.useState(null),[L,E]=n.useState("");n.useEffect(()=>{if(!t||!i){s(null),c("");return}let d=!0;return(async()=>{try{f(!0),c("");const w=await Ie(t);if(!d)return;w.success?s(w.data):c(w.error||"Failed to load weekly data.")}catch(w){d&&(console.error("Failed to load weekly data:",w),c("Failed to load weekly data. Please try again."))}finally{d&&f(!1)}})(),()=>{d=!1}},[t,i,l]);const j=n.useCallback(async()=>{if(!(!t||!i))try{f(!0);const d=await Ie(t);d.success?(s(d.data),c("")):c(d.error||"Failed to refresh data.")}catch(d){console.error("Failed to refresh weekly data:",d),c("Failed to refresh data.")}finally{f(!1)}},[t,i]),S=n.useCallback(()=>!r||!r.char_map?[]:Object.entries(r.char_map).map(([d,u])=>{var w,N;return{index:parseInt(d),name:u,bossConfig:((w=r.boss_config)==null?void 0:w[d])||"",weeklyClears:((N=r.weekly_clears)==null?void 0:N[d])||""}}).sort((d,u)=>d.index-u.index),[r]),I=n.useCallback(async d=>{if(!t||!i)return c("Not logged in."),{success:!1,error:"Not logged in."};if(!(d!=null&&d.trim()))return c("Character name cannot be empty."),{success:!1,error:"Character name cannot be empty."};try{f(!0),c("");const u=await ct(t,l,d.trim());return u.success?(await j(),E(""),{success:!0,characterIndex:u.characterIndex}):(c(u.error||"Failed to add character."),u)}catch(u){console.error("Failed to add character:",u);const w="Failed to add character.";return c(w),{success:!1,error:w}}finally{f(!1)}},[t,i,l,j]),b=n.useCallback(async d=>{if(!t||!i)return c("Not logged in."),{success:!1,error:"Not logged in."};try{f(!0),c("");const u=await lt(t,l,d);return u.success?(await j(),p===d&&k(null),{success:!0}):(c(u.error||"Failed to remove character."),u)}catch(u){console.error("Failed to remove character:",u);const w="Failed to remove character.";return c(w),{success:!1,error:w}}finally{f(!1)}},[t,i,l,p,j]),a=n.useCallback(async(d,u)=>{if(!t||!i)return c("Not logged in."),{success:!1,error:"Not logged in."};try{f(!0),c("");const w=await dt(t,l,d,u);return w.success?(await j(),{success:!0}):(c(w.error||"Failed to update character name."),w)}catch(w){console.error("Failed to update character name:",w);const N="Failed to update character name.";return c(N),{success:!1,error:N}}finally{f(!1)}},[t,i,l,j]),o=n.useCallback(async(d,u)=>{if(!t||!i)return c("Not logged in."),{success:!1,error:"Not logged in."};try{f(!0),c("");const w=await ht(t,l,d,u);return w.success?(await j(),{success:!0}):(c(w.error||"Failed to update boss configuration."),w)}catch(w){console.error("Failed to update boss configuration:",w);const N="Failed to update boss configuration.";return c(N),{success:!1,error:N}}finally{f(!1)}},[t,i,l,j]),g=n.useCallback(d=>S().find(w=>w.index===d)||null,[S]),x=n.useCallback((d,u=null)=>S().some(N=>N.name.toLowerCase()===d.toLowerCase()&&N.index!==u),[S]);return{weeklyData:r,currentWeekStart:l,isLoading:v,error:C,setError:c,characters:S(),selectedCharacterIndex:p,setSelectedCharacterIndex:k,newCharacterName:L,setNewCharacterName:E,refreshWeeklyData:j,addCharacter:I,removeCharacter:b,updateCharacterName:a,updateCharacterBossConfig:o,getCharacterByIndex:g,characterNameExists:x,fetchWeeklyData:(d,u)=>ut(d,u),saveWeeklyData:(d,u,w)=>mt(d,u,w)}}function Rt({characterBossSelections:t,bossData:i,checked:r,setChecked:s,userCode:l,appWeekKey:m,showOnboardingIndicators:v}){var he;const{lastWeeklyResetTimestamp:f}=We(),{refreshWeeklyData:C}=Mt();function c(R,z){const se=i.find(ae=>ae.name===R);if(!se)return 0;const U=se.difficulties.find(ae=>ae.difficulty===z);return U?U.price:0}const[p,k]=n.useState(!0),[L,E]=n.useState([]),[j,S]=n.useState(0),[I,b]=n.useState(null),[a,o]=n.useState(!1),g=n.useRef(!1),[x,d]=n.useState(()=>{const R=localStorage.getItem(ue.WEEKLY_HIDE_COMPLETED);return R?JSON.parse(R):!1});n.useEffect(()=>{localStorage.setItem(ue.WEEKLY_HIDE_COMPLETED,JSON.stringify(x))},[x]),n.useEffect(()=>{if(t.length)o(!1);else{o(!1);const R=setTimeout(()=>{o(!0)},2e3);return()=>clearTimeout(R)}},[t.length]);const u=Dt(l,m,(he=t[j])==null?void 0:he.name),{pitchedChecked:w,setPitchedChecked:N,cloudPitchedItems:D,refreshPitchedItems:H,userInteractionRef:P,addNewPitchedItem:B,removePitchedItemByDetails:y}=Pt(l||null,u.selectedWeekKey),_=Wt({userId:l,characterBossSelections:t,selectedCharIdx:j,checked:r,setChecked:s,setCrystalAnimations:E,setError:b,onDataChange:()=>{C(),H()},isHistoricalWeek:u.isHistoricalWeek,onBossUncheckStart:()=>{g.current=!0},onBossUncheckEnd:()=>{setTimeout(()=>{g.current=!1},500)}}),G=$t(l,H);n.useEffect(()=>{if(l){const R=localStorage.getItem(ue.USER_CODE);if(!R||R!==l){h.debug("WeeklyTracker: Skipping data refresh - logout in progress");return}h.debug("WeeklyTracker: Refreshing data on mount/user change"),H(),C()}},[l,H,C]),n.useEffect(()=>{if(f>0&&l){const R=localStorage.getItem(ue.USER_CODE);if(!R||R!==l){h.debug("WeeklyTracker: Skipping weekly reset refresh - logout in progress");return}h.debug("WeeklyTracker: Detected weekly reset, refreshing pitched items.");const z=setTimeout(()=>{l&&localStorage.getItem(ue.USER_CODE)===l&&H()},500);return()=>clearTimeout(z)}},[f,l,H]);const X=R=>{h.debug("WeeklyTracker: Week changed",{from:u.selectedWeekKey,to:R,isHistorical:u.isHistoricalWeek}),u.handleWeekChange(R),u.refreshHistoricalAnalysis&&u.refreshHistoricalAnalysis(),H()};n.useEffect(()=>{j>=t.length&&S(Math.max(0,t.length-1))},[t.length,j]);const V=t[j],te=`${(V==null?void 0:V.name)||""}-${j}`,O=(V==null?void 0:V.bosses)||[],T=[...O].sort((R,z)=>{try{const se=c(R.name,R.difficulty)/(R.partySize||1);return c(z.name,z.difficulty)/(z.partySize||1)-se}catch(se){return h.error("WeeklyTracker: Error sorting bosses",se),b(`Error sorting bosses: ${se.message}`),0}}),ie=t.reduce((R,z,se)=>{const U=`${(z==null?void 0:z.name)||""}-${se}`;return R+(z.bosses||[]).reduce((ae,$)=>{var A;return(A=r[U])!=null&&A[$.name+"-"+$.difficulty]?ae+c($.name,$.difficulty)/($.partySize||1):ae},0)},0),Y=t.reduce((R,z)=>R+(z.bosses||[]).reduce((se,U)=>se+c(U.name,U.difficulty)/(U.partySize||1),0),0),Q=t.map((R,z)=>{const se=`${(R==null?void 0:R.name)||""}-${z}`,U=(R==null?void 0:R.bosses)||[],ae=U.filter(F=>{var W;return(W=r[se])==null?void 0:W[F.name+"-"+F.difficulty]}).length,$=U.length,A=U.reduce((F,W)=>{var K;return(K=r[se])!=null&&K[W.name+"-"+W.difficulty]?F+Math.ceil(c(W.name,W.difficulty)/(W.partySize||1)):F},0);return{name:R.name,cleared:ae,total:$,allCleared:$>0&&ae===$,left:$-ae,idx:z,totalMeso:A}}),M=x?Q.filter(R=>!R.allCleared):Q,ne=O.length>0,ce=async R=>{var z,se;if(!l){h.error("WeeklyTracker: No userCode available for pitched item interaction");return}if(!t.length){h.error("WeeklyTracker: No characters available");return}h.debug("WeeklyTracker: Pitched item clicked",R);try{const{bossName:U,itemName:ae,characterName:$,weekKey:A,isChecked:F,isHistorical:W,itemImage:K}=R;if(!$){h.error("WeeklyTracker: No character name provided");return}if(!t.some(Z=>Z.name===$)){h.error("WeeklyTracker: Character not found in character list",{characterName:$});return}if(F)await y($,U,ae,W?Ee(A):null),h.info("WeeklyTracker: Pitched item removed",{characterName:$,bossName:U,itemName:ae});else{if(W){const Z=(await J(async()=>{const{getBossPitchedItems:re}=await import("./bossRegistryService-D89mOkSS.js");return{getBossPitchedItems:re}},__vite__mapDeps([8,4,3,0,1,2,5]))).getBossPitchedItems,q=(Z(U)||[]).find(re=>re.name===ae);if(q){const re={bossName:U,itemName:ae,itemImage:K||q.image,weekKey:A,character:$};G.setHistoricalPitchedData(re),G.setShowHistoricalPitchedModal(!0)}return}if(await B($,U,ae,W?Ee(A):null),h.info("WeeklyTracker: Pitched item added",{characterName:$,bossName:U,itemName:ae}),!W){if(g.current){h.info("WeeklyTracker: Skipping auto-check because boss unchecking is in progress");return}try{h.info("WeeklyTracker: Starting automatic boss check process",{characterName:$,bossName:U,totalCharacters:t.length,characterNames:t.map(q=>q.name)});const Z=t.findIndex(q=>q.name===$),oe=t[Z];if(oe&&Z!==-1){const q=oe.bosses.find(re=>re.name===U);if(q){const re=`${oe.name}-${Z}`,fe=`${q.name}-${q.difficulty}`,pe=(z=r[re])==null?void 0:z[fe];if(h.info("WeeklyTracker: Boss check status verification",{charKey:re,bossKey:fe,isAlreadyCleared:pe,shouldAutoCheck:!pe}),pe)h.info("WeeklyTracker: Boss already cleared, skipping auto-check",{characterName:$,bossName:q.name});else{h.info("WeeklyTracker: Auto-checking boss since pitched item was obtained",{characterName:$,characterIndex:Z,bossName:q.name,difficulty:q.difficulty});const{getBossRegistryId:Oe}=await J(async()=>{const{getBossRegistryId:me}=await import("./bossCodeMapping-BCZH3EaK.js");return{getBossRegistryId:me}},__vite__mapDeps([9,4,3])),{toggleBossClearStatus:Be}=await J(async()=>{const{toggleBossClearStatus:me}=await import("./userWeeklyDataService-CnD16_tc.js");return{toggleBossClearStatus:me}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:Ae}=await J(async()=>{const{getCurrentMapleWeekStartDate:me}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:me}},[]),Fe=await Oe(q.name,q.difficulty),Ke=Ae(),_e=await Be(l,Ke,oe.index.toString(),Fe,!0);_e.success?(s(me=>{const ge={...me};return ge[re]||(ge[re]={}),ge[re]={...ge[re]},ge[re][fe]=!0,ge}),h.info("WeeklyTracker: Auto-check boss completed successfully",{bossName:q.name,difficulty:q.difficulty})):h.error("WeeklyTracker: Auto-check boss failed",{error:_e.error,bossName:q.name})}}else h.warn("WeeklyTracker: Boss not found in character configuration",{characterName:$,bossName:U,characterBosses:((se=oe.bosses)==null?void 0:se.map(re=>re.name))||[]})}else h.warn("WeeklyTracker: Character not found in character selections",{characterName:$,availableCharacters:t.map(q=>q.name)})}catch(Z){h.error("WeeklyTracker: Failed to auto-check boss after pitched item",{error:Z.message,characterName:$,bossName:U})}}E(Z=>[...Z,{id:Date.now()+Math.random(),image:K||"/images/pitched-items/test-crystal.png",bossName:U,itemName:ae,characterName:$,startPosition:{x:50,y:50},endPosition:{x:window.innerWidth-100,y:100}}])}}catch(U){h.error("WeeklyTracker: Error handling pitched item click",U)}};return I?e.jsxs("div",{className:"weekly-tracker-error",children:[e.jsx("div",{className:"weekly-tracker-error-message",children:I}),e.jsx("button",{onClick:()=>b(null),children:"Try Again"})]}):t.length?e.jsxs("div",{className:"weekly-tracker",children:[L.length>0&&L.map(R=>e.jsx(gt,{startPosition:R.startPosition,endPosition:R.endPosition,onComplete:()=>E(z=>z.filter(se=>se.id!==R.id))},R.id)),e.jsxs("div",{className:"weekly-tracker-container",children:[e.jsx(xt,{sidebarVisible:p,setSidebarVisible:k,isHistoricalWeek:u.isHistoricalWeek,totalMeso:ie,obtainableMeso:Y,selectedWeekKey:u.selectedWeekKey,hideCompleted:x,setHideCompleted:d,visibleCharSummaries:M,selectedCharIdx:j,setSelectedCharIdx:S,setPurgeTargetCharacter:G.setPurgeTargetCharacter,setShowCharacterPurgeConfirm:G.setShowCharacterPurgeConfirm,setShowCharacterPitchedModal:G.setShowCharacterPitchedModal,onShowTreasureAnalytics:()=>G.setShowStats(!0),characterBossSelections:t,showOnboardingIndicators:v}),e.jsx(wt,{sidebarVisible:p,setSidebarVisible:k}),e.jsx("div",{className:"weekly-tracker-main fade-in",children:e.jsxs("div",{className:"weekly-tracker-content",children:[e.jsx("div",{className:"weekly-tracker-header",children:e.jsx("h2",{className:"weekly-tracker-title",children:u.isHistoricalWeek?"Historical Week View":"Weekly Boss Tracker"})}),e.jsx("div",{className:"weekly-tracker-navigator-wrapper",children:e.jsx(ft,{appWeekKey:m,selectedWeekKey:u.selectedWeekKey,onWeekChange:X,isHistoricalWeek:u.isHistoricalWeek,historicalAnalysis:u.historicalAnalysis})}),ne&&e.jsx(e.Fragment,{children:u.isHistoricalWeek?e.jsx(yt,{bossData:i,characterKey:te,selectedWeekKey:u.selectedWeekKey,selectedCharIdx:j,pitchedChecked:w,onPitchedItemClick:ce,userCode:l,cloudPitchedItems:D,characterBossSelections:t}):e.jsx(vt,{bosses:T,bossData:i,checked:r,characterKey:te,onBossCheck:_.handleCheck,getBossPrice:c,showTickAll:!0,onTickAll:_.handleTickAll,allTicked:O.every(R=>{var z;return(z=r[te])==null?void 0:z[R.name+"-"+R.difficulty]})&&O.length>0,pitchedChecked:w,onPitchedItemClick:ce,isHistoricalWeek:!1,userCode:l,selectedWeekKey:u.selectedWeekKey,selectedCharIdx:j,userInteractionRef:P,cloudPitchedItems:D,characterBossSelections:t})})]})}),e.jsx(It,{statsManagement:G,weekNavigation:u,pitchedChecked:w,setPitchedChecked:N,userInteractionRef:P,setError:b,characterBossSelections:t,selectedCharIdx:j,cloudPitchedItems:D})]})]}):e.jsx("div",{className:"weekly-tracker-no-characters",children:e.jsx("div",{className:`weekly-tracker-no-characters-message ${a?"visible":""}`,children:"No characters found. Go back and add a character first."})})}function Ht({show:t,onComplete:i,onSkip:r}){const[s,l]=n.useState(0),[m,v]=n.useState(!1),[f,C]=n.useState(!1),[c,p]=n.useState({}),k=[{id:"welcome",title:"Welcome to Weekly Tracker! 🎉",content:e.jsxs("div",{children:[e.jsx("p",{children:"Track weekly boss completions and rare item drops efficiently."}),e.jsx("p",{children:"Let me show you the key interactive features."})]}),highlight:null,position:"center",offset:{x:0,y:0}},{id:"characters-title",title:"Analytics Hub 📊",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:'Click "Characters"'})," to access account-wide analytics."]}),e.jsx("p",{children:"View all pitched items and drops across characters and years."})]}),highlight:".sidebar-title",position:"right",arrow:"left",offset:{x:24,y:0}},{id:"weekly-progress",title:"Progress Toggle 🔄",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Click progress bar"})," to toggle views:"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Account Total:"})," Overall weekly progress",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Selected Character:"})," Individual progress"]})]}),highlight:".sidebar-progress-section",position:"right",arrow:"left",offset:{x:24,y:0}},{id:"boss-table",title:"Boss Management 🗡️",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Check off bosses"})," as you complete them."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Click pitched item icons"})," to track rare drops."]})]}),highlight:".weekly-tracker-main .weekly-tracker-content",position:"left",arrow:"right",offset:{x:-24,y:0}},{id:"week-navigation",title:"Week Navigation 📅",content:e.jsx("div",{children:e.jsx("p",{children:"Navigate between weeks to view historical data and track progress patterns."})}),highlight:".weekly-tracker-navigator-wrapper",position:"bottom",arrow:"top",offset:{x:0,y:16}},{id:"final",title:"Ready to Boss! ✅",content:e.jsxs("div",{children:[e.jsx("p",{children:"You're all set! Start tracking your weekly progress."}),e.jsxs("div",{className:"onboarding-reset-tip",children:[e.jsx("strong",{children:"💡 Tip:"})," To replay this guide, clear localStorage key 'ms-weekly-onboarding-seen'"]})]}),highlight:null,position:"center",offset:{x:0,y:0}}],L=n.useCallback(a=>{if(!a.highlight)return{};const o=document.querySelector(a.highlight);if(!o)return console.warn(`Onboarding: Element not found for selector: ${a.highlight}`),{};const g=o.getBoundingClientRect(),x=420,{x:d=0,y:u=0}=a.offset||{},w={width:window.innerWidth,height:window.innerHeight};let N={};switch(a.position){case"right":N={position:"fixed",left:`${Math.min(g.right+d,w.width-x-16)}px`,top:`${Math.max(16,g.top+g.height/2-90)}px`,transform:"none"};break;case"left":N={position:"fixed",left:`${Math.max(16,g.left+d-x)}px`,top:`${Math.max(16,g.top+g.height/2-90)}px`,transform:"none"};break;case"bottom":N={position:"fixed",left:`${Math.max(16,Math.min(g.left+g.width/2+d-x/2,w.width-x-16))}px`,top:`${g.bottom+u}px`,transform:"none"};break;case"top":N={position:"fixed",left:`${Math.max(16,Math.min(g.left+g.width/2+d-x/2,w.width-x-16))}px`,bottom:`${w.height-g.top+u}px`,transform:"none"};break;default:return{}}return N},[]);n.useEffect(()=>{if(m&&s<k.length){const a=k[s],o=L(a);p(o)}},[s,m,L]),n.useEffect(()=>{const a=()=>{if(m&&s<k.length){const o=k[s],g=L(o);p(g)}};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[s,m,L]),n.useEffect(()=>(t?(v(!0),l(0),document.body.classList.add("onboarding-active")):(v(!1),document.body.classList.remove("onboarding-active")),()=>{document.body.classList.remove("onboarding-active")}),[t]);const E=()=>{s<k.length-1?(C(!0),setTimeout(()=>{l(s+1),setTimeout(()=>C(!1),50)},200)):S()},j=()=>{s>0&&(C(!0),setTimeout(()=>{l(s-1),setTimeout(()=>C(!1),50)},200))},S=()=>{v(!1),document.body.classList.remove("onboarding-active"),setTimeout(()=>{i()},300)},I=()=>{v(!1),document.body.classList.remove("onboarding-active"),setTimeout(()=>{r()},300)};if(!t)return null;const b=k[s];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`onboarding-overlay ${m?"visible":""}`}),b.highlight&&e.jsx("div",{className:"onboarding-spotlight","data-highlight":b.highlight}),e.jsxs("div",{className:`onboarding-modal ${m?"visible":""} ${f?"transitioning":""} position-${b.position}`,style:c,"data-step":b.id,children:[b.arrow&&e.jsx("div",{className:`onboarding-arrow arrow-${b.arrow}`}),e.jsxs("div",{className:"onboarding-content",children:[e.jsxs("div",{className:"onboarding-header",children:[e.jsx("h2",{className:"onboarding-title",children:b.title}),e.jsx("button",{className:"onboarding-skip",onClick:I,title:"Skip tutorial",children:"Skip Tour"})]}),e.jsx("div",{className:"onboarding-body",children:b.content}),e.jsxs("div",{className:"onboarding-footer",children:[e.jsxs("div",{className:"onboarding-progress",children:[e.jsxs("span",{className:"onboarding-step-counter",children:[s+1," of ",k.length]}),e.jsx("div",{className:"onboarding-progress-bar",children:e.jsx("div",{className:"onboarding-progress-fill","data-progress":`${(s+1)/k.length*100}`})})]}),e.jsxs("div",{className:"onboarding-actions",children:[s>0&&e.jsx("button",{className:"onboarding-btn secondary",onClick:j,children:"Previous"}),e.jsx("button",{className:"onboarding-btn primary",onClick:E,children:s===k.length-1?"Get Started!":"Next"})]})]})]})]})]})}function Zt(){ze();const{userCode:t,isLoggedIn:i,handleDeleteAccount:r}=Pe(),{characterBossSelections:s,checked:l,setChecked:m,fullUserData:v,weekKey:f,preservingCheckedStateRef:C,sortedBossData:c,isLoading:p,hasDataLoaded:k}=We(),[L,E]=n.useState(!1),[j,S]=n.useState(!1),[I,b]=n.useState(""),[a,o]=n.useState(!1),[g,x]=n.useState(!1);n.useEffect(()=>{if(k&&s.length>0&&!localStorage.getItem(ue.WEEKLY_ONBOARDING_SEEN)){const N=setTimeout(()=>{x(!0)},500);return()=>clearTimeout(N)}},[k,s.length]);const d=()=>{localStorage.setItem(ue.WEEKLY_ONBOARDING_SEEN,"true"),x(!1)};if(!i)return null;const u=async()=>{o(!0),b("");try{const w=await r();w.success?S(!1):b(w.error)}catch(w){b("Failed to delete account. Try again."),console.error("Delete error:",w)}finally{o(!1)}};return p||!k?e.jsxs("div",{className:"page-container",children:[e.jsx(Le,{currentPage:"weeklytracker",onShowHelp:()=>E(!0),onShowDeleteConfirm:()=>S(!0)}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",color:"#e6e0ff",fontSize:"1.2rem"},children:"Loading data..."})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(Le,{currentPage:"weeklytracker",onShowHelp:()=>E(!0),onShowDeleteConfirm:()=>S(!0)}),e.jsx(qe,{children:e.jsx(Rt,{characterBossSelections:s,bossData:c,checked:l,setChecked:m,userCode:t,fullUserData:v,appWeekKey:f,preservingCheckedStateRef:C,showOnboardingIndicators:g})}),e.jsx(Ht,{show:g,onComplete:d,onSkip:d}),e.jsx(Ze,{showHelp:L,onClose:()=>E(!1),children:e.jsx(Je,{})}),e.jsx(Xe,{showDeleteConfirm:j,onClose:()=>S(!1),onConfirm:u,showDeleteLoading:a,deleteError:I})]})}export{Zt as default};
