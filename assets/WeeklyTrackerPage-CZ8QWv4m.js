const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabaseClient-B7fnwhYs.js","assets/vendor-supabase-B7S7y5aO.js","assets/vendor-react-eWEExxYH.js","assets/pitched-data-service-hqf7KOUT.js","assets/Navbar-C88T-MOZ.js","assets/vendor-ui-DqxmAIBo.js","assets/vendor-router-BPn28yDh.js","assets/index-CFYAW1g3.js","assets/index-C9_Ifi-v.css"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-DqxmAIBo.js";import{r as c,b as me}from"./vendor-router-BPn28yDh.js";import{M as fe,S as ne,u as ue,V as ge}from"./index-CFYAW1g3.js";import{a as ie,c as pe,d as ee,p as xe,e as he,f as ye,h as te,u as be,N as ke,b as ve}from"./Navbar-C88T-MOZ.js";import{_ as Q}from"./vendor-supabase-B7S7y5aO.js";import{getHistoricalWeekAnalysis as ce,getAvailableWeeks as je,getPitchedItems as we,getAllPitchedItems as Se,removeManyPitchedItems as ae,getYearlyPitchedStats as le,purgeAllStatsData as Ne,clearCharacterPitchedUI as Ce,purgePitchedRecords as Pe,getPitchedResetAuditHistory as We,savePitchedItem as de}from"./pitched-data-service-hqf7KOUT.js";import{C as De,u as Ie}from"./CustomCheckbox-8tvI5vQL.js";import"./vendor-react-eWEExxYH.js";function Te({selectedWeekKey:t,onWeekChange:r,availableWeeks:o=[],isReadOnlyMode:m=!1,isHistoricalWeek:d=!1,historicalAnalysis:f={hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[]},characters:P=[],checked:T={},selectedCharIdx:E=0,totalMeso:R=0,obtainableMeso:h=0,charSummaries:b=[]}){const w=ie();console.log("ðŸŽ¯ WeekNavigator received historicalAnalysis:",f);const S=c.useMemo(()=>{const $=f.adaptiveWeekLimit||8;return{min:-$,max:0,current:0,adaptiveLimit:$}},[f]),g=pe(t),j=c.useCallback(v=>{v!==t&&r(v)},[t,r]),x=()=>{const v=g-1;if(v>=S.min){const $=ee(v);j($)}},N=()=>{const v=g+1;if(v<=S.max){const $=ee(v);j($)}},k=c.useCallback(()=>{if(console.log("ðŸ” goToOldestOrFallback called with analysis:",{hasHistoricalData:f.hasHistoricalData,oldestHistoricalWeek:f.oldestHistoricalWeek,userType:f.userType,adaptiveLimit:S.adaptiveLimit}),f.hasHistoricalData&&f.oldestHistoricalWeek)console.log(`ðŸŽ¯ Jumping to oldest historical data: ${f.oldestHistoricalWeek} (${f.userType} user)`),j(f.oldestHistoricalWeek);else{const v=ee(-S.adaptiveLimit);console.log(`ðŸŽ¯ No historical data found, jumping to ${S.adaptiveLimit} weeks back: ${v}`),j(v)}},[f,S.adaptiveLimit,j]),n=()=>{j(w)},u=()=>{f.hasHistoricalData&&f.oldestHistoricalWeek&&j(f.oldestHistoricalWeek)},s=g>S.min,l=g<S.max,W=f.hasHistoricalData||g>-S.adaptiveLimit,a=t===w,B=f.hasHistoricalData;g<=S.min;const M=c.useMemo(()=>{const v=xe(t),$=he(t);return{label:ye(t),parsed:v,dateRange:$,isCurrentWeek:a,offset:g}},[t,a,g]),z=P[E],L=(z==null?void 0:z.bosses)||[],y=`${(z==null?void 0:z.name)||""}-${E}`,H=L.filter(v=>{var $;return($=T[y])==null?void 0:$[v.name+"-"+v.difficulty]}).length,p=L.length,D=p>0?H/p*100:0;return e.jsxs("div",{className:"week-navigator-container",children:[e.jsxs("div",{className:"week-navigator-header",children:[e.jsxs("div",{className:`week-navigator-title ${a?"current-week":"historical-week"}`,children:[M.label.replace(/\s*\(Current\)/i,""),a&&e.jsx("span",{className:"week-navigator-current-dot",children:e.jsx("span",{className:"week-navigator-current-dot-inner"})})]}),f.userType==="existing"&&e.jsxs("div",{className:"week-navigator-extended-history",children:["Extended History (",S.adaptiveLimit," weeks)"]})]}),e.jsxs("div",{className:"week-navigator-navigation",children:[e.jsx("div",{className:"week-navigator-arrow-container",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:s?x:void 0,className:`week-navigator-arrow arrow-left ${s?"enabled":"disabled"}`,title:s?"Previous Week":`Already at oldest week (${S.adaptiveLimit} weeks back)`,children:e.jsx("path",{d:"M20.3284 11.0001V13.0001L7.50011 13.0001L10.7426 16.2426L9.32842 17.6568L3.67157 12L9.32842 6.34314L10.7426 7.75735L7.49988 11.0001L20.3284 11.0001Z",fill:"currentColor"})})}),M.dateRange&&e.jsxs("div",{className:"week-navigator-date-range",children:[M.dateRange.start.toLocaleDateString()," - ",M.dateRange.end.toLocaleDateString()]}),e.jsx("div",{className:"week-navigator-arrow-container",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:a?W?k:void 0:l?N:void 0,className:`week-navigator-arrow arrow-right ${(a?W:l)?"enabled":"disabled"}`,title:a?W?f.hasHistoricalData?`Jump to oldest data (${f.oldestHistoricalWeek})`:`Jump to ${S.adaptiveLimit} weeks back`:"No historical data available":l?"Next Week":"Already at current week",children:e.jsx("path",{d:"M15.0378 6.34317L13.6269 7.76069L16.8972 11.0157L3.29211 11.0293L3.29413 13.0293L16.8619 13.0157L13.6467 16.2459L15.0643 17.6568L20.7079 11.9868L15.0378 6.34317Z",fill:"currentColor"})})})]}),e.jsx("div",{className:"week-navigator-content",children:a&&z&&e.jsxs("div",{className:"week-navigator-progress",children:[e.jsxs("div",{className:"week-navigator-progress-header",children:[e.jsxs("div",{className:"week-navigator-progress-character",children:[z.name," Progress"]}),e.jsxs("div",{className:"week-navigator-progress-count",children:[H,"/",p," bosses"]})]}),e.jsx("div",{className:"week-navigator-progress-bar-container",children:e.jsx("div",{className:"week-navigator-progress-bar",style:{width:`${D}%`},children:D>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"week-navigator-progress-meso",children:[e.jsxs("span",{children:[Math.floor(R).toLocaleString()," mesos earned"]}),e.jsxs("span",{children:[Math.floor(R/h*100),"% of potential"]})]})]})}),e.jsx("div",{className:"week-navigator-buttons",children:a?e.jsx("div",{className:"week-navigator-spacer"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n,className:"week-navigator-button current-week-btn",title:"Jump to current week",children:"Current Week"}),B&&e.jsx("button",{onClick:u,className:"week-navigator-button oldest-data-btn",title:`Jump to oldest data (${f.oldestHistoricalWeek})`,children:"Oldest Data"})]})})]},t)}function Ee({data:t,characters:r,onClose:o,onConfirm:m}){const[d,f]=c.useState(""),[P,T]=c.useState(""),[E,R]=c.useState(!1),h=c.useMemo(()=>t.weekKey?he(t.weekKey):{start:null,end:null},[t.weekKey]),b=g=>g.toISOString().split("T")[0],w=c.useMemo(()=>{if(!h.start||!h.end)return[];const g=[],j=new Date(h.start),x=new Date(h.end);for(;j<=x;)g.push(new Date(j)),j.setDate(j.getDate()+1);return g},[h]);c.useEffect(()=>{w.length>0&&!d&&f(b(w[0])),r.length>0&&!P&&T(r[0].name)},[w,d,r,P]);const S=async()=>{if(!d||!P)return;R(!0);const g=new Date(d+"T12:00:00.000Z").toISOString();await m(g,P),R(!1)};return e.jsxs("div",{className:"historical-modal-container",onClick:g=>g.stopPropagation(),children:[e.jsx("div",{className:"historical-modal-header",children:e.jsx("img",{src:t.itemImage,alt:t.itemName,className:"historical-modal-header-image"})}),e.jsx("h2",{className:"historical-modal-title",children:"Log Historical Pitched Item"}),e.jsxs("div",{className:"historical-modal-info-box",children:[e.jsxs("div",{className:"historical-modal-info-item",children:[e.jsx("span",{className:"historical-modal-info-label",children:"Character:"})," ",P||t.character]}),e.jsxs("div",{className:"historical-modal-info-item",children:[e.jsx("span",{className:"historical-modal-info-label",children:"Boss:"})," ",t.bossName]}),e.jsxs("div",{className:"historical-modal-info-item",children:[e.jsx("span",{className:"historical-modal-info-label",children:"Item:"})," ",t.itemName]}),e.jsxs("div",{className:"historical-modal-info-item",children:[e.jsx("span",{className:"historical-modal-info-label",children:"Week:"})," ",t.weekKey]})]}),e.jsxs("div",{className:"historical-modal-form-section",children:[e.jsx("label",{className:"historical-modal-label",children:"Select Character:"}),e.jsx("select",{value:P,onChange:g=>T(g.target.value),className:"historical-modal-select",children:r.map(g=>e.jsx("option",{value:g.name,children:g.name},g.name))})]}),e.jsxs("div",{className:"historical-modal-form-section",children:[e.jsx("label",{className:"historical-modal-label",children:"Select Date:"}),e.jsx("input",{type:"date",value:d,onChange:g=>f(g.target.value),min:h.start?b(h.start):"",max:h.end?b(h.end):"",className:"historical-modal-date-input"}),h.start&&h.end&&e.jsxs("div",{className:"historical-modal-helper-text",children:["Valid range: ",b(h.start)," to ",b(h.end)]})]}),e.jsxs("div",{className:"historical-modal-buttons",children:[e.jsx("button",{onClick:o,disabled:E,className:"historical-modal-button historical-modal-button-cancel",children:"Cancel"}),e.jsxs("button",{onClick:S,disabled:E||!d||!P,className:"historical-modal-button historical-modal-button-confirm",children:[E&&e.jsx("div",{className:"historical-modal-spinner"}),E?"Logging...":"Log Item"]})]})]})}function Le({startPosition:t,endPosition:r,onComplete:o}){const[m,d]=c.useState(t),[f,P]=c.useState(1);return c.useEffect(()=>{const T=Date.now(),E=1e3,R=()=>{const h=Date.now()-T,b=Math.min(h/E,1),w=1-Math.pow(1-b,3),S=t.x+(r.x-t.x)*w,g=t.y+(r.y-t.y)*w;d({x:S,y:g}),P(1-b),b<1?requestAnimationFrame(R):o()};requestAnimationFrame(R)},[t,r,o]),e.jsx("div",{style:{position:"fixed",left:m.x,top:m.y,transform:"translate(-50%, -50%)",opacity:f,pointerEvents:"none",zIndex:1e3,transition:"transform 0.1s ease"},children:e.jsx("img",{src:"/bosses/crystal.png",alt:"Crystal",style:{width:24,height:24,transform:`rotate(${m.x*.1}deg)`,filter:"drop-shadow(0 0 4px rgba(162, 89, 247, 0.6))"}})})}const se=t=>{if(t===0)return"0";if(t<1e9){const o=t/1e6;if(o<1){const m=t/1e3;return m<1?t.toString():`${m.toFixed(1)}K`}return`${o.toFixed(1)}M`}return`${(t/1e9).toFixed(1)}B`};function He({sidebarVisible:t,isHistoricalWeek:r,totalMeso:o,obtainableMeso:m,selectedWeekKey:d,hideCompleted:f,setHideCompleted:P,visibleCharSummaries:T,selectedCharIdx:E,setSelectedCharIdx:R,isReadOnlyMode:h,setPurgeTargetCharacter:b,setShowCharacterPurgeConfirm:w}){const[S,g]=c.useState(0),j=5,x=c.useMemo(()=>{const n=T.length,u=Math.ceil(n/j),s=S*j,l=Math.min(s+j,n),W=T.slice(s,l);return{totalPages:u,currentPageCharacters:W,startIndex:s,endIndex:l,totalCharacters:n}},[T,S,j]);me.useEffect(()=>{g(0)},[T.length,f]);const N=()=>{x.totalPages>1&&g(n=>n===0?x.totalPages-1:n-1)},k=()=>{x.totalPages>1&&g(n=>n===x.totalPages-1?0:n+1)};return e.jsx(e.Fragment,{children:e.jsx("div",{className:`sidebar-scroll fade-in-no-slide ${t?"visible":"hidden"}`,children:e.jsxs("div",{className:"sidebar-content",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h3",{className:"sidebar-title",children:"Characters"}),e.jsxs("div",{className:"sidebar-crystal-icons",children:[e.jsx("img",{src:"/bosses/crystal.png",alt:"Crystal",className:"sidebar-crystal-icon"}),e.jsx("img",{src:"/bosses/bluecrystal.png",alt:"Blue Crystal",className:"sidebar-crystal-icon"}),e.jsx("img",{src:"/bosses/yellowcrystal.png",alt:"Yellow Crystal",className:"sidebar-crystal-icon"})]})]}),!r&&e.jsxs("div",{className:"sidebar-progress-section",children:[e.jsx("div",{className:"sidebar-progress-title",children:"Weekly Progress"}),e.jsx("div",{className:"sidebar-progress-track",children:e.jsx("div",{className:"sidebar-progress-fill",style:{width:`${m>0?Math.min(o/m*100,100):0}%`}})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:se(o)}),e.jsx("span",{children:se(m)})]})]}),r&&e.jsxs("div",{className:"sidebar-historical-section",children:[e.jsxs("div",{className:"sidebar-historical-title",children:["Week ",d]}),e.jsx("div",{className:"sidebar-historical-subtitle",children:"Historical Data"})]}),e.jsx("div",{className:"sidebar-checkbox-section",children:e.jsxs("label",{className:"sidebar-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:n=>P(n.target.checked),className:"sidebar-checkbox-input"}),"Hide completed"]})}),x.totalPages>1&&e.jsxs("div",{className:"sidebar-pagination",children:[e.jsx("svg",{className:"sidebar-pagination-arrow previous",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:N,title:"Previous Page",children:e.jsx("path",{d:"M20.3284 11.0001V13.0001L7.50011 13.0001L10.7426 16.2426L9.32842 17.6568L3.67157 12L9.32842 6.34314L10.7426 7.75735L7.49988 11.0001L20.3284 11.0001Z",fill:"#ffffff"})}),e.jsx("div",{className:"sidebar-pagination-indicator",children:x.totalCharacters>0?e.jsxs(e.Fragment,{children:["Page ",S+1," of ",x.totalPages]}):"No characters"}),e.jsx("svg",{className:"sidebar-pagination-arrow next",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:k,title:"Next Page",children:e.jsx("path",{d:"M15.0378 6.34317L13.6269 7.76069L16.8972 11.0157L3.29211 11.0293L3.29413 13.0293L16.8619 13.0157L13.6467 16.2459L15.0643 17.6568L20.7079 11.9868L15.0378 6.34317Z",fill:"#ffffff"})})]}),e.jsx("div",{className:"sidebar-character-list",children:x.currentPageCharacters.length===0?e.jsx("div",{className:"sidebar-empty-state",style:{opacity:T.length===0?0:1},children:f?"No characters with bosses left to clear.":"No characters found."}):x.currentPageCharacters.map(n=>e.jsxs("div",{onClick:()=>R(n.idx),onContextMenu:u=>{u.preventDefault(),h||(b({name:n.name,idx:n.idx}),w(!0))},className:`sidebar-character-card ${E===n.idx?`selected ${r?"historical-week":"current-week"}`:"default"}`,children:[r&&E===n.idx&&e.jsx("div",{className:`sidebar-character-status-indicator ${h?"readonly":"editable"}`,children:h?"ðŸ”’":"âœï¸"}),e.jsxs("div",{className:"sidebar-character-header",children:[e.jsx("span",{className:`sidebar-character-name ${E===n.idx?"selected":"default"}`,children:n.name}),n.allCleared&&e.jsxs("svg",{className:"sidebar-character-checkmark",width:"16",height:"16",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]})]}),e.jsx("div",{className:"sidebar-character-stats",children:n.total===0?e.jsx("div",{className:"sidebar-character-no-bosses",children:"No bosses configured"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-character-completion",children:[n.cleared," / ",n.total," bosses cleared"]}),e.jsxs("div",{className:"sidebar-character-meso",children:[se(n.totalMeso)," meso"]})]})})]},n.name+"-"+n.idx))})]})})})}function $e({sidebarVisible:t,setSidebarVisible:r}){return e.jsx("div",{className:`sidebar-toggle ${t?"visible":"hidden"}`,onClick:()=>r(!t),title:t?"Hide sidebar":"Show sidebar",children:t?e.jsxs("svg",{className:"sidebar-toggle-close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"crossGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff"}),e.jsx("stop",{offset:"50%",stopColor:"#e6e0ff"}),e.jsx("stop",{offset:"100%",stopColor:"#d6b4ff"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#crossGradient)"})]}):e.jsx("div",{className:"sidebar-toggle-hamburger",children:[0,1,2].map(o=>e.jsx("span",{className:"sidebar-toggle-hamburger-line"},o))})})}function Re({isHistoricalWeek:t,isReadOnlyMode:r,readOnlyOverride:o,setReadOnlyOverride:m}){return t?e.jsxs("div",{className:`mode-indicator-container ${r?"read-only":"edit-mode"}`,children:[e.jsxs("div",{className:"mode-indicator-content",children:[e.jsx("span",{className:"mode-indicator-icon",children:r?"ðŸ”’":"âœï¸"}),e.jsxs("div",{className:"mode-indicator-text",children:[e.jsx("div",{className:"mode-indicator-title",children:r?"Read-Only Mode":"Edit Mode"}),e.jsx("div",{className:"mode-indicator-description",children:r?"Historical week data is protected from changes":"Editing enabled for historical week data"})]})]}),e.jsxs("button",{className:`mode-toggle-button ${r?"read-only":"edit-mode"}`,onClick:()=>m(!o),title:r?"Enable editing for this historical week":"Disable editing to protect historical data",children:[e.jsx("span",{className:"mode-toggle-icon",children:r?"ðŸ”“":"ðŸ”’"}),e.jsx("span",{className:"mode-toggle-text",children:r?"Enable Edit":"Lock Data"})]})]}):null}function Z(t,r,o,m,d){return`${t}-${r}__${o}__${m}__${d}`}const Me=Object.freeze(Object.defineProperty({__proto__:null,getPitchedKey:Z},Symbol.toStringTag,{value:"Module"}));function Be({isHistoricalWeek:t,characters:r,selectedCharIdx:o,charBosses:m,sortedBosses:d,bossData:f,checked:P,setChecked:T,charKey:E,getBossPrice:R,isReadOnlyMode:h,pitchedChecked:b,weekKey:w,handleCheck:S,refreshCheckedStateFromDatabase:g,userInteractionRef:j,userCode:x,savePitchedItem:N,removeManyPitchedItems:k,setPitchedChecked:n,setError:u,startStatsTrackingIfNeeded:s,setHistoricalPitchedData:l,setShowHistoricalPitchedModal:W,readOnlyOverride:a,loadingPitchedItems:B,setLoadingPitchedItems:M,refreshPitchedItems:z,refreshHistoricalAnalysis:L}){if(t){const y=new Map;return r.forEach(H=>{var p;(p=H.bosses)==null||p.forEach(D=>{const v=f.find($=>$.name===D.name);v&&v.pitchedItems&&v.pitchedItems.length>0&&y.set(D.name,v)})}),e.jsx("div",{className:"historical-week-cards-container",children:Array.from(y.values()).map(H=>e.jsxs("div",{className:"historical-boss-card",children:[e.jsxs("div",{className:"historical-boss-header",children:[e.jsx("img",{src:H.image,alt:H.name,className:"historical-boss-image"}),e.jsxs("div",{className:"historical-boss-info",children:[e.jsx("div",{className:"historical-boss-name",children:H.name}),e.jsx("div",{className:"historical-boss-difficulty",children:(()=>{const p=new Set;return r.forEach(D=>{var v;(v=D.bosses)==null||v.forEach($=>{$.name===H.name&&p.add($.difficulty)})}),Array.from(p).join(", ")})()})]})]}),e.jsxs("div",{className:"historical-pitched-section",children:[e.jsx("div",{className:"historical-pitched-label",children:"Pitched Items"}),(H.pitchedItems||[]).length>0?e.jsx("div",{className:"historical-pitched-grid",children:(H.pitchedItems||[]).map(p=>{let D=!1,v=null;return r.forEach(($,i)=>{const C=Z($.name,i,H.name,p.name,w);b[C]&&(D=!0,v=$.name)}),e.jsxs("div",{className:`historical-pitched-item ${D?"obtained":""}`,title:h?D?`${p.name} (obtained by ${v})`:p.name:D?`Click to remove: ${p.name} (obtained by ${v})`:`Click to track: ${p.name}`,onClick:async $=>{if($.stopPropagation(),h){console.log("Historical pitched item click blocked - read-only mode");return}if(t&&a){if(D){console.log("Removing historical pitched item:",p.name);try{const i=await N(x,{character:v,characterIdx:r.findIndex(C=>C.name===v),bossName:H.name,bossDifficulty:"Unknown",itemName:p.name,itemImage:p.image,date:new Date().toISOString()},!0,w);i.success?(console.log("âœ… Historical pitched item removed successfully"),await z(x),L&&await L()):(console.error("âŒ Failed to remove historical pitched item:",i.error),u("Failed to remove historical pitched item: "+(i.error||"Unknown error")))}catch(i){console.error("âŒ Error removing historical pitched item:",i),u("Error removing historical pitched item: "+i.message)}}else console.log("Opening historical pitched item modal for:",p.name),l({character:"",characterIdx:-1,bossName:H.name,itemName:p.name,itemImage:p.image,weekKey:w}),W(!0);return}},children:[e.jsx("img",{src:p.image,alt:p.name,className:`historical-pitched-item-image ${D?"obtained":"not-obtained"}`}),D&&e.jsx("span",{className:"historical-pitched-checkmark",children:"âœ“"})]},p.name)})}):e.jsx("div",{className:"historical-no-pitched",children:"No pitched items available"})]})]},H.name))})}return e.jsx("div",{className:"boss-table-scroll",children:e.jsxs("table",{className:`boss-table ${t?"historical-week":""}`,children:[e.jsx("thead",{children:e.jsxs("tr",{className:"boss-table-header-row",children:[e.jsx("th",{className:"boss-table-header-cell",children:"Boss"}),e.jsx("th",{className:"boss-table-header-cell-difficulty",children:"Difficulty"}),e.jsx("th",{className:"boss-table-header-cell-mesos",children:"Mesos"}),e.jsx("th",{className:"boss-table-header-cell-cleared",children:"Cleared"})]})}),e.jsx("tbody",{children:d.map((y,H)=>{var $;const p=f.find(i=>i.name===y.name),D=!!(($=P[E])!=null&&$[y.name+"-"+y.difficulty]),v=(p==null?void 0:p.pitchedItems)||[];return e.jsxs("tr",{className:`boss-table-row ${H%2===0?"even":"odd"} ${h?"read-only":""}`,onClick:i=>{!h&&!i.target.closest(".checkbox-wrapper")&&!i.target.closest(".pitched-item-icon")&&S(y,!D,i)},children:[e.jsxs("td",{className:"boss-table-cell-boss",children:[(p==null?void 0:p.image)&&e.jsx("img",{src:p.image,alt:y.name,className:"boss-table-boss-image"}),e.jsx("span",{className:"boss-table-boss-name",children:y.name}),v.length>0&&(y.name==="Lotus"&&(y.difficulty==="Hard"||y.difficulty==="Extreme")||y.name!=="Lotus"&&["Hard","Chaos","Extreme","Hell"].includes(y.difficulty))&&e.jsx("div",{className:"boss-table-pitched-container inline",children:v.map(i=>{if(y.name==="Lotus"&&(i.name==="Total Control"&&y.difficulty!=="Extreme"||(i.name==="Berserked"||i.name==="Black Heart")&&!["Hard","Extreme"].includes(y.difficulty)))return null;const C=Z(r[o].name,o,y.name,i.name,w),I=!!b[C];return e.jsxs("span",{className:`pitched-item-icon inline ${I?"obtained":""} ${h?"read-only":""}`,title:I?`Click to remove: ${i.name}`:`Click to track: ${i.name}`,onClick:async A=>{var V;if(A.stopPropagation(),h){console.log("Pitched item click blocked - read-only mode");return}if(t&&a){console.log("Opening historical pitched item modal for:",i.name),l({character:"",characterIdx:-1,bossName:y.name,itemName:i.name,itemImage:i.image,weekKey:w}),W(!0);return}const U=`${r[o].name}-${o}`,F=Z(r[o].name,o,y.name,i.name,w),O=!!b[F];let K=!1,G="";if(r.forEach((Y,J)=>{if(J!==o){const q=Z(Y.name,J,y.name,i.name,w);b[q]&&(K=!0,G=Y.name)}}),K&&!O){alert(`${i.name} is already obtained by ${G}. Only one character can have each item per week.`);return}j.current=!0,console.log("ðŸ–±ï¸ USER: Pitched item clicked:",{item:i.name,boss:y.name,character:r[o].name,currentState:O}),!!((V=P[U])!=null&&V[y.name+"-"+y.difficulty])||(console.log("ðŸ–±ï¸ USER: Auto-checking boss since it was not cleared"),S(y,!0,A)),M(Y=>({...Y,[F]:!0}));try{if(!x){u("Please log in to save pitched items to cloud.");return}const Y=!O;console.log(`ðŸ–±ï¸ USER: Toggling pitched item from ${O} to ${Y}`),n(q=>{const X={...q};return Y?X[F]=!0:delete X[F],console.log("ðŸ–±ï¸ USER: Updated local pitched state:",Y?"added":"removed"),X}),console.log("ðŸ–±ï¸ USER: Saving to cloud...");const J=await N(x,{character:r[o].name,characterIdx:o,bossName:y.name,bossDifficulty:y.difficulty,itemName:i.name,itemImage:i.image,date:new Date().toISOString()},O,w);J.success?(console.log("ðŸ–±ï¸ USER: Cloud save successful"),L&&L().catch(q=>{console.error("Error refreshing historical analysis:",q)})):(console.error("ðŸ–±ï¸ USER: Cloud save failed:",J.error),u("Failed to save to cloud. Reverting changes."),n(q=>{const X={...q};return O?X[F]=!0:delete X[F],X}))}catch(Y){console.error("âŒ Error in pitched item click handler:",Y),u("Failed to update pitched item. Please try again."),n(J=>{const q={...J};return O?q[F]=!0:delete q[F],q})}finally{M(Y=>{const J={...Y};return delete J[F],J}),setTimeout(()=>{j.current=!1,console.log("ðŸ–±ï¸ USER: Interaction flag cleared, sync can resume")},1e3)}s()},children:[B[C]?e.jsx("div",{className:"pitched-item-loading inline",children:e.jsx("div",{className:"pitched-item-spinner inline"})}):e.jsx("img",{src:i.image,alt:i.name,className:`pitched-item-image inline ${I?"obtained":"not-obtained"}`}),I&&!B[C]&&e.jsx("span",{className:"pitched-item-checkmark inline",children:"âœ“"})]},i.name)})})]}),e.jsx("td",{className:"boss-table-cell-difficulty",children:e.jsx("span",{children:y.difficulty})}),e.jsx("td",{className:"boss-table-cell-mesos",children:e.jsx("span",{children:Math.floor(R(y.name,y.difficulty)/(y.partySize||1)).toLocaleString()})}),e.jsx("td",{className:"boss-table-cell-cleared",children:e.jsx("span",{onClick:i=>i.stopPropagation(),children:e.jsx(De,{checked:D,onChange:i=>!h&&S(y,i.target.checked,i),disabled:h})})})]},y.name+"-"+y.difficulty)})})]})})}function ze({showStats:t,setShowStats:r,allYears:o,selectedYear:m,setSelectedYear:d,yearlyPitchedSummary:f,isLoadingCloudStats:P,setPitchedModalItem:T,setShowPitchedModal:E,setShowStatsResetConfirm:R}){return t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(40,32,74,0.92)",zIndex:5e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{className:"modal-fade",style:{background:"#2d2540",borderRadius:14,padding:"2.5rem 2rem",maxWidth:600,color:"#e6e0ff",boxShadow:"0 4px 24px #0006",position:"relative",minWidth:320,maxHeight:"90vh",overflowY:"auto"},onClick:h=>h.stopPropagation(),children:[e.jsx("button",{onClick:()=>r(!1),style:{position:"absolute",top:16,right:16,background:"transparent",color:"#fff",border:"none",fontSize:"1.5rem",cursor:"pointer"},title:"Close",children:"Ã—"}),e.jsx("h2",{style:{color:"#a259f7",fontWeight:700,marginBottom:18,textAlign:"center"},children:"Yearly Stats"}),e.jsx("div",{style:{marginBottom:18,display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsx("select",{value:m,onChange:h=>d(h.target.value),style:{background:"#3a335a",color:"#e6e0ff",border:"1px solid #805ad5",borderRadius:6,padding:"6px 18px",fontWeight:600,fontSize:"1.08em",minWidth:120,textAlign:"center"},children:o.map(h=>e.jsx("option",{value:h,children:h},h))})}),e.jsx("div",{style:{marginBottom:8,textAlign:"center"},children:f.length===0?`No pitched items were found for ${m}`:"Pitched Items Obtained:"}),P?e.jsx("div",{style:{textAlign:"center",padding:"15px",color:"#b39ddb"},children:"Loading cloud stats..."}):f.length===0?e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"#888",fontSize:"1.1rem"}}):e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:10,marginBottom:8,justifyContent:"center"},children:f.map((h,b)=>e.jsxs("span",{className:"pitched-count-white pitched-hover",style:{display:"inline-flex",alignItems:"center",gap:4,background:"#3a335a",borderRadius:6,padding:"2px 10px",fontSize:"1em",fontWeight:600,cursor:"pointer",boxShadow:"0 0 8px #805ad5",border:"1px solid #805ad5",transition:"transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s cubic-bezier(.4,2,.6,1)",position:"relative"},onClick:()=>{T(h),E(!0)},title:"Click for details",onMouseOver:w=>{w.currentTarget.style.transform="scale(1.08)",w.currentTarget.style.boxShadow="0 4px 16px #a259f7cc"},onMouseOut:w=>{w.currentTarget.style.transform="scale(1)",w.currentTarget.style.boxShadow="0 0 8px #805ad5"},children:[e.jsx("img",{src:h.image,alt:h.name,style:{width:22,borderRadius:4,marginRight:2,transition:"box-shadow 0.18s cubic-bezier(.4,2,.6,1)"}}),h.name,e.jsxs("span",{className:"pitched-count-white",style:{color:"#fff",marginLeft:6,fontWeight:700,fontSize:"1.1em"},children:["Ã—",h.count]})]},b))}),e.jsx("div",{style:{textAlign:"center",marginTop:24},children:e.jsx("button",{style:{background:"#e53e3e",color:"#fff",border:"none",borderRadius:8,padding:"0.6rem 1.5rem",fontWeight:700,fontSize:"1.1rem",cursor:"pointer"},onClick:()=>R(!0),children:"Reset Stats"})})]})}):null}function Ae({showStatsResetConfirm:t,setShowStatsResetConfirm:r,onConfirm:o}){return t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(40,32,74,0.92)",zIndex:6e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-fade",style:{background:"#2d2540",borderRadius:14,padding:"2rem 1.5rem",maxWidth:340,color:"#e6e0ff",boxShadow:"0 4px 24px #0006",position:"relative",minWidth:220,textAlign:"center"},children:[e.jsx("h3",{style:{color:"#ffbaba",marginBottom:16},children:"Are you sure?"}),e.jsx("p",{style:{marginBottom:18},children:"This will permanently erase all stats. This cannot be undone."}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>r(!1),style:{background:"#3a335a",color:"#e6e0ff",border:"none",borderRadius:8,padding:"0.7rem 1.5rem",fontWeight:700,fontSize:"1.1rem",cursor:"pointer",minWidth:100},children:"Cancel"}),e.jsx("button",{onClick:o,style:{background:"#e53e3e",color:"#fff",border:"none",borderRadius:8,padding:"0.7rem 1.5rem",fontWeight:700,fontSize:"1.1rem",cursor:"pointer",minWidth:100},children:"Reset"})]})]})}):null}function Oe({showCharacterPurgeConfirm:t,setShowCharacterPurgeConfirm:r,purgeTargetCharacter:o,purgeInProgress:m,onConfirm:d}){return t?e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(40,32,74,0.96)",zIndex:6e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-fade",style:{background:"#2d2540",borderRadius:16,padding:"2.5rem",maxWidth:480,color:"#e6e0ff",boxShadow:"0 8px 32px rgba(0,0,0,0.5)",position:"relative",minWidth:360,textAlign:"center",border:"2px solid #ff6b6b"},children:[e.jsx("div",{style:{width:80,height:80,background:"linear-gradient(135deg, #ff6b6b, #ff8e8e)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px",boxShadow:"0 4px 20px rgba(255, 107, 107, 0.4)"},children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{style:{color:"#ff6b6b",fontWeight:700,marginBottom:20,fontSize:"1.5rem"},children:"Purge Character Data"}),e.jsxs("div",{style:{background:"rgba(255, 107, 107, 0.1)",border:"1px solid rgba(255, 107, 107, 0.3)",borderRadius:12,padding:"20px",marginBottom:28},children:[e.jsx("p",{style:{marginBottom:12,fontSize:"1.1rem",lineHeight:"1.5",color:"#ffbaba"},children:e.jsx("strong",{children:"This will permanently delete all pitched items and boss runs for:"})}),e.jsx("p",{style:{fontSize:"1.2rem",fontWeight:700,color:"#fff",marginBottom:12},children:o==null?void 0:o.name}),e.jsx("p",{style:{fontSize:"0.9rem",color:"#ffbaba",marginBottom:0},children:"This action cannot be undone."})]}),e.jsxs("div",{style:{display:"flex",gap:16,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>r(!1),disabled:m,style:{background:m?"#2a2540":"#3a335a",color:m?"#888":"#e6e0ff",border:m?"1px solid #2a2540":"2px solid #4a4370",borderRadius:12,padding:"0.8rem 2rem",fontWeight:700,fontSize:"1.1rem",cursor:m?"not-allowed":"pointer",minWidth:140,transition:"all 0.2s ease",opacity:m?.5:1},children:"Cancel"}),e.jsxs("button",{onClick:d,disabled:m,style:{background:m?"#cc5555":"linear-gradient(135deg, #ff6b6b, #ff4757)",color:"#fff",border:"2px solid #ff6b6b",borderRadius:12,padding:"0.8rem 2rem",fontWeight:700,fontSize:"1.1rem",cursor:m?"not-allowed":"pointer",opacity:m?.7:1,minWidth:140,transition:"all 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:m?"none":"0 4px 16px rgba(255, 107, 107, 0.3)"},children:[m&&e.jsx("div",{style:{width:20,height:20,border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"#fff",borderRadius:"50%",animation:"spin 1s linear infinite"}}),m?"Purging...":"Purge Data"]})]})]})}):null}function _e({resetSuccessVisible:t,closeResetSuccess:r,purgeSuccess:o,setPurgeSuccess:m}){return!t&&!o?null:e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",zIndex:7e3,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs("div",{className:"modal-fade",style:{background:"#2d2540",borderRadius:14,padding:"2rem 1.5rem",maxWidth:340,color:"#e6e0ff",boxShadow:"0 4px 24px #0006",position:"relative",minWidth:220,textAlign:"center"},onClick:d=>d.stopPropagation(),children:[e.jsx("h3",{style:{color:"#38a169",marginBottom:16,fontSize:"1.5rem"},children:t?"Stats reset!":"Character purged!"}),e.jsx("p",{style:{marginBottom:24,fontSize:"1.1rem"},children:t?"Your stats have been cleared.":"Character data has been purged."}),e.jsx("button",{onClick:t?r:()=>m(!1),style:{background:"#3a335a",color:"#e6e0ff",border:"none",borderRadius:8,padding:"0.6rem 1.5rem",fontWeight:600,fontSize:"1.1rem",cursor:"pointer",marginTop:10,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:"Close"})]})})}function Fe({showPitchedModal:t,setShowPitchedModal:r,pitchedModalItem:o,pitchedModalDetails:m}){return!t||!o?null:e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(40,32,74,0.92)",zIndex:6e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>r(!1),children:e.jsxs("div",{className:"modal-fade",style:{background:"#2d2540",borderRadius:14,padding:"2rem 1.5rem",maxWidth:400,color:"#e6e0ff",boxShadow:"0 4px 24px #0006",position:"relative",minWidth:220,textAlign:"center"},onClick:d=>d.stopPropagation(),children:[e.jsx("button",{onClick:()=>r(!1),style:{position:"absolute",top:12,right:12,background:"transparent",color:"#fff",border:"none",fontSize:"1.3rem",cursor:"pointer"},title:"Close",children:"Ã—"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:10,marginBottom:16},children:[e.jsx("img",{src:o.image,alt:o.name,style:{width:32,borderRadius:6}}),e.jsx("span",{style:{fontWeight:700,fontSize:"1.1em",color:"#a259f7"},children:o.name})]}),e.jsx("div",{style:{marginBottom:10,color:"#b39ddb",fontWeight:600},children:"Obtained by:"}),m.length===0?e.jsx("div",{style:{color:"#888",marginBottom:8},children:"None this year."}):e.jsx("div",{style:{maxHeight:220,overflowY:"auto",marginBottom:8},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"1em",background:"none"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{color:"#b39ddb",background:"none"},children:[e.jsx("th",{style:{padding:"4px 8px",fontWeight:700},children:"Character"}),e.jsx("th",{style:{padding:"4px 8px",fontWeight:700},children:"Date"})]})}),e.jsx("tbody",{children:m.map((d,f)=>e.jsxs("tr",{style:{background:f%2===0?"#23203a":"#201c32"},children:[e.jsx("td",{style:{padding:"4px 8px",fontWeight:600},children:d.char}),e.jsx("td",{style:{padding:"4px 8px",color:"#b39ddb"},children:d.date})]},f))})]})})]})})}function Ke(t){const r=ie(),[o,m]=c.useState(r),[d,f]=c.useState([]),[P,T]=c.useState({}),[E,R]=c.useState(!1),[h,b]=c.useState({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[]}),w=o!==r,S=w&&!E,g=c.useCallback(async()=>{if(t)try{console.log("ðŸ”„ Refreshing historical analysis...");const x=await ce(t);x.success&&(b({hasHistoricalData:x.hasHistoricalData,oldestHistoricalWeek:x.oldestHistoricalWeek,userType:x.userType,adaptiveWeekLimit:x.adaptiveWeekLimit,historicalWeeks:x.historicalWeeks,analysis:x.analysis}),console.log("âœ… Historical analysis refreshed:",{userType:x.userType,hasData:x.hasHistoricalData,oldestWeek:x.oldestHistoricalWeek,adaptiveLimit:x.adaptiveWeekLimit}))}catch(x){console.error("Error refreshing historical analysis:",x)}},[t]),j=async(x,N={},k=[],n={})=>{x!==o&&(console.log(`Navigating from week ${o} to ${x}`),o&&!P[o]&&(Object.keys(N).length>0||k.length>0)&&T(u=>({...u,[o]:{checkedState:N,pitchedItems:k,pitchedChecked:n,hasData:Object.keys(N).length>0||k.length>0}})),R(!1),m(x))};return c.useEffect(()=>{(async()=>{if(t)try{const[N,k]=await Promise.all([je(t),ce(t)]);N.success&&f(N.weeks),k.success&&(b({hasHistoricalData:k.hasHistoricalData,oldestHistoricalWeek:k.oldestHistoricalWeek,userType:k.userType,adaptiveWeekLimit:k.adaptiveWeekLimit,historicalWeeks:k.historicalWeeks,analysis:k.analysis}),console.log("ðŸ“Š Week navigation updated with historical analysis:",{userType:k.userType,hasData:k.hasHistoricalData,oldestWeek:k.oldestHistoricalWeek,adaptiveLimit:k.adaptiveWeekLimit}))}catch(N){console.error("Error fetching week navigation data:",N)}})()},[t]),{selectedWeekKey:o,availableWeeks:d,weekDataCache:P,setWeekDataCache:T,isHistoricalWeek:w,isReadOnlyMode:S,readOnlyOverride:E,setReadOnlyOverride:R,handleWeekChange:j,historicalAnalysis:h,refreshHistoricalAnalysis:g}}function Ye(t,r,o,m,d,f=null){const[P,T]=c.useState({}),[E,R]=c.useState([]),[h,b]=c.useState(!1),[w,S]=c.useState({}),g=c.useRef(!1),j=N=>{if(!N)return N;const k=N.split("-");if(k.length===3){const n=k[0],u=parseInt(k[1]).toString(),s=parseInt(k[2]).toString();return`${n}-${u}-${s}`}return N},x=async N=>{if(!h)try{b(!0);const k=N||t;if(!k)return;const n=await Se(k);if(n.success){if(R(n.items||[]),!g.current){const u=j(d),s=(n.items||[]).filter(W=>j(W.weekKey)===u),l={};s.forEach(W=>{const a=r.findIndex(B=>B.name===W.character);if(a!==-1){const B=Z(W.character,a,W.boss,W.item,d);l[B]=!0}}),T(l)}}else console.error("Error refreshing pitched items:",n.error)}catch(k){console.error("Error in refreshPitchedItems:",k)}finally{b(!1)}};return c.useCallback(async()=>{if(t)try{const N=await we(t);if(N.success){R(N.data||[]);const k=j(d),n=(N.data||[]).filter(s=>j(s.weekKey)===k),u={};n.forEach(s=>{const l=r.findIndex(W=>W.name===s.character);if(l!==-1){const W=Z(s.character,l,s.boss,s.item,d);u[W]=!0}}),T(u)}}catch(N){console.error("Error refreshing pitched items:",N)}},[t,d,r]),c.useEffect(()=>{(async()=>{try{if(!t)return;const{supabase:k}=await Q(async()=>{const{supabase:s}=await import("./supabaseClient-B7fnwhYs.js");return{supabase:s}},__vite__mapDeps([0,1,2])),{data:n,error:u}=await k.from("user_data").select("pitched_items").eq("id",t).single();if(u){console.error("Error fetching pitched items:",u);return}n&&n.pitched_items&&Array.isArray(n.pitched_items)?R(n.pitched_items):R([])}catch(k){console.error("Error in fetchPitchedItemsFromDatabase:",k)}})()},[t]),c.useEffect(()=>{if(E.length===0)return;(async()=>{try{if(g.current)return;const k=j(d),n=E.filter(u=>j(u.weekKey)===k);if(n.length>0){const u={...o},s={};let l=!1;n.forEach(W=>{const a=r.findIndex(H=>H.name===W.character);if(a===-1)return;const B=`${W.character}-${a}`;u[B]||(u[B]={});const M=r[a];if(!M)return;const z=M.bosses.find(H=>H.name===W.boss);if(!z)return;const L=`${z.name}-${z.difficulty}`,y=Z(W.character,a,W.boss,W.item,d);s[y]=!0,u[B][L]||(u[B][L]=!0,l=!0)}),T(s),l&&(!f||!f.current)?(console.log("ðŸ”„ PITCHED: Updating checked state from pitched items sync"),console.log("ðŸ”„ PITCHED: New checked state being set:",JSON.stringify(u,null,2)),m(u)):l&&(f!=null&&f.current)?(console.log("ðŸš« PITCHED: Skipping checked state update - preservation in progress"),console.log("ðŸš« PITCHED: Would have set:",JSON.stringify(u,null,2))):l||console.log("â„¹ï¸ PITCHED: No boss checks needed updating")}}catch(k){console.error("Error synchronizing pitched items:",k)}})()},[E,d,r]),c.useEffect(()=>{console.log(`ðŸ”„ PITCHED: Week changed to ${d}, updating pitched checked state...`),console.log(`ðŸ”„ PITCHED: Total cloud pitched items: ${E.length}`);const N=j(d);console.log(`ðŸ”„ PITCHED: Normalized week key: ${d} â†’ ${N}`);const k=E.filter(u=>{const s=j(u.weekKey),l=s===N;return l||console.log(`ðŸ”„ PITCHED: Week key mismatch: item(${u.weekKey}â†’${s}) vs target(${d}â†’${N})`),l});console.log(`ðŸ”„ PITCHED: Items for week ${d}:`,k.map(u=>({character:u.character,boss:u.boss,item:u.item,difficulty:u.difficulty,weekKey:u.weekKey,normalizedWeekKey:j(u.weekKey)})));const n={};k.forEach(u=>{const s=r.findIndex(l=>l.name===u.character);if(s!==-1){const l=Z(u.character,s,u.boss,u.item,d);n[l]=!0,console.log(`ðŸ”„ PITCHED: Adding key: ${l}`)}else console.log(`ðŸ”„ PITCHED: Character not found: ${u.character}`)}),console.log(`ðŸ”„ PITCHED: Found ${k.length} pitched items for week ${d}`),console.log("ðŸ”„ PITCHED: Setting pitched checked state:",n),T(n)},[d,E,r]),{pitchedChecked:P,setPitchedChecked:T,cloudPitchedItems:E,setCloudPitchedItems:R,userInteractionRef:g,refreshPitchedItems:x,loadingPitchedItems:w,setLoadingPitchedItems:S,isRefreshingPitchedItems:h}}function Ue({characters:t,selectedCharIdx:r,checked:o,setChecked:m,bossData:d,pitchedChecked:f,setPitchedChecked:P,weekKey:T,selectedWeekKey:E,isHistoricalWeek:R,readOnlyOverride:h,userCode:b,userInteractionRef:w,setCrystalAnimation:S,setError:g,startStatsTrackingIfNeeded:j,refreshHistoricalAnalysis:x}){const N=ie();return{handleCheck:async(s,l,W=null)=>{var a;try{if(R&&!h){console.log("Boss check blocked - read-only mode active for historical week");return}w.current=!0;let B,M,z;if(s&&s.name)B=s,M=l,z=W;else if(s&&s.target)z=s,B=l,M=z.target.checked;else{console.error("Invalid parameters to handleCheck");return}if(z&&z.clientX&&S){const i={x:z.clientX,y:z.clientY},C=document.querySelector(".progress-bar");if(C){const I=C.getBoundingClientRect(),A={x:I.left+I.width/2,y:I.top+I.height/2};S({startPosition:i,endPosition:A})}}const L=((a=t[r])==null?void 0:a.name)||"",y=r,H=`${L}-${y}`,p=B.name,D=B.difficulty,v=`${p}-${D}`,$={...o,[H]:{...o[H]||{},[v]:M}};if(m($),b&&E===N)try{const{saveBossRun:i}=await Q(async()=>{const{saveBossRun:A}=await import("./pitched-data-service-hqf7KOUT.js");return{saveBossRun:A}},__vite__mapDeps([3,1,2,4,5,6,7,8])),C={character:L,characterIdx:y,bossName:p,bossDifficulty:D,isCleared:M,date:new Date().toISOString()},I=await i(b,C);I.success?console.log("âœ… Boss run saved successfully"):console.error("Error saving boss run:",I.error)}catch(i){console.error("Error saving boss state to database:",i)}if(!M&&E===N){const i=d.find(C=>C.name===p);if(i&&i.pitchedItems){P(I=>{const A={...I};return i.pitchedItems.forEach(U=>{const F=Z(L,y,p,U.name,T);A[F]&&delete A[F]}),A});const C=i.pitchedItems.map(I=>({character:L,bossName:p,itemName:I.name,weekKey:T}));C.length>0&&b&&ae(b,C).then(async()=>{x&&await x()}).catch(I=>{console.error("Error removing pitched items:",I)})}}j()}catch(B){console.error("Error in handleCheck:",B),g("Failed to update boss status. Please try again.")}finally{setTimeout(()=>{w.current=!1,console.log("ðŸ–±ï¸ USER: Boss interaction flag cleared, sync can resume")},1e3)}},handleTickAll:async()=>{try{if(R&&!h){console.log("Tick All blocked - read-only mode active for historical week");return}const s=t[r],l=(s==null?void 0:s.bosses)||[],W=`${(s==null?void 0:s.name)||""}-${r}`,a=o[W]||{},M=!l.every(L=>a[L.name+"-"+L.difficulty]);w.current=!0;const z={...o,[W]:Object.fromEntries(l.map(L=>[L.name+"-"+L.difficulty,M]))};if(m(z),!M){const L={...f};l.forEach(y=>{const H=d.find(p=>p.name===y.name);H!=null&&H.pitchedItems&&H.pitchedItems.forEach(p=>{const D=Z(t[r].name,r,y.name,p.name,T);L[D]&&delete L[D]})}),P(L)}if(b)try{console.log(`ðŸ”„ Batch updating ${l.length} bosses to ${M?"checked":"unchecked"}`);const{saveBatchBossRuns:L}=await Q(async()=>{const{saveBatchBossRuns:p}=await import("./pitched-data-service-hqf7KOUT.js");return{saveBatchBossRuns:p}},__vite__mapDeps([3,1,2,4,5,6,7,8])),y=l.map(p=>({character:t[r].name,characterIdx:r,bossName:p.name,bossDifficulty:p.difficulty,isCleared:M,date:new Date().toISOString()})),H=await L(b,y);if(H.success?console.log(`âœ… Batch update successful: ${l.length} bosses updated`):(console.error("Batch update failed:",H.error),g("Failed to save all boss updates. Please try again.")),!M){const p=[];l.forEach(D=>{const v=d.find($=>$.name===D.name);v!=null&&v.pitchedItems&&v.pitchedItems.forEach($=>{const i=Z(t[r].name,r,D.name,$.name,T);f[i]&&p.push({character:t[r].name,bossName:D.name,itemName:$.name,weekKey:T})})}),p.length>0&&(await ae(b,p),x&&await x())}}catch(L){console.error("Error in batch boss update:",L),g("Failed to update all bosses. Please try again.")}}catch(s){console.error("Error in handleTickAll:",s),g("Failed to update all bosses. Please try again.")}finally{setTimeout(()=>{w.current=!1},1e3)}},refreshCheckedStateFromDatabase:async()=>{if(b){try{console.log("ðŸ”„ Refreshing checked state from boss runs...");const{supabase:s}=await Q(async()=>{const{supabase:a}=await import("./supabaseClient-B7fnwhYs.js");return{supabase:a}},__vite__mapDeps([0,1,2])),{data:l,error:W}=await s.from("user_data").select("data").eq("id",b).single();if(!W&&l&&l.data&&l.data.boss_runs){const a={};return l.data.boss_runs.forEach(B=>{if(B.cleared){const M=`${B.character}-${B.characterIdx||0}`,z=`${B.boss}-${B.difficulty}`;a[M]||(a[M]={}),a[M][z]=!0}}),console.log("âœ… Refreshed checked state from boss_runs after boss action"),m(a),a}}catch(s){console.error("Error refreshing checked state from boss runs:",s)}return null}}}}function Ve(t,r){const[o,m]=c.useState(!1),[d,f]=c.useState(!1),[P,T]=c.useState({monthly:[],yearly:[]}),[E,R]=c.useState(!1),[h,b]=c.useState(null),[w,S]=c.useState(!1),[g,j]=c.useState(!1),[x,N]=c.useState([]),[k,n]=c.useState(!1),[u,s]=c.useState({}),[l,W]=c.useState(!1),[a,B]=c.useState(null),[M,z]=c.useState(!1),[L,y]=c.useState(!1),[H,p]=c.useState(null),D=c.useMemo(()=>{const O=te(),K=new Set([O]);return P&&P.yearly&&Array.isArray(P.yearly)&&P.yearly.forEach(_=>K.add(_.yearKey)),Object.keys(u).forEach(_=>K.add(_)),Array.from(K).sort((_,V)=>V.localeCompare(_))},[P.yearly,u]),[v,$]=c.useState(()=>te());c.useEffect(()=>{D&&Array.isArray(D)&&D.length>0&&(D.includes(v)||$(D[0]))},[D,v]),c.useEffect(()=>{o&&t&&(async()=>{try{W(!0);const K=await le(t);K.success&&s(K.data)}catch(K){console.error("Error fetching cloud pitched stats:",K)}finally{W(!1)}})()},[o,t]);const i=c.useMemo(()=>{const O=new Map,K=u[v];K&&K.items&&Array.isArray(K.items)&&K.items.forEach(_=>{if(!_||!_.item||!_.image)return;const V=_.item+"|"+_.image;O.has(V)||O.set(V,{name:_.item,image:_.image,count:0,history:[],source:"cloud"}),O.get(V).count+=1;const Y=new Date(_.date),J=Y.getUTCMonth(),q=Y.getUTCDate();O.get(V).history.push({char:_.character,date:`${fe[J]} ${q}`,cloud:!0,fullDate:_.date})});const G=Array.from(O.values());return G.forEach(_=>{_.history&&Array.isArray(_.history)&&_.history.sort((V,Y)=>V.fullDate&&Y.fullDate?new Date(Y.fullDate)-new Date(V.fullDate):0)}),G.sort((_,V)=>V.count-_.count||_.name.localeCompare(V.name))},[v,u]),C=async(O,K,G,_,V)=>{if(h)try{S(!0);const{name:Y,idx:J}=h;_.current=!0;const q=Ce(O,Y,J,G);if(K(q),(await Pe(t,Y,J)).success){s({}),await r(t);const re=await le(t);re.success&&s(re.data),j(!0),R(!1);const oe=await We(t);oe.success&&N(oe.history),setTimeout(()=>{j(!1)},3e3)}else V("Failed to purge character data. Please try again.")}catch(Y){console.error("Error in handleCharacterPurge:",Y),V("Failed to purge character data. Please try again.")}finally{S(!1),setTimeout(()=>{_.current=!1},1e3)}},I=async O=>{try{if(T({monthly:[],yearly:[]}),$(te()),t)if((await Ne(t)).success)s({}),await r(t);else{O("Failed to reset stats data. Please try again.");return}f(!1),n(!0),setTimeout(()=>{n(!1),m(!1)},3400)}catch(K){console.error("Error in stats reset:",K),O("Failed to reset stats data. Please try again.")}},A=()=>{n(!1),m(!1)},U=c.useMemo(()=>a?a.history||[]:[],[a]);function F(){console.log("Stats tracking is now cloud-based - no action needed")}return{showStats:o,setShowStats:m,showStatsResetConfirm:d,setShowStatsResetConfirm:f,statsPanel:P,setStatsPanel:T,showCharacterPurgeConfirm:E,setShowCharacterPurgeConfirm:R,purgeTargetCharacter:h,setPurgeTargetCharacter:b,purgeInProgress:w,purgeSuccess:g,setPurgeSuccess:j,auditHistory:x,resetSuccessVisible:k,closeResetSuccess:A,cloudPitchedStats:u,setCloudPitchedStats:s,isLoadingCloudStats:l,pitchedModalItem:a,setPitchedModalItem:B,showPitchedModal:M,setShowPitchedModal:z,pitchedModalDetails:U,showHistoricalPitchedModal:L,setShowHistoricalPitchedModal:y,historicalPitchedData:H,setHistoricalPitchedData:p,allYears:D,selectedYear:v,setSelectedYear:$,yearlyPitchedSummary:i,handleCharacterPurge:C,handleStatsReset:I,startStatsTrackingIfNeeded:F}}function Ge({characters:t,bossData:r,checked:o,setChecked:m,userCode:d,preservingCheckedStateRef:f}){function P(i,C){const I=r.find(U=>U.name===i);if(!I)return 0;const A=I.difficulties.find(U=>U.difficulty===C);return A?A.price:0}const[T,E]=c.useState(!0),[R,h]=c.useState(null),[b,w]=c.useState(0),[S,g]=c.useState(null),[j,x]=c.useState(!1),[N,k]=c.useState({weeklyTotal:0,lastReset:new Date().toISOString(),history:[]}),[n,u]=c.useState(()=>{const i=localStorage.getItem(ne.WEEKLY_HIDE_COMPLETED);return i?JSON.parse(i):!1});c.useEffect(()=>{localStorage.setItem(ne.WEEKLY_HIDE_COMPLETED,JSON.stringify(n))},[n]),c.useEffect(()=>{if(t.length)x(!1);else{x(!1);const i=setTimeout(()=>{x(!0)},2e3);return()=>clearTimeout(i)}},[t.length]);const s=Ke(d),l=Ye(d,t,o,m,s.selectedWeekKey,f),W=Ue({characters:t,selectedCharIdx:b,checked:o,setChecked:m,bossData:r,pitchedChecked:l.pitchedChecked,setPitchedChecked:l.setPitchedChecked,weekKey:s.selectedWeekKey,selectedWeekKey:s.selectedWeekKey,isHistoricalWeek:s.isHistoricalWeek,readOnlyOverride:s.readOnlyOverride,userCode:d,userInteractionRef:l.userInteractionRef,setCrystalAnimation:h,setError:g,startStatsTrackingIfNeeded:()=>{},refreshHistoricalAnalysis:s.refreshHistoricalAnalysis}),a=Ve(d,l.refreshPitchedItems),B=i=>{s.handleWeekChange(i,o,l.cloudPitchedItems,l.pitchedChecked)};c.useEffect(()=>{b>=t.length&&w(Math.max(0,t.length-1))},[t.length,b]);const M=t[b],z=`${(M==null?void 0:M.name)||""}-${b}`,L=(M==null?void 0:M.bosses)||[],y=[...L].sort((i,C)=>{try{const I=P(i.name,i.difficulty)/(i.partySize||1);return P(C.name,C.difficulty)/(C.partySize||1)-I}catch{return 0}}),H=t.reduce((i,C,I)=>{const A=`${(C==null?void 0:C.name)||""}-${I}`;return i+(C.bosses||[]).reduce((U,F)=>{var O;return(O=o[A])!=null&&O[F.name+"-"+F.difficulty]?U+P(F.name,F.difficulty)/(F.partySize||1):U},0)},0),p=t.reduce((i,C)=>i+(C.bosses||[]).reduce((I,A)=>I+P(A.name,A.difficulty)/(A.partySize||1),0),0),D=t.map((i,C)=>{const I=`${(i==null?void 0:i.name)||""}-${C}`,A=(i==null?void 0:i.bosses)||[],U=A.filter(K=>{var G;return(G=o[I])==null?void 0:G[K.name+"-"+K.difficulty]}).length,F=A.length,O=A.reduce((K,G)=>{var _;return(_=o[I])!=null&&_[G.name+"-"+G.difficulty]?K+Math.ceil(P(G.name,G.difficulty)/(G.partySize||1)):K},0);return{name:i.name,cleared:U,total:F,allCleared:F>0&&U===F,left:F-U,idx:C,totalMeso:O}}),v=n?D.filter(i=>!i.allCleared):D,$=L.length>0;return S?e.jsxs("div",{className:"App dark",style:{padding:"2rem",color:"#e6e0ff",fontSize:"1.2rem",textAlign:"center"},children:[e.jsx("div",{style:{color:"#ff6b6b",marginBottom:"1rem"},children:S}),e.jsx("button",{onClick:()=>g(null),style:{marginRight:"1rem"},children:"Try Again"})]}):t.length?e.jsxs("div",{className:"App dark",style:{},children:[R&&e.jsx(Le,{startPosition:R.startPosition,endPosition:R.endPosition,onComplete:()=>h(null)}),e.jsxs("div",{style:{display:"flex",maxWidth:1200,margin:"0 auto",width:"100%",minHeight:"100vh",boxSizing:"border-box"},children:[e.jsx(He,{sidebarVisible:T,isHistoricalWeek:s.isHistoricalWeek,totalMeso:H,obtainableMeso:p,selectedWeekKey:s.selectedWeekKey,hideCompleted:n,setHideCompleted:u,visibleCharSummaries:v,selectedCharIdx:b,setSelectedCharIdx:w,isReadOnlyMode:s.isReadOnlyMode,setPurgeTargetCharacter:a.setPurgeTargetCharacter,setShowCharacterPurgeConfirm:a.setShowCharacterPurgeConfirm}),e.jsx($e,{sidebarVisible:T,setSidebarVisible:E}),e.jsx("div",{className:"weekly-tracker-main fade-in",children:e.jsxs("div",{style:{maxWidth:900,margin:"0 auto",padding:"2rem",width:"100%"},children:[e.jsx("div",{style:{textAlign:"center",marginBottom:"2rem"},children:e.jsx("h2",{style:{fontWeight:700,fontSize:"2rem",marginBottom:"0.5rem"},children:"Weekly Boss Tracker"})}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"2rem"},children:e.jsx(Te,{selectedWeekKey:s.selectedWeekKey,onWeekChange:B,availableWeeks:s.availableWeeks,isReadOnlyMode:s.isReadOnlyMode,isHistoricalWeek:s.isHistoricalWeek,historicalAnalysis:s.historicalAnalysis,characters:t,checked:o,selectedCharIdx:b,totalMeso:H,obtainableMeso:p,charSummaries:D})}),e.jsx(Re,{isHistoricalWeek:s.isHistoricalWeek,isReadOnlyMode:s.isReadOnlyMode,readOnlyOverride:s.readOnlyOverride,setReadOnlyOverride:s.setReadOnlyOverride}),$&&e.jsxs("div",{children:[!s.isHistoricalWeek&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:12,marginBottom:24},children:e.jsx("button",{onClick:W.handleTickAll,disabled:s.isReadOnlyMode,style:{padding:"0.5rem 1.2rem",borderRadius:6,background:s.isReadOnlyMode?"#4a4a4a":"#805ad5",color:"#fff",fontWeight:600,cursor:s.isReadOnlyMode?"not-allowed":"pointer",opacity:s.isReadOnlyMode?.5:1,border:"1px solid #9f7aea"},children:L.every(i=>{var C;return(C=o[z])==null?void 0:C[i.name+"-"+i.difficulty]})&&L.length>0?"Untick All":"Tick All"})}),e.jsx(Be,{isHistoricalWeek:s.isHistoricalWeek,characters:t,selectedCharIdx:b,charBosses:L,sortedBosses:y,bossData:r,checked:o,setChecked:m,charKey:z,getBossPrice:P,isReadOnlyMode:s.isReadOnlyMode,pitchedChecked:l.pitchedChecked,setPitchedChecked:l.setPitchedChecked,weekKey:s.selectedWeekKey,handleCheck:W.handleCheck,refreshCheckedStateFromDatabase:W.refreshCheckedStateFromDatabase,userInteractionRef:l.userInteractionRef,userCode:d,savePitchedItem:de,removeManyPitchedItems:ae,setError:g,startStatsTrackingIfNeeded:a.startStatsTrackingIfNeeded,setHistoricalPitchedData:a.setHistoricalPitchedData,setShowHistoricalPitchedModal:a.setShowHistoricalPitchedModal,readOnlyOverride:s.readOnlyOverride,loadingPitchedItems:l.loadingPitchedItems,setLoadingPitchedItems:l.setLoadingPitchedItems,refreshPitchedItems:l.refreshPitchedItems,refreshHistoricalAnalysis:s.refreshHistoricalAnalysis})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:12,marginTop:"2rem"},children:e.jsx("button",{style:{background:"linear-gradient(135deg, #805ad5, #9f7aea)",color:"#fff",border:"none",borderRadius:12,padding:"0.8rem 2.5rem",fontWeight:700,fontSize:"1.1em",cursor:"pointer",width:"100%",maxWidth:320,boxShadow:"0 4px 12px rgba(128, 90, 213, 0.4)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"},onClick:()=>a.setShowStats(!0),children:"View Stats"})})]})}),e.jsx(ze,{showStats:a.showStats,setShowStats:a.setShowStats,allYears:a.allYears,selectedYear:a.selectedYear,setSelectedYear:a.setSelectedYear,yearlyPitchedSummary:a.yearlyPitchedSummary,isLoadingCloudStats:a.isLoadingCloudStats,setPitchedModalItem:a.setPitchedModalItem,setShowPitchedModal:a.setShowPitchedModal,setShowStatsResetConfirm:a.setShowStatsResetConfirm}),e.jsx(Ae,{showStatsResetConfirm:a.showStatsResetConfirm,setShowStatsResetConfirm:a.setShowStatsResetConfirm,onConfirm:()=>a.handleStatsReset(g)}),e.jsx(Oe,{showCharacterPurgeConfirm:a.showCharacterPurgeConfirm,setShowCharacterPurgeConfirm:a.setShowCharacterPurgeConfirm,purgeTargetCharacter:a.purgeTargetCharacter,purgeInProgress:a.purgeInProgress,onConfirm:()=>a.handleCharacterPurge(l.pitchedChecked,l.setPitchedChecked,s.selectedWeekKey,l.userInteractionRef,g)}),e.jsx(_e,{resetSuccessVisible:a.resetSuccessVisible,closeResetSuccess:a.closeResetSuccess,purgeSuccess:a.purgeSuccess,setPurgeSuccess:a.setPurgeSuccess}),e.jsx(Fe,{showPitchedModal:a.showPitchedModal,setShowPitchedModal:a.setShowPitchedModal,pitchedModalItem:a.pitchedModalItem,pitchedModalDetails:a.pitchedModalDetails}),a.showHistoricalPitchedModal&&a.historicalPitchedData&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(40,32,74,0.96)",zIndex:6e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>a.setShowHistoricalPitchedModal(!1),children:e.jsx(Ee,{data:a.historicalPitchedData,characters:t,onClose:()=>a.setShowHistoricalPitchedModal(!1),onConfirm:async(i,C)=>{try{console.log("ðŸ›ï¸ Historical pitched item logging:",{character:C,boss:a.historicalPitchedData.bossName,item:a.historicalPitchedData.itemName,date:i,weekKey:a.historicalPitchedData.weekKey});const I=t.findIndex(U=>U.name===C);if(I===-1){g("Selected character not found");return}const A=await de(d,{character:C,characterIdx:I,bossName:a.historicalPitchedData.bossName,bossDifficulty:"Unknown",itemName:a.historicalPitchedData.itemName,itemImage:a.historicalPitchedData.itemImage,date:i},!1,a.historicalPitchedData.weekKey);if(A.success){console.log("âœ… Historical pitched item saved successfully");const{getPitchedKey:U}=await Q(async()=>{const{getPitchedKey:O}=await Promise.resolve().then(()=>Me);return{getPitchedKey:O}},void 0),F=U(C,I,a.historicalPitchedData.bossName,a.historicalPitchedData.itemName,a.historicalPitchedData.weekKey);l.setPitchedChecked(O=>({...O,[F]:!0})),await l.refreshPitchedItems(d),await s.refreshHistoricalAnalysis(),a.setShowHistoricalPitchedModal(!1)}else console.error("âŒ Failed to save historical pitched item:",A.error),g("Failed to save historical pitched item: "+(A.error||"Unknown error"))}catch(I){console.error("âŒ Error in historical pitched item save:",I),g("Error saving historical pitched item: "+I.message)}}})})]})]}):e.jsxs("div",{className:"App dark",style:{padding:"2rem",color:"#e6e0ff",fontSize:"1.2rem",textAlign:"center"},children:[e.jsx("div",{style:{opacity:j?1:0,transition:"opacity 0.5s ease-in-out",animation:j?"fadeInMessage 0.5s ease-in-out":"none"},children:"No characters found. Go back and add a character first."}),e.jsx("style",{children:`
            @keyframes fadeInMessage {
              from {
                opacity: 0;
                transform: translateY(10px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }
          `})]})}function at(){const{navigate:t}=be(),{userCode:r,isLoggedIn:o,handleDeleteAccount:m}=ue(),{characters:d,checked:f,setChecked:P,fullUserData:T,weekKey:E,preservingCheckedStateRef:R}=Ie(),[h,b]=c.useState(!1),[w,S]=c.useState(!1),[g,j]=c.useState(""),[x,N]=c.useState(!1);if(!o)return t("/login",{replace:!0}),null;const k=async()=>{N(!0),j("");try{const n=await m();n.success?(S(!1),t("/login",{replace:!0})):j(n.error)}catch(n){j("Failed to delete account. Try again."),console.error("Delete error:",n)}finally{N(!1)}};return e.jsxs("div",{className:"page-container",children:[e.jsx(ke,{currentPage:"weeklytracker",onShowHelp:()=>b(!0),onShowDeleteConfirm:()=>S(!0)}),e.jsx(ge,{children:e.jsx(Ge,{characters:d,bossData:ve,checked:f,setChecked:P,userCode:r,fullUserData:T,weekKey:E,preservingCheckedStateRef:R})}),h&&e.jsx("div",{className:"modal-backdrop",onClick:()=>b(!1),children:e.jsxs("div",{className:"modal-fade modal-content",onClick:n=>n.stopPropagation(),children:[e.jsx("button",{onClick:()=>b(!1),className:"modal-close-btn",title:"Close",children:"Ã—"}),e.jsx("h2",{className:"modal-title",children:"Help & FAQ"}),e.jsxs("div",{className:"modal-section-content",style:{marginBottom:24},children:[e.jsx("h3",{className:"modal-section-title",children:"Weekly Tracking"}),e.jsx("p",{children:"Track your boss completions and see your weekly mesos progress"}),e.jsx("p",{children:"Check off bosses as you complete them throughout the week"}),e.jsx("p",{children:"Click on pitched item icons to track rare drops from bosses"})]}),e.jsxs("div",{className:"modal-section-content",style:{marginBottom:24},children:[e.jsx("h3",{className:"modal-section-title",children:"Pitched Items & Stats"}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Pitched tracking:"})," Click item icons to track rare boss drops"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Historical data:"})," Navigate between weeks to view past progress"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Stats overview:"})," View detailed statistics of all your pitched items"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Character management:"})," Purge data for specific characters if needed"]})]}),e.jsxs("div",{className:"modal-section-content",style:{marginBottom:24},children:[e.jsx("h3",{className:"modal-section-title",children:"Week Navigation"}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Current week:"})," Full editing capabilities for this week's progress"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Historical weeks:"})," View-only mode for past weeks (toggle edit mode if needed)"]}),e.jsxs("p",{children:["â€¢ ",e.jsx("strong",{children:"Smart navigation:"})," Only shows weeks where you have data"]})]}),e.jsxs("div",{className:"modal-section-content",children:[e.jsx("h3",{className:"modal-section-title",children:"Quick Tips"}),e.jsx("p",{children:'â€¢ Use "Tick All" to quickly mark all bosses completed for a character'}),e.jsx("p",{children:"â€¢ Hide completed characters to focus on remaining work"}),e.jsx("p",{children:"â€¢ Weekly reset happens every Thursday at 00:00 UTC"}),e.jsx("p",{children:"â€¢ Pitched items are automatically linked to boss completions"})]})]})}),w&&e.jsx("div",{className:"modal-backdrop modal-backdrop-critical",onClick:()=>S(!1),children:e.jsxs("div",{className:"modal-fade modal-content-critical",onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"critical-modal-icon",children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"critical-modal-title",children:"Delete Account"}),e.jsx("div",{className:"critical-modal-warning",children:e.jsxs("p",{children:[e.jsx("strong",{children:"This will permanently delete your account and all associated data."}),e.jsx("br",{}),"This action cannot be undone."]})}),e.jsxs("div",{className:"modal-button-container",children:[e.jsx("button",{onClick:()=>S(!1),disabled:x,className:"modal-btn-cancel",children:"Cancel"}),e.jsxs("button",{onClick:k,disabled:x,className:"modal-btn-critical",children:[x&&e.jsx("div",{className:"loading-spinner"}),x?"Deleting...":"Delete Forever"]})]}),g&&e.jsx("div",{className:"modal-error-message",children:g})]})})]})}export{at as default};
