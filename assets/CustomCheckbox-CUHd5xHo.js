const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabaseClient-D8oTKsok.js","assets/vendor-supabase-BFiW0B7-.js","assets/vendor-react-DrD-X_hS.js","assets/pitched-data-service-D4ozxiqx.js","assets/Navbar-DRcgWmZ6.js","assets/vendor-ui-CuB_UNaH.js","assets/vendor-router-JN-2l_OL.js","assets/index-BZwWEsGV.js","assets/index-tCh2PDLW.css"])))=>i.map(i=>d[i]);
import{_ as T}from"./vendor-supabase-BFiW0B7-.js";import{r as g}from"./vendor-router-JN-2l_OL.js";import{u as ye,L as U}from"./index-BZwWEsGV.js";import{g as V,b as M}from"./Navbar-DRcgWmZ6.js";import{j}from"./vendor-ui-CuB_UNaH.js";function ge(c,b){const n=g.useMemo(()=>l=>l.bosses.reduce((u,_)=>u+Math.ceil((_.price||0)/(_.partySize||1)),0),[]),d=g.useMemo(()=>c.reduce((l,u)=>l+n(u),0),[c,n]),i=g.useMemo(()=>[...b].sort((l,u)=>{const _=Math.max(...l.difficulties.map(B=>B.price));return Math.max(...u.difficulties.map(B=>B.price))-_}),[b]),m=g.useMemo(()=>c.reduce((l,u)=>{var _;return l+(((_=u.bosses)==null?void 0:_.length)||0)},0),[c]),h=g.useMemo(()=>(l,u)=>l==="Limbo"?[1,2,3]:l==="Lotus"&&u==="Extreme"?[1,2]:[1,2,3,4,5,6],[]),S=g.useMemo(()=>l=>l.difficulties.map(u=>u.difficulty),[]);return{charTotal:n,overallTotal:d,sortedBossData:i,totalBossCount:m,getAvailablePartySizes:h,getBossDifficulties:S}}function be(c){const b=[],n=new Set,d={};return c.boss_runs&&Array.isArray(c.boss_runs)&&c.boss_runs.forEach(i=>{if(i.character&&typeof i.characterIdx=="number"){const m=`${i.character}-${i.characterIdx}`;if(n.has(m)||(n.add(m),b.push({name:i.character,index:i.characterIdx,bosses:[]})),d[m]||(d[m]=new Set),i.boss&&i.difficulty){const h=`${i.boss}-${i.difficulty}`;d[m].has(h)||d[m].add(h)}}}),c.checked&&typeof c.checked=="object"&&Object.keys(c.checked).forEach(i=>{const m=i.split("-");if(m.length>=2){const h=m.slice(0,-1).join("-"),S=parseInt(m[m.length-1]);if(!isNaN(S)&&h){const l=`${h}-${S}`;n.has(l)||(n.add(l),b.push({name:h,index:S,bosses:[]})),d[l]||(d[l]=new Set),Object.keys(c.checked[i]||{}).forEach(u=>{const _=u.split("-");if(_.length>=2){const x=_[_.length-1],A=`${_.slice(0,-1).join("-")}-${x}`;d[l].has(A)||d[l].add(A)}})}}}),c.weeklyBossClearHistory&&typeof c.weeklyBossClearHistory=="object"&&Object.values(c.weeklyBossClearHistory).forEach(i=>{i.bossClearStatus&&typeof i.bossClearStatus=="object"&&Object.keys(i.bossClearStatus).forEach(m=>{const h=m.split("-");if(h.length>=2){const S=h.slice(0,-1).join("-"),l=parseInt(h[h.length-1]);if(!isNaN(l)&&S){const u=`${S}-${l}`;n.has(u)||(n.add(u),b.push({name:S,index:l,bosses:[]})),d[u]||(d[u]=new Set),Object.keys(i.bossClearStatus[m]||{}).forEach(_=>{const x=_.split("-");if(x.length>=2){const B=x[x.length-1],R=`${x.slice(0,-1).join("-")}-${B}`;d[u].has(R)||d[u].add(R)}})}}})}),b.forEach(i=>{const m=`${i.name}-${i.index}`,h=d[m];h&&h.size>0&&(i.bosses=Array.from(h).map(S=>{const l=S.split("-"),u=l[l.length-1];return{name:l.slice(0,-1).join("-"),difficulty:u,partySize:1,price:0}}))}),b.sort((i,m)=>i.index-m.index),b}function Ee(){const{userCode:c,isLoggedIn:b}=ye(),[n,d]=g.useState([]),[i,m]=g.useState(""),[h,S]=g.useState(null),[l,u]=g.useState(""),[_,x]=g.useState(!1),[B,A]=g.useState({}),R=g.useRef(!1),$=r=>{A(r)},[H,F]=g.useState(""),[G,N]=g.useState(!1),[v,z]=g.useState(null),[J,Q]=g.useState(""),[W,X]=g.useState(!1),Y=g.useRef(null),P=g.useRef(null),{charTotal:Z,overallTotal:K,sortedBossData:ee,totalBossCount:te,getAvailablePartySizes:L,getBossDifficulties:se}=ge(n,M);g.useEffect(()=>{if(!c||!b){d([]),A({}),u("");return}(async()=>{try{u("");const{supabase:s}=await T(async()=>{const{supabase:t}=await import("./supabaseClient-D8oTKsok.js");return{supabase:t}},__vite__mapDeps([0,1,2])),{data:e,error:a}=await s.from("user_data").select("data").eq("id",c).single();if(a){if(a.code==="PGRST116"){d([]),$({});return}throw a}if(e&&e.data){const t=e.data;if(t.characters&&Array.isArray(t.characters))d(t.characters);else{const f=be(t);d(f)}const o={};t.boss_runs&&Array.isArray(t.boss_runs)&&t.boss_runs.forEach(f=>{if(f.cleared){const p=`${f.character}-${f.characterIdx||0}`,y=`${f.boss}-${f.difficulty}`;o[p]||(o[p]={}),o[p][y]=!0}}),Object.keys(o).length===0&&t.checked&&typeof t.checked=="object"?$(t.checked):$(o)}else d([]),$({})}catch{u("Failed to load user data. Please try refreshing the page.")}})()},[c,b]);const ae=async()=>{if(!(!c||!b)){try{const{supabase:r}=await T(async()=>{const{supabase:a}=await import("./supabaseClient-D8oTKsok.js");return{supabase:a}},__vite__mapDeps([0,1,2])),{data:s,error:e}=await r.from("user_data").select("data").eq("id",c).single();if(e)throw e;if(s&&s.data&&s.data.boss_runs&&Array.isArray(s.data.boss_runs)){const a={};return s.data.boss_runs.forEach(t=>{if(t.cleared){const o=`${t.character}-${t.characterIdx||0}`,f=`${t.boss}-${t.difficulty}`;a[o]||(a[o]={}),a[o][f]=!0}}),$(a),a}}catch{}return null}},re=r=>{const s=r.split("-");if(s.length>=2){const e=parseInt(s[s.length-1]);return[s.slice(0,-1).join("-"),e]}return[r,0]},oe=(r,s,e)=>r.find((a,t)=>a.name===s&&(a.index===e||t===e)),ce=(r,s)=>{const e={...s};return Object.keys(e).forEach(a=>{const[t,o]=re(a),f=oe(r,t,o);if(!f)delete e[a];else{const p=(f.bosses||[]).map(w=>`${w.name}-${w.difficulty}`);Object.keys(e[a]||{}).forEach(w=>{p.includes(w)||delete e[a][w]}),Object.keys(e[a]||{}).length===0&&delete e[a]}}),e},ne=async(r,s)=>{if(!(!c||!b))try{const e=new Date().toISOString(),{supabase:a}=await T(async()=>{const{supabase:C}=await import("./supabaseClient-D8oTKsok.js");return{supabase:C}},__vite__mapDeps([0,1,2])),{data:t,error:o}=await a.from("user_data").select("data").eq("id",c).single();if(o){console.error("Error fetching user data for boss_runs cleanup:",o);return}const f=t.data||{},p=f.boss_runs||[];if(p.length===0)return;const y=new Set;r.forEach((C,I)=>{var k;(k=C.bosses)==null||k.forEach(E=>{const D=`${C.name}-${I}-${E.name}-${E.difficulty}`;y.add(D)})});const w=p.filter(C=>{const I=`${C.character}-${C.characterIdx||0}-${C.boss}-${C.difficulty}`,k=y.has(I);return k});if(w.length!==p.length){const C={...f,boss_runs:w,lastUpdated:new Date().toISOString()},{error:I}=await a.from("user_data").update({data:C}).eq("id",c);I&&console.error("❌ DATABASE: Error updating boss_runs:",I)}}catch(e){console.error("❌ DATABASE: Error in cleanupBossRunsInDatabase:",e)}},q=async r=>{if(!c||!b){console.log("❌ PRESERVE: Skipping - no userCode or not logged in");return}R.current=!0;const s=ce(r,B);$(s),await ne(r);try{const{cleanupOrphanedPitchedItems:e}=await T(async()=>{const{cleanupOrphanedPitchedItems:t}=await import("./pitched-data-service-D4ozxiqx.js");return{cleanupOrphanedPitchedItems:t}},__vite__mapDeps([3,1,2,4,5,6,7,8])),a=await e(c,r);a.success&&a.itemsRemoved>0}catch(e){console.error("Error cleaning up orphaned pitched items:",e)}setTimeout(()=>{R.current=!1},500)},O=async r=>{if(!(!c||!b))try{const{supabase:s}=await T(async()=>{const{supabase:p}=await import("./supabaseClient-D8oTKsok.js");return{supabase:p}},__vite__mapDeps([0,1,2])),{data:e,error:a}=await s.from("user_data").select("data").eq("id",c).single();if(a&&a.code!=="PGRST116")throw a;const o={...(e==null?void 0:e.data)||{},...r,lastUpdated:new Date().toISOString()};"checked"in o&&delete o.checked;const{error:f}=await s.from("user_data").update({data:o}).eq("id",c);if(f)throw f}catch(s){console.error("Error saving to cloud:",s)}},ie=r=>{x(!0),S(r.target.value?parseInt(r.target.value):null),setTimeout(()=>x(!1),300)},de=async()=>{if(!i.trim()||n.length>=U.CHARACTER_CAP)return;const r=n.length>0?Math.max(...n.map(t=>t.index||0))+1:0,s={name:i.trim(),index:r,bosses:[]},e=[...n,s];d(e),m(""),await O({characterBossSelections:e})},le=async r=>{if(r<0||r>=n.length)return;const s=n[r];z({character:s,index:r,timestamp:Date.now()}),N(!0),P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{N(!1),z(null)},1e4);const e=n.filter((a,t)=>t!==r);d(e),h===r?S(e.length>0?Math.max(0,r-1):null):h>r&&S(h-1);try{const{supabase:a}=await T(async()=>{const{supabase:E}=await import("./supabaseClient-D8oTKsok.js");return{supabase:E}},__vite__mapDeps([0,1,2])),{data:t,error:o}=await a.from("user_data").select("data, pitched_items").eq("id",c).single();if(o&&o.code!=="PGRST116")throw o;const f=(t==null?void 0:t.data)||{},p=(t==null?void 0:t.pitched_items)||[],w=(f.boss_runs||[]).filter(E=>{const D=!(E.character===s.name&&(E.characterIdx===r||E.characterIdx===s.index));return D}),C=p.filter(E=>{const D=E.character!==s.name;return D}),I={...f,characterBossSelections:e,boss_runs:w,lastUpdated:new Date().toISOString()},{error:k}=await a.from("user_data").update({data:I,pitched_items:C}).eq("id",c);if(k)throw k}catch(a){console.error("❌ DELETE: Error cleaning up database entries:",a),u("Failed to completely remove character data from database"),setTimeout(()=>u(""),5e3)}},ue=()=>{if(!v)return;P.current&&clearTimeout(P.current);const r=[...n];r.splice(v.index,0,v.character),d(r),(h===null||h>=v.index)&&S(v.index),N(!1),z(null)},fe=async(r,s)=>{const e=n.map((t,o)=>o===r?{...t,name:s}:t);d(e),await O({characterBossSelections:e})},he=(r,s,e)=>{const a=n.map((o,f)=>f!==r?o:e?o.bosses.find(y=>y.name===s)?{...o,bosses:o.bosses.map(y=>y.name===s?{...y,difficulty:e,price:V(M.find(w=>w.name===s),e),partySize:L(s,e)[0]||1}:y)}:o.bosses.length<U.CHARACTER_BOSS_CAP?{...o,bosses:[...o.bosses,{name:s,difficulty:e,price:V(M.find(y=>y.name===s),e),partySize:L(s,e)[0]||1}]}:o:o.bosses.find(w=>w.name===s)?{...o,bosses:o.bosses.filter(w=>w.name!==s)}:o);d(a),q(a).catch(console.error),(async()=>{await O({characterBossSelections:a})})().catch(console.error)},pe=(r,s)=>{const e=n.map((t,o)=>{if(o!==r)return t;const f=s.map(p=>({name:p.name,difficulty:p.difficulty,price:V(M.find(y=>y.name===p.name),p.difficulty),partySize:p.partySize||L(p.name,p.difficulty)[0]||1}));return{...t,bosses:f}});d(e),q(e).catch(console.error),(async()=>{await O({characterBossSelections:e})})().catch(console.error)},me=async(r,s,e,a)=>{const t=n.map((f,p)=>p!==r?f:{...f,bosses:f.bosses.map(y=>y.name===s&&y.difficulty===e?{...y,partySize:a}:y)});d(t),await O({characterBossSelections:t})};return g.useEffect(()=>{h>=n.length&&S(Math.max(0,n.length-1))},[n.length,h]),{characterBossSelections:n,setCharacterBossSelections:d,newCharName:i,setNewCharName:m,selectedCharIdx:h,setSelectedCharIdx:S,error:l,setError:u,isLoading:_,setIsLoading:x,checked:B,setChecked:A,cloneError:H,setCloneError:F,showUndo:G,undoData:v,fileInputRef:Y,importError:J,setImportError:Q,importSuccess:W,setImportSuccess:X,charTotal:Z,overallTotal:K,sortedBossData:ee,totalBossCount:te,getAvailablePartySizes:L,getBossDifficulties:se,handleCharacterChange:ie,addCharacter:de,removeCharacter:le,handleUndo:ue,toggleBoss:he,updateCharacterName:fe,updatePartySize:me,batchSetBosses:pe,refreshCheckedStateFromBossRuns:ae,preserveCheckedStateOnBossChange:q,preservingCheckedStateRef:R}}function Be({checked:c,onChange:b,disabled:n=!1}){return j.jsxs("div",{className:"checkbox-wrapper",style:{transform:"scale(0.8)",opacity:n?.5:1,cursor:n?"not-allowed":"pointer"},children:[j.jsx("input",{type:"checkbox",checked:c,onChange:b,disabled:n,style:{background:"#3a335a",color:"#e6e0ff",border:"1.5px solid #2d2540",cursor:n?"not-allowed":"pointer"}}),j.jsxs("svg",{viewBox:"0 0 35.6 35.6",children:[j.jsx("circle",{className:"background",cx:"17.8",cy:"17.8",r:"17.8"}),j.jsx("circle",{className:"stroke",cx:"17.8",cy:"17.8",r:"14.37"}),j.jsx("polyline",{className:"check",points:"11.78 18.12 15.55 22.23 25.17 12.87"})]})]})}export{Be as C,Ee as u};
