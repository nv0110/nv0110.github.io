const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BOPki7CY.js","assets/vendor-ui-aK89YfOw.js","assets/vendor-router-Cg8TMqY4.js","assets/vendor-react-eWEExxYH.js","assets/vendor-supabase-B7S7y5aO.js","assets/index-o9PZVm3f.css"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-aK89YfOw.js";import{r as c,c as Le}from"./vendor-router-Cg8TMqY4.js";import{g as $e,c as fe,p as We,d as Ce,e as xe,f as me,l as X,h as Pe,i as oe,j as Ie,k as ge,m as Ee,r as He,n as Te,o as Me,q as he,M as _e,u as be,b as Se,S as ve,a as Re,N as ke,V as Fe,H as Be,W as Oe,D as Ae}from"./index-BOPki7CY.js";import{C as Ke}from"./CustomCheckbox-C2-rm8qf.js";import{getBossPitchedItems as ue,getBossDataForFrontend as Ge}from"./bossRegistryService-CzaT6rGM.js";import{getHistoricalWeekAnalysis as Ye,purgeAllStatsData as Ue,clearCharacterPitchedUI as ze,purgePitchedRecords as Ve,getPitchedResetAuditHistory as Ze}from"./utilityService-CdBu7uq6.js";import{markAllBossesForCharacter as qe,clearAllBossesForCharacter as Je,toggleBossClearStatus as Xe,fetchCurrentWeekData as ye,addCharacterToWeeklySetup as Qe,removeCharacterFromWeeklySetup as et,updateCharacterNameInWeeklySetup as tt,updateCharacterBossConfigInWeeklySetup as st,saveOrUpdateUserWeeklyData as at,fetchUserWeeklyData as rt}from"./userWeeklyDataService-CZHArzoq.js";import{getCurrentMapleWeekStartDate as we}from"./mapleWeekUtils-Bm65Nri8.js";import{getBossRegistryId as it}from"./bossCodeMapping-BWbetsCB.js";import{_ as Ne}from"./vendor-supabase-B7S7y5aO.js";import"./vendor-react-eWEExxYH.js";function de(t){if(t===0)return"0";if(t<1e9){const i=t/1e6;if(i<1){const r=t/1e3;return r<1?t.toString():`${r.toFixed(1)}K`}return`${i.toFixed(1)}M`}return`${(t/1e9).toFixed(1)}B`}function lt({appWeekKey:t,selectedWeekKey:n,onWeekChange:i,historicalAnalysis:r={hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[]},characterBossSelections:h=[],checked:j={},selectedCharIdx:N=0}){const p=c.useMemo(()=>{const x=(r==null?void 0:r.adaptiveWeekLimit)||8;return{min:-x,max:0,current:0,adaptiveLimit:x}},[r,t]),y=c.useMemo(()=>$e(n,t),[n,t]),s=c.useCallback(l=>{l!==n&&i(l)},[n,i]),o=()=>{const l=y-1;if(l>=p.min){const x=fe(l,t);s(x)}},S=()=>{const l=y+1;if(l<=p.max){const x=fe(l,t);s(x)}},$=c.useCallback(()=>{if(r!=null&&r.hasHistoricalData&&(r!=null&&r.oldestHistoricalWeek))s(r.oldestHistoricalWeek);else{const l=fe(-p.adaptiveLimit,t);s(l)}},[r,p.adaptiveLimit,t,s]),b=()=>{s(t)},g=y>p.min,D=y<p.max,C=(r==null?void 0:r.hasHistoricalData)||y>-p.adaptiveLimit,m=n===t,w=c.useMemo(()=>{const l=We(n),x=Ce(n);return{label:xe(n,t),parsed:l,dateRange:x,isSelectedWeekTheCurrentAppWeek:m,offset:y}},[n,t,m,y]),u=h[N],k=(u==null?void 0:u.bosses)||[],f=`${(u==null?void 0:u.name)||"char"}-${(u==null?void 0:u.index)!==void 0?u.index:N}`;let a=0;u&&(a=k.reduce((l,x)=>{const _=x.price||0,F=x.partySize||1;return l+Math.ceil(_/F)},0));let d=0;return u&&j[f]&&(d=k.reduce((l,x)=>{var F;const _=`${x.name}-${x.difficulty}`;if((F=j[f])!=null&&F[_]){const J=x.price||0,v=x.partySize||1;return l+Math.ceil(J/v)}return l},0)),e.jsxs("div",{className:"week-navigator-container",children:[e.jsx("div",{className:"week-navigator-header",children:e.jsxs("div",{className:`week-navigator-title ${m?"current-week":"historical-week"}`,children:[e.jsx("span",{className:"week-title-text",children:w.label.replace(/\s*\(Current\)/i,"")}),m&&e.jsx("span",{className:"week-navigator-current-dot",children:e.jsx("span",{className:"week-navigator-current-dot-inner"})})]})}),e.jsxs("div",{className:"week-navigator-navigation",children:[e.jsx("div",{className:"week-navigator-arrow-container",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:g?o:void 0,className:`week-navigator-arrow arrow-left ${g?"enabled":"disabled"}`,title:g?"Previous Week":`Already at oldest allowed week (${p.adaptiveLimit} weeks back from current)`,children:e.jsx("path",{d:"M20.3284 11.0001V13.0001L7.50011 13.0001L10.7426 16.2426L9.32842 17.6568L3.67157 12L9.32842 6.34314L10.7426 7.75735L7.49988 11.0001L20.3284 11.0001Z",fill:"currentColor"})})}),w.dateRange&&e.jsxs("div",{className:"week-navigator-date-range",children:[w.dateRange.start.toLocaleDateString()," - ",w.dateRange.end.toLocaleDateString()]}),e.jsx("div",{className:"week-navigator-arrow-container",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",onClick:m?C?$:void 0:D?S:void 0,className:`week-navigator-arrow arrow-right ${m?C?"enabled":"disabled":D?"enabled":"disabled"}`,title:m?C?r!=null&&r.hasHistoricalData&&(r!=null&&r.oldestHistoricalWeek)?`Jump to oldest data (${xe(r.oldestHistoricalWeek,t)})`:`Jump to ${p.adaptiveLimit} weeks back`:"No older data available to jump to":D?"Next Week":"Already at current application week",children:e.jsx("path",{d:"M15.0378 6.34317L13.6269 7.76069L16.8972 11.0157L3.29211 11.0293L3.29413 13.0293L16.8619 13.0157L13.6467 16.2459L15.0643 17.6568L20.7079 11.9868L15.0378 6.34317Z",fill:"currentColor"})})})]}),e.jsx("div",{className:"week-navigator-content",children:m&&u&&e.jsx("div",{className:"week-navigator-progress",children:e.jsxs("div",{className:"week-navigator-progress-meso",children:[e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${a>0?Math.min(d/a*100,100):0}%`},children:a>0&&d>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:de(d)}),e.jsx("span",{children:de(a)})]})]})})}),e.jsx("div",{className:"week-navigator-buttons",children:m?e.jsx("div",{className:"week-navigator-spacer"}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:b,className:"week-navigator-button current-week-btn",title:"Jump to current application week",children:"Current Week"}),(r==null?void 0:r.hasHistoricalData)&&(r==null?void 0:r.oldestHistoricalWeek)&&n!==r.oldestHistoricalWeek&&e.jsx("button",{onClick:$,className:"week-navigator-button oldest-data-btn",title:`Jump to oldest recorded data (${xe(r.oldestHistoricalWeek,t)})`,children:"Oldest Data"})]})})]},n)}function nt({startPosition:t,endPosition:n,onComplete:i}){const[r,h]=c.useState(t),[j,N]=c.useState(1);return c.useEffect(()=>{const p=Date.now(),y=1e3,s=()=>{const o=Date.now()-p,S=Math.min(o/y,1),$=1-Math.pow(1-S,3),b=t.x+(n.x-t.x)*$,g=t.y+(n.y-t.y)*$;h({x:b,y:g}),N(1-S),S<1?requestAnimationFrame(s):i()};requestAnimationFrame(s)},[t,n,i]),e.jsx("div",{style:{position:"fixed",left:r.x,top:r.y,transform:"translate(-50%, -50%)",opacity:j,pointerEvents:"none",zIndex:1e3,transition:"transform 0.1s ease"},children:e.jsx("img",{src:"/bosses/crystal.png",alt:"Crystal",style:{width:24,height:24,transform:`rotate(${r.x*.1}deg)`,filter:"drop-shadow(0 0 4px rgba(162, 89, 247, 0.6))"}})})}const ct=Le.memo(function({sidebarVisible:n,isHistoricalWeek:i,totalMeso:r,obtainableMeso:h,selectedWeekKey:j,hideCompleted:N,setHideCompleted:p,visibleCharSummaries:y,selectedCharIdx:s,setSelectedCharIdx:o,setPurgeTargetCharacter:S,setShowCharacterPurgeConfirm:$,setShowCharacterPitchedModal:b,onShowTreasureAnalytics:g}){const[D,C]=c.useState(!1),[m,w]=c.useState(!1),u=c.useRef(null),k=c.useRef(null);c.useEffect(()=>{const a=()=>{const x=u.current;if(x){const _=x.scrollHeight>x.clientHeight,F=x.scrollTop+x.clientHeight>=x.scrollHeight-5;C(_&&!F&&!m)}},d=()=>{w(!0),C(!1),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{w(!1),a()},1e3)};a();const l=u.current;if(l)return l.addEventListener("scroll",d),()=>{l.removeEventListener("scroll",d),k.current&&clearTimeout(k.current)}},[y,m]),c.useEffect(()=>{n&&setTimeout(()=>{const a=u.current;if(a){const d=a.scrollHeight>a.clientHeight,l=a.scrollTop+a.clientHeight>=a.scrollHeight-5;C(d&&!l&&!m)}},100)},[n,m]);const f=c.useCallback((a,d)=>{a.stopPropagation(),o(d.idx),b&&b(!0)},[o,b]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:`sidebar-scroll fade-in-no-slide ${n?"visible":"hidden"}`,children:e.jsxs("div",{className:"sidebar-content",children:[e.jsx("div",{className:"sidebar-header",children:e.jsx("h3",{className:"sidebar-title",onClick:g,title:"View logged item analytics across all characters",children:"Characters"})}),!i&&e.jsxs("div",{className:"sidebar-progress-section",children:[e.jsx("div",{className:"sidebar-progress-title",children:"Weekly Progress"}),e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${h>0?Math.min(r/h*100,100):0}%`},children:h>0&&r>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:de(r)}),e.jsx("span",{children:de(h)})]})]}),i&&e.jsxs("div",{className:"sidebar-historical-section",children:[e.jsxs("div",{className:"sidebar-historical-title",children:["Week ",j.split("-").slice(1).join("-")]}),e.jsx("div",{className:"sidebar-historical-subtitle",children:"Historical Data"})]}),e.jsxs("div",{className:"sidebar-character-list-container",children:[e.jsx("div",{className:"sidebar-character-list",ref:u,children:y.length===0?e.jsx("div",{className:"sidebar-empty-state",children:N?"No characters with bosses left to clear.":"No characters found."}):y.map(a=>e.jsxs("div",{onClick:()=>o(a.idx),onContextMenu:d=>{d.preventDefault(),S({name:a.name,idx:a.idx}),$(!0)},className:`sidebar-character-card ${s===a.idx?`selected ${i?"historical-week":"current-week"}`:"default"}`,children:[e.jsxs("div",{className:"sidebar-character-header",children:[e.jsx("span",{className:`sidebar-character-name ${s===a.idx?"selected":"default"}`,children:a.name}),e.jsxs("div",{className:"sidebar-character-actions",children:[a.allCleared&&e.jsxs("svg",{className:"sidebar-character-checkmark",width:"16",height:"16",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("button",{className:"sidebar-character-pitched-btn",onClick:d=>f(d,a),title:"View pitched items",children:e.jsxs("div",{className:"pitched-btn-content",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7.75735 13.2574L2 9.27L8.91 8.26L12 2Z",fill:"url(#starGradient)",stroke:"url(#starStrokeGradient)",strokeWidth:"1.5"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"starGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]}),e.jsxs("linearGradient",{id:"starStrokeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#d6b4ff"}),e.jsx("stop",{offset:"1",stopColor:"#a259f7"})]})]})]}),e.jsx("span",{className:"pitched-btn-glow"})]})})]})]}),e.jsx("div",{className:"sidebar-character-stats",children:a.total===0?e.jsx("div",{className:"sidebar-character-no-bosses",children:"No bosses configured"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-character-completion",children:[a.cleared," / ",a.total," bosses cleared"]}),e.jsxs("div",{className:"sidebar-character-meso",children:[de(a.totalMeso)," meso"]})]})})]},a.name+"-"+a.idx))}),D&&e.jsx("div",{className:"sidebar-scroll-indicator",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M11.0001 3.67157L13.0001 3.67157L13.0001 16.4999L16.2426 13.2574L17.6568 14.6716L12 20.3284L6.34314 14.6716L7.75735 13.2574L11.0001 16.5001L11.0001 3.67157Z",fill:"currentColor"})})})]})]})})})});function ot({sidebarVisible:t,setSidebarVisible:n}){return e.jsx("div",{className:`sidebar-toggle ${t?"visible":"hidden"}`,onClick:()=>n(!t),title:t?"Hide sidebar":"Show sidebar",children:t?e.jsxs("svg",{className:"sidebar-toggle-close-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"crossGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff"}),e.jsx("stop",{offset:"50%",stopColor:"#e6e0ff"}),e.jsx("stop",{offset:"100%",stopColor:"#d6b4ff"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#crossGradient)"})]}):e.jsx("div",{className:"sidebar-toggle-hamburger",children:[0,1,2].map(i=>e.jsx("span",{className:"sidebar-toggle-hamburger-line"},i))})})}function dt({selectedWeekKey:t,showTickAll:n,onTickAll:i,allTicked:r}){const h=me(),j=t===h;return e.jsxs("div",{className:"mode-indicator-container purple",children:[e.jsx("div",{className:"mode-indicator-content",children:e.jsxs("div",{className:"mode-indicator-text",children:[e.jsx("div",{className:"mode-indicator-title",children:j?"Active Week Tracking":"Historical Week Review"}),e.jsx("div",{className:"mode-indicator-description",children:j?"Track your boss clears and pitched item  for the current week":"Track you pitched items you have collected this week"})]})}),n&&j&&e.jsx("button",{onClick:i,className:"mode-indicator-tick-all-button",title:r?"Clear all boss completions":"Mark all bosses as completed",children:r?"Clear All":"Complete All"})]})}function pe(t,n,i,r,h){return`${t}-${n}__${i}__${r}__${h}`}function ht({isHistoricalWeek:t,characterBossSelections:n,selectedCharIdx:i,sortedBosses:r,bossData:h,checked:j,charKey:N,getBossPrice:p,handleCheck:y,context:s="weekly",pitchedChecked:o,setPitchedChecked:S,weekKey:$,refreshCheckedStateFromDatabase:b,userInteractionRef:g,userCode:D,setError:C,startStatsTrackingIfNeeded:m,setHistoricalPitchedData:w,setShowHistoricalPitchedModal:u,handleHistoricalPitchedRemove:k,loadingPitchedItems:f,setLoadingPitchedItems:a,refreshPitchedItems:d,refreshHistoricalAnalysis:l,addNewPitchedItem:x,removePitchedItemByDetails:_}){if(t){const v=new Map;return n.forEach(H=>{var I;(I=H.bosses)==null||I.forEach(R=>{const G=h.find(B=>B.name===R.name),W=ue(R.name);if(G&&W&&W.length>0){const B={...G,pitchedItems:W};v.set(R.name,B)}})}),e.jsx("div",{className:"historical-week-cards-container",children:Array.from(v.values()).map(H=>e.jsxs("div",{className:"historical-boss-card",children:[e.jsxs("div",{className:"historical-boss-header",children:[e.jsx("img",{src:H.image,alt:H.name,className:"historical-boss-image"}),e.jsx("div",{className:"historical-boss-info",children:e.jsx("div",{className:"historical-boss-name",children:H.name})})]}),e.jsxs("div",{className:"historical-pitched-section",children:[e.jsx("div",{className:"historical-pitched-label",children:"Pitched Items"}),(H.pitchedItems||[]).length>0?e.jsx("div",{className:"historical-pitched-grid",children:(H.pitchedItems||[]).map(I=>{const R=n[i],G=(R==null?void 0:R.name)||"",W=pe(G,0,H.name,I.name,$),B=!!o[W];return e.jsxs("div",{className:`historical-pitched-item ${B?"obtained":""}`,title:`${I.name}${B?" (obtained)":""}`,onClick:Y=>{if(Y.stopPropagation(),w&&u)if(B)k(G,H.name,I.name,$);else{const L={itemName:I.name,itemImage:I.image,bossName:H.name,character:G,weekKey:$};w(L),u(!0)}},children:[e.jsx("img",{src:I.image,alt:I.name,className:`historical-pitched-item-image ${B?"obtained":"not-obtained"}`}),B&&e.jsx("span",{className:"historical-pitched-checkmark",children:"âœ“"})]},I.name)})}):e.jsx("div",{className:"historical-no-pitched",children:"No pitched items available"})]})]},H.name))})}const F={wrapper:s==="weekly"?"boss-table-wrapper-weekly":"boss-table-wrapper-price",headerContainer:s==="weekly"?"boss-table-header-container-weekly":"boss-table-header-container-price",bodyContainer:s==="weekly"?"boss-table-body-container-weekly":"boss-table-body-container-price",table:s==="weekly"?"boss-table-weekly":"boss-table-price"};return e.jsxs("div",{className:F.wrapper,children:[e.jsx("div",{className:F.headerContainer,children:e.jsx("table",{className:`${F.table} boss-table-header ${t?"historical-week":""}`,children:e.jsx("thead",{children:e.jsxs("tr",{className:"boss-table-header-row",children:[e.jsx("th",{className:"boss-table-header-cell",children:"Boss"}),e.jsx("th",{className:"boss-table-header-cell-difficulty",children:"Difficulty"}),e.jsx("th",{className:"boss-table-header-cell-mesos",children:"Mesos"}),e.jsx("th",{className:"boss-table-header-cell-cleared",children:"Cleared"})]})})})}),e.jsx("div",{className:F.bodyContainer,children:e.jsx("table",{className:`${F.table} boss-table-body ${t?"historical-week":""}`,children:e.jsx("tbody",{children:r.map((v,H)=>{var Y;const I=h.find(L=>L.name===v.name),R=!!((Y=j[N])!=null&&Y[v.name+"-"+v.difficulty]),G=ue(v.name),W=n[i],B=(W==null?void 0:W.name)||"";return e.jsxs("tr",{className:`boss-table-row ${H%2===0?"even":"odd"}`,onClick:L=>{!L.target.closest(".checkbox-wrapper")&&!L.target.closest(".pitched-item-icon")&&y(v,!R,L)},children:[e.jsxs("td",{className:"boss-table-cell-boss",children:[(I==null?void 0:I.image)&&e.jsx("img",{src:I.image,alt:v.name,className:"boss-table-boss-image"}),e.jsx("span",{className:"boss-table-boss-name",children:v.name}),G.length>0&&e.jsx("div",{className:"boss-table-pitched-container inline",children:G.map(L=>{if((v.name==="Watcher Kalos"||v.name==="Kaling")&&L.name==="Grindstone of Life"){const re=pe(B,0,v.name,L.name,$),te=!!o[re],P=f[re];return e.jsxs("span",{className:`pitched-item-icon inline ${te?"obtained":""} ${P?"loading":""}`,title:`${L.name}${te?" (obtained)":""}`,onClick:A=>{A.stopPropagation(),J(v,L,B,te,re)},children:[e.jsx("img",{src:L.image,alt:L.name,className:`pitched-item-image inline ${te?"obtained":"not-obtained"}`}),te&&e.jsx("span",{className:"pitched-item-checkmark inline",children:"âœ“"})]},L.name)}if(v.name==="Lotus"&&(L.name==="Total Control"&&v.difficulty!=="Extreme"||(L.name==="Berserked"||L.name==="Black Heart")&&!["Hard","Extreme"].includes(v.difficulty))||v.name==="Limbo"&&L.name==="Whisper of the Source"&&v.difficulty!=="Hard"||v.name==="Chosen Seren"&&L.name==="Gravity Module"&&v.difficulty!=="Extreme"||v.name==="Watcher Kalos"&&L.name==="Mark of Destruction"&&v.difficulty!=="Extreme"||v.name==="Kaling"&&L.name==="Helmet of Loyalty"&&v.difficulty!=="Extreme"||v.name!=="Lotus"&&v.name!=="Watcher Kalos"&&v.name!=="Kaling"&&v.name!=="Limbo"&&!["Hard","Chaos","Extreme","Hell"].includes(v.difficulty))return null;const q=pe(B,0,v.name,L.name,$),U=!!o[q],ae=f[q];return e.jsxs("span",{className:`pitched-item-icon inline ${U?"obtained":""} ${ae?"loading":""}`,title:`${L.name}${U?" (obtained)":""}`,onClick:re=>{re.stopPropagation(),J(v,L,B,U,q)},children:[e.jsx("img",{src:L.image,alt:L.name,className:`pitched-item-image inline ${U?"obtained":"not-obtained"}`}),U&&e.jsx("span",{className:"pitched-item-checkmark inline",children:"âœ“"})]},L.name)})})]}),e.jsx("td",{className:"boss-table-cell-difficulty",children:e.jsx("span",{children:v.difficulty})}),e.jsx("td",{className:"boss-table-cell-mesos",children:e.jsx("span",{children:Math.floor(p(v.name,v.difficulty)/(v.partySize||1)).toLocaleString()})}),e.jsx("td",{className:"boss-table-cell-cleared",children:e.jsx("span",{onClick:L=>L.stopPropagation(),children:e.jsx(Ke,{checked:R,onChange:L=>y(v,L.target.checked,L)})})})]},v.name+"-"+v.difficulty)})})})})]});async function J(v,H,I,R,G){try{if(!I){C==null||C("No character selected");return}if(g.current=!0,t){if(w&&u){const W={itemName:H.name,itemImage:H.image,bossName:v.name,character:I,weekKey:$};w(W),u(!0)}}else{a==null||a(W=>({...W,[G]:!0}));try{let W;if(R?(X.info(`Removing pitched item: ${H.name} from ${v.name} by ${I}`),W=await _(I,v.name,H.name)):(X.info(`Adding pitched item: ${H.name} from ${v.name} by ${I}`),W=await x(I,v.name,H.name)),!W.success)throw new Error(W.error||"Failed to update pitched item")}catch(W){X.error("Error with pitched item service:",W),C==null||C(`Failed to update pitched item: ${W.message}`)}if(m){const W=`${v.name}-${H.name}`;m(I,D,W,H.name)}b&&await b(),a==null||a(W=>({...W,[G]:!1}))}}catch(W){X.error("Error handling pitched item click:",W),C==null||C(`Failed to update pitched item: ${W.message}`),a==null||a(B=>({...B,[G]:!1}))}}}function mt({showStats:t,setShowStats:n,allYears:i,selectedYear:r,setSelectedYear:h,groupedYearlyPitchedItems:j,isLoadingCloudStats:N,setShowStatsResetConfirm:p,handleItemDetailClick:y}){if(!t)return null;const s=j.reduce((o,S)=>o+S.count,0);return e.jsx("div",{className:"modal-backdrop stats-modal-backdrop",onClick:()=>n(!1),children:e.jsxs("div",{className:"modern-stats-modal",onClick:o=>o.stopPropagation(),children:[e.jsxs("div",{className:"modern-stats-header",children:[e.jsxs("div",{className:"modern-stats-title-section",children:[e.jsx("h2",{className:"modern-stats-title",children:"Pitched Items Statistics"}),e.jsx("div",{className:"modern-stats-subtitle",children:r})]}),e.jsx("button",{onClick:()=>n(!1),className:"modern-stats-close",title:"Close",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"modern-stats-controls",children:[e.jsxs("div",{className:"modern-year-selector",children:[e.jsx("label",{className:"modern-year-label",children:"Year:"}),e.jsx("select",{value:r,onChange:o=>h(o.target.value),className:"modern-year-select",children:i.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsxs("div",{className:"modern-stats-summary",children:[e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:j.length}),e.jsx("div",{className:"modern-stat-label",children:"Unique Items"})]}),e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:s}),e.jsx("div",{className:"modern-stat-label",children:"Total Obtained"})]})]})]}),e.jsx("div",{className:"modern-stats-content",children:N?e.jsxs("div",{className:"modern-stats-loading",children:[e.jsx("div",{className:"modern-loading-spinner"}),e.jsx("span",{children:"Loading statistics..."})]}):j.length===0?e.jsxs("div",{className:"modern-stats-empty",children:[e.jsx("div",{className:"modern-empty-icon",children:"ðŸ“Š"}),e.jsx("div",{className:"modern-empty-title",children:"No Data Yet"}),e.jsx("div",{className:"modern-empty-text",children:"Start clearing bosses to see your pitched item statistics!"})]}):e.jsx("div",{className:"modern-items-grid",children:j.map((o,S)=>e.jsxs("div",{className:"modern-item-card",onClick:()=>y(o),children:[e.jsxs("div",{className:"modern-item-image-container",children:[e.jsx("img",{src:o.itemImage,alt:o.itemName,className:"modern-item-image"}),e.jsx("div",{className:"modern-item-count-badge",children:o.count})]}),e.jsxs("div",{className:"modern-item-info",children:[e.jsx("div",{className:"modern-item-name",children:o.itemName}),e.jsx("div",{className:"modern-item-meta",children:o.count===1?"1 time":`${o.count} times`})]}),e.jsx("div",{className:"modern-item-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]},`${o.itemName}-${S}`))})}),e.jsx("div",{className:"modern-stats-footer",children:e.jsxs("button",{className:"modern-reset-button",onClick:()=>p(!0),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"})}),"Reset All Statistics"]})})]})})}function ut({showItemDetailModal:t,setShowItemDetailModal:n,selectedItemDetail:i}){if(!t||!i)return null;const{itemName:r,itemImage:h,count:j,instances:N}=i,p=N.reduce((s,o)=>(s[o.charId]||(s[o.charId]=[]),s[o.charId].push(o),s),{}),y=Object.keys(p).sort();return e.jsx("div",{className:"modal-backdrop item-detail-backdrop",onClick:()=>n(!1),children:e.jsxs("div",{className:"modern-item-detail-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modern-item-detail-header",children:[e.jsxs("div",{className:"modern-item-detail-title-section",children:[e.jsx("div",{className:"modern-item-detail-icon",children:e.jsx("img",{src:h,alt:r,className:"modern-item-detail-image"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"modern-item-detail-title",children:r}),e.jsxs("div",{className:"modern-item-detail-subtitle",children:["Obtained ",j," time",j!==1?"s":""]})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"modern-item-detail-close",title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsx("div",{className:"modern-item-detail-content",children:y.map(s=>e.jsxs("div",{className:"modern-character-section",children:[e.jsxs("div",{className:"modern-character-header",children:[e.jsx("div",{className:"modern-character-name",children:s}),e.jsxs("div",{className:"modern-character-count",children:[p[s].length," time",p[s].length!==1?"s":""]})]}),e.jsx("div",{className:"modern-dates-grid",children:p[s].map((o,S)=>e.jsxs("div",{className:"modern-date-chip",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"modern-date-icon",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),o.displayDate]},`${s}-${o.fullDate}-${S}`))})]},s))}),e.jsx("div",{className:"modern-item-detail-footer",children:e.jsxs("div",{className:"modern-detail-stats",children:[e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:y.length}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Character",y.length!==1?"s":""]})]}),e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:j}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Total Drop",j!==1?"s":""]})]})]})})]})})}function ft({data:t,characterBossSelections:n,onClose:i,onConfirm:r,pitchedChecked:h}){const[j,N]=c.useState(""),[p,y]=c.useState(!1),s=c.useMemo(()=>t.weekKey?Ce(t.weekKey):{start:null,end:null},[t.weekKey]),o=c.useCallback(g=>g.toISOString().split("T")[0],[]),S=c.useMemo(()=>{var g;return t.character||((g=n[0])==null?void 0:g.name)||""},[t.character,n]);c.useEffect(()=>{s.start&&!j&&N(o(s.start))},[s,j,o]);const $=async()=>{if(!j||!S)return;y(!0);const g=new Date(j+"T12:00:00.000Z").toISOString();await r(g,S),y(!1)},b=c.useMemo(()=>{if(!s.start||!s.end)return"";const g=s.start.toLocaleDateString("en-US",{month:"short"}),D=s.end.toLocaleDateString("en-US",{month:"short"}),C=s.start.getDate(),m=s.end.getDate();return g===D?`${g} ${C}-${m}`:`${g} ${C} - ${D} ${m}`},[s]);return e.jsxs("div",{className:"historical-modal-container-new",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"historical-modal-item-showcase",children:[e.jsx("div",{className:"historical-modal-item-glow-new"}),e.jsx("img",{src:t.itemImage,alt:t.itemName,className:"historical-modal-item-image-new"})]}),e.jsx("h2",{className:"historical-modal-title-new",children:"Add Historical Drop"}),e.jsxs("div",{className:"historical-modal-details",children:[e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Item:"}),e.jsx("span",{className:"detail-value",children:t.itemName})]}),e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Character:"}),e.jsx("span",{className:"detail-value character-name",children:S})]}),e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Week:"}),e.jsx("span",{className:"detail-value",children:b})]})]}),e.jsxs("div",{className:"historical-modal-date-section",children:[e.jsx("label",{className:"historical-modal-date-label",children:"Select Drop Date:"}),e.jsx("input",{type:"date",value:j,onChange:g=>N(g.target.value),min:s.start?o(s.start):"",max:s.end?o(s.end):"",className:"historical-modal-date-input-new"})]}),e.jsxs("div",{className:"historical-modal-actions",children:[e.jsx("button",{onClick:i,disabled:p,className:"historical-modal-btn historical-modal-btn-cancel",children:"Cancel"}),e.jsxs("button",{onClick:$,disabled:p||!j||!S,className:"historical-modal-btn historical-modal-btn-add",children:[p&&e.jsx("div",{className:"historical-modal-spinner-new"}),p?"Adding...":"Add Drop"]})]})]})}function xt({isOpen:t,onClose:n,characterName:i,cloudPitchedItems:r=[],setPitchedModalItem:h,setShowPitchedModal:j}){const[N,p]=c.useState([]);c.useEffect(()=>{if(!t||!i)return;const s=r.filter($=>$.charId===i),o=new Map;s.forEach($=>{const b=$.item;if(!o.has(b)){let D="/items/crystal.png";const C=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling"];for(const m of C){const u=ue(m).find(k=>k.name===$.item);if(u){D=u.image;break}}o.set(b,{name:$.item,image:D,count:0,history:[]})}const g=o.get(b);g.count+=1,g.history.push({date:$.date})});const S=Array.from(o.values()).sort(($,b)=>b.count-$.count);p(S)},[t,i,r]);const y=s=>{if(!h||!j)return;const o=s.history.map(S=>({char:i,date:new Date(S.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}));h({name:s.name,image:s.image,history:o}),j(!0)};return t?e.jsx("div",{className:"pitched-modal-backdrop",onClick:n,children:e.jsxs("div",{className:`pitched-modal ${N.length===0?"pitched-modal-no-scroll":""}`,onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"pitched-modal-close",onClick:n,"aria-label":"Close modal",children:e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"closeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#closeGradient)"})]})}),e.jsx("h2",{className:"pitched-modal-title",children:i?`${i}'s Pitched Items`:"Pitched Items"}),N.length>0?e.jsx("div",{className:"pitched-modal-list-container",children:e.jsx("div",{className:"pitched-modal-list",children:N.map(s=>e.jsxs("div",{className:"pitched-modal-item",onClick:()=>y(s),style:{cursor:"pointer"},children:[e.jsx("div",{className:"pitched-modal-item-glow"}),e.jsx("img",{src:s.image,alt:s.name,className:"pitched-modal-item-img"}),e.jsx("div",{className:"pitched-modal-item-name",children:s.name}),e.jsx("div",{className:"pitched-modal-item-count",children:s.count})]},s.name))})}):e.jsxs("div",{className:"pitched-modal-empty",children:[e.jsx("div",{className:"empty-star-container",children:e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 24 24",fill:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"emptyStarGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#6a11cb"})]}),e.jsxs("filter",{id:"starGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),e.jsx("feFlood",{floodColor:"#a259f7",floodOpacity:"0.5",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"glow",operator:"over"})]})]}),e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"url(#emptyStarGradient)",stroke:"#e6e0ff",strokeWidth:"1.5",filter:"url(#starGlow)",className:"empty-star-path"})]})}),e.jsx("h3",{className:"empty-title",children:"No pitched items yet"}),e.jsxs("p",{className:"empty-desc",children:[i?`${i} hasn't`:"You haven't"," obtained any pitched items yet"]})]})]})}):null}function pt({showStatsResetConfirm:t,setShowStatsResetConfirm:n,onConfirm:i}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-small",children:[e.jsx("h3",{className:"stats-reset-title",children:"Are you sure?"}),e.jsx("p",{className:"stats-reset-message",children:"This will permanently erase all stats. This cannot be undone."}),e.jsxs("div",{className:"stats-reset-buttons",children:[e.jsx("button",{onClick:()=>n(!1),className:"stats-reset-button stats-reset-button-cancel",children:"Cancel"}),e.jsx("button",{onClick:i,className:"stats-reset-button stats-reset-button-confirm",children:"Reset"})]})]})}):null}function gt({showCharacterPurgeConfirm:t,setShowCharacterPurgeConfirm:n,purgeTargetCharacter:i,purgeInProgress:r,onConfirm:h}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-medium character-purge-container",children:[e.jsx("div",{className:"character-purge-icon",children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"character-purge-title",children:"Purge Character Data"}),e.jsxs("div",{className:"character-purge-warning",children:[e.jsx("p",{className:"character-purge-warning-title",children:e.jsx("strong",{children:"This will permanently delete all pitched items and boss runs for:"})}),e.jsx("p",{className:"character-purge-character-name",children:i==null?void 0:i.name}),e.jsx("p",{className:"character-purge-warning-note",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"character-purge-buttons",children:[e.jsx("button",{onClick:()=>n(!1),disabled:r,className:"character-purge-button character-purge-button-cancel",children:"Cancel"}),e.jsxs("button",{onClick:h,disabled:r,className:"character-purge-button character-purge-button-confirm",children:[r&&e.jsx("div",{className:"character-purge-spinner"}),r?"Purging...":"Purge Data"]})]})]})}):null}function wt({resetSuccessVisible:t,closeResetSuccess:n,purgeSuccess:i,setPurgeSuccess:r}){return!t&&!i?null:e.jsx("div",{className:"modal-backdrop modal-backdrop-high",children:e.jsxs("div",{className:"modal-container modal-container-small",onClick:h=>h.stopPropagation(),children:[e.jsx("h3",{className:"success-title",children:t?"Stats reset!":"Character purged!"}),e.jsx("p",{className:"success-message",children:t?"Your stats have been cleared.":"Character data has been purged."}),e.jsx("button",{onClick:t?n:()=>r(!1),className:"success-button",children:"Close"})]})})}function jt({showPitchedModal:t,setShowPitchedModal:n,pitchedModalItem:i,pitchedModalDetails:r}){return!t||!i?null:e.jsx("div",{className:"pitched-details-modal-backdrop",onClick:()=>n(!1),style:{zIndex:9999},children:e.jsxs("div",{className:"pitched-details-modal pitched-details-modal-visible",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"pitched-details-modal-header",children:[e.jsx("button",{className:"pitched-details-modal-close",onClick:()=>n(!1),title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"currentColor"})})}),e.jsxs("div",{className:"pitched-details-modal-item-showcase",children:[e.jsx("img",{src:i.image,alt:i.name,className:"pitched-details-modal-item-img"}),e.jsxs("div",{className:"pitched-details-modal-item-info",children:[e.jsx("h2",{className:"pitched-details-modal-title",children:i.name}),e.jsxs("div",{className:"pitched-details-modal-subtitle",children:[e.jsx("span",{className:"pitched-details-modal-count",children:r.length}),e.jsx("span",{className:"pitched-details-modal-acquired",children:r.length===1?"time obtained":"times obtained"})]})]})]})]}),e.jsxs("div",{className:"pitched-details-modal-content",children:[e.jsxs("div",{className:"pitched-details-section-header",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})}),e.jsx("h3",{children:"Acquisition History"})]}),e.jsx("div",{className:"pitched-details-acquisition",children:r.length===0?e.jsx("div",{className:"empty-state",children:"None this year."}):e.jsx("div",{className:"pitched-details-table-container",children:e.jsxs("table",{className:"pitched-details-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Character"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:r.map((h,j)=>e.jsxs("tr",{className:`pitched-details-row ${j%2===0?"even-row":"odd-row"}`,children:[e.jsx("td",{children:h.char}),e.jsx("td",{children:e.jsx("span",{className:"date-value",children:h.date})})]},j))})]})})})]})]})})}function vt({statsManagement:t,weekNavigation:n,pitchedChecked:i,setPitchedChecked:r,userInteractionRef:h,setError:j,characterBossSelections:N,selectedCharIdx:p,cloudPitchedItems:y}){var s;return e.jsxs(e.Fragment,{children:[e.jsx(mt,{showStats:t.showStats,setShowStats:t.setShowStats,allYears:t.allYears,selectedYear:t.selectedYear,setSelectedYear:t.setSelectedYear,groupedYearlyPitchedItems:t.groupedYearlyPitchedItems,isLoadingCloudStats:t.isLoadingCloudStats,setShowStatsResetConfirm:t.setShowStatsResetConfirm,handleItemDetailClick:t.handleItemDetailClick}),e.jsx(ut,{showItemDetailModal:t.showItemDetailModal,setShowItemDetailModal:t.setShowItemDetailModal,selectedItemDetail:t.selectedItemDetail}),e.jsx(pt,{showStatsResetConfirm:t.showStatsResetConfirm,setShowStatsResetConfirm:t.setShowStatsResetConfirm,onConfirm:()=>t.handleStatsReset(j)}),e.jsx(gt,{showCharacterPurgeConfirm:t.showCharacterPurgeConfirm,setShowCharacterPurgeConfirm:t.setShowCharacterPurgeConfirm,purgeTargetCharacter:t.purgeTargetCharacter,purgeInProgress:t.purgeInProgress,onConfirm:()=>t.handleCharacterPurge(i,r,n.selectedWeekKey,h,j)}),e.jsx(wt,{resetSuccessVisible:t.resetSuccessVisible,closeResetSuccess:t.closeResetSuccess,purgeSuccess:t.purgeSuccess,setPurgeSuccess:t.setPurgeSuccess}),t.showHistoricalPitchedModal&&e.jsx("div",{className:"modal-backdrop",onClick:()=>t.setShowHistoricalPitchedModal(!1),children:e.jsx(ft,{data:t.historicalPitchedData,characterBossSelections:N,onClose:()=>t.setShowHistoricalPitchedModal(!1),onConfirm:t.handleHistoricalPitchedConfirm,pitchedChecked:i})}),e.jsx(xt,{isOpen:t.showCharacterPitchedModal,onClose:()=>t.setShowCharacterPitchedModal(!1),characterName:((s=N[p])==null?void 0:s.name)||"",cloudPitchedItems:y,setPitchedModalItem:t.setPitchedModalItem,setShowPitchedModal:t.setShowPitchedModal}),e.jsx(jt,{showPitchedModal:t.showPitchedModal,setShowPitchedModal:t.setShowPitchedModal,pitchedModalItem:t.pitchedModalItem,pitchedModalDetails:t.pitchedModalDetails})]})}function kt(t,n){const[i,r]=c.useState(n||me()),[h,j]=c.useState({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[],analysis:null});c.useEffect(()=>{n&&n!==i&&(console.log(`useWeekNavigation: appWeekKeyFromProps (${n}) differs from selectedWeekKey (${i}). Updating selectedWeekKey.`),r(n))},[n]);const N=i!==(n||me()),p=c.useCallback(async()=>{if(!t)return;const s=me();try{console.log(`ðŸ”„ Refreshing historical analysis (user: ${t}, relative to real week: ${s})...`);const o=await Ye(t,n||s);o.success?(j({hasHistoricalData:o.hasHistoricalData,oldestHistoricalWeek:o.oldestHistoricalWeek,userType:o.userType,adaptiveWeekLimit:o.adaptiveWeekLimit,historicalWeeks:o.historicalWeeks,analysis:o.analysis}),console.log("âœ… Historical analysis refreshed:",{userType:o.userType,hasData:o.hasHistoricalData,oldestWeek:o.oldestHistoricalWeek,adaptiveLimit:o.adaptiveWeekLimit})):console.error("Error in analysisResult:",o.error)}catch(o){console.error("Error refreshing historical analysis:",o)}},[t,n]),y=c.useCallback(s=>{s!==i&&r(s)},[i]);return c.useEffect(()=>{if(t){const s=setTimeout(()=>{p()},150);return()=>clearTimeout(s)}},[t,n]),{selectedWeekKey:i,isHistoricalWeek:N,handleWeekChange:y,historicalAnalysis:h,refreshHistoricalAnalysis:p}}function yt(t){const[n,i]=c.useState({}),[r,h]=c.useState([]),[j,N]=c.useState({}),[p,y]=c.useState(!1),s=c.useRef(!1),o=async()=>{try{if(!t)return;y(!0);const m=await Pe(t,{});if(m.success){h(m.items);const w={};m.items.forEach(u=>{const k=oe(u.date),f=`${u.charId}-0__${u.bossName}__${u.item}__${k}`;w[f]=!0}),i(w)}else console.error("Failed to refresh pitched items:",m.error)}catch(m){console.error("Error refreshing pitched items:",m)}finally{y(!1)}},S=async(m,w,u,k=null)=>{try{if(!t)return console.warn("addNewPitchedItem: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};const f=k||new Date().toISOString().split("T")[0],a=oe(f),d=`${m}-0__${w}__${u}__${a}`;if(n[d])return console.log("Item already exists, skipping add"),{success:!0,message:"Item already exists"};const x=await Me(t,{charId:m,bossName:w,item:u,date:f});if(x.success){const _=x.pitchedItem;return h(F=>[...F,_]),i(F=>({...F,[d]:!0})),{success:!0}}else throw new Error(x.error)}catch(f){return console.error("Error adding pitched item:",f),{success:!1,error:f.message}}},$=async(m,w,u,k=null)=>{try{if(!t)return console.warn("removePitchedItemByDetails: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};let f=k;if(!f){const d=r.filter(l=>l.charId===m&&l.bossName===w&&l.item===u);if(d.length>0)d.sort((l,x)=>new Date(x.date)-new Date(l.date)),f=d[0].date;else return console.log("No matching items found to remove"),{success:!0,message:"No items to remove"}}const a=await Te(t,m,w,u,f);if(a.success){h(x=>x.filter(_=>!(_.charId===m&&_.bossName===w&&_.item===u&&_.date===f)));const d=oe(f),l=`${m}-0__${w}__${u}__${d}`;return i(x=>{const _={...x};return delete _[l],_}),{success:!0}}else throw new Error(a.error)}catch(f){return console.error("Error removing pitched item:",f),{success:!1,error:f.message}}},b=async m=>{try{if(!t)throw new Error("No user ID provided");const w=await He(t,m);if(w.success)return h(u=>{let k=[...u];return m.forEach(({charId:f,item:a,date:d})=>{if(d)k=k.filter(l=>!(l.charId===f&&l.item===a&&l.date===d));else{const l=k.findLastIndex(x=>x.charId===f&&x.item===a);l!==-1&&k.splice(l,1)}}),k}),i(u=>{const k={...u};return m.forEach(({charId:f,item:a,date:d})=>{if(d){const l=oe(d),x=`${f}-0__${a}__${l}`;delete k[x]}else Object.keys(k).forEach(l=>{l.startsWith(`${f}-0__${a}__`)&&delete k[l]})}),k}),{success:!0,removedCount:w.removedCount};throw new Error(w.error)}catch(w){return console.error("Error removing multiple pitched items:",w),{success:!1,error:w.message}}},g=async m=>{try{if(!t)throw new Error("No user ID provided");const w=await Ee(t,m);if(w.success)return h(u=>u.filter(k=>oe(k.date)!==m)),i(u=>{const k={...u};return Object.keys(k).forEach(f=>{f.endsWith(`__${m}`)&&delete k[f]}),k}),{success:!0,removedCount:w.removedCount};throw new Error(w.error)}catch(w){return console.error("Error clearing week pitched items:",w),{success:!1,error:w.message}}},D=async(m=null)=>{try{if(!t)throw new Error("No user ID provided");const w=await ge(t,m);if(w.success)return{success:!0,stats:w.stats};throw new Error(w.error)}catch(w){return console.error("Error getting yearly stats:",w),{success:!1,error:w.message}}},C=async()=>{try{if(!t)throw new Error("No user ID provided");const m=await Ie(t);if(m.success)return h([]),i({}),{success:!0,removedCount:m.removedCount};throw new Error(m.error)}catch(m){return console.error("Error purging all pitched items:",m),{success:!1,error:m.message}}};return c.useEffect(()=>{t&&o()},[t]),{pitchedChecked:n,setPitchedChecked:i,cloudPitchedItems:r,setCloudPitchedItems:h,userInteractionRef:s,refreshPitchedItems:o,loadingPitchedItems:j,setLoadingPitchedItems:N,isRefreshingPitchedItems:p,addNewPitchedItem:S,removePitchedItemByDetails:$,removeManyPitchedItemsByDetails:b,clearWeekPitchedItems:g,getYearlyStats:D,purgeAllItems:C}}function Nt({userId:t,characterBossSelections:n,selectedCharIdx:i,checked:r,setChecked:h,setCrystalAnimation:j,setError:N,onDataChange:p}){const[y,s]=c.useState(!1),o=c.useRef(0);return{handleCheck:async(g,D,C)=>{try{if(y||!t)return;if(!g||D===void 0){console.error("Invalid parameters to handleCheck");return}if(s(!0),C&&C.clientX&&j){const J={x:C.clientX,y:C.clientY},v=document.querySelector(".progress-bar");if(v){const H=v.getBoundingClientRect(),I={x:H.left+H.width/2,y:H.top+H.height/2};j({startPosition:J,endPosition:I})}}const m=n[i];if(!m)throw new Error("No character selected");const w=m.name||"",u=i.toString(),k=`${w}-${i}`,f=g.name,a=g.difficulty,d=`${f}-${a}`,l={...r,[k]:{...r[k]||{},[d]:D}};h(l);const x=await it(f,a);if(!x)throw new Error(`Could not find boss registry ID for ${f} ${a}`);const _=we(),F=await Xe(t,_,u,x,D);if(!F.success)throw h(r),new Error(F.error);p&&p(),o.current=Date.now()}catch(m){console.error("Error in handleCheck:",m),h(r),N&&N(`Failed to update boss status: ${m.message}`)}finally{s(!1)}},handleTickAll:async()=>{try{if(y||!t)return;s(!0);const g=n[i];if(!g)throw new Error("No character selected");const D=g.bosses||[],C=`${g.name||""}-${i}`,m=r[C]||{},u=!D.every(l=>m[l.name+"-"+l.difficulty]),k={...r,[C]:Object.fromEntries(D.map(l=>[l.name+"-"+l.difficulty,u]))};h(k);const f=i.toString(),a=we();let d;if(u?d=await qe(t,a,f):d=await Je(t,a,f),!d.success)throw h(r),new Error(d.error);p&&p(),o.current=Date.now()}catch(g){console.error("Error in handleTickAll:",g),h(r),N&&N(`Failed to update all bosses: ${g.message}`)}finally{s(!1)}},refreshCheckedStateFromDatabase:async()=>{try{return t?(p&&p(),!0):null}catch(g){return console.error("Error refreshing checked state:",g),null}},isUpdating:y,lastUpdate:o.current}}const Ct=t=>{const n=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling","Limbo"];for(const i of n){const h=ue(i).find(j=>j.name===t);if(h)return h.image}return"/items/crystal.png"};function bt(t,n){const[i,r]=c.useState(!1),[h,j]=c.useState(!1),[N,p]=c.useState({monthly:[],yearly:[]}),[y,s]=c.useState(!1),[o,S]=c.useState(null),[$,b]=c.useState(!1),[g,D]=c.useState(!1),[C,m]=c.useState([]),[w,u]=c.useState(!1),[k,f]=c.useState({}),[a,d]=c.useState(!1),[l,x]=c.useState(null),[_,F]=c.useState(!1),[J,v]=c.useState(!1),[H,I]=c.useState(!1),[R,G]=c.useState(null),[W,B]=c.useState(!1),[Y,L]=c.useState(null),q=c.useMemo(()=>{const M=he(),T=new Set([M]);return N!=null&&N.yearly&&Array.isArray(N.yearly)&&N.yearly.forEach(O=>T.add(O.yearKey)),k&&Object.keys(k).forEach(O=>T.add(O)),Array.from(T).sort((O,E)=>E.localeCompare(O))},[N==null?void 0:N.yearly,k]),[U,ae]=c.useState(()=>he());c.useEffect(()=>{(q==null?void 0:q.length)>0&&!q.includes(U)&&ae(q[0])},[q,U]),c.useEffect(()=>{if(!i||!t)return;(async()=>{try{d(!0);const T=parseInt(U,10),O=await ge(t,T);O.success&&f(E=>({...E,[U]:O.stats}))}catch(T){console.error("Error fetching cloud pitched stats:",T)}finally{d(!1)}})()},[i,t,U]);const re=c.useMemo(()=>{if(!U||!k)return[];const M=k[U];if(!(M!=null&&M.items)||!Array.isArray(M.items))return[];const T=new Map;return M.items.filter(E=>(E==null?void 0:E.item)&&(E==null?void 0:E.charId)&&(E==null?void 0:E.date)).forEach(E=>{const K=E.item;T.has(K)||T.set(K,{itemName:K,itemImage:Ct(K),count:0,instances:[]});const z=T.get(K);z.count+=1;const se=new Date(E.date),ie=_e[se.getUTCMonth()],le=se.getUTCDate();z.instances.push({charId:E.charId,fullDate:E.date,displayDate:`${ie} ${le}`,sortDate:se.getTime()})}),Array.from(T.values()).map(E=>({...E,instances:E.instances.sort((K,z)=>z.sortDate-K.sortDate)})).sort((E,K)=>K.count!==E.count?K.count-E.count:E.itemName.localeCompare(K.itemName))},[U,k]),te=async(M,T,O,E,K)=>{if(o)try{b(!0);const{name:z,idx:se}=o;E.current=!0;const ie=ze(M,z,se,O);if(T(ie),(await Ve(t,z,se)).success){f({}),await n(t);const ne=await ge(t);if(ne.success){const De=he();f({[De]:ne.stats})}D(!0),s(!1);const je=await Ze(t);je.success&&m(je.history),setTimeout(()=>{D(!1)},3e3)}else K("Failed to purge character data. Please try again.")}catch(z){console.error("Error in handleCharacterPurge:",z),K("Failed to purge character data. Please try again.")}finally{b(!1),setTimeout(()=>{E.current=!1},1e3)}},P=async M=>{try{if(p({monthly:[],yearly:[]}),ae(he()),t)if((await Ue(t)).success)f({}),await n(t);else{M("Failed to reset stats data. Please try again.");return}j(!1),u(!0),setTimeout(()=>{u(!1),r(!1)},3400)}catch(T){console.error("Error in stats reset:",T),M("Failed to reset stats data. Please try again.")}},A=()=>{u(!1),r(!1)},V=c.useMemo(()=>l?l.history||[]:[],[l]);function Z(){X.silence("Stats tracking is now cloud-based - no action needed")}return{showStats:i,setShowStats:r,showStatsResetConfirm:h,setShowStatsResetConfirm:j,statsPanel:N,setStatsPanel:p,showCharacterPurgeConfirm:y,setShowCharacterPurgeConfirm:s,purgeTargetCharacter:o,setPurgeTargetCharacter:S,purgeInProgress:$,purgeSuccess:g,setPurgeSuccess:D,auditHistory:C,resetSuccessVisible:w,closeResetSuccess:A,cloudPitchedStats:k,setCloudPitchedStats:f,isLoadingCloudStats:a,pitchedModalItem:l,setPitchedModalItem:x,showPitchedModal:_,setShowPitchedModal:F,showCharacterPitchedModal:J,setShowCharacterPitchedModal:v,pitchedModalDetails:V,showItemDetailModal:H,setShowItemDetailModal:I,selectedItemDetail:R,setSelectedItemDetail:G,showHistoricalPitchedModal:W,setShowHistoricalPitchedModal:B,historicalPitchedData:Y,setHistoricalPitchedData:L,allYears:q,selectedYear:U,setSelectedYear:ae,groupedYearlyPitchedItems:re,handleCharacterPurge:te,handleStatsReset:P,startStatsTrackingIfNeeded:Z,handleHistoricalPitchedConfirm:async(M,T)=>{try{if(!Y)throw new Error("No historical pitched data available");const{itemName:O,bossName:E,weekKey:K}=Y;X.userAction("Adding historical pitched item",`${O} for ${E} by ${T}`);const{addPitchedItem:z}=await Ne(async()=>{const{addPitchedItem:le}=await import("./index-BOPki7CY.js").then(ne=>ne.v);return{addPitchedItem:le}},__vite__mapDeps([0,1,2,3,4,5])),se={charId:T,bossName:E,item:O,date:M.split("T")[0]},ie=await z(t,se);if(ie.success)return X.silence("Historical pitched item added successfully"),B(!1),L(null),n&&await n(),{success:!0};throw new Error(ie.error||"Failed to add historical pitched item")}catch(O){throw X.error("Error handling historical pitched confirmation:",O),O}},handleHistoricalPitchedRemove:async(M,T,O,E=null)=>{try{let K=E,z=T;if(!K&&Y&&(K=Y.weekKey,z||(z=Y.bossName)),!K)throw new Error("Week key not available for historical pitched item removal");if(!z)throw new Error("Boss name not available for historical pitched item removal");X.userAction("Removing historical pitched item",`${O} from ${z} by ${M}`);const{removePitchedItem:se}=await Ne(async()=>{const{removePitchedItem:le}=await import("./index-BOPki7CY.js").then(ne=>ne.v);return{removePitchedItem:le}},__vite__mapDeps([0,1,2,3,4,5])),ie=await se(t,M,z,O,null);if(ie.success)return X.silence("Historical pitched item removed successfully"),Y&&(B(!1),L(null)),n&&await n(),{success:!0};throw new Error(ie.error||"Failed to remove historical pitched item")}catch(K){throw X.error("Error handling historical pitched removal:",K),K}},handleItemDetailClick:M=>{G(M),I(!0)}}}function St(){const{userCode:t,isLoggedIn:n}=be(),[i,r]=c.useState(null),[h,j]=c.useState(()=>we()),[N,p]=c.useState(!1),[y,s]=c.useState(""),[o,S]=c.useState(null),[$,b]=c.useState("");c.useEffect(()=>{if(!t||!n){r(null),s("");return}let a=!0;return(async()=>{try{p(!0),s("");const l=await ye(t);if(!a)return;l.success?r(l.data):s(l.error||"Failed to load weekly data.")}catch(l){a&&(console.error("Failed to load weekly data:",l),s("Failed to load weekly data. Please try again."))}finally{a&&p(!1)}})(),()=>{a=!1}},[t,n,h]);const g=c.useCallback(async()=>{if(!(!t||!n))try{p(!0);const a=await ye(t);a.success?(r(a.data),s("")):s(a.error||"Failed to refresh data.")}catch(a){console.error("Failed to refresh weekly data:",a),s("Failed to refresh data.")}finally{p(!1)}},[t,n]),D=c.useCallback(()=>!i||!i.char_map?[]:Object.entries(i.char_map).map(([a,d])=>{var l,x;return{index:parseInt(a),name:d,bossConfig:((l=i.boss_config)==null?void 0:l[a])||"",weeklyClears:((x=i.weekly_clears)==null?void 0:x[a])||""}}).sort((a,d)=>a.index-d.index),[i]),C=c.useCallback(async a=>{if(!t||!n)return s("Not logged in."),{success:!1,error:"Not logged in."};if(!(a!=null&&a.trim()))return s("Character name cannot be empty."),{success:!1,error:"Character name cannot be empty."};try{p(!0),s("");const d=await Qe(t,h,a.trim());return d.success?(await g(),b(""),{success:!0,characterIndex:d.characterIndex}):(s(d.error||"Failed to add character."),d)}catch(d){console.error("Failed to add character:",d);const l="Failed to add character.";return s(l),{success:!1,error:l}}finally{p(!1)}},[t,n,h,g]),m=c.useCallback(async a=>{if(!t||!n)return s("Not logged in."),{success:!1,error:"Not logged in."};try{p(!0),s("");const d=await et(t,h,a);return d.success?(await g(),o===a&&S(null),{success:!0}):(s(d.error||"Failed to remove character."),d)}catch(d){console.error("Failed to remove character:",d);const l="Failed to remove character.";return s(l),{success:!1,error:l}}finally{p(!1)}},[t,n,h,o,g]),w=c.useCallback(async(a,d)=>{if(!t||!n)return s("Not logged in."),{success:!1,error:"Not logged in."};try{p(!0),s("");const l=await tt(t,h,a,d);return l.success?(await g(),{success:!0}):(s(l.error||"Failed to update character name."),l)}catch(l){console.error("Failed to update character name:",l);const x="Failed to update character name.";return s(x),{success:!1,error:x}}finally{p(!1)}},[t,n,h,g]),u=c.useCallback(async(a,d)=>{if(!t||!n)return s("Not logged in."),{success:!1,error:"Not logged in."};try{p(!0),s("");const l=await st(t,h,a,d);return l.success?(await g(),{success:!0}):(s(l.error||"Failed to update boss configuration."),l)}catch(l){console.error("Failed to update boss configuration:",l);const x="Failed to update boss configuration.";return s(x),{success:!1,error:x}}finally{p(!1)}},[t,n,h,g]),k=c.useCallback(a=>D().find(l=>l.index===a)||null,[D]),f=c.useCallback((a,d=null)=>D().some(x=>x.name.toLowerCase()===a.toLowerCase()&&x.index!==d),[D]);return{weeklyData:i,currentWeekStart:h,isLoading:N,error:y,setError:s,characters:D(),selectedCharacterIndex:o,setSelectedCharacterIndex:S,newCharacterName:$,setNewCharacterName:b,refreshWeeklyData:g,addCharacter:C,removeCharacter:m,updateCharacterName:w,updateCharacterBossConfig:u,getCharacterByIndex:k,characterNameExists:f,fetchWeeklyData:(a,d)=>rt(a,d),saveWeeklyData:(a,d,l)=>at(a,d,l)}}function Dt({characterBossSelections:t,bossData:n,checked:i,setChecked:r,userCode:h,appWeekKey:j}){const{lastWeeklyResetTimestamp:N}=Se(),{refreshWeeklyData:p}=St();function y(P,A){const V=n.find(Q=>Q.name===P);if(!V)return 0;const Z=V.difficulties.find(Q=>Q.difficulty===A);return Z?Z.price:0}const[s,o]=c.useState(!0),[S,$]=c.useState(null),[b,g]=c.useState(0),[D,C]=c.useState(null),[m,w]=c.useState(!1),[u,k]=c.useState(()=>{const P=localStorage.getItem(ve.WEEKLY_HIDE_COMPLETED);return P?JSON.parse(P):!1});c.useEffect(()=>{localStorage.setItem(ve.WEEKLY_HIDE_COMPLETED,JSON.stringify(u))},[u]),c.useEffect(()=>{if(t.length)w(!1);else{w(!1);const P=setTimeout(()=>{w(!0)},2e3);return()=>clearTimeout(P)}},[t.length]);const f=kt(h,j),{pitchedChecked:a,setPitchedChecked:d,cloudPitchedItems:l,refreshPitchedItems:x,loadingPitchedItems:_,setLoadingPitchedItems:F,userInteractionRef:J,addNewPitchedItem:v,removePitchedItemByDetails:H}=yt(h||null),I=Nt({userId:h,characterBossSelections:t,selectedCharIdx:b,checked:i,setChecked:r,setCrystalAnimation:$,setError:C,onDataChange:()=>{p(),x()}}),R=bt(h,x);c.useEffect(()=>{if(N>0&&h){X.info("WeeklyTracker: Detected weekly reset, refreshing pitched items.");const P=setTimeout(()=>{x()},500);return()=>clearTimeout(P)}},[N]);const G=P=>{f.handleWeekChange(P)};c.useEffect(()=>{b>=t.length&&g(Math.max(0,t.length-1))},[t.length,b]);const W=t[b],B=`${(W==null?void 0:W.name)||""}-${b}`,Y=(W==null?void 0:W.bosses)||[],L=[...Y].sort((P,A)=>{try{const V=y(P.name,P.difficulty)/(P.partySize||1);return y(A.name,A.difficulty)/(A.partySize||1)-V}catch(V){return C(`Error sorting bosses: ${V.message}`),0}}),q=t.reduce((P,A,V)=>{const Z=`${(A==null?void 0:A.name)||""}-${V}`;return P+(A.bosses||[]).reduce((Q,ee)=>{var ce;return(ce=i[Z])!=null&&ce[ee.name+"-"+ee.difficulty]?Q+y(ee.name,ee.difficulty)/(ee.partySize||1):Q},0)},0),U=t.reduce((P,A)=>P+(A.bosses||[]).reduce((V,Z)=>V+y(Z.name,Z.difficulty)/(Z.partySize||1),0),0),ae=t.map((P,A)=>{const V=`${(P==null?void 0:P.name)||""}-${A}`,Z=(P==null?void 0:P.bosses)||[],Q=Z.filter(M=>{var T;return(T=i[V])==null?void 0:T[M.name+"-"+M.difficulty]}).length,ee=Z.length,ce=Z.reduce((M,T)=>{var O;return(O=i[V])!=null&&O[T.name+"-"+T.difficulty]?M+Math.ceil(y(T.name,T.difficulty)/(T.partySize||1)):M},0);return{name:P.name,cleared:Q,total:ee,allCleared:ee>0&&Q===ee,left:ee-Q,idx:A,totalMeso:ce}}),re=u?ae.filter(P=>!P.allCleared):ae,te=Y.length>0;return D?e.jsxs("div",{className:"weekly-tracker-error",children:[e.jsx("div",{className:"weekly-tracker-error-message",children:D}),e.jsx("button",{onClick:()=>C(null),children:"Try Again"})]}):t.length?e.jsxs("div",{className:"weekly-tracker",children:[S&&e.jsx(nt,{startPosition:S.startPosition,endPosition:S.endPosition,onComplete:()=>$(null)}),e.jsxs("div",{className:"weekly-tracker-container",children:[e.jsx(ct,{sidebarVisible:s,isHistoricalWeek:f.isHistoricalWeek,totalMeso:q,obtainableMeso:U,selectedWeekKey:f.selectedWeekKey,hideCompleted:u,setHideCompleted:k,visibleCharSummaries:re,selectedCharIdx:b,setSelectedCharIdx:g,setPurgeTargetCharacter:R.setPurgeTargetCharacter,setShowCharacterPurgeConfirm:R.setShowCharacterPurgeConfirm,setShowCharacterPitchedModal:R.setShowCharacterPitchedModal,onShowTreasureAnalytics:()=>R.setShowStats(!0)}),e.jsx(ot,{sidebarVisible:s,setSidebarVisible:o}),e.jsx("div",{className:"weekly-tracker-main fade-in",children:e.jsxs("div",{className:"weekly-tracker-content",children:[e.jsx("div",{className:"weekly-tracker-header",children:e.jsx("h2",{className:"weekly-tracker-title",children:"Weekly Boss Tracker"})}),e.jsx("div",{className:"weekly-tracker-navigator-wrapper",children:e.jsx(lt,{appWeekKey:j,selectedWeekKey:f.selectedWeekKey,onWeekChange:G,isHistoricalWeek:f.isHistoricalWeek,historicalAnalysis:f.historicalAnalysis,characterBossSelections:t,checked:i,selectedCharIdx:b,totalMeso:q,obtainableMeso:U,charSummaries:ae})}),e.jsx(dt,{selectedWeekKey:f.selectedWeekKey,showTickAll:te&&!f.isHistoricalWeek,onTickAll:I.handleTickAll,allTicked:Y.every(P=>{var A;return(A=i[B])==null?void 0:A[P.name+"-"+P.difficulty]})&&Y.length>0}),te&&e.jsx("div",{children:e.jsx(ht,{isHistoricalWeek:f.isHistoricalWeek,characterBossSelections:t,selectedCharIdx:b,charBosses:Y,sortedBosses:L,bossData:n,checked:i,setChecked:r,charKey:B,getBossPrice:y,handleCheck:I.handleCheck,pitchedChecked:a,setPitchedChecked:d,weekKey:f.selectedWeekKey,refreshCheckedStateFromDatabase:I.refreshCheckedStateFromDatabase,userInteractionRef:J,userCode:h,setError:C,startStatsTrackingIfNeeded:R.startStatsTrackingIfNeeded,setHistoricalPitchedData:R.setHistoricalPitchedData,setShowHistoricalPitchedModal:R.setShowHistoricalPitchedModal,handleHistoricalPitchedRemove:R.handleHistoricalPitchedRemove,loadingPitchedItems:_,setLoadingPitchedItems:F,refreshPitchedItems:x,refreshHistoricalAnalysis:f.refreshHistoricalAnalysis,addNewPitchedItem:v,removePitchedItemByDetails:H},`${f.selectedWeekKey}-${b}`)})]})}),e.jsx(vt,{statsManagement:R,weekNavigation:f,pitchedChecked:a,setPitchedChecked:d,userInteractionRef:J,setError:C,characterBossSelections:t,selectedCharIdx:b,cloudPitchedItems:l})]})]}):e.jsx("div",{className:"weekly-tracker-no-characters",children:e.jsx("div",{className:`weekly-tracker-no-characters-message ${m?"visible":""}`,children:"No characters found. Go back and add a character first."})})}function Ft(){const{navigate:t}=Re(),{userCode:n,isLoggedIn:i,handleDeleteAccount:r}=be(),{characterBossSelections:h,checked:j,setChecked:N,fullUserData:p,weekKey:y,preservingCheckedStateRef:s}=Se(),[o,S]=c.useState([]),[$,b]=c.useState(!0),[g,D]=c.useState(!1),[C,m]=c.useState(!1),[w,u]=c.useState(""),[k,f]=c.useState(!1);if(c.useEffect(()=>{(async()=>{try{b(!0);const l=await Ge();l.success?S(l.data):(console.error("Failed to load boss data:",l.error),S([]))}catch(l){console.error("Error loading boss data:",l),S([])}finally{b(!1)}})()},[]),!i)return t("/login",{replace:!0}),null;const a=async()=>{f(!0),u("");try{const d=await r();d.success?(m(!1),t("/login",{replace:!0})):u(d.error)}catch(d){u("Failed to delete account. Try again."),console.error("Delete error:",d)}finally{f(!1)}};return $?e.jsxs("div",{className:"page-container",children:[e.jsx(ke,{currentPage:"weeklytracker",onShowHelp:()=>D(!0),onShowDeleteConfirm:()=>m(!0)}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",color:"#e6e0ff",fontSize:"1.2rem"},children:"Loading boss data..."})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(ke,{currentPage:"weeklytracker",onShowHelp:()=>D(!0),onShowDeleteConfirm:()=>m(!0)}),e.jsx(Fe,{children:e.jsx(Dt,{characterBossSelections:h,bossData:o,checked:j,setChecked:N,userCode:n,fullUserData:p,appWeekKey:y,preservingCheckedStateRef:s})}),e.jsx(Be,{showHelp:g,onClose:()=>D(!1),children:e.jsx(Oe,{})}),e.jsx(Ae,{showDeleteConfirm:C,onClose:()=>m(!1),onConfirm:a,showDeleteLoading:k,deleteError:w})]})}export{Ft as default};
