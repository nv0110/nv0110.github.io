import{j as e}from"./vendor-ui-aK89YfOw.js";import{r as h}from"./vendor-router-Cg8TMqY4.js";import{l as p,u as de,V as ue}from"./index-CCuhfZ7n.js";import"./vendor-react-eWEExxYH.js";import"./vendor-supabase-B7S7y5aO.js";const me={0:{success:95,maintain:5,decrease:0,destroy:0},1:{success:90,maintain:10,decrease:0,destroy:0},2:{success:85,maintain:15,decrease:0,destroy:0},3:{success:85,maintain:15,decrease:0,destroy:0},4:{success:80,maintain:20,decrease:0,destroy:0},5:{success:75,maintain:25,decrease:0,destroy:0},6:{success:70,maintain:30,decrease:0,destroy:0},7:{success:65,maintain:35,decrease:0,destroy:0},8:{success:60,maintain:40,decrease:0,destroy:0},9:{success:55,maintain:45,decrease:0,destroy:0},10:{success:50,maintain:50,decrease:0,destroy:0},11:{success:45,maintain:55,decrease:0,destroy:0},12:{success:40,maintain:60,decrease:0,destroy:0},13:{success:35,maintain:65,decrease:0,destroy:0},14:{success:30,maintain:70,decrease:0,destroy:0},15:{success:30,maintain:67.9,decrease:0,destroy:2.1},16:{success:30,maintain:0,decrease:67.9,destroy:2.1},17:{success:30,maintain:0,decrease:67.9,destroy:2.1},18:{success:30,maintain:0,decrease:67.2,destroy:2.8},19:{success:30,maintain:0,decrease:67.2,destroy:2.8},20:{success:30,maintain:63,decrease:0,destroy:7},21:{success:30,maintain:0,decrease:63,destroy:7},22:{success:3,maintain:0,decrease:77.6,destroy:19.4},23:{success:2,maintain:0,decrease:68.6,destroy:29.4},24:{success:1,maintain:0,decrease:59.4,destroy:39.6}};function J(a,t,r,d={},c=1e4){try{if(p.info("Starting starforce simulation",{equipLevel:a,currentStar:t,targetStar:r,options:d,simulations:c}),!a||a<1||a>300)return{success:!1,error:"Invalid equipment level. Must be between 1-300."};if(t<0||t>25||r<0||r>25)return{success:!1,error:"Invalid star levels. Must be between 0-25."};if(t>=r)return{success:!1,error:"Target star must be higher than current star."};const{eventType:x="none",mvpLevel:i="none",hasPremium:u=!1,isZeroWeapon:N=!1,safeguard15to16:f=!1,safeguard16to17:k=!1,useStarCatch:M=!1}=d,v=[],j=performance.now();for(let T=0;T<c;T++){const L=he(a,t,r,{eventType:x,mvpLevel:i,hasPremium:u,isZeroWeapon:N,safeguard15to16:f,safeguard16to17:k,useStarCatch:M});v.push(L)}const E=performance.now(),b=fe(v);return p.info("Starforce simulation completed",{simulations:c,duration:`${(E-j).toFixed(2)}ms`,averageCost:b.averageCost,averageAttempts:b.averageAttempts}),{success:!0,...b,equipLevel:a,currentStar:t,targetStar:r,options:{eventType:x,mvpLevel:i,hasPremium:u,isZeroWeapon:N,safeguard15to16:f,safeguard16to17:k,useStarCatch:M},simulationCount:c,duration:E-j}}catch(x){return p.error("Error in starforce simulation",x),{success:!1,error:"Failed to simulate starforce enhancement. Please try again."}}}function he(a,t,r,d){let c=t,x=0,i=0,u=!1,N=0,f=0,k=0,M=0;const v=Ne(a,d.isZeroWeapon);for(;c<r;){i++;const j=pe(v,c,d,a);x+=j;const E=u||(d.eventType==="51015"||d.eventType==="ssf")&&(c===5||c===10||c===15),b=ve(c,d,E),T=ge(b);if(T==="success"?(c++,M++,N=0,u=!1):T==="decrease"?c>=12&&(c=Math.max(12,c-1),k++,N++,N>=2&&(u=!0,N=0)):T==="destroy"&&(c===15&&d.safeguard15to16||c===16&&d.safeguard16to17||(c=12,f++,N=0,u=!1)),i>1e4){p.warn("Simulation exceeded 10000 attempts, terminating");break}}return{totalCost:x,attempts:i,successes:M,decreases:k,booms:f,chanceTimeUsed:M>r-t}}function ve(a,t,r){const d=me[a];if(r)return{success:100,maintain:0,decrease:0,destroy:0};let c=d.success;t.useStarCatch&&!r&&(c*=1.05);const x=d.maintain+d.decrease+d.destroy;c-d.success;const i=x>0?(100-c)/x:0;return{success:c,maintain:d.maintain*i,decrease:d.decrease*i,destroy:d.destroy*i}}function ge(a){const t=Math.random()*100;return t<a.success?"success":t<a.success+a.maintain?"maintain":t<a.success+a.maintain+a.decrease?"decrease":"destroy"}function pe(a,t,r,d){let c=0;const x=Se(d,t);if(x!==null)c=x;else{const N=Math.round(Math.pow(a,3)),f=t+1;t>=0&&t<=9?c=100*N*f/2510:t===10?c=100*N*Math.pow(f,2.7)/40010:t===11?c=100*N*Math.pow(f,2.7)/22010:t===12?c=100*N*Math.pow(f,2.7)/15010:t===13?c=100*N*Math.pow(f,2.7)/11010:t===14?c=100*N*Math.pow(f,2.7)/7510:t>=15&&t<=24&&(c=100*N*Math.pow(f,2.7)/20010),c=ee(c)}let i=xe(c,r,t);return(t===15&&r.safeguard15to16||t===16&&r.safeguard16to17)&&(i*=2),i}function xe(a,t,r){let d=a;if(r<=16){const x=Ce(t.mvpLevel,t.hasPremium);d*=x}return(t.eventType==="30off"||t.eventType==="ssf")&&(d*=.7),ee(d)}function fe(a){const t=a.map(i=>i.totalCost).sort((i,u)=>i-u),r=a.map(i=>i.attempts).sort((i,u)=>i-u),d=a.reduce((i,u)=>i+u.successes,0),c=a.reduce((i,u)=>i+u.decreases,0),x=a.reduce((i,u)=>i+u.booms,0);return{averageCost:Math.round(t.reduce((i,u)=>i+u,0)/t.length),medianCost:t[Math.floor(t.length*.5)],percentile25Cost:t[Math.floor(t.length*.25)],percentile75Cost:t[Math.floor(t.length*.75)],percentile90Cost:t[Math.floor(t.length*.9)],percentile99Cost:t[Math.floor(t.length*.99)],minCost:t[0],maxCost:t[t.length-1],averageAttempts:Math.round(r.reduce((i,u)=>i+u,0)/r.length),medianAttempts:r[Math.floor(r.length*.5)],percentile90Attempts:r[Math.floor(r.length*.9)],minAttempts:r[0],maxAttempts:r[r.length-1],averageSuccesses:Math.round(d/a.length),averageDecreases:Math.round(c/a.length),averageBooms:x/a.length,chanceTimeUsageRate:Math.round(a.filter(i=>i.chanceTimeUsed).length/a.length*100),costDistribution:je(t)}}function je(a){const r=a[0],c=(a[a.length-1]-r)/20,x=[];for(let i=0;i<20;i++){const u=r+i*c,N=r+(i+1)*c,f=a.filter(k=>k>=u&&k<N).length;x.push({range:`${w(u)} - ${w(N)}`,count:f,percentage:Math.round(f/a.length*100)})}return x}function Ne(a,t=!1){return t&&a>150?150:Math.floor(a/10)*10}function Ce(a,t=!1){let r=0;switch(a){case"silver":r+=.03;break;case"gold":r+=.05;break;case"diamond":r+=.1;break}return t&&(r+=.05),1-r}function Se(a,t){return(a===108||a===109)&&t===7?321e3:(a===118||a===119)&&t===9?533400:(a===128||a===129)&&t===14?6471400:null}function ee(a){return Math.round(a/100)*100}function ye(){return[{value:"none",name:"None",discount:"0%"},{value:"silver",name:"Silver",discount:"3%"},{value:"gold",name:"Gold",discount:"5%"},{value:"diamond",name:"Diamond",discount:"10%"}]}function w(a){return a>=1e9?`${(a/1e9).toFixed(2)}B`:a>=1e6?`${(a/1e6).toFixed(1)}M`:a>=1e3?`${(a/1e3).toFixed(0)}K`:a.toLocaleString()}function Re(){const{isLoggedIn:a}=de();h.useEffect(()=>{const s=document.body.style.overflowY,n=document.documentElement.style.overflowY;return document.body.style.overflowY="auto",document.documentElement.style.overflowY="auto",()=>{document.body.style.overflowY=s,document.documentElement.style.overflowY=n}},[]);const[t,r]=h.useState("calculator"),[d,c]=h.useState(200),[x,i]=h.useState(0),[u,N]=h.useState(17),[f,k]=h.useState("none"),[M,v]=h.useState("none"),[j,E]=h.useState(!1),[b,T]=h.useState(!1),[L,V]=h.useState(!1),[A,H]=h.useState(!1),[m,D]=h.useState(null),[B,z]=h.useState(!1),[C,_]=h.useState({eventType:"none",mvpLevel:"none",useStarCatch:!1,useMedianCost:!1}),[R,W]=h.useState({characters:[]}),[q,K]=h.useState(""),[Q,$]=h.useState(new Set);h.useEffect(()=>{try{const s=localStorage.getItem("enhancementPlannerData");if(s){const l=JSON.parse(s);W(l),p.info("Loaded planner data from localStorage")}const n=localStorage.getItem("enhancementCalculator_mode");n&&(r(n),p.info("Loaded mode from localStorage:",n));const o=localStorage.getItem("enhancementCalculator_calculatorSettings");if(o){const l=JSON.parse(o);c(l.equipLevel||200),i(l.currentStar||0),N(l.targetStar||17),k(l.eventType||"none"),v(l.mvpLevel||"none"),E(l.isZeroWeapon||!1),T(l.safeguard15to16||!1),V(l.safeguard16to17||!1),H(l.useStarCatch||!1),p.info("Loaded calculator settings from localStorage")}const g=localStorage.getItem("enhancementCalculator_globalSettings");if(g){const l=JSON.parse(g);_({eventType:l.eventType||"none",mvpLevel:l.mvpLevel||"none",useStarCatch:l.useStarCatch||!1,useMedianCost:l.useMedianCost||!1}),p.info("Loaded global settings from localStorage:",l)}}catch(s){p.error("Failed to load saved settings:",s)}},[]),h.useEffect(()=>{R.characters.length>0&&(localStorage.setItem("enhancementPlannerData",JSON.stringify(R)),p.info("Saved planner data to localStorage"))},[R]),h.useEffect(()=>{localStorage.setItem("enhancementCalculator_mode",t),p.info("Saved mode to localStorage:",t)},[t]),h.useEffect(()=>{const s={equipLevel:d,currentStar:x,targetStar:u,eventType:f,mvpLevel:M,isZeroWeapon:j,safeguard15to16:b,safeguard16to17:L,useStarCatch:A};localStorage.setItem("enhancementCalculator_calculatorSettings",JSON.stringify(s)),p.info("Saved calculator settings to localStorage")},[d,x,u,f,M,j,b,L,A]),h.useEffect(()=>{localStorage.setItem("enhancementCalculator_globalSettings",JSON.stringify(C)),p.info("Saved global settings to localStorage:",C)},[C]);const X=h.useCallback(()=>{if(!q.trim())return;const s={id:Date.now().toString(),name:q.trim(),items:[]};W(n=>({...n,characters:[...n.characters,s]})),K(""),$(n=>new Set([...n,s.id])),p.info("Added character:",s.name)},[q]),se=h.useCallback(s=>{W(n=>({...n,characters:n.characters.filter(o=>o.id!==s)})),$(n=>{const o=new Set(n);return o.delete(s),o}),p.info("Removed character:",s)},[]),ae=h.useCallback(s=>{$(n=>{const o=new Set(n);return o.has(s)?o.delete(s):o.add(s),o})},[]),te=[{value:"hat",name:"Hat",icon:"⛑️"},{value:"face_accessory",name:"Face Accessory",icon:"🎭"},{value:"eye_accessory",name:"Eye Accessory",icon:"🥽"},{value:"earrings",name:"Earrings",icon:"💎"},{value:"pendant",name:"Pendant",icon:"🏺"},{value:"ring",name:"Ring",icon:"💍"},{value:"overall",name:"Overall",icon:"🛡️"},{value:"top",name:"Top",icon:"🎽"},{value:"bottom",name:"Bottom",icon:"👖"},{value:"shoes",name:"Shoes",icon:"🥾"},{value:"gloves",name:"Gloves",icon:"🧤"},{value:"cape",name:"Cape",icon:"🧥"},{value:"belt",name:"Belt",icon:"⚜️"},{value:"shoulder",name:"Shoulder",icon:"🏛️"},{value:"weapon",name:"Weapon",icon:"⚔️"},{value:"shield",name:"Shield",icon:"🛡️"}],ne=h.useCallback(s=>{const n={id:Date.now().toString(),type:"weapon",name:"Weapon",equipLevel:200,currentStar:0,targetStar:17,isZeroWeapon:!1,useSafeguard:!1,calculationResult:null};W(o=>({...o,characters:o.characters.map(g=>g.id===s?{...g,items:[...g.items,n]}:g)})),p.info("Added item to character:",s)},[]),le=h.useCallback((s,n)=>{W(o=>({...o,characters:o.characters.map(g=>g.id===s?{...g,items:g.items.filter(l=>l.id!==n)}:g)})),p.info("Removed item:",n,"from character:",s)},[]),ce=h.useCallback((s,n,o)=>{W(g=>({...g,characters:g.characters.map(S=>S.id===s?{...S,items:S.items.map(y=>y.id===n?{...y,...o,...o.calculationResult?{}:{calculationResult:null}}:y)}:S)}))},[]),I=h.useCallback(()=>{p.info("Starting bulk calculation for all items"),W(s=>{let n={...s};return s.characters.forEach(o=>{o.items.forEach(g=>{if(g.equipLevel&&g.currentStar!==null&&g.targetStar!==null&&g.currentStar<g.targetStar)try{const l=C.eventType==="51015"||C.eventType==="ssf",S=g.useSafeguard&&!l,y=g.useSafeguard,P=J(g.equipLevel,g.currentStar,g.targetStar,{eventType:C.eventType,mvpLevel:C.mvpLevel,hasPremium:!1,isZeroWeapon:g.isZeroWeapon,safeguard15to16:S,safeguard16to17:y,useStarCatch:C.useStarCatch});n={...n,characters:n.characters.map(F=>F.id===o.id?{...F,items:F.items.map(Z=>Z.id===g.id?{...Z,calculationResult:P}:Z)}:F)}}catch(l){p.error("Calculation failed for item:",g.name,l),n={...n,characters:n.characters.map(S=>S.id===o.id?{...S,items:S.items.map(y=>y.id===g.id?{...y,calculationResult:{success:!1,error:"Calculation failed. Please try again."}}:y)}:S)}}})}),n})},[C]);h.useEffect(()=>{if(R.characters.length>0){const s=setTimeout(()=>{I()},500);return()=>clearTimeout(s)}},[C,I]);const re=h.useCallback((s,n)=>{p.info("calculateItemCost called with:",{characterId:s,itemId:n}),W(o=>{const g=o.characters.find(S=>S.id===s);if(!g)return p.error("Character not found:",s),o;const l=g.items.find(S=>S.id===n);if(!l)return p.error("Item not found:",n),o;if(p.info("Found item for calculation:",l),!l.equipLevel||l.currentStar===null||l.targetStar===null||l.currentStar>=l.targetStar)return p.error("Invalid item parameters:",{equipLevel:l.equipLevel,currentStar:l.currentStar,targetStar:l.targetStar}),{...o,characters:o.characters.map(S=>S.id===s?{...S,items:S.items.map(y=>y.id===n?{...y,calculationResult:{success:!1,error:"Please enter valid equipment level and star range."}}:y)}:S)};try{const S=C.eventType==="51015"||C.eventType==="ssf",y=l.useSafeguard&&!S,P=l.useSafeguard;p.info("Calculating cost for item:",l.name,"with params:",{equipLevel:l.equipLevel,currentStar:l.currentStar,targetStar:l.targetStar,eventType:C.eventType,mvpLevel:C.mvpLevel,isZeroWeapon:l.isZeroWeapon,safeguard15to16:y,safeguard16to17:P,useStarCatch:C.useStarCatch});const F=J(l.equipLevel,l.currentStar,l.targetStar,{eventType:C.eventType,mvpLevel:C.mvpLevel,hasPremium:!1,isZeroWeapon:l.isZeroWeapon,safeguard15to16:y,safeguard16to17:P,useStarCatch:C.useStarCatch});return p.info("Calculation result:",F),p.info("Calculation completed for item:",l.name),{...o,characters:o.characters.map(Z=>Z.id===s?{...Z,items:Z.items.map(Y=>Y.id===n?{...Y,calculationResult:F}:Y)}:Z)}}catch(S){return p.error("Calculation failed for item:",l.name,S),{...o,characters:o.characters.map(y=>y.id===s?{...y,items:y.items.map(P=>P.id===n?{...P,calculationResult:{success:!1,error:"Calculation failed. Please try again."}}:P)}:y)}}})},[C]),G=h.useCallback(s=>s.items.reduce((n,o)=>{var g;if((g=o.calculationResult)!=null&&g.success){const l=C.useMedianCost?o.calculationResult.medianCost:o.calculationResult.averageCost;return n+l}return n},0),[C.useMedianCost]),ie=h.useCallback(()=>R.characters.reduce((s,n)=>s+G(n),0),[R.characters,G]),oe=h.useCallback(()=>{if(!d||x===null||u===null||x>=u){D({success:!1,error:"Please enter valid equipment level and star range."});return}z(!0),setTimeout(()=>{try{p.info("Starting calculation with params:",{equipLevel:d,currentStar:x,targetStar:u,eventType:f,mvpLevel:M,isZeroWeapon:j,safeguard15to16:b,safeguard16to17:L,useStarCatch:A});const s=J(d,x,u,{eventType:f,mvpLevel:M,hasPremium:!1,isZeroWeapon:j,safeguard15to16:b,safeguard16to17:L,useStarCatch:A});p.info("Calculation completed:",s),D(s)}catch(s){p.error("Calculation failed:",s),D({success:!1,error:"Calculation failed. Please try again."})}finally{z(!1)}},100)},[d,x,u,f,M,j,b,L,A]);if(h.useEffect(()=>{m&&D(null)},[d,x,u,f,M,j,b,L,A]),!a)return null;const U=ye(),O=f==="51015"||f==="ssf";return h.useEffect(()=>{O&&b&&(T(!1),p.info("Safeguard 15→16 disabled due to 5/10/15 event (guaranteed success)"))},[f,O,b]),h.useEffect(()=>{j&&d>150&&(c(150),p.info("Equipment level capped at 150 due to Zero weapon setting"))},[j,d]),h.useEffect(()=>{try{localStorage.setItem("enhancementCalculator_mode",t),p.info("Saved mode to localStorage:",t)}catch(s){p.error("Failed to save mode to localStorage:",s)}},[t]),e.jsx("div",{className:"enhancement-calculator-page-wrapper",children:e.jsx("div",{className:"enhancement-calculator-page",children:e.jsx(ue,{children:e.jsxs("div",{className:"enhancement-calculator-main fade-in",children:[e.jsxs("div",{className:"enhancement-header",children:[e.jsx("h2",{className:"enhancement-title",children:"Enhancement Calculator"}),e.jsx("p",{className:"enhancement-subtitle",children:"Calculate meso costs for starforcing equipment"}),e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{className:`mode-button ${t==="calculator"?"active":""}`,onClick:()=>r("calculator"),children:"Single Calculator"}),e.jsx("button",{className:`mode-button ${t==="planner"?"active":""}`,onClick:()=>r("planner"),children:"Multi-Character Planner"})]})]}),t==="calculator"?e.jsxs("div",{className:"enhancement-container",children:[e.jsxs("div",{className:"enhancement-inputs",children:[e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Equipment Settings"}),e.jsxs("div",{className:"input-group",children:[e.jsxs("label",{htmlFor:"equip-level",children:["Equipment Level:",j&&e.jsx("span",{className:"level-cap-info",children:" (Max 150 for Zero weapons)"})]}),e.jsx("input",{id:"equip-level",type:"number",min:"1",max:j?"150":"300",value:d,onChange:s=>{const n=parseInt(s.target.value)||1;c(Math.min(n,j?150:300))},className:"level-input"})]}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>E(s.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-text",children:"Zero Weapon (Capped at Level 150)"})]})})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Star Range"}),e.jsxs("div",{className:"star-range-inputs",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"current-star",children:"Current Stars:"}),e.jsx("select",{id:"current-star",value:x,onChange:s=>i(parseInt(s.target.value)),className:"star-select",children:Array.from({length:25},(s,n)=>e.jsxs("option",{value:n,children:[n,"★"]},n))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"target-star",children:"Target Stars:"}),e.jsx("select",{id:"target-star",value:u,onChange:s=>N(parseInt(s.target.value)),className:"star-select",children:Array.from({length:25},(s,n)=>n+1).map(s=>e.jsxs("option",{value:s,disabled:s<=x,children:[s,"★"]},s))})]})]})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Discounts & Events"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"mvp-level",children:"MVP Level:"}),e.jsx("select",{id:"mvp-level",value:M,onChange:s=>v(s.target.value),className:"mvp-select",children:U.map(s=>e.jsxs("option",{value:s.value,children:[s.name," (",s.discount,")"]},s.value))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"event-type",children:"Active Event:"}),e.jsxs("select",{id:"event-type",value:f,onChange:s=>k(s.target.value),className:"event-select",children:[e.jsx("option",{value:"none",children:"No Event"}),e.jsx("option",{value:"30off",children:"30% Cost Reduction"}),e.jsx("option",{value:"51015",children:"5/10/15 Guaranteed Success"}),e.jsx("option",{value:"ssf",children:"Shiny Star Force (30% + 5/10/15)"})]})]}),f!=="none"&&e.jsxs("div",{className:"event-info",children:[f==="30off"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge",children:"30% Off"}),"All starforce costs reduced by 30%"]}),f==="51015"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge guaranteed",children:"5/10/15"}),"Guaranteed success for 5★→6★, 10★→11★, and 15★→16★ upgrades"]}),f==="ssf"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge",children:"SSF"}),"30% cost reduction + guaranteed success for 5★→6★, 10★→11★, and 15★→16★"]})]})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Star Catch Minigame"}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:s=>H(s.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-text",children:"Use Star Catch (+5% Success Rate)"})]})}),A&&e.jsx("div",{className:"starcatch-info",children:e.jsx("p",{className:"info-text",children:"Star Catch minigame increases success rate by 5% multiplicatively when successful. Does not appear during guaranteed upgrades (5/10/15 events, Chance Time)."})})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Safeguard Options"}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:`toggle-label ${O?"disabled":""}`,children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>T(s.target.checked),className:"toggle-checkbox",disabled:O}),e.jsx("span",{className:"toggle-slider"}),e.jsxs("span",{className:"toggle-text",children:["Safeguard 15★ → 16★",O&&e.jsx("span",{className:"disabled-reason",children:" (Guaranteed by event)"})]})]})}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:s=>V(s.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-text",children:"Safeguard 16★ → 17★"})]})}),(b||L)&&e.jsx("div",{className:"safeguard-info",children:e.jsx("p",{className:"info-text",children:"Safeguard doubles the cost but prevents equipment destruction."})})]}),e.jsx("div",{className:"enhancement-section",children:e.jsxs("div",{className:"calculate-section",children:[e.jsx("button",{onClick:oe,disabled:B||!d||x>=u,className:`calculate-button ${B?"calculating":""}`,children:B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"button-spinner"}),e.jsx("span",{children:"Running Simulation..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🎲"}),e.jsx("span",{children:"Calculate Starforce Cost"})]})}),e.jsx("div",{className:"calculate-info",children:e.jsx("p",{className:"info-text",children:"Runs 10,000 simulations to provide realistic cost estimates and risk analysis."})})]})})]}),e.jsx("div",{className:"enhancement-results",children:B?e.jsxs("div",{className:"calculating-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Calculating..."})]}):m?m.success?e.jsxs("div",{className:"results-content",children:[e.jsxs("div",{className:"simulation-header",children:[e.jsx("h3",{className:"results-title",children:"Simulation Results"}),e.jsxs("div",{className:"simulation-info",children:[e.jsxs("span",{className:"simulation-count",children:[m.simulationCount.toLocaleString()," simulations"]}),e.jsxs("span",{className:"simulation-time",children:["(",m.duration.toFixed(0),"ms)"]})]})]}),e.jsxs("div",{className:"statistics-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("h4",{children:"Average Cost"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:w(m.averageCost)}),e.jsxs("div",{className:"stat-tooltip",children:[m.averageCost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Median Cost"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:w(m.medianCost)}),e.jsxs("div",{className:"stat-tooltip",children:[m.medianCost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Average Booms"}),e.jsx("div",{className:"stat-value",children:m.averageBooms.toFixed(2)}),e.jsx("div",{className:"stat-unit",children:"booms"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"90th Percentile"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:w(m.percentile90Cost)}),e.jsxs("div",{className:"stat-tooltip",children:[m.percentile90Cost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]})]}),e.jsxs("div",{className:"risk-analysis",children:[e.jsx("h4",{children:"Cost Range Analysis"}),e.jsxs("div",{className:"range-stats",children:[e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"Best Case:"}),e.jsx("span",{className:"range-value",children:w(m.minCost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"25th Percentile:"}),e.jsx("span",{className:"range-value",children:w(m.percentile25Cost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"75th Percentile:"}),e.jsx("span",{className:"range-value",children:w(m.percentile75Cost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"99th Percentile:"}),e.jsx("span",{className:"range-value",children:w(m.percentile99Cost)})]}),e.jsxs("div",{className:"range-item worst-case",children:[e.jsx("span",{className:"range-label",children:"Worst Case:"}),e.jsx("span",{className:"range-value",children:w(m.maxCost)})]})]})]}),e.jsxs("div",{className:"outcome-analysis",children:[e.jsx("h4",{children:"Enhancement Outcomes"}),e.jsxs("div",{className:"outcome-stats",children:[e.jsxs("div",{className:"outcome-item success",children:[e.jsx("span",{className:"outcome-label",children:"Avg Successes:"}),e.jsx("span",{className:"outcome-value",children:m.averageSuccesses})]}),e.jsxs("div",{className:"outcome-item decrease",children:[e.jsx("span",{className:"outcome-label",children:"Avg Decreases:"}),e.jsx("span",{className:"outcome-value",children:m.averageDecreases})]}),e.jsxs("div",{className:"outcome-item boom",children:[e.jsx("span",{className:"outcome-label",children:"Avg Booms:"}),e.jsx("span",{className:"outcome-value",children:m.averageBooms})]}),e.jsxs("div",{className:"outcome-item chance-time",children:[e.jsx("span",{className:"outcome-label",children:"Chance Time Usage:"}),e.jsxs("span",{className:"outcome-value",children:[m.chanceTimeUsageRate,"%"]})]})]})]}),e.jsxs("div",{className:"simulation-summary",children:[e.jsx("h4",{children:"Simulation Parameters"}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Equipment Level:"}),e.jsx("span",{className:"summary-value",children:m.equipLevel})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Star Range:"}),e.jsxs("span",{className:"summary-value",children:[m.currentStar,"★ → ",m.targetStar,"★"]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Event:"}),e.jsxs("span",{className:"summary-value",children:[m.options.eventType==="none"&&"None",m.options.eventType==="30off"&&"30% Cost Reduction",m.options.eventType==="51015"&&"5/10/15 Guaranteed",m.options.eventType==="ssf"&&"Shiny Star Force"]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"MVP Level:"}),e.jsx("span",{className:"summary-value",children:m.options.mvpLevel==="none"?"None":m.options.mvpLevel.toUpperCase()})]}),m.options.useStarCatch&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Star Catch:"}),e.jsx("span",{className:"summary-value",children:"Enabled (+5% Success)"})]}),(m.options.safeguard15to16||m.options.safeguard16to17)&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Safeguards:"}),e.jsxs("span",{className:"summary-value",children:[m.options.safeguard15to16&&"15★→16★",m.options.safeguard15to16&&m.options.safeguard16to17&&", ",m.options.safeguard16to17&&"16★→17★"]})]}),m.options.isZeroWeapon&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Zero Weapon:"}),e.jsx("span",{className:"summary-value",children:"Yes (Capped at 150)"})]})]})]})]}):e.jsxs("div",{className:"error-message",children:[e.jsx("span",{className:"error-icon",children:"⚠️"}),e.jsx("span",{children:m.error})]}):e.jsx("div",{className:"no-results",children:e.jsx("span",{children:'Click the "Calculate Starforce Cost" button to run simulation'})})})]}):e.jsxs("div",{className:"planner-container",children:[e.jsxs("div",{className:"global-settings-panel",children:[e.jsx("h3",{className:"section-title",children:"Global Settings"}),e.jsxs("div",{className:"global-settings-grid",children:[e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"Event Type:"}),e.jsxs("select",{value:C.eventType,onChange:s=>_(n=>({...n,eventType:s.target.value})),className:"setting-select",children:[e.jsx("option",{value:"none",children:"No Event"}),e.jsx("option",{value:"30off",children:"30% Cost Reduction"}),e.jsx("option",{value:"51015",children:"5/10/15 Guaranteed Success"}),e.jsx("option",{value:"ssf",children:"Shiny Star Force (30% + 5/10/15)"})]})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"MVP Level:"}),e.jsx("select",{value:C.mvpLevel,onChange:s=>_(n=>({...n,mvpLevel:s.target.value})),className:"setting-select",children:U.map(s=>e.jsxs("option",{value:s.value,children:[s.name," (",s.discount,")"]},s.value))})]}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{type:"button",className:`toggle-button ${C.useStarCatch?"active":""}`,onClick:()=>_(s=>({...s,useStarCatch:!s.useStarCatch})),children:[e.jsx("span",{className:"toggle-icon",children:"⭐"}),e.jsx("span",{className:"toggle-text",children:"Star Catch (+5%)"})]})}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{type:"button",className:`toggle-button ${C.useMedianCost?"active":""}`,onClick:()=>_(s=>({...s,useMedianCost:!s.useMedianCost})),title:C.useMedianCost?"Using median cost (50th percentile)":"Using average cost (mean)",children:[e.jsx("span",{className:"toggle-icon",children:"📊"}),e.jsx("span",{className:"toggle-text",children:C.useMedianCost?"Median Cost":"Average Cost"})]})}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{onClick:I,className:"calculate-all-button",disabled:R.characters.length===0,children:[e.jsx("span",{children:"🎲"}),e.jsx("span",{children:"Re-run All Simulations"})]})})]})]}),e.jsxs("div",{className:"planner-header",children:[e.jsxs("div",{className:"add-character-section",children:[e.jsx("h3",{className:"section-title",children:"Add Character"}),e.jsxs("div",{className:"add-character-form",children:[e.jsx("input",{type:"text",value:q,onChange:s=>K(s.target.value),placeholder:"Enter character name...",className:"character-name-input",onKeyPress:s=>s.key==="Enter"&&X()}),e.jsx("button",{onClick:X,disabled:!q.trim(),className:"add-character-button",children:"Add Character"})]})]}),e.jsxs("div",{className:"overall-total",children:[e.jsxs("h3",{className:"section-title",children:["Total Costs",e.jsx("span",{className:"cost-type-indicator",children:C.useMedianCost?"Median":"Average"})]}),e.jsx("div",{className:"total-cost-display",children:R.characters.length>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"total-amount",children:w(ie())}),e.jsx("span",{className:"total-unit",children:"mesos"})]}):e.jsx("span",{className:"total-amount",children:"0 mesos"})})]})]}),e.jsx("div",{className:"characters-list",children:R.characters.length===0?e.jsx("div",{className:"no-characters",children:e.jsx("span",{children:"No characters added yet. Add a character to start planning!"})}):R.characters.map(s=>e.jsxs("div",{className:"character-card",children:[e.jsxs("div",{className:"character-header",children:[e.jsxs("div",{className:"character-info",children:[e.jsx("div",{className:"character-name-row",children:e.jsx("h4",{className:"character-name",children:s.name})}),e.jsxs("div",{className:"character-stats",children:[e.jsxs("span",{className:"item-count",children:[s.items.length," items"]}),e.jsxs("span",{className:"calculated-items",children:[s.items.filter(n=>{var o;return(o=n.calculationResult)==null?void 0:o.success}).length," calculated"]})]})]}),e.jsx("span",{className:"character-total-badge",children:w(G(s))}),e.jsxs("div",{className:"character-actions",children:[e.jsx("button",{onClick:()=>ae(s.id),className:"expand-button",children:Q.has(s.id)?"▲":"▼"}),e.jsx("button",{onClick:()=>se(s.id),className:"remove-character-button",children:"✕"})]})]}),Q.has(s.id)&&e.jsx("div",{className:"character-content",children:e.jsxs("div",{className:"items-section",children:[e.jsxs("div",{className:"items-header",children:[e.jsx("h5",{children:"Items"}),e.jsx("button",{onClick:()=>ne(s.id),className:"add-item-button",children:"+ Add Item"})]}),s.items.length===0?e.jsx("div",{className:"no-items",children:e.jsx("span",{children:"No items added yet."})}):e.jsx("div",{className:"items-list",children:s.items.map(n=>e.jsx(be,{item:n,characterId:s.id,onUpdateItem:ce,onRemoveItem:le,onCalculate:re,mvpOptions:U,equipmentTypes:te,globalSettings:C},n.id))})]})})]},s.id))})]})]})})})})}function be({item:a,characterId:t,onUpdateItem:r,onRemoveItem:d,onCalculate:c,mvpOptions:x,equipmentTypes:i,globalSettings:u}){var M;const N=(v,j)=>{if(v==="type"){const E=i.find(b=>b.value===j);r(t,a.id,{[v]:j,name:E?E.name:j})}else if(v==="equipLevel"){const E=a.isZeroWeapon?150:300,b=Math.min(j,E);r(t,a.id,{[v]:b})}else if(v==="isZeroWeapon"){const E={[v]:j};j&&a.equipLevel>150&&(E.equipLevel=150),r(t,a.id,E)}else r(t,a.id,{[v]:j})};h.useEffect(()=>{if(a.equipLevel&&a.currentStar!==null&&a.targetStar!==null&&a.currentStar<a.targetStar){const v=setTimeout(()=>{c(t,a.id)},300);return()=>clearTimeout(v)}},[a.equipLevel,a.currentStar,a.targetStar,a.isZeroWeapon,a.useSafeguard,t,a.id,c]);const f=u.eventType==="51015"||u.eventType==="ssf",k=()=>f?"Safeguard 16★→17★ (15★→16★ guaranteed by event)":"Safeguard 15★→16★ & 16★→17★ (same as calculator)";return e.jsxs("div",{className:"item-card",children:[e.jsxs("div",{className:"item-header",children:[e.jsx("div",{className:"item-info",children:e.jsxs("div",{className:"item-header-row-inline",children:[e.jsx("div",{className:"item-type-selector",children:e.jsx("select",{value:a.type||"weapon",onChange:v=>N("type",v.target.value),className:"item-type-select",children:i.map(v=>e.jsxs("option",{value:v.value,children:[v.icon," ",v.name]},v.value))})}),e.jsxs("div",{className:"summary-control-inline",children:[e.jsxs("label",{children:["Lv.",a.isZeroWeapon&&e.jsx("span",{className:"level-cap-hint",title:"Zero weapons capped at 150",children:"(≤150)"})]}),e.jsx("input",{type:"number",min:"1",max:a.isZeroWeapon?"150":"300",value:a.equipLevel,onChange:v=>N("equipLevel",parseInt(v.target.value)||1),className:"level-input-inline"})]}),e.jsxs("div",{className:"star-range-inline",children:[e.jsx("select",{value:a.currentStar,onChange:v=>N("currentStar",parseInt(v.target.value)),className:"star-select-inline",children:Array.from({length:25},(v,j)=>e.jsxs("option",{value:j,children:[j,"★"]},j))}),e.jsx("span",{className:"star-arrow",children:"→"}),e.jsx("select",{value:a.targetStar,onChange:v=>N("targetStar",parseInt(v.target.value)),className:"star-select-inline",children:Array.from({length:25},(v,j)=>j+1).map(v=>e.jsxs("option",{value:v,disabled:v<=a.currentStar,children:[v,"★"]},v))})]}),e.jsxs("div",{className:"toggle-controls-inline",children:[e.jsxs("button",{type:"button",className:`toggle-btn-inline ${a.isZeroWeapon?"active":""}`,onClick:()=>N("isZeroWeapon",!a.isZeroWeapon),title:"Zero Weapon",children:[e.jsx("span",{className:"toggle-icon",children:"⚔️"}),e.jsx("span",{className:"toggle-text",children:"Zero Weapon"})]}),e.jsxs("button",{type:"button",className:`toggle-btn-inline ${a.useSafeguard?"active":""}`,onClick:()=>N("useSafeguard",!a.useSafeguard),title:k(),children:[e.jsx("span",{className:"toggle-icon",children:"🛡️"}),e.jsx("span",{className:"toggle-text",children:"Safeguard"})]})]}),(M=a.calculationResult)!=null&&M.success?e.jsxs("div",{className:"item-cost-badge",children:[e.jsxs("div",{className:"meso-part",children:["💰 ",w(u.useMedianCost?a.calculationResult.medianCost:a.calculationResult.averageCost),e.jsxs("div",{className:"cost-tooltip meso-tooltip",children:[u.useMedianCost?"Median":"Average"," Cost: ",(u.useMedianCost?a.calculationResult.medianCost:a.calculationResult.averageCost).toLocaleString()," mesos"]})]}),e.jsxs("div",{className:"boom-part",children:["💥",a.calculationResult.averageBooms.toFixed(1),e.jsxs("div",{className:"cost-tooltip boom-tooltip",children:["Expected Booms: ",a.calculationResult.averageBooms.toFixed(2)]})]})]}):e.jsx("div",{className:"item-cost-pending-badge",children:a.equipLevel&&a.currentStar<a.targetStar?"Calculating...":"Not calculated"})]})}),e.jsx("div",{className:"item-actions",children:e.jsx("button",{onClick:()=>d(t,a.id),className:"remove-item-button",children:"✕"})})]}),a.calculationResult&&!a.calculationResult.success&&e.jsxs("div",{className:"item-error-inline",children:["⚠️ ",a.calculationResult.error]})]})}export{Re as default};
