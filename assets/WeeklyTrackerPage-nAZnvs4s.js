const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B71EDpPb.js","assets/vendor-ui-aK89YfOw.js","assets/vendor-router-Cg8TMqY4.js","assets/vendor-react-eWEExxYH.js","assets/vendor-supabase-B7S7y5aO.js","assets/index-Bc7RTHCf.css","assets/userWeeklyDataService-ZqJ-EB27.js","assets/mapleWeekUtils-Bm65Nri8.js","assets/bossRegistryService-DvalQhf8.js","assets/bossCodeMapping-Cii3oUax.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-aK89YfOw.js";import{r as i,c as Ke}from"./vendor-router-Cg8TMqY4.js";import{s as ce,c as de,g as Ge,d as Ce,p as Ye,e as Ie,f as xe,l as d,h as Se,i as we,M as Ue,u as Pe,b as We,S as ue,j as De,a as Ve,N as Ee,V as ze,H as qe,W as Ze,D as Je}from"./index-B71EDpPb.js";import{_ as re}from"./vendor-supabase-B7S7y5aO.js";import{C as Xe}from"./CustomCheckbox-C2-rm8qf.js";import{getBossPitchedItems as be}from"./bossRegistryService-DvalQhf8.js";import{getCharacterHistoricalWeekAnalysis as Qe,getHistoricalWeekAnalysis as et,purgeAllStatsData as tt,clearCharacterPitchedUI as st,purgePitchedRecords as rt,getPitchedResetAuditHistory as at}from"./utilityService-Di5Jhq0_.js";import{getBossRegistryId as it}from"./bossCodeMapping-Cii3oUax.js";import{getCurrentMapleWeekStartDate as ot}from"./mapleWeekUtils-Bm65Nri8.js";import{fetchCurrentWeekData as Le,addCharacterToWeeklySetup as nt,removeCharacterFromWeeklySetup as ct,updateCharacterNameInWeeklySetup as lt,updateCharacterBossConfigInWeeklySetup as dt,saveOrUpdateUserWeeklyData as ht,fetchUserWeeklyData as ut}from"./userWeeklyDataService-ZqJ-EB27.js";import"./vendor-react-eWEExxYH.js";async function Te(t,o){try{if(!t||!o)return{success:!1,error:"Missing required parameters: userId and pitchedItemData"};const{charId:r,bossName:s,item:u}=o;if(!r||!s||!u)return{success:!1,error:"Missing required fields: charId, bossName, item"};const{data:g,error:b}=await ce.from("user_data").select("pitched_items").eq("id",t).single();if(b)return console.error("Error fetching user data for pitched items:",b),{success:!1,error:"Failed to fetch user data"};if(!g)return{success:!1,error:"User not found"};const w={charId:r.trim(),bossName:s.trim(),item:u.trim(),date:o.date||new Date().toISOString().split("T")[0]},c=[...g.pitched_items||[],w],{error:f}=await ce.from("user_data").update({pitched_items:c}).eq("id",t);return f?(console.error("Error adding pitched item:",f),{success:!1,error:"Failed to add pitched item"}):{success:!0,pitchedItem:w}}catch(r){return console.error("Error in addPitchedItem:",r),{success:!1,error:r.message}}}async function $e(t,o,r,s,u=null){try{if(!t||!o||!r||!s)return{success:!1,error:"Missing required parameters: userId, charId, bossName, and item"};const{data:g,error:b}=await ce.from("user_data").select("pitched_items").eq("id",t).single();if(b)return console.error("Error fetching user data for pitched item removal:",b),{success:!1,error:"Failed to fetch user data"};if(!g)return{success:!1,error:"User not found"};const w=g.pitched_items||[];let C;if(u)C=w.filter(f=>!(f.charId===o&&f.bossName===r&&f.item===s&&f.date===u));else{const f=w.findLastIndex(v=>v.charId===o&&v.bossName===r&&v.item===s);if(f===-1)return{success:!1,error:"Pitched item not found"};C=w.filter((v,W)=>W!==f)}if(C.length===w.length)return{success:!1,error:"Pitched item not found"};const{error:c}=await ce.from("user_data").update({pitched_items:C}).eq("id",t);return c?(console.error("Error removing pitched item:",c),{success:!1,error:"Failed to remove pitched item"}):{success:!0}}catch(g){return console.error("Error in removePitchedItem:",g),{success:!1,error:g.message}}}async function Re(t,o){try{if(!t||!Array.isArray(o)||o.length===0)return{success:!1,error:"Missing required parameters or empty items array"};const{data:r,error:s}=await ce.from("user_data").select("pitched_items").eq("id",t).single();if(s)return console.error("Error fetching user data for bulk removal:",s),{success:!1,error:"Failed to fetch user data"};if(!r)return{success:!1,error:"User not found"};const u=r.pitched_items||[];let g=[...u];o.forEach(({charId:C,item:c,date:f})=>{if(f)g=g.filter(v=>!(v.charId===C&&v.item===c&&v.date===f));else{const v=g.findLastIndex(W=>W.charId===C&&W.item===c);v!==-1&&g.splice(v,1)}});const b=u.length-g.length;if(b===0)return{success:!1,error:"No matching pitched items found"};const{error:w}=await ce.from("user_data").update({pitched_items:g}).eq("id",t);return w?(console.error("Error removing multiple pitched items:",w),{success:!1,error:"Failed to remove pitched items"}):{success:!0,removedCount:b}}catch(r){return console.error("Error in removeManyPitchedItems:",r),{success:!1,error:r.message}}}async function je(t,o={}){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const{weekKey:r,charId:s,year:u}=o,{data:g,error:b}=await ce.from("user_data").select("pitched_items").eq("id",t).single();if(b)return console.error("Error fetching pitched items:",b),{success:!1,error:"Failed to fetch pitched items"};if(!g)return{success:!1,error:"User not found"};let w=g.pitched_items||[];return r&&(w=w.filter(C=>de(C.date)===r)),s&&(w=w.filter(C=>C.charId===s)),u&&(w=w.filter(C=>new Date(C.date).getFullYear()===u)),{success:!0,items:w}}catch(r){return console.error("Error in getPitchedItems:",r),{success:!1,error:r.message}}}async function Me(t,o){try{if(!t||!o)return{success:!1,error:"Missing required parameters: userId and weekKey"};const{data:r,error:s}=await ce.from("user_data").select("pitched_items").eq("id",t).single();if(s)return console.error("Error fetching user data for week clear:",s),{success:!1,error:"Failed to fetch user data"};if(!r)return{success:!1,error:"User not found"};const u=r.pitched_items||[],g=u.filter(C=>de(C.date)!==o),b=u.length-g.length;if(b===0)return{success:!0,removedCount:0};const{error:w}=await ce.from("user_data").update({pitched_items:g}).eq("id",t);return w?(console.error("Error clearing week pitched items:",w),{success:!1,error:"Failed to clear week pitched items"}):{success:!0,removedCount:b}}catch(r){return console.error("Error in clearPitchedItemsForWeek:",r),{success:!1,error:r.message}}}async function ye(t,o=null){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const r=o?parseInt(o,10):new Date().getFullYear(),s=await je(t,{year:r});if(!s.success)return s;const u=s.items,g={total:u.length,characters:new Set,items:[]};return u.forEach(w=>{g.characters.add(w.charId),g.items.push({charId:w.charId,item:w.item,date:w.date})}),{success:!0,stats:{year:r,total:g.total,characters:Array.from(g.characters),items:g.items}}}catch(r){return console.error("Error in getYearlyPitchedStats:",r),{success:!1,error:r.message}}}async function Oe(t){try{if(!t)return{success:!1,error:"Missing required parameter: userId"};const o=await je(t,{});if(!o.success)return o;const r=o.items.length;if(r===0)return{success:!0,removedCount:0};const{error:s}=await ce.from("user_data").update({pitched_items:[]}).eq("id",t);return s?(console.error("Error purging all pitched items:",s),{success:!1,error:"Failed to purge pitched items"}):{success:!0,removedCount:r}}catch(o){return console.error("Error in purgeAllPitchedItems:",o),{success:!1,error:o.message}}}const ke=Object.freeze(Object.defineProperty({__proto__:null,addPitchedItem:Te,clearPitchedItemsForWeek:Me,getPitchedItems:je,getYearlyPitchedStats:ye,purgeAllPitchedItems:Oe,removeManyPitchedItems:Re,removePitchedItem:$e},Symbol.toStringTag,{value:"Module"}));function mt({appWeekKey:t,selectedWeekKey:o,onWeekChange:r,historicalAnalysis:s={hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[]}}){const[u,g]=i.useState(!1);i.useEffect(()=>{const a=()=>{g(window.innerWidth<=768)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const b=i.useMemo(()=>{const n=(s==null?void 0:s.adaptiveWeekLimit)||8;return{min:-n,max:0,current:0,adaptiveLimit:n}},[s,t]),w=i.useMemo(()=>Ge(o,t),[o,t]),C=i.useCallback(a=>{a!==o&&r(a)},[o,r]),c=()=>{const a=w-1;if(a>=b.min){const n=Ce(a,t);C(n)}},f=()=>{const a=w+1;if(a<=b.max){const n=Ce(a,t);C(n)}},v=i.useCallback(()=>{if(s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek))C(s.oldestHistoricalWeek);else{const a=Ce(-b.adaptiveLimit,t);C(a)}},[s,b.adaptiveLimit,t,C]),W=()=>{C(t)},E=w>b.min,S=w<b.max,_=(s==null?void 0:s.hasHistoricalData)||w>-b.adaptiveLimit,P=o===t,h=i.useMemo(()=>{const a=Ye(o),n=Ie(o);return{label:xe(o,t),parsed:a,dateRange:n,isSelectedWeekTheCurrentAppWeek:P,offset:w}},[o,t,P,w]);return i.useEffect(()=>{const a=!P,n=(s==null?void 0:s.hasHistoricalData)&&(s==null?void 0:s.oldestHistoricalWeek)&&o!==s.oldestHistoricalWeek&&!P;d.debug("WeekNavigator: Button visibility debug",{selectedWeekKey:o,appWeekKey:t,isSelectedWeekTheCurrentAppWeek:P,currentBtnVisible:a,oldestBtnVisible:n,historicalAnalysis:{hasHistoricalData:s==null?void 0:s.hasHistoricalData,oldestHistoricalWeek:s==null?void 0:s.oldestHistoricalWeek,userType:s==null?void 0:s.userType,adaptiveWeekLimit:s==null?void 0:s.adaptiveWeekLimit}})},[o,t,P,s]),e.jsx("div",{className:"week-navigator-wrapper",children:e.jsxs("div",{className:"week-navigator-container",children:[e.jsx("div",{className:"week-navigator-header",children:e.jsxs("div",{className:`week-navigator-title ${P?"current-week":"historical-week"}`,children:[e.jsx("span",{className:"week-title-text",children:h.label.replace(/\s*\(Current\)/i,"")}),P&&e.jsx("span",{className:"week-navigator-current-dot",children:e.jsx("span",{className:"week-navigator-current-dot-inner"})})]})}),e.jsxs("div",{className:"week-navigator-navigation",children:[e.jsx("div",{className:`week-navigator-arrow-container ${E?"enabled arrow-left":"disabled"}`,onClick:E?c:void 0,title:E?"Previous Week":`Already at oldest allowed week (${b.adaptiveLimit} weeks back from current)`,children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`week-navigator-arrow arrow-left ${E?"enabled":"disabled"}`,children:e.jsx("path",{d:"M20.3284 11.0001V13.0001L7.50011 13.0001L10.7426 16.2426L9.32842 17.6568L3.67157 12L9.32842 6.34314L10.7426 7.75735L7.49988 11.0001L20.3284 11.0001Z",fill:"currentColor"})})}),e.jsxs("div",{className:"week-navigator-center-content",children:[h.dateRange&&e.jsxs("div",{className:"week-navigator-date-range",children:[h.dateRange.start.toLocaleDateString()," - ",h.dateRange.end.toLocaleDateString()]}),e.jsxs("div",{className:"week-navigator-integrated-buttons",children:[e.jsxs("button",{onClick:W,className:`week-navigator-integrated-btn current-week-btn ${P?"hidden":"visible"}`,title:"Jump to current application week",disabled:P,children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})}),"Current"]}),e.jsxs("button",{onClick:v,className:`week-navigator-integrated-btn oldest-data-btn ${s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)&&o!==s.oldestHistoricalWeek&&!P?"visible":"hidden"}`,title:`Jump to oldest recorded data (${s!=null&&s.oldestHistoricalWeek?xe(s.oldestHistoricalWeek,t):"oldest data"})`,disabled:!(s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)&&o!==s.oldestHistoricalWeek&&!P),children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Oldest"]})]})]}),e.jsx("div",{className:`week-navigator-arrow-container ${P?_?"enabled arrow-right":"disabled":S?"enabled arrow-right":"disabled"}`,onClick:P?_?v:void 0:S?f:void 0,title:P?_?s!=null&&s.hasHistoricalData&&(s!=null&&s.oldestHistoricalWeek)?`Jump to oldest data (${xe(s.oldestHistoricalWeek,t)})`:`Jump to ${b.adaptiveLimit} weeks back`:"No older data available to jump to":S?"Next Week":"Already at current application week",children:e.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:`week-navigator-arrow arrow-right ${P?_?"enabled":"disabled":S?"enabled":"disabled"}`,children:e.jsx("path",{d:"M15.0378 6.34317L13.6269 7.76069L16.8972 11.0157L3.29211 11.0293L3.29413 13.0293L16.8619 13.0157L13.6467 16.2459L15.0643 17.6568L20.7079 11.9868L15.0378 6.34317Z",fill:"currentColor"})})})]}),!P&&e.jsx("div",{className:"week-navigator-floating-actions week-navigator-floating-left",children:e.jsx("button",{onClick:W,className:"week-navigator-floating-btn",title:"Jump to current week",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})})})}),(s==null?void 0:s.hasHistoricalData)&&(s==null?void 0:s.oldestHistoricalWeek)&&o!==s.oldestHistoricalWeek&&e.jsx("div",{className:"week-navigator-floating-actions week-navigator-floating-right",children:e.jsx("button",{onClick:v,className:"week-navigator-floating-btn",title:`Jump to oldest data (${xe(s.oldestHistoricalWeek,t)})`,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M3 12H21M3 6H21M3 18H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})})]},o)})}function pe(t){if(t===0)return"0";if(t<1e9){const r=t/1e6;if(r<1){const s=t/1e3;return s<1?t.toString():`${s.toFixed(1)}K`}return`${r.toFixed(1)}M`}return`${(t/1e9).toFixed(1)}B`}const ft=(t=[])=>{const[o,r]=i.useState(!1),s=i.useRef(null);return i.useEffect(()=>{const u=s.current;if(!u)return;const g=()=>{const w=u.scrollHeight>u.clientHeight,C=u.scrollTop<=5;r(w&&C)},b=()=>{g()};return g(),u.addEventListener("scroll",b),()=>{u.removeEventListener("scroll",b)}},t),{showIndicator:o,elementRef:s}},gt=({show:t,className:o=""})=>e.jsx("div",{className:`scroll-indicator ${t?"visible":"hidden"} ${o}`,children:e.jsx("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M7 10L12 15L17 10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),pt=Ke.memo(function({sidebarVisible:o,setSidebarVisible:r,isHistoricalWeek:s,totalMeso:u,obtainableMeso:g,selectedWeekKey:b,hideCompleted:w,setHideCompleted:C,visibleCharSummaries:c,selectedCharIdx:f,setSelectedCharIdx:v,setPurgeTargetCharacter:W,setShowCharacterPurgeConfirm:E,setShowCharacterPitchedModal:S,onShowTreasureAnalytics:_,characterBossSelections:P,showOnboardingIndicators:h,onReorderCharacters:a}){const[n,m]=i.useState(!1),[k,l]=i.useState(!1),[j,y]=i.useState(!1),[N,I]=i.useState(!0),[D,L]=i.useState(null),[R,M]=i.useState(null),[U,ae]=i.useState(!1),{showIndicator:Q,elementRef:te}=ft([c,o]);i.useEffect(()=>{const x=()=>{const p=window.innerWidth;m(p<=768),l(p<=480)};return x(),window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]),i.useEffect(()=>{if(!o)return;const x=p=>{if(U||D){console.log("CharacterSidebar: Click outside blocked - drag in progress",{isDragging:U,draggedCharacter:D==null?void 0:D.name,eventType:p.type});return}p.target.closest(".sidebar-scroll")||p.target.closest(".sidebar-toggle")||p.target.closest(".sidebar-mobile-fab")||p.target.closest(".modal-overlay")||p.target.closest(".dropdown-menu")||p.target.closest(".navbar")||p.target.closest("button")||p.target.closest("select")||p.target.closest("input")||p.target.closest("a")||p.target.closest('[role="button"]')||p.target.closest(".clickable")||p.target.closest(".boss-table-container")||p.target.closest(".boss-table-grid")||p.target.closest(".boss-table-row")||p.target.closest(".boss-config-table-grid")||p.target.closest(".boss-config-row")||p.target.closest(".week-navigator")||p.target.closest(".week-card")||p.target.closest(".crystal-tracker")||p.target.closest(".character-dropdown")||p.target.closest(".mode-indicator")||p.target.closest('.sidebar-character-card[draggable="true"]')||p.target.onclick||p.target.getAttribute("onClick")||(console.log("CharacterSidebar: Closing sidebar due to outside click"),r&&r(!1))};if(U||D){console.log("CharacterSidebar: Skipping click outside listener - drag in progress");return}return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[o,r,U,D]);const z=i.useCallback((x,p)=>{if(console.log("=== DRAG START ===",{character:p.name,eventTarget:x.target.className,eventType:x.type,isMobile:n,isVerySmall:k,isHistoricalWeek:s}),n||k)return console.log("CharacterSidebar: Drag prevented - mobile or small screen"),x.preventDefault(),!1;if(s)return console.log("CharacterSidebar: Drag prevented - historical week"),x.preventDefault(),!1;console.log("CharacterSidebar: Drag start processing...",{character:p.name,target:x.target.className,currentTarget:x.currentTarget.className,dataTransfer:x.dataTransfer});try{x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",p.name);const $=x.target.closest(".sidebar-character-card");return $&&($.style.opacity="0.5",console.log("CharacterSidebar: Visual feedback applied to card")),setTimeout(()=>{L(p),ae(!0),console.log("CharacterSidebar: State updated after drag start")},0),console.log("CharacterSidebar: Drag start completed successfully"),!0}catch($){return console.error("CharacterSidebar: Error in drag start:",$),!1}},[n,k,s]),A=i.useCallback(x=>{console.log("=== DRAG END ===",{eventType:x.type,target:x.target.className,currentTarget:x.currentTarget.className,draggedCharacter:D==null?void 0:D.name,isDragging:U,timeStamp:x.timeStamp});const p=x.target.closest(".sidebar-character-card");p&&(p.style.opacity="1",console.log("CharacterSidebar: Opacity reset for card")),L(null),M(null),ae(!1),console.log("CharacterSidebar: Drag end cleanup completed")},[D,U]),V=i.useCallback((x,p,$)=>{!D||D.idx===p.idx||(x.preventDefault(),x.stopPropagation(),M($))},[D]),J=i.useCallback(x=>{const p=x.currentTarget.getBoundingClientRect(),$=x.clientX,H=x.clientY;($<p.left||$>p.right||H<p.top||H>p.bottom)&&M(null)},[]),X=i.useCallback(async(x,p,$)=>{if(console.log("CharacterSidebar: Drop event triggered"),x.preventDefault(),x.stopPropagation(),!D||!a||D.idx===p.idx){console.log("CharacterSidebar: Drop cancelled",{draggedCharacter:D==null?void 0:D.name,onReorderCharacters:!!a,sameCharacter:(D==null?void 0:D.idx)===p.idx}),M(null);return}console.log("CharacterSidebar: Processing drop",{draggedCharacter:D.name,targetCharacter:p.name,targetIndex:$}),d.debug("CharacterSidebar: Drop",{draggedCharacter:D.name,targetCharacter:p.name,targetIndex:$});try{const K=[...c.map(Y=>Y.name)],G=K.findIndex(Y=>Y===D.name);G!==-1&&K.splice(G,1);const B=K.findIndex(Y=>Y===p.name);B!==-1?K.splice(B,0,D.name):K.push(D.name);const O=await a(K);O.success?d.info("CharacterSidebar: Characters reordered successfully"):d.error("CharacterSidebar: Failed to reorder characters",{error:O.error})}catch(H){d.error("CharacterSidebar: Error during character reordering",{error:H})}M(null)},[D,a,c]),T=i.useCallback((x,p)=>{x.stopPropagation(),v(p.idx),S&&S(!0)},[v,S]),oe=i.useCallback(x=>{U||D||(v(x),k&&o&&r&&setTimeout(()=>r(!1),300))},[v,k,o,r,U,D]),ne=i.useCallback((x,p)=>{x.preventDefault(),x.stopPropagation(),W({name:p.name,idx:p.idx}),E(!0)},[W,E]),le=i.useCallback(x=>{x.stopPropagation(),y(p=>!p)},[]),F=i.useCallback(x=>{x.stopPropagation(),I(p=>!p)},[]),ee=i.useCallback(()=>{const x=c.reduce(($,H)=>$+H.total,0),p=c.reduce(($,H)=>$+H.cleared,0);return{totalPossible:x,totalCleared:p}},[c]);return e.jsxs(e.Fragment,{children:[n&&o&&e.jsx("div",{className:"sidebar-mobile-overlay",onClick:()=>r&&r(!1)}),k&&!o&&e.jsxs("button",{className:"sidebar-mobile-fab",onClick:()=>r&&r(!0),title:"Open character sidebar",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7.75735 13.2574L2 9.27L8.91 8.26L12 2Z",fill:"currentColor"})}),e.jsx("span",{className:"sidebar-mobile-fab-badge",children:c.length})]}),e.jsx("div",{className:`sidebar-scroll fade-in-no-slide ${o?"visible":"hidden"} ${n?"mobile":"desktop"} ${k?"very-small":""}`,children:e.jsxs("div",{className:"sidebar-content",children:[n&&e.jsx("button",{className:"sidebar-mobile-close",onClick:()=>r&&r(!1),title:"Close sidebar",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6 18L18 6M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),e.jsx("div",{className:"sidebar-header",children:e.jsx("h3",{className:`sidebar-title ${h?"onboarding-highlight":""}`,onClick:_,title:"View logged item analytics across all characters",children:"Characters"})}),!s&&e.jsx("div",{className:`sidebar-progress-section premium-progress ${h?"onboarding-highlight":""}`,onClick:le,children:j?c[f]&&e.jsxs("div",{className:"sidebar-progress-container sidebar-progress-character",children:[e.jsxs("div",{className:"sidebar-progress-title",children:[c[f].name,"'s Weekly"]}),e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${(()=>{const x=c[f];if(!x)return 0;`${x.name}${x.idx}`;const p=P[x.idx];if(!p)return 0;const $=p.bosses.reduce((H,K)=>H+Math.ceil((K.price||0)/(K.partySize||1)),0);return $>0?Math.min(x.totalMeso/$*100,100):0})()}%`},children:c[f].totalMeso>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:pe(c[f].totalMeso)}),e.jsx("span",{children:pe((()=>{const x=c[f];if(!x)return 0;const p=P[x.idx];return p?p.bosses.reduce(($,H)=>$+Math.ceil((H.price||0)/(H.partySize||1)),0):0})())})]})]}):e.jsxs("div",{className:"sidebar-progress-container sidebar-progress-weekly",children:[e.jsx("div",{className:"sidebar-progress-title",children:"Weekly Progress"}),e.jsx("div",{className:"sidebar-progress-track week-navigator-progress-bar-container",children:e.jsx("div",{className:"sidebar-progress-fill week-navigator-progress-bar",style:{width:`${g>0?Math.min(u/g*100,100):0}%`},children:g>0&&u>0&&e.jsx("div",{className:"week-navigator-progress-shimmer"})})}),e.jsxs("div",{className:"sidebar-progress-numbers",children:[e.jsx("span",{children:pe(u)}),e.jsx("span",{children:pe(g)})]})]})}),c[f]&&e.jsx("div",{className:"sidebar-crystal-count premium-progress",onClick:F,children:N?(()=>{const{totalPossible:x,totalCleared:p}=ee(),$=x-p,H=x>0&&p===x;return e.jsxs("div",{className:"sidebar-crystal-count-container sidebar-crystal-count-account",children:[e.jsx("div",{className:"crystal-account-header",children:e.jsx("span",{className:"crystal-account-title",children:"Account Overview"})}),e.jsxs("div",{className:"crystal-account-stats",children:[e.jsxs("div",{className:"crystal-stat-item crystal-stat-sold",children:[e.jsx("span",{className:"crystal-stat-number",children:p}),e.jsx("span",{className:"crystal-stat-label",children:"Sold"})]}),e.jsx("div",{className:"crystal-stat-divider",children:"•"}),e.jsxs("div",{className:"crystal-stat-item crystal-stat-remaining",children:[e.jsx("span",{className:"crystal-stat-number",children:$}),e.jsx("span",{className:"crystal-stat-label",children:"Remaining"})]})]}),H&&e.jsxs("div",{className:"crystal-count-status",children:[e.jsxs("svg",{className:"crystal-complete-icon",width:"14",height:"14",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"crystal-complete-text",children:"All Complete!"})]})]})})():e.jsxs("div",{className:"sidebar-crystal-count-container sidebar-crystal-count-character",children:[e.jsxs("div",{className:"sidebar-crystal-count-header",children:[e.jsx("span",{className:"crystal-count-character",children:c[f].name}),e.jsxs("span",{className:`crystal-count-display ${c[f].allCleared?"all-cleared":""}`,children:[c[f].cleared,"/",c[f].total," crystals"]})]}),c[f].allCleared&&e.jsxs("div",{className:"crystal-count-status",children:[e.jsxs("svg",{className:"crystal-complete-icon",width:"14",height:"14",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"crystal-complete-text",children:"Week Complete!"})]})]})}),s&&e.jsxs("div",{className:"sidebar-historical-section",children:[e.jsxs("div",{className:"sidebar-historical-title",children:["Week ",b.split("-").slice(1).join("-")]}),e.jsx("div",{className:"sidebar-historical-subtitle",children:"Historical Data"})]}),e.jsxs("div",{className:"sidebar-character-list-container",children:[e.jsx("div",{className:"sidebar-character-list",ref:te,children:c.length===0?e.jsx("div",{className:"sidebar-empty-state",children:w?"No characters with bosses left to clear.":"No characters found."}):c.map((x,p)=>e.jsxs("div",{draggable:!n&&!k&&!s,onClick:()=>oe(x.idx),onContextMenu:$=>ne($,x),onDragStart:$=>z($,x),onDragEnd:A,onDragOver:$=>V($,x,p),onDragLeave:J,onDrop:$=>X($,x,p),className:`sidebar-character-card ${f===x.idx?`selected ${s?"historical-week":"current-week"}`:"default"} ${(D==null?void 0:D.idx)===x.idx?"dragging":""} ${R===p&&(D==null?void 0:D.idx)!==x.idx?"drag-over":""} ${!n&&!k&&!s?"draggable":""}`,children:[e.jsxs("div",{className:"sidebar-character-header",children:[e.jsx("span",{className:`sidebar-character-name ${f===x.idx?"selected":"default"}`,children:x.name}),e.jsxs("div",{className:"sidebar-character-actions",children:[x.allCleared&&e.jsxs("svg",{className:"sidebar-character-checkmark",width:"16",height:"16",viewBox:"0 0 22 22",children:[e.jsx("circle",{cx:"11",cy:"11",r:"11",fill:"#38a169"}),e.jsx("polyline",{points:"6,12 10,16 16,7",fill:"none",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("button",{className:"sidebar-character-pitched-btn",onClick:$=>T($,x),title:"View pitched items",children:e.jsxs("div",{className:"pitched-btn-content",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7.75735 13.2574L2 9.27L8.91 8.26L12 2Z",fill:"url(#starGradient)",stroke:"url(#starStrokeGradient)",strokeWidth:"1.5"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"starGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]}),e.jsxs("linearGradient",{id:"starStrokeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#d6b4ff"}),e.jsx("stop",{offset:"1",stopColor:"#a259f7"})]})]})]}),e.jsx("span",{className:"pitched-btn-glow"})]})})]})]}),e.jsx("div",{className:"sidebar-character-stats",children:x.total===0?e.jsx("div",{className:"sidebar-character-no-bosses",children:"No bosses configured"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-character-completion",children:[x.cleared," / ",x.total," bosses cleared"]}),e.jsxs("div",{className:"sidebar-character-meso",children:[pe(x.totalMeso)," meso"]})]})})]},x.name+"-"+x.idx))}),e.jsx(gt,{show:Q})]})]})})]})});function kt({sidebarVisible:t,setSidebarVisible:o}){const[r,s]=i.useState(!1),[u,g]=i.useState(!1);return i.useEffect(()=>{const b=()=>{const w=window.innerWidth;s(w<=768),g(w<=480)};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),u?null:e.jsx("div",{className:`sidebar-toggle ${t?"visible":"hidden"} ${r?"mobile":"desktop"}`,onClick:()=>o(!t),title:t?"Hide sidebar":"Show sidebar",children:t?e.jsxs("svg",{className:"sidebar-toggle-close-icon",width:r?"20":"24",height:r?"20":"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"crossGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ffffff"}),e.jsx("stop",{offset:"50%",stopColor:"#e6e0ff"}),e.jsx("stop",{offset:"100%",stopColor:"#d6b4ff"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#crossGradient)"})]}):e.jsx("div",{className:"sidebar-toggle-hamburger",children:[0,1,2].map(b=>e.jsx("span",{className:"sidebar-toggle-hamburger-line",style:{width:r?"18px":"22px",height:r?"2px":"3px"}},b))})})}function ve(t,o,r,s){return`${t}__${o}__${r}__${s}`}function xt({bosses:t=[],bossData:o=[],checked:r={},characterKey:s="",onBossCheck:u=()=>{},getBossPrice:g=()=>0,showTickAll:b=!1,onTickAll:w=()=>{},allTicked:C=!1,pitchedChecked:c={},onPitchedItemClick:f=()=>{},isHistoricalWeek:v=!1,userCode:W="",selectedWeekKey:E="",selectedCharIdx:S=0,userInteractionRef:_=null,cloudPitchedItems:P=[],characterBossSelections:h=[]}){const[a,n]=i.useState(new Set);if(!t.length||!o.length)return e.jsx("div",{className:"boss-table-container",children:e.jsx("div",{className:"boss-table-loading",children:e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"#e6e0ff"},children:"Loading boss data..."})})});const m=L=>o.find(R=>R.name===L)||{},k=L=>new Intl.NumberFormat().format(L),l=i.useMemo(()=>s.split("-").slice(0,-1).join("-"),[s]),j=(L,R)=>be(L,R),y=(L,R,M)=>{if(!l)return!1;const U=ve(l,L,R,M);return!!c[U]},N=(L,R,M,U)=>{var te;const ae=((te=h[S])==null?void 0:te.name)||L,Q=ve(ae,R,M,U);return a.has(Q)},I=async(L,R,M,U)=>{var z;L.stopPropagation(),_&&(_.current=!0);const ae=((z=h[S])==null?void 0:z.name)||U,Q=ve(ae,R.name,M.name,E),te=y(R.name,M.name,E);if(!a.has(Q)){if(v){if(te){n(A=>new Set([...A,Q]));try{await f({bossName:R.name,itemName:M.name,characterName:ae,weekKey:E,isChecked:te,isHistorical:!0})}finally{n(A=>{const V=new Set(A);return V.delete(Q),V})}}return}n(A=>new Set([...A,Q]));try{await f({bossName:R.name,itemName:M.name,characterName:ae,weekKey:E,isChecked:te,isHistorical:!1,itemImage:M.image})}finally{n(A=>{const V=new Set(A);return V.delete(Q),V})}}},D=(L,R,M)=>{M.target.closest(".boss-pitched-items")||u(L,!R,M)};return e.jsx("div",{className:"boss-table-container",children:e.jsxs("div",{className:"boss-table-grid",children:[e.jsxs("div",{className:"boss-table-header",children:[e.jsx("div",{className:"header-boss",children:"Boss"}),e.jsx("div",{className:"header-difficulty",children:"Difficulty"}),e.jsx("div",{className:"header-mesos",children:"Mesos"}),e.jsxs("div",{className:"header-cleared",children:[b&&e.jsx("button",{onClick:w,className:"header-tick-all-button",title:C?"Clear all boss completions":"Mark all bosses as completed",children:C?"Clear All":"Complete All"}),!b&&"Cleared"]})]}),t.map((L,R)=>{var A;const M=m(L.name),U=`${L.name}-${L.difficulty}`,ae=!!((A=r[s])!=null&&A[U]),Q=g(L.name,L.difficulty)/(L.partySize||1),te=j(L.name,L.difficulty),z=l;return e.jsxs("div",{className:`boss-table-row ${R%2===0?"even":"odd"}`,onClick:V=>D(L,ae,V),children:[e.jsxs("div",{className:"cell-boss",children:[e.jsxs("div",{className:"boss-info-section",children:[M.image&&e.jsx("img",{src:M.image,alt:L.name,className:"boss-image"}),e.jsxs("div",{className:"boss-details",children:[e.jsx("span",{className:"boss-name",children:L.name}),L.partySize&&L.partySize>1&&e.jsxs("span",{className:"boss-party-size",children:["Party: ",L.partySize]})]})]}),te.length>0&&e.jsx("div",{className:"boss-pitched-items",onClick:V=>V.stopPropagation(),children:te.map((V,J)=>{const X=y(L.name,V.name,E),T=N(z,L.name,V.name,E);return e.jsx("div",{className:`pitched-item-icon ${X?"checked":"unchecked"} ${v?"historical":""} ${T?"loading":""}`,onClick:oe=>!T&&I(oe,L,V,z),title:T?"Processing...":`${V.name} ${X?"(Obtained)":"(Click to mark as obtained)"}`,style:{cursor:T?"not-allowed":"pointer",opacity:T?.7:1},children:T?e.jsx("div",{className:"pitched-item-loading",children:e.jsx("div",{className:"loading-spinner-small"})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:V.image,alt:V.name,className:"pitched-item-image"}),X&&e.jsx("div",{className:"pitched-item-checkmark",children:e.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})})]})},`${V.name}-${J}`)})})]}),e.jsx("div",{className:"cell-difficulty",children:L.difficulty}),e.jsx("div",{className:"cell-mesos",children:k(Math.ceil(Q))}),e.jsx("div",{className:"cell-cleared",children:e.jsx(Xe,{checked:ae,onChange:V=>{V.stopPropagation(),u(L,V.target.checked,V)}})})]},U)})]})})}function wt({bossData:t=[],characterKey:o="",selectedWeekKey:r="",selectedCharIdx:s=0,pitchedChecked:u={},onPitchedItemClick:g=()=>{},userCode:b="",cloudPitchedItems:w=[],characterBossSelections:C=[]}){const[c,f]=i.useState([]),v=i.useMemo(()=>o.split("-").slice(0,-1).join("-"),[o]),W=_=>t.find(P=>P.name===_)||{};i.useEffect(()=>{(async()=>{d.info("HistoricalWeekCards: Loading all bosses with pitched items from registry");const P=[],h=[{boss_name:"Lotus",difficulty:"Hard",drops_pitched:["Black Heart","Berserked"]},{boss_name:"Lotus",difficulty:"Extreme",drops_pitched:["Total Control","Black Heart","Berserked"]},{boss_name:"Damien",difficulty:"Hard",drops_pitched:["Magic Eyepatch"]},{boss_name:"Lucid",difficulty:"Hard",drops_pitched:["Dreamy Belt"]},{boss_name:"Will",difficulty:"Hard",drops_pitched:["Cursed Spellbook"]},{boss_name:"Gloom",difficulty:"Chaos",drops_pitched:["Endless Terror"]},{boss_name:"Darknell",difficulty:"Hard",drops_pitched:["Commanding Force Earring"]},{boss_name:"Verus Hilla",difficulty:"Hard",drops_pitched:["Source of Suffering"]},{boss_name:"Chosen Seren",difficulty:"Hard",drops_pitched:["Mitra's Rage"]},{boss_name:"Chosen Seren",difficulty:"Extreme",drops_pitched:["Mitra's Rage","Gravity Module"]},{boss_name:"Watcher Kalos",difficulty:"Easy",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Normal",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Chaos",drops_pitched:["Grindstone of Life"]},{boss_name:"Watcher Kalos",difficulty:"Extreme",drops_pitched:["Grindstone of Life","Mark of Destruction"]},{boss_name:"Kaling",difficulty:"Easy",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Normal",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Hard",drops_pitched:["Grindstone of Life"]},{boss_name:"Kaling",difficulty:"Extreme",drops_pitched:["Grindstone of Life","Helmet of Loyalty"]},{boss_name:"Limbo",difficulty:"Hard",drops_pitched:["Whisper of the Source"]}],a={};for(const n of h)if(n.drops_pitched.length>0){a[n.boss_name]||(a[n.boss_name]={name:n.boss_name,difficulties:[],itemMap:{}}),a[n.boss_name].difficulties.push(n.difficulty);for(const m of n.drops_pitched)a[n.boss_name].itemMap[m]||(a[n.boss_name].itemMap[m]=[]),a[n.boss_name].itemMap[m].push(n.difficulty)}for(const[n,m]of Object.entries(a)){const k=[...new Set(m.difficulties)].sort(),l=[];for(const[j,y]of Object.entries(m.itemMap)){const I=(be(n)||[]).find(D=>D.name===j)||{};l.push({name:j,image:I.image||"/images/items/default.png",droppingDifficulties:y.sort()})}l.length>0&&(P.push({name:n,items:l,difficultiesThatDropItems:k}),d.info("HistoricalWeekCards: Added boss with registry items",{bossName:n,itemCount:l.length,difficultiesThatDropItems:k,items:l.map(j=>`${j.name} (${j.droppingDifficulties.join(", ")})`)}))}f(P),d.info("HistoricalWeekCards: Total bosses with pitched items loaded from registry:",P.length)})()},[]);const E=(_,P,h)=>{if(!v)return!1;const a=ve(v,_,P,h);return!!u[a]},S=async(_,P,h)=>{var m;_.stopPropagation();const a=((m=C[s])==null?void 0:m.name)||v,n=E(P.name,h.name,r);d.debug("HistoricalWeekCards: Pitched item clicked",{bossName:P.name,itemName:h.name,character:a,weekKey:r,isChecked:n}),await g({bossName:P.name,itemName:h.name,characterName:a,weekKey:r,isChecked:n,isHistorical:!0,itemImage:h.image})};return i.useEffect(()=>{d.info("HistoricalWeekCards: Rendering with data",{bossesWithItemsCount:c.length,weekKey:r,characterName:v})},[c.length,r,v]),c.length?e.jsxs("div",{className:"historical-week-cards",children:[e.jsxs("div",{className:"historical-cards-header",children:[e.jsx("h3",{children:"Historical Week Overview"}),e.jsx("p",{children:"All bosses with droppable items - click on pitched items to add/remove historical drops"})]}),e.jsx("div",{className:"historical-cards-grid",children:c.map((_,P)=>{const h=W(_.name),a=_.name;return e.jsxs("div",{className:"historical-boss-card",children:[e.jsxs("div",{className:"historical-boss-header",children:[h.image&&e.jsx("img",{src:h.image,alt:_.name,className:"historical-boss-image"}),e.jsxs("div",{className:"historical-boss-details",children:[e.jsx("h4",{className:"historical-boss-name",children:_.name}),e.jsxs("span",{className:"historical-boss-difficulties",children:["Available in: ",_.difficultiesThatDropItems.join(", ")]})]})]}),e.jsxs("div",{className:"historical-pitched-section",children:[e.jsxs("div",{className:"historical-pitched-header",children:[e.jsx("span",{children:"Dropped Items"}),e.jsxs("span",{className:"historical-pitched-count",children:[_.items.filter(n=>E(_.name,n.name,r)).length," / ",_.items.length]})]}),e.jsx("div",{className:"historical-pitched-grid",children:_.items.map((n,m)=>{const k=E(_.name,n.name,r);return e.jsxs("div",{className:`historical-pitched-item ${k?"checked":"unchecked"}`,onClick:l=>S(l,_,n),title:`${n.name} - Drops from: ${n.droppingDifficulties.join(", ")} ${k?"(Obtained)":"(Click to mark as obtained)"}`,children:[e.jsx("img",{src:n.image,alt:n.name,className:"historical-pitched-image"}),e.jsxs("div",{className:"historical-pitched-info",children:[e.jsx("span",{className:"historical-pitched-name",children:n.name}),e.jsx("span",{className:"historical-pitched-difficulties",children:n.droppingDifficulties.join(", ")})]}),k&&e.jsx("div",{className:"historical-pitched-checkmark",children:"✓"})]},`${n.name}-${m}`)})})]})]},a)})})]}):e.jsxs("div",{className:"historical-cards-empty",children:[e.jsx("div",{className:"historical-cards-empty-icon",children:"🎁"}),e.jsx("h3",{children:"No Droppable Items"}),e.jsx("p",{children:"No bosses with droppable pitched items found."})]})}function vt({showStats:t,setShowStats:o,allYears:r,selectedYear:s,setSelectedYear:u,groupedYearlyPitchedItems:g,isLoadingCloudStats:b,setShowStatsResetConfirm:w,handleItemDetailClick:C}){if(!t)return null;const c=g.reduce((f,v)=>f+v.count,0);return e.jsx("div",{className:"modal-backdrop stats-modal-backdrop",onClick:()=>o(!1),children:e.jsxs("div",{className:"modern-stats-modal",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"modern-stats-header",children:[e.jsxs("div",{className:"modern-stats-title-section",children:[e.jsx("h2",{className:"modern-stats-title",children:"Pitched Items Statistics"}),e.jsx("div",{className:"modern-stats-subtitle",children:s})]}),e.jsx("button",{onClick:()=>o(!1),className:"modern-stats-close",title:"Close",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsxs("div",{className:"modern-stats-controls",children:[e.jsxs("div",{className:"modern-year-selector",children:[e.jsx("label",{className:"modern-year-label",children:"Year:"}),e.jsx("select",{value:s,onChange:f=>u(f.target.value),className:"modern-year-select",children:r.map(f=>e.jsx("option",{value:f,children:f},f))})]}),e.jsxs("div",{className:"modern-stats-summary",children:[e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:g.length}),e.jsx("div",{className:"modern-stat-label",children:"Unique Items"})]}),e.jsxs("div",{className:"modern-stat-card",children:[e.jsx("div",{className:"modern-stat-number",children:c}),e.jsx("div",{className:"modern-stat-label",children:"Total Obtained"})]})]})]}),e.jsx("div",{className:"modern-stats-content",children:b?e.jsxs("div",{className:"modern-stats-loading",children:[e.jsx("div",{className:"modern-loading-spinner"}),e.jsx("span",{children:"Loading statistics..."})]}):g.length===0?e.jsxs("div",{className:"modern-stats-empty",children:[e.jsx("div",{className:"modern-empty-icon",children:"📊"}),e.jsx("div",{className:"modern-empty-title",children:"No Data Yet"}),e.jsx("div",{className:"modern-empty-text",children:"Start clearing bosses to see your pitched item statistics!"})]}):e.jsx("div",{className:"modern-items-grid",children:g.map((f,v)=>e.jsxs("div",{className:"modern-item-card",onClick:()=>C(f),children:[e.jsxs("div",{className:"modern-item-image-container",children:[e.jsx("img",{src:f.itemImage,alt:f.itemName,className:"modern-item-image"}),e.jsx("div",{className:"modern-item-count-badge",children:f.count})]}),e.jsxs("div",{className:"modern-item-info",children:[e.jsx("div",{className:"modern-item-name",children:f.itemName}),e.jsx("div",{className:"modern-item-meta",children:f.count===1?"1 time":`${f.count} times`})]}),e.jsx("div",{className:"modern-item-arrow",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]},`${f.itemName}-${v}`))})}),e.jsx("div",{className:"modern-stats-footer",children:e.jsxs("button",{className:"modern-reset-button",onClick:()=>w(!0),children:[e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c0-1 1-2 2-2v2"})}),"Reset All Statistics"]})})]})})}function yt({showItemDetailModal:t,setShowItemDetailModal:o,selectedItemDetail:r}){if(!t||!r)return null;const{itemName:s,itemImage:u,count:g,instances:b}=r,w=b.reduce((c,f)=>(c[f.charId]||(c[f.charId]=[]),c[f.charId].push(f),c),{}),C=Object.keys(w).sort();return e.jsx("div",{className:"modal-backdrop item-detail-backdrop",onClick:()=>o(!1),children:e.jsxs("div",{className:"modern-item-detail-modal",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"modern-item-detail-header",children:[e.jsxs("div",{className:"modern-item-detail-title-section",children:[e.jsx("div",{className:"modern-item-detail-icon",children:e.jsx("img",{src:u,alt:s,className:"modern-item-detail-image"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"modern-item-detail-title",children:s}),e.jsxs("div",{className:"modern-item-detail-subtitle",children:["Obtained ",g," time",g!==1?"s":""]})]})]}),e.jsx("button",{onClick:()=>o(!1),className:"modern-item-detail-close",title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6 6 18M6 6l12 12"})})})]}),e.jsx("div",{className:"modern-item-detail-content",children:C.map(c=>e.jsxs("div",{className:"modern-character-section",children:[e.jsxs("div",{className:"modern-character-header",children:[e.jsx("div",{className:"modern-character-name",children:c}),e.jsxs("div",{className:"modern-character-count",children:[w[c].length," time",w[c].length!==1?"s":""]})]}),e.jsx("div",{className:"modern-dates-grid",children:w[c].map((f,v)=>e.jsxs("div",{className:"modern-date-chip",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"modern-date-icon",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),f.displayDate]},`${c}-${f.fullDate}-${v}`))})]},c))}),e.jsx("div",{className:"modern-item-detail-footer",children:e.jsxs("div",{className:"modern-detail-stats",children:[e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:C.length}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Character",C.length!==1?"s":""]})]}),e.jsxs("div",{className:"modern-detail-stat",children:[e.jsx("span",{className:"modern-detail-stat-number",children:g}),e.jsxs("span",{className:"modern-detail-stat-label",children:["Total Drop",g!==1?"s":""]})]})]})})]})})}function bt({data:t,characterBossSelections:o,onClose:r,onConfirm:s,pitchedChecked:u}){const[g,b]=i.useState(""),[w,C]=i.useState(!1),[c,f]=i.useState(""),v=i.useMemo(()=>t.weekKey?Ie(t.weekKey):{start:null,end:null},[t.weekKey]),W=i.useCallback(h=>h.toISOString().split("T")[0],[]),E=i.useMemo(()=>{var h;return t.character||((h=o[0])==null?void 0:h.name)||""},[t.character,o]);i.useEffect(()=>{v.start&&!g&&b(W(v.start))},[v,g,W]);const S=async()=>{if(!g||!E){f("Please select a valid date and character.");return}C(!0),f("");try{const h=new Date(g+"T12:00:00.000Z").toISOString();d.info("HistoricalPitchedModal: Confirming historical drop",{bossName:t.bossName,itemName:t.itemName,character:E,weekKey:t.weekKey,date:h}),await s(h,E),C(!1)}catch(h){d.error("HistoricalPitchedModal: Error confirming historical drop",h),f("Failed to add historical drop. Please try again."),C(!1)}},_=i.useMemo(()=>{if(!v.start||!v.end)return"";const h=v.start.toLocaleDateString("en-US",{month:"short"}),a=v.end.toLocaleDateString("en-US",{month:"short"}),n=v.start.getDate(),m=v.end.getDate(),k=v.start.getFullYear();return h===a?`${h} ${n}-${m}, ${k}`:`${h} ${n} - ${a} ${m}, ${k}`},[v]),P=i.useMemo(()=>{if(!v.start||!v.end)return[];const h=[],a=new Date(v.start);for(;a<=v.end;){const n=W(a),m=a.toLocaleDateString("en-US",{weekday:"long"}),k=a.toLocaleDateString("en-US",{month:"short",day:"numeric"});h.push({value:n,label:`${m}, ${k}`,date:new Date(a)}),a.setDate(a.getDate()+1)}return h},[v,W]);return e.jsx("div",{className:"historical-modal-overlay",onClick:r,children:e.jsxs("div",{className:"historical-modal-container",onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"historical-modal-header",children:[e.jsx("div",{className:"historical-modal-icon",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M12 2v20l-7-7h14l-7 7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"historical-modal-title",children:"Add Historical Drop"}),e.jsx("button",{className:"historical-modal-close",onClick:r,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{className:"historical-modal-showcase",children:[e.jsxs("div",{className:"historical-modal-item-container",children:[e.jsx("div",{className:"historical-modal-item-glow"}),e.jsx("img",{src:t.itemImage,alt:t.itemName,className:"historical-modal-item-image"})]}),e.jsxs("div",{className:"historical-modal-item-details",children:[e.jsx("h3",{className:"historical-modal-item-name",children:t.itemName}),e.jsxs("p",{className:"historical-modal-boss-name",children:["from ",t.bossName]})]})]}),e.jsx("div",{className:"historical-modal-details",children:e.jsxs("div",{className:"historical-modal-detail-group",children:[e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Character:"}),e.jsx("span",{className:"detail-value character-name",children:E})]}),e.jsxs("div",{className:"historical-modal-detail-row",children:[e.jsx("span",{className:"detail-label",children:"Week Range:"}),e.jsx("span",{className:"detail-value",children:_})]})]})}),e.jsxs("div",{className:"historical-modal-date-section",children:[e.jsx("label",{className:"historical-modal-section-title",children:"Select the day you obtained this item:"}),e.jsx("div",{className:"historical-modal-date-options",children:P.map(h=>e.jsxs("button",{className:`historical-modal-date-option ${g===h.value?"selected":""}`,onClick:()=>b(h.value),disabled:w,children:[e.jsx("span",{className:"date-option-day",children:h.label.split(",")[0]}),e.jsx("span",{className:"date-option-date",children:h.label.split(",")[1]})]},h.value))}),e.jsxs("div",{className:"historical-modal-date-input-wrapper",children:[e.jsx("label",{className:"historical-modal-date-input-label",children:"Or select date manually:"}),e.jsx("input",{type:"date",value:g,onChange:h=>b(h.target.value),min:v.start?W(v.start):"",max:v.end?W(v.end):"",className:"historical-modal-date-input",disabled:w})]})]}),c&&e.jsxs("div",{className:"historical-modal-error",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),c]}),e.jsxs("div",{className:"historical-modal-actions",children:[e.jsx("button",{onClick:r,disabled:w,className:"historical-modal-btn historical-modal-btn-cancel",children:"Cancel"}),e.jsxs("button",{onClick:S,disabled:w||!g||!E,className:"historical-modal-btn historical-modal-btn-confirm",children:[w&&e.jsx("div",{className:"historical-modal-spinner"}),w?"Adding Drop...":"Confirm Drop"]})]})]})})}function jt({isOpen:t,onClose:o,characterName:r,cloudPitchedItems:s=[],setPitchedModalItem:u,setShowPitchedModal:g}){const[b,w]=i.useState([]);i.useEffect(()=>{if(!t||!r)return;const c=s.filter(W=>W.charId===r),f=new Map;c.forEach(W=>{const E=W.item;if(!f.has(E)){let _="/items/crystal.png";const P=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling","Limbo"];for(const h of P){const n=be(h).find(m=>m.name===W.item);if(n){_=n.image;break}}f.set(E,{name:W.item,image:_,count:0,history:[]})}const S=f.get(E);S.count+=1,S.history.push({date:W.date})});const v=Array.from(f.values()).sort((W,E)=>E.count-W.count);w(v)},[t,r,s]);const C=c=>{if(!u||!g)return;const f=c.history.map(v=>({char:r,date:new Date(v.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}));u({name:c.name,image:c.image,history:f}),g(!0)};return t?e.jsx("div",{className:"pitched-modal-backdrop",onClick:o,children:e.jsxs("div",{className:`pitched-modal ${b.length===0?"pitched-modal-no-scroll":""}`,onClick:c=>c.stopPropagation(),children:[e.jsx("button",{className:"pitched-modal-close",onClick:o,"aria-label":"Close modal",children:e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"closeGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#805ad5"})]})}),e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"url(#closeGradient)"})]})}),e.jsx("h2",{className:"pitched-modal-title",children:r?`${r}'s Pitched Items`:"Pitched Items"}),b.length>0?e.jsx("div",{className:"pitched-modal-list-container",children:e.jsx("div",{className:"pitched-modal-list",children:b.map(c=>e.jsxs("div",{className:"pitched-modal-item",onClick:()=>C(c),style:{cursor:"pointer"},children:[e.jsx("div",{className:"pitched-modal-item-glow"}),e.jsx("img",{src:c.image,alt:c.name,className:"pitched-modal-item-img"}),e.jsx("div",{className:"pitched-modal-item-name",children:c.name}),e.jsx("div",{className:"pitched-modal-item-count",children:c.count})]},c.name))})}):e.jsxs("div",{className:"pitched-modal-empty",children:[e.jsx("div",{className:"empty-star-container",children:e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 24 24",fill:"none",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"emptyStarGradient",x1:"0",y1:"0",x2:"24",y2:"24",children:[e.jsx("stop",{stopColor:"#a259f7"}),e.jsx("stop",{offset:"1",stopColor:"#6a11cb"})]}),e.jsxs("filter",{id:"starGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"1.5",result:"blur"}),e.jsx("feFlood",{floodColor:"#a259f7",floodOpacity:"0.5",result:"color"}),e.jsx("feComposite",{in:"color",in2:"blur",operator:"in",result:"glow"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"glow",operator:"over"})]})]}),e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",fill:"url(#emptyStarGradient)",stroke:"#e6e0ff",strokeWidth:"1.5",filter:"url(#starGlow)",className:"empty-star-path"})]})}),e.jsx("h3",{className:"empty-title",children:"No pitched items yet"}),e.jsxs("p",{className:"empty-desc",children:[r?`${r} hasn't`:"You haven't"," obtained any pitched items yet"]})]})]})}):null}function Nt({showStatsResetConfirm:t,setShowStatsResetConfirm:o,onConfirm:r}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-small",children:[e.jsx("h3",{className:"stats-reset-title",children:"Are you sure?"}),e.jsx("p",{className:"stats-reset-message",children:"This will permanently erase all stats. This cannot be undone."}),e.jsxs("div",{className:"stats-reset-buttons",children:[e.jsx("button",{onClick:()=>o(!1),className:"stats-reset-button stats-reset-button-cancel",children:"Cancel"}),e.jsx("button",{onClick:r,className:"stats-reset-button stats-reset-button-confirm",children:"Reset"})]})]})}):null}function Ct({showCharacterPurgeConfirm:t,setShowCharacterPurgeConfirm:o,purgeTargetCharacter:r,purgeInProgress:s,onConfirm:u}){return t?e.jsx("div",{className:"modal-backdrop",children:e.jsxs("div",{className:"modal-container modal-container-medium character-purge-container",children:[e.jsx("div",{className:"character-purge-icon",children:e.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",stroke:"#fff",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("h2",{className:"character-purge-title",children:"Purge Character Data"}),e.jsxs("div",{className:"character-purge-warning",children:[e.jsx("p",{className:"character-purge-warning-title",children:e.jsx("strong",{children:"This will permanently delete all pitched items and boss runs for:"})}),e.jsx("p",{className:"character-purge-character-name",children:r==null?void 0:r.name}),e.jsx("p",{className:"character-purge-warning-note",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"character-purge-buttons",children:[e.jsx("button",{onClick:()=>o(!1),disabled:s,className:"character-purge-button character-purge-button-cancel",children:"Cancel"}),e.jsxs("button",{onClick:u,disabled:s,className:"character-purge-button character-purge-button-confirm",children:[s&&e.jsx("div",{className:"character-purge-spinner"}),s?"Purging...":"Purge Data"]})]})]})}):null}function St({resetSuccessVisible:t,closeResetSuccess:o,purgeSuccess:r,setPurgeSuccess:s}){return!t&&!r?null:e.jsx("div",{className:"modal-backdrop modal-backdrop-high",children:e.jsxs("div",{className:"modal-container modal-container-small",onClick:u=>u.stopPropagation(),children:[e.jsx("h3",{className:"success-title",children:t?"Stats reset!":"Character purged!"}),e.jsx("p",{className:"success-message",children:t?"Your stats have been cleared.":"Character data has been purged."}),e.jsx("button",{onClick:t?o:()=>s(!1),className:"success-button",children:"Close"})]})})}function _t({showPitchedModal:t,setShowPitchedModal:o,pitchedModalItem:r,pitchedModalDetails:s}){return!t||!r?null:e.jsx("div",{className:"pitched-details-modal-backdrop",onClick:()=>o(!1),style:{zIndex:9999},children:e.jsxs("div",{className:"pitched-details-modal pitched-details-modal-visible",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"pitched-details-modal-header",children:[e.jsx("button",{className:"pitched-details-modal-close",onClick:()=>o(!1),title:"Close",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M6.2253 4.81108C5.83477 4.42056 5.20161 4.42056 4.81108 4.81108C4.42056 5.20161 4.42056 5.83477 4.81108 6.2253L10.5858 12L4.81114 17.7747C4.42062 18.1652 4.42062 18.7984 4.81114 19.1889C5.20167 19.5794 5.83483 19.5794 6.22535 19.1889L12 13.4142L17.7747 19.1889C18.1652 19.5794 18.7984 19.5794 19.1889 19.1889C19.5794 18.7984 19.5794 18.1652 19.1889 17.7747L13.4142 12L19.189 6.2253C19.5795 5.83477 19.5795 5.20161 19.189 4.81108C18.7985 4.42056 18.1653 4.42056 17.7748 4.81108L12 10.5858L6.2253 4.81108Z",fill:"currentColor"})})}),e.jsxs("div",{className:"pitched-details-modal-item-showcase",children:[e.jsx("img",{src:r.image,alt:r.name,className:"pitched-details-modal-item-img"}),e.jsxs("div",{className:"pitched-details-modal-item-info",children:[e.jsx("h2",{className:"pitched-details-modal-title",children:r.name}),e.jsxs("div",{className:"pitched-details-modal-subtitle",children:[e.jsx("span",{className:"pitched-details-modal-count",children:s.length}),e.jsx("span",{className:"pitched-details-modal-acquired",children:s.length===1?"time obtained":"times obtained"})]})]})]})]}),e.jsxs("div",{className:"pitched-details-modal-content",children:[e.jsxs("div",{className:"pitched-details-section-header",children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"})}),e.jsx("h3",{children:"Acquisition History"})]}),e.jsx("div",{className:"pitched-details-acquisition",children:s.length===0?e.jsx("div",{className:"empty-state",children:"None this year."}):e.jsx("div",{className:"pitched-details-table-container",children:e.jsxs("table",{className:"pitched-details-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Character"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:s.map((u,g)=>e.jsxs("tr",{className:`pitched-details-row ${g%2===0?"even-row":"odd-row"}`,children:[e.jsx("td",{children:u.char}),e.jsx("td",{children:e.jsx("span",{className:"date-value",children:u.date})})]},g))})]})})})]})]})})}function Dt({statsManagement:t,weekNavigation:o,pitchedChecked:r,setPitchedChecked:s,userInteractionRef:u,setError:g,characterBossSelections:b,selectedCharIdx:w,cloudPitchedItems:C}){var c;return e.jsxs(e.Fragment,{children:[e.jsx(vt,{showStats:t.showStats,setShowStats:t.setShowStats,allYears:t.allYears,selectedYear:t.selectedYear,setSelectedYear:t.setSelectedYear,groupedYearlyPitchedItems:t.groupedYearlyPitchedItems,isLoadingCloudStats:t.isLoadingCloudStats,setShowStatsResetConfirm:t.setShowStatsResetConfirm,handleItemDetailClick:t.handleItemDetailClick}),e.jsx(yt,{showItemDetailModal:t.showItemDetailModal,setShowItemDetailModal:t.setShowItemDetailModal,selectedItemDetail:t.selectedItemDetail}),e.jsx(Nt,{showStatsResetConfirm:t.showStatsResetConfirm,setShowStatsResetConfirm:t.setShowStatsResetConfirm,onConfirm:()=>t.handleStatsReset(g)}),e.jsx(Ct,{showCharacterPurgeConfirm:t.showCharacterPurgeConfirm,setShowCharacterPurgeConfirm:t.setShowCharacterPurgeConfirm,purgeTargetCharacter:t.purgeTargetCharacter,purgeInProgress:t.purgeInProgress,onConfirm:()=>t.handleCharacterPurge(r,s,o.selectedWeekKey,u,g)}),e.jsx(St,{resetSuccessVisible:t.resetSuccessVisible,closeResetSuccess:t.closeResetSuccess,purgeSuccess:t.purgeSuccess,setPurgeSuccess:t.setPurgeSuccess}),t.showHistoricalPitchedModal&&e.jsx("div",{className:"modal-backdrop",onClick:()=>t.setShowHistoricalPitchedModal(!1),children:e.jsx(bt,{data:t.historicalPitchedData,characterBossSelections:b,onClose:()=>t.setShowHistoricalPitchedModal(!1),onConfirm:t.handleHistoricalPitchedConfirm,pitchedChecked:r})}),e.jsx(jt,{isOpen:t.showCharacterPitchedModal,onClose:()=>t.setShowCharacterPitchedModal(!1),characterName:((c=b[w])==null?void 0:c.name)||"",cloudPitchedItems:C,setPitchedModalItem:t.setPitchedModalItem,setShowPitchedModal:t.setShowPitchedModal}),e.jsx(_t,{showPitchedModal:t.showPitchedModal,setShowPitchedModal:t.setShowPitchedModal,pitchedModalItem:t.pitchedModalItem,pitchedModalDetails:t.pitchedModalDetails})]})}function Et(t,o,r=null){const[s,u]=i.useState(o||Se()),[g,b]=i.useState({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[],analysis:null}),[w,C]=i.useState(!1);i.useEffect(()=>{o&&o!==s&&(d.info("useWeekNavigation: App week key differs from selected, updating",{appWeekKey:o,selectedWeekKey:s}),u(o))},[o]);const c=s!==(o||Se()),f=i.useCallback(async()=>{var E;if(!t||w)return;try{const{STORAGE_KEYS:S}=await re(async()=>{const{STORAGE_KEYS:P}=await import("./index-B71EDpPb.js").then(h=>h.k);return{STORAGE_KEYS:P}},__vite__mapDeps([0,1,2,3,4,5])),_=localStorage.getItem(S.USER_CODE);if(!_||_!==t){d.debug("useWeekNavigation: Skipping analysis refresh - logout in progress",{userCode:t,storedCode:_});return}}catch(S){d.error("useWeekNavigation: Error checking auth state for analysis",{error:S});return}const W=Se();try{C(!0),d.debug("useWeekNavigation: Refreshing historical analysis",{userCode:t,realCurrentWeek:W,selectedCharacterName:r});const S=r?await Qe(t,r):await et(t);S.success?(b({hasHistoricalData:S.hasHistoricalData,oldestHistoricalWeek:S.oldestHistoricalWeek,userType:S.userType,adaptiveWeekLimit:S.adaptiveWeekLimit,historicalWeeks:S.historicalWeeks,analysis:S.analysis}),d.debug("useWeekNavigation: Historical analysis refreshed",{userType:S.userType,hasData:S.hasHistoricalData,oldestWeek:S.oldestHistoricalWeek,adaptiveLimit:S.adaptiveWeekLimit,historicalWeeksCount:((E=S.historicalWeeks)==null?void 0:E.length)||0,characterSpecific:!!r})):d.error("useWeekNavigation: Error in historical analysis result",S.error)}catch(S){d.error("useWeekNavigation: Error refreshing historical analysis",S)}finally{C(!1)}},[t,w,r]),v=i.useCallback(W=>{W!==s&&(d.info("useWeekNavigation: Week changed",{from:s,to:W}),u(W),t&&(async()=>{try{const{STORAGE_KEYS:S}=await re(async()=>{const{STORAGE_KEYS:P}=await import("./index-B71EDpPb.js").then(h=>h.k);return{STORAGE_KEYS:P}},__vite__mapDeps([0,1,2,3,4,5])),_=localStorage.getItem(S.USER_CODE);_&&_===t?setTimeout(()=>{f()},100):d.debug("useWeekNavigation: Skipping week change analysis - logout in progress")}catch(S){d.error("useWeekNavigation: Error checking auth for week change",{error:S})}})())},[s,t,f]);return i.useEffect(()=>{t?(async()=>{try{const{STORAGE_KEYS:E}=await re(async()=>{const{STORAGE_KEYS:_}=await import("./index-B71EDpPb.js").then(P=>P.k);return{STORAGE_KEYS:_}},__vite__mapDeps([0,1,2,3,4,5])),S=localStorage.getItem(E.USER_CODE);if(S&&S===t){d.debug("useWeekNavigation: Loading historical analysis for user",{userCode:t});const _=setTimeout(()=>{t&&localStorage.getItem(E.USER_CODE)===t&&f()},150);return()=>clearTimeout(_)}else d.debug("useWeekNavigation: Skipping load - logout in progress or userCode mismatch",{userCode:t,storedCode:S})}catch(E){d.error("useWeekNavigation: Error checking auth state",{error:E})}})():(d.debug("useWeekNavigation: Clearing analysis state for logout"),b({hasHistoricalData:!1,oldestHistoricalWeek:null,userType:"new",adaptiveWeekLimit:8,historicalWeeks:[],analysis:null}),C(!1))},[t,r,f]),{selectedWeekKey:s,isHistoricalWeek:c,handleWeekChange:v,historicalAnalysis:g,refreshHistoricalAnalysis:f,isLoadingAnalysis:w}}function Lt(t,o=null){const[r,s]=i.useState({}),[u,g]=i.useState([]),[b,w]=i.useState({}),[C,c]=i.useState(!1),f=i.useRef(!1),v=i.useCallback(async()=>{if(t)try{c(!0);const a=await je(t,{});if(a.success){g(a.items);const{getCurrentWeekKey:n}=await re(async()=>{const{getCurrentWeekKey:j}=await import("./index-B71EDpPb.js").then(y=>y.w);return{getCurrentWeekKey:j}},__vite__mapDeps([0,1,2,3,4,5])),m=n(),k=o||m;d.debug("usePitchedItems: Current week info",{currentAppWeekKey:m,currentViewingWeekKey:k,selectedWeekKey:o,totalItems:a.items.length});const l={};a.items.forEach(j=>{const y=de(j.date);if(y===k){const N=`${j.charId}__${j.bossName}__${j.item}__${y}`;l[N]=!0}}),d.debug("usePitchedItems: Loaded pitched items with week filtering",{totalItemsInDatabase:a.items.length,checkedKeysForCurrentWeek:Object.keys(l).length,currentViewingWeekKey:k,sampleCheckedKeys:Object.keys(l).slice(0,3),itemsInCurrentWeek:a.items.filter(j=>de(j.date)===k).length,itemsInOtherWeeks:a.items.filter(j=>de(j.date)!==k).length}),s(l)}else d.error("usePitchedItems: Failed to refresh pitched items",a.error)}catch(a){d.error("usePitchedItems: Error refreshing pitched items",a)}finally{c(!1)}},[t,o]),W=i.useCallback(async(a,n,m,k=null)=>{if(!t)return d.warn("usePitchedItems: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};const l=k||new Date().toISOString().split("T")[0],j=de(l),y=`${a}__${n}__${m}__${j}`;if(r[y])return d.info("usePitchedItems: Item already exists, skipping add",{key:y,existingChecked:!!r[y],charId:a,bossName:n,item:m,itemWeekKey:j}),{success:!0,message:"Item already exists"};d.debug("usePitchedItems: Adding new pitched item",{key:y,charId:a,bossName:n,item:m,itemWeekKey:j,pitchedCheckedKeys:Object.keys(r).length});const I=await Te(t,{charId:a,bossName:n,item:m,date:l});if(I.success){const D=I.pitchedItem;return g(L=>[...L,D]),s(L=>({...L,[y]:!0})),{success:!0}}else throw new Error(I.error)},[t,r]),E=i.useCallback(async(a,n,m,k=null)=>{if(!t)return d.warn("usePitchedItems: No user ID available, user may not be authenticated yet"),{success:!1,error:"User not authenticated"};d.debug("usePitchedItems: Attempting to remove pitched item",{charId:a,bossName:n,item:m,providedDate:k,cloudItemsCount:u.length});let l=k;if(l){if(!u.find(N=>N.charId===a&&N.bossName===n&&N.item===m&&N.date===k)){d.warn("usePitchedItems: Exact date match not found",{charId:a,bossName:n,item:m,targetDate:k,availableItemsForCharacter:u.filter(I=>I.charId===a).map(I=>({bossName:I.bossName,item:I.item,date:I.date}))});const N=u.filter(I=>I.charId===a&&I.bossName===n&&I.item===m);if(N.length>0)d.info("usePitchedItems: Found alternative matches, using most recent",{alternativeCount:N.length,alternatives:N.map(I=>I.date)}),N.sort((I,D)=>new Date(D.date)-new Date(I.date)),l=N[0].date;else throw d.error("usePitchedItems: No alternative matches found"),new Error("Pitched item not found")}}else{const y=u.filter(N=>N.charId===a&&N.bossName===n&&N.item===m);if(d.debug("usePitchedItems: Searching for matching items without date",{matchingItemsCount:y.length,matchingItems:y.map(N=>({charId:N.charId,bossName:N.bossName,item:N.item,date:N.date}))}),y.length>0)y.sort((N,I)=>new Date(I.date)-new Date(N.date)),l=y[0].date,d.debug("usePitchedItems: Found most recent item",{targetDate:l});else return d.info("usePitchedItems: No matching items found to remove",{charId:a,bossName:n,item:m,availableItems:u.map(N=>({charId:N.charId,bossName:N.bossName,item:N.item,date:N.date})).slice(0,5)}),{success:!0,message:"No items to remove"}}d.debug("usePitchedItems: Proceeding with removal",{charId:a,bossName:n,item:m,targetDate:l});const j=await $e(t,a,n,m,l);if(j.success){g(I=>I.filter(D=>!(D.charId===a&&D.bossName===n&&D.item===m&&D.date===l)));const y=de(l),N=`${a}__${n}__${m}__${y}`;return s(I=>{const D={...I};return delete D[N],D}),d.info("usePitchedItems: Successfully removed pitched item",{charId:a,bossName:n,item:m,targetDate:l,removedKey:N}),{success:!0}}else throw new Error(j.error)},[t,u]),S=i.useCallback(async a=>{if(!t)throw new Error("No user ID provided");const n=await Re(t,a);if(n.success)return g(m=>{let k=[...m];return a.forEach(({charId:l,bossName:j,item:y,date:N})=>{if(N)k=k.filter(I=>!(I.charId===l&&I.bossName===j&&I.item===y&&I.date===N));else{const I=k.findLastIndex(D=>D.charId===l&&D.bossName===j&&D.item===y);I!==-1&&k.splice(I,1)}}),k}),s(m=>{const k={...m};return a.forEach(({charId:l,bossName:j,item:y,date:N})=>{if(N){const I=de(N),D=`${l}__${j}__${y}__${I}`;delete k[D]}else Object.keys(k).forEach(I=>{I.startsWith(`${l}__${j}__${y}__`)&&delete k[I]})}),k}),{success:!0,removedCount:n.removedCount};throw new Error(n.error)},[t]),_=i.useCallback(async a=>{if(!t)throw new Error("No user ID provided");const n=await Me(t,a);if(n.success)return g(m=>m.filter(k=>de(k.date)!==a)),s(m=>{const k={...m};return Object.keys(k).forEach(l=>{l.endsWith(`__${a}`)&&delete k[l]}),k}),{success:!0,removedCount:n.removedCount};throw new Error(n.error)},[t]),P=i.useCallback(async(a=null)=>{if(!t)throw new Error("No user ID provided");const n=await ye(t,a);if(n.success)return{success:!0,stats:n.stats};throw new Error(n.error)},[t]),h=i.useCallback(async()=>{if(!t)throw new Error("No user ID provided");const a=await Oe(t);if(a.success)return g([]),s({}),{success:!0,removedCount:a.removedCount};throw new Error(a.error)},[t]);return i.useEffect(()=>{t?(async()=>{try{const{STORAGE_KEYS:n}=await re(async()=>{const{STORAGE_KEYS:k}=await import("./index-B71EDpPb.js").then(l=>l.k);return{STORAGE_KEYS:k}},__vite__mapDeps([0,1,2,3,4,5])),m=localStorage.getItem(n.USER_CODE);m&&m===t?(d.debug("usePitchedItems: Loading pitched items for user",{userId:t}),v()):d.debug("usePitchedItems: Skipping load - logout in progress or userId mismatch",{userId:t,storedCode:m})}catch(n){d.error("usePitchedItems: Error checking auth state",{error:n})}})():(d.debug("usePitchedItems: Clearing state for logout"),g([]),s({}),c(!1))},[t,v]),{pitchedChecked:r,setPitchedChecked:s,cloudPitchedItems:u,setCloudPitchedItems:g,userInteractionRef:f,refreshPitchedItems:v,loadingPitchedItems:b,setLoadingPitchedItems:w,isRefreshingPitchedItems:C,addNewPitchedItem:W,removePitchedItemByDetails:E,removeManyPitchedItemsByDetails:S,clearWeekPitchedItems:_,getYearlyStats:P,purgeAllItems:h}}function It({userId:t=null,characterBossSelections:o=[],selectedCharIdx:r=0,checked:s={},setChecked:u=()=>{},setError:g=()=>{},onDataChange:b=()=>{},isHistoricalWeek:w=!1,onBossUncheckStart:C=()=>{},onBossUncheckEnd:c=()=>{}}){const[f,v]=i.useState(!1),W=i.useRef(!1),E=i.useRef(0),S=i.useCallback(async(h,a,n)=>{if(f||!t){d.info("useBossActions: Boss check skipped",{isUpdating:f,hasUserId:!!t});return}if(r==null){d.debug("useBossActions: Boss check skipped",{reason:"No character selected",characterIdx:r,bossName:h.name,difficulty:h.difficulty});return}if(w){d.debug("useBossActions: Boss check skipped for historical week");return}v(!0),W.current=!0;try{d.debug("useBossActions: Boss check initiated",{bossName:h.name,difficulty:h.difficulty,isChecked:a,characterIdx:r});const m=o[r];if(!m)throw new Error("No character selected");const k=`${m.name}-${r}`,l=`${h.name}-${h.difficulty}`;u(R=>{const M={...R};return M[k]||(M[k]={}),M[k]={...M[k]},a?M[k][l]=!0:delete M[k][l],M}),d.debug("useBossActions: Boss check details",{charName:m.name,charIdx:r,bossName:h.name,difficulty:h.difficulty}),d.debug("useBossActions: Converting boss to registry ID",{bossName:h.name,difficulty:h.difficulty});const j=await it(h.name,h.difficulty);d.debug("useBossActions: Boss registry ID obtained",j);const{toggleBossClearStatus:y}=await re(async()=>{const{toggleBossClearStatus:R}=await import("./userWeeklyDataService-ZqJ-EB27.js");return{toggleBossClearStatus:R}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:N}=await re(async()=>{const{getCurrentMapleWeekStartDate:R}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:R}},[]),I=N(),D={userId:t,characterName:m.name,characterIndex:m.index.toString(),bossRegistryId:j,isCompleted:a,weekKey:I};d.debug("useBossActions: Updating database",{userId:t,characterName:m.name,characterIndex:m.index.toString(),bossRegistryId:j,isCompleted:a,weekKey:I});const L=await y(t,I,m.index.toString(),j,a);if(d.debug("useBossActions: Database update result",L),!L.success)throw new Error(L.error||"Failed to update boss completion");if(!a){C();try{d.info("useBossActions: Boss unchecked - removing associated pitched items",{characterName:m.name,bossName:h.name,difficulty:h.difficulty});const{removeManyPitchedItems:R}=await re(async()=>{const{removeManyPitchedItems:X}=await Promise.resolve().then(()=>ke);return{removeManyPitchedItems:X}},void 0),{getCurrentWeekKey:M,convertWeekKeyToDate:U,getWeekDateRange:ae}=await re(async()=>{const{getCurrentWeekKey:X,convertWeekKeyToDate:T,getWeekDateRange:oe}=await import("./index-B71EDpPb.js").then(ne=>ne.w);return{getCurrentWeekKey:X,convertWeekKeyToDate:T,getWeekDateRange:oe}},__vite__mapDeps([0,1,2,3,4,5])),Q=M(),te=U(Q),z=ae(Q);d.info("useBossActions: Week date analysis",{currentWeek:Q,currentWeekDate:te,currentWeekRange:{start:z.start,end:z.end}});const A=[],{getPitchedItems:V}=await re(async()=>{const{getPitchedItems:X}=await Promise.resolve().then(()=>ke);return{getPitchedItems:X}},void 0),J=await V(t,{});if(d.info("useBossActions: Retrieved pitched items for removal check",{success:J.success,totalItems:J.success?J.items.length:0,userId:t,currentWeekDate:te}),J.success){J.items.forEach((T,oe)=>{const ne=T.date?new Date(T.date):null,le=T.date===null||ne&&ne>=z.start&&ne<=z.end;d.info(`useBossActions: Item ${oe} - Character comparison: "${T.charId}" === "${m.name}" = ${T.charId===m.name}`),d.info(`useBossActions: Item ${oe} - Boss comparison: "${T.bossName}" === "${h.name}" = ${T.bossName===h.name}`),d.info(`useBossActions: Item ${oe} - Date analysis: ${T.date} (as Date: ${ne}) in range ${z.start} to ${z.end} OR null = ${le}`),d.info(`useBossActions: Item ${oe} - Overall match: ${T.charId===m.name&&T.bossName===h.name&&le}`)});const X=J.items.filter(T=>{const oe=T.date?new Date(T.date):null,ne=T.date===null||oe&&oe>=z.start&&oe<=z.end;return T.charId===m.name&&T.bossName===h.name&&ne});if(d.info("useBossActions: Filtered items for removal",{totalItemsFromDB:J.items.length,filteredItems:X.length,filterCriteria:{charId:m.name,bossName:h.name,date:te,alsoMatchingNull:!0},allItemsFromDB:J.items.map(T=>({charId:T.charId,bossName:T.bossName,item:T.item,date:T.date})),filteredItemDetails:X.map(T=>({charId:T.charId,bossName:T.bossName,item:T.item,date:T.date}))}),X.forEach(T=>{A.push({charId:T.charId,bossName:T.bossName,item:T.item,date:T.date})}),A.length>0){d.info("useBossActions: Removing pitched items for unchecked boss",{characterName:m.name,bossName:h.name,itemsToRemove:A.length,itemDetails:A});const T=await R(t,A);d.info("useBossActions: Pitched items removal result",{success:T.success,error:T.error,removedCount:T.removedCount,attemptedRemovalCount:A.length}),T.success?(d.info("useBossActions: Successfully removed pitched items",{removedCount:T.removedCount,originalCount:A.length}),b&&b()):d.warn("useBossActions: Failed to remove some pitched items",{error:T.error,itemsToRemove:A})}else d.info("useBossActions: No pitched items found to remove",{characterName:m.name,bossName:h.name,currentWeekDate:te,totalItemsInDB:J.items.length})}}catch(R){d.warn("useBossActions: Failed to remove pitched items for unchecked boss",{error:R,characterName:m.name,bossName:h.name})}finally{c()}}u(R=>{const M={...R};return M[k]||(M[k]={}),M[k]={...M[k]},a?M[k][l]=!0:delete M[k][l],M}),d.debug("useBossActions: Boss check completed successfully"),E.current=Date.now()}catch(m){d.error("useBossActions: Error handling boss check",m),g(m.message),u(k=>{const l={...k},j=o[r];if(j){const y=`${j.name}-${r}`,N=`${h.name}-${h.difficulty}`;l[y]||(l[y]={}),l[y]={...l[y]},a?delete l[y][N]:l[y][N]=!0}return l})}finally{v(!1)}},[t,o,r,s,u,g,b,f,w,C,c]),_=i.useCallback(async()=>{if(!(!t||w||f)){v(!0),W.current=!0;try{const h=o[r];if(!h)throw new Error("No character selected");const a=`${h.name}-${r}`,n=h.bosses||[],k=!n.every(L=>{var R;return(R=s[a])==null?void 0:R[`${L.name}-${L.difficulty}`]}),l={...s};u(L=>{const R={...L};R[a]||(R[a]={}),R[a]={...R[a]};for(const M of n){const U=`${M.name}-${M.difficulty}`;k?R[a][U]=!0:delete R[a][U]}return R});const{clearAllBossesForCharacter:j,markAllBossesForCharacter:y}=await re(async()=>{const{clearAllBossesForCharacter:L,markAllBossesForCharacter:R}=await import("./userWeeklyDataService-ZqJ-EB27.js");return{clearAllBossesForCharacter:L,markAllBossesForCharacter:R}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:N}=await re(async()=>{const{getCurrentMapleWeekStartDate:L}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:L}},[]),I=N();let D;if(k?(d.debug("useBossActions: Marking all bosses as cleared",{characterIdx:h.index,bossCount:n.length,weekKey:I}),D=await y(t,I,h.index.toString())):(d.debug("useBossActions: Clearing all bosses",{characterIdx:h.index,bossCount:n.length,weekKey:I}),D=await j(t,I,h.index.toString())),!D.success)d.error("useBossActions: Bulk operation failed",{action:k?"markAll":"clearAll",error:D.error}),u(l),g(`Failed to ${k?"mark all bosses as completed":"clear all boss completions"}. Please try again.`);else{if(!k){C();try{d.info("useBossActions: All bosses cleared - removing all pitched items for character",{characterName:h.name,bossCount:n.length});const{getPitchedItems:L,removeManyPitchedItems:R}=await re(async()=>{const{getPitchedItems:z,removeManyPitchedItems:A}=await Promise.resolve().then(()=>ke);return{getPitchedItems:z,removeManyPitchedItems:A}},void 0),{getCurrentWeekKey:M}=await re(async()=>{const{getCurrentWeekKey:z}=await import("./index-B71EDpPb.js").then(A=>A.w);return{getCurrentWeekKey:z}},__vite__mapDeps([0,1,2,3,4,5])),{convertWeekKeyToDate:U}=await re(async()=>{const{convertWeekKeyToDate:z}=await import("./index-B71EDpPb.js").then(A=>A.w);return{convertWeekKeyToDate:z}},__vite__mapDeps([0,1,2,3,4,5])),ae=M(),Q=U(ae),te=await L(t,{});if(te.success){const z=te.items.filter(A=>A.charId===h.name&&A.date===Q);if(z.length>0){const A=z.map(J=>({charId:J.charId,bossName:J.bossName,item:J.item,date:J.date}));d.info("useBossActions: Removing all pitched items for character",{characterName:h.name,itemsToRemove:A.length});const V=await R(t,A);V.success?d.info("useBossActions: Successfully removed all pitched items for character",{removedCount:V.removedCount}):d.warn("useBossActions: Failed to remove some pitched items during clear all",{error:V.error})}}}catch(L){d.warn("useBossActions: Failed to remove pitched items during clear all",{error:L,characterName:h.name})}finally{c()}}await b(),d.debug("useBossActions: Tick all completed successfully",{characterIdx:h.index,allTicked:k,processedBosses:n.length})}}catch(h){d.error("useBossActions: Error handling tick all",h),g(h.message),u(a=>{const n=o[r];if(!n)return a;const m=`${n.name}-${r}`,k=a[m]||{};return{...a,[m]:{...k}}})}finally{v(!1)}}},[t,o,r,s,u,g,b,f,w,C,c]);return{handleCheck:S,handleTickAll:_,refreshCheckedStateFromDatabase:async()=>{try{return t?(b&&b(),!0):null}catch(h){return console.error("Error refreshing checked state:",h),null}},isUpdating:f,userInteractionRef:W,lastUpdate:E.current}}const Pt=t=>{const o=["Lotus","Damien","Lucid","Will","Gloom","Darknell","Verus Hilla","Chosen Seren","Watcher Kalos","Kaling","Limbo"];for(const r of o){const u=be(r).find(g=>g.name===t);if(u)return u.image}return"/items/crystal.png"};function Wt(t,o){const[r,s]=i.useState(!1),[u,g]=i.useState(!1),[b,w]=i.useState({monthly:[],yearly:[]}),[C,c]=i.useState(!1),[f,v]=i.useState(null),[W,E]=i.useState(!1),[S,_]=i.useState(!1),[P,h]=i.useState([]),[a,n]=i.useState(!1),[m,k]=i.useState({}),[l,j]=i.useState(!1),[y,N]=i.useState(null),[I,D]=i.useState(!1),[L,R]=i.useState(!1),[M,U]=i.useState(!1),[ae,Q]=i.useState(null),[te,z]=i.useState(!1),[A,V]=i.useState(null),J=i.useMemo(()=>{const K=we(),G=new Set([K]);return b!=null&&b.yearly&&Array.isArray(b.yearly)&&b.yearly.forEach(B=>G.add(B.yearKey)),m&&Object.keys(m).forEach(B=>G.add(B)),Array.from(G).sort((B,O)=>O.localeCompare(B))},[b==null?void 0:b.yearly,m]),[X,T]=i.useState(()=>we());i.useEffect(()=>{(J==null?void 0:J.length)>0&&!J.includes(X)&&T(J[0])},[J,X]),i.useEffect(()=>{if(!r||!t)return;(async()=>{try{const{STORAGE_KEYS:G}=await re(async()=>{const{STORAGE_KEYS:O}=await import("./index-B71EDpPb.js").then(Y=>Y.k);return{STORAGE_KEYS:O}},__vite__mapDeps([0,1,2,3,4,5])),B=localStorage.getItem(G.USER_CODE);if(!B||B!==t){d.debug("useStatsManagement: Skipping cloud stats fetch - logout in progress",{userCode:t,storedCode:B});return}}catch(G){console.error("useStatsManagement: Error checking auth state for stats fetch",{error:G});return}try{j(!0);const G=parseInt(X,10),B=await ye(t,G),{STORAGE_KEYS:O}=await re(async()=>{const{STORAGE_KEYS:q}=await import("./index-B71EDpPb.js").then(ie=>ie.k);return{STORAGE_KEYS:q}},__vite__mapDeps([0,1,2,3,4,5])),Y=localStorage.getItem(O.USER_CODE);if(!Y||Y!==t){d.debug("useStatsManagement: Skipping result processing - logout occurred during fetch");return}B.success&&k(q=>({...q,[X]:B.stats}))}catch(G){console.error("Error fetching cloud pitched stats:",G)}finally{const{STORAGE_KEYS:G}=await re(async()=>{const{STORAGE_KEYS:O}=await import("./index-B71EDpPb.js").then(Y=>Y.k);return{STORAGE_KEYS:O}},__vite__mapDeps([0,1,2,3,4,5])),B=localStorage.getItem(G.USER_CODE);B&&B===t&&j(!1)}})()},[r,t,X]);const oe=i.useMemo(()=>{if(!X||!m)return[];const K=m[X];if(!(K!=null&&K.items)||!Array.isArray(K.items))return[];const G=new Map;return K.items.filter(O=>(O==null?void 0:O.item)&&(O==null?void 0:O.charId)&&(O==null?void 0:O.date)).forEach(O=>{const Y=O.item;G.has(Y)||G.set(Y,{itemName:Y,itemImage:Pt(Y),count:0,instances:[]});const q=G.get(Y);q.count+=1;const ie=new Date(O.date),Z=Ue[ie.getUTCMonth()],se=ie.getUTCDate();q.instances.push({charId:O.charId,fullDate:O.date,displayDate:`${Z} ${se}`,sortDate:ie.getTime()})}),Array.from(G.values()).map(O=>({...O,instances:O.instances.sort((Y,q)=>q.sortDate-Y.sortDate)})).sort((O,Y)=>Y.count!==O.count?Y.count-O.count:O.itemName.localeCompare(Y.itemName))},[X,m]),ne=async(K,G,B,O,Y)=>{if(f)try{E(!0);const{name:q,idx:ie}=f;O.current=!0;const Z=st(K,q,ie,B);if(G(Z),(await rt(t,q,ie)).success){k({}),await o(t);const me=await ye(t);if(me.success){const Ne=we();k({[Ne]:me.stats})}_(!0),c(!1);const fe=await at(t);fe.success&&h(fe.history),setTimeout(()=>{_(!1)},3e3)}else Y("Failed to purge character data. Please try again.")}catch(q){console.error("Error in handleCharacterPurge:",q),Y("Failed to purge character data. Please try again.")}finally{E(!1),setTimeout(()=>{O.current=!1},1e3)}},le=async K=>{try{if(w({monthly:[],yearly:[]}),T(we()),t)if((await tt(t)).success)k({}),await o(t);else{K("Failed to reset stats data. Please try again.");return}g(!1),n(!0),setTimeout(()=>{n(!1),s(!1)},3400)}catch(G){console.error("Error in stats reset:",G),K("Failed to reset stats data. Please try again.")}},F=()=>{n(!1),s(!1)},ee=i.useMemo(()=>y?y.history||[]:[],[y]);function x(){d.silence("Stats tracking is now cloud-based - no action needed")}return{showStats:r,setShowStats:s,showStatsResetConfirm:u,setShowStatsResetConfirm:g,statsPanel:b,setStatsPanel:w,showCharacterPurgeConfirm:C,setShowCharacterPurgeConfirm:c,purgeTargetCharacter:f,setPurgeTargetCharacter:v,purgeInProgress:W,purgeSuccess:S,setPurgeSuccess:_,auditHistory:P,resetSuccessVisible:a,closeResetSuccess:F,cloudPitchedStats:m,setCloudPitchedStats:k,isLoadingCloudStats:l,pitchedModalItem:y,setPitchedModalItem:N,showPitchedModal:I,setShowPitchedModal:D,showCharacterPitchedModal:L,setShowCharacterPitchedModal:R,pitchedModalDetails:ee,showItemDetailModal:M,setShowItemDetailModal:U,selectedItemDetail:ae,setSelectedItemDetail:Q,showHistoricalPitchedModal:te,setShowHistoricalPitchedModal:z,historicalPitchedData:A,setHistoricalPitchedData:V,allYears:J,selectedYear:X,setSelectedYear:T,groupedYearlyPitchedItems:oe,handleCharacterPurge:ne,handleStatsReset:le,startStatsTrackingIfNeeded:x,handleHistoricalPitchedConfirm:async(K,G)=>{try{if(!A)throw new Error("No historical pitched data available");const{itemName:B,bossName:O,weekKey:Y}=A;d.userAction("Adding historical pitched item",`${B} for ${O} by ${G}`);const{addPitchedItem:q}=await re(async()=>{const{addPitchedItem:se}=await Promise.resolve().then(()=>ke);return{addPitchedItem:se}},void 0),ie={charId:G,bossName:O,item:B,date:K.split("T")[0]},Z=await q(t,ie);if(Z.success)return d.silence("Historical pitched item added successfully"),z(!1),V(null),o&&await o(),{success:!0};throw new Error(Z.error||"Failed to add historical pitched item")}catch(B){throw d.error("Error handling historical pitched confirmation:",B),B}},handleHistoricalPitchedRemove:async(K,G,B,O=null)=>{try{let Y=O,q=G;if(!Y&&A&&(Y=A.weekKey,q||(q=A.bossName)),!Y)throw new Error("Week key not available for historical pitched item removal");if(!q)throw new Error("Boss name not available for historical pitched item removal");d.userAction("Removing historical pitched item",`${B} from ${q} by ${K}`);const{removePitchedItem:ie}=await re(async()=>{const{removePitchedItem:se}=await Promise.resolve().then(()=>ke);return{removePitchedItem:se}},void 0),Z=await ie(t,K,q,B,null);if(Z.success)return d.silence("Historical pitched item removed successfully"),A&&(z(!1),V(null)),o&&await o(),{success:!0};throw new Error(Z.error||"Failed to remove historical pitched item")}catch(Y){throw d.error("Error handling historical pitched removal:",Y),Y}},handleItemDetailClick:K=>{Q(K),U(!0)}}}function Tt(){const{userCode:t,isLoggedIn:o}=Pe(),[r,s]=i.useState(null),[u,g]=i.useState(()=>ot()),[b,w]=i.useState(!1),[C,c]=i.useState(""),[f,v]=i.useState(null),[W,E]=i.useState("");i.useEffect(()=>{if(!t||!o){s(null),c("");return}let l=!0;return(async()=>{try{w(!0),c("");const y=await Le(t);if(!l)return;y.success?s(y.data):c(y.error||"Failed to load weekly data.")}catch(y){l&&(d.error("useUserWeeklyData: Failed to load weekly data:",y),c("Failed to load weekly data. Please try again."))}finally{l&&w(!1)}})(),()=>{l=!1}},[t,o,u]);const S=i.useCallback(async()=>{if(!(!t||!o))try{w(!0);const l=await Le(t);l.success?(s(l.data),c("")):c(l.error||"Failed to refresh data.")}catch(l){d.error("useUserWeeklyData: Failed to refresh weekly data:",l),c("Failed to refresh data.")}finally{w(!1)}},[t,o]),_=i.useCallback(()=>!r||!r.char_map?[]:Object.entries(r.char_map).map(([l,j])=>{var y,N;return{index:parseInt(l),name:j,bossConfig:((y=r.boss_config)==null?void 0:y[l])||"",weeklyClears:((N=r.weekly_clears)==null?void 0:N[l])||""}}).sort((l,j)=>l.index-j.index),[r]),P=i.useCallback(async l=>{if(!t||!o)return c("Not logged in."),{success:!1,error:"Not logged in."};if(!(l!=null&&l.trim()))return c("Character name cannot be empty."),{success:!1,error:"Character name cannot be empty."};try{w(!0),c("");const j=await nt(t,u,l.trim());return j.success?(await S(),E(""),{success:!0,characterIndex:j.characterIndex}):(c(j.error||"Failed to add character."),j)}catch(j){d.error("useUserWeeklyData: Failed to add character:",j);const y="Failed to add character.";return c(y),{success:!1,error:y}}finally{w(!1)}},[t,o,u,S]),h=i.useCallback(async l=>{if(!t||!o)return c("Not logged in."),{success:!1,error:"Not logged in."};try{w(!0),c("");const j=await ct(t,u,l);return j.success?(await S(),f===l&&v(null),{success:!0}):(c(j.error||"Failed to remove character."),j)}catch(j){d.error("useUserWeeklyData: Failed to remove character:",j);const y="Failed to remove character.";return c(y),{success:!1,error:y}}finally{w(!1)}},[t,o,u,f,S]),a=i.useCallback(async(l,j)=>{if(!t||!o)return c("Not logged in."),{success:!1,error:"Not logged in."};try{w(!0),c("");const y=await lt(t,u,l,j);return y.success?(await S(),{success:!0}):(c(y.error||"Failed to update character name."),y)}catch(y){d.error("useUserWeeklyData: Failed to update character name:",y);const N="Failed to update character name.";return c(N),{success:!1,error:N}}finally{w(!1)}},[t,o,u,S]),n=i.useCallback(async(l,j)=>{if(!t||!o)return c("Not logged in."),{success:!1,error:"Not logged in."};try{w(!0),c("");const y=await dt(t,u,l,j);return y.success?(await S(),{success:!0}):(c(y.error||"Failed to update boss configuration."),y)}catch(y){d.error("useUserWeeklyData: Failed to update boss configuration:",y);const N="Failed to update boss configuration.";return c(N),{success:!1,error:N}}finally{w(!1)}},[t,o,u,S]),m=i.useCallback(l=>_().find(y=>y.index===l)||null,[_]),k=i.useCallback((l,j=null)=>_().some(N=>N.name.toLowerCase()===l.toLowerCase()&&N.index!==j),[_]);return{weeklyData:r,currentWeekStart:u,isLoading:b,error:C,setError:c,characters:_(),selectedCharacterIndex:f,setSelectedCharacterIndex:v,newCharacterName:W,setNewCharacterName:E,refreshWeeklyData:S,addCharacter:P,removeCharacter:h,updateCharacterName:a,updateCharacterBossConfig:n,getCharacterByIndex:m,characterNameExists:k,fetchWeeklyData:(l,j)=>ut(l,j),saveWeeklyData:(l,j,y)=>ht(l,j,y)}}function $t({characterBossSelections:t,bossData:o,checked:r,setChecked:s,userCode:u,appWeekKey:g,showOnboardingIndicators:b}){var le;const{lastWeeklyResetTimestamp:w,reorderCharacters:C}=We(),{refreshWeeklyData:c}=Tt();function f(F,ee){const x=o.find($=>$.name===F);if(!x)return 0;const p=x.difficulties.find($=>$.difficulty===ee);return p?p.price:0}const[v,W]=i.useState(!0),[E,S]=i.useState(0),[_,P]=i.useState(null),[h,a]=i.useState(!1),n=i.useRef(!1),[m,k]=i.useState(()=>{const F=localStorage.getItem(ue.WEEKLY_HIDE_COMPLETED);return F?JSON.parse(F):!1});i.useEffect(()=>{localStorage.setItem(ue.WEEKLY_HIDE_COMPLETED,JSON.stringify(m))},[m]),i.useEffect(()=>{if(t.length)a(!1);else{a(!1);const F=setTimeout(()=>{a(!0)},2e3);return()=>clearTimeout(F)}},[t.length]);const l=Et(u,g,(le=t[E])==null?void 0:le.name),{pitchedChecked:j,setPitchedChecked:y,cloudPitchedItems:N,refreshPitchedItems:I,userInteractionRef:D,addNewPitchedItem:L,removePitchedItemByDetails:R}=Lt(u||null,l.selectedWeekKey),M=It({userId:u,characterBossSelections:t,selectedCharIdx:E,checked:r,setChecked:s,setError:P,onDataChange:()=>{c(),I()},isHistoricalWeek:l.isHistoricalWeek,onBossUncheckStart:()=>{n.current=!0},onBossUncheckEnd:()=>{setTimeout(()=>{n.current=!1},500)}}),U=Wt(u,I);i.useEffect(()=>{if(u){const F=localStorage.getItem(ue.USER_CODE);if(!F||F!==u){d.debug("WeeklyTracker: Skipping data refresh - logout in progress");return}d.debug("WeeklyTracker: Refreshing data on mount/user change"),I(),c()}},[u,I,c]),i.useEffect(()=>{if(w>0&&u){const F=localStorage.getItem(ue.USER_CODE);if(!F||F!==u){d.debug("WeeklyTracker: Skipping weekly reset refresh - logout in progress");return}d.debug("WeeklyTracker: Detected weekly reset, refreshing pitched items.");const ee=setTimeout(()=>{u&&localStorage.getItem(ue.USER_CODE)===u&&I()},500);return()=>clearTimeout(ee)}},[w,u,I]);const ae=F=>{d.debug("WeeklyTracker: Week changed",{from:l.selectedWeekKey,to:F,isHistorical:l.isHistoricalWeek}),l.handleWeekChange(F),l.refreshHistoricalAnalysis&&l.refreshHistoricalAnalysis(),I()};i.useEffect(()=>{E>=t.length&&S(Math.max(0,t.length-1))},[t.length,E]);const Q=t[E],te=`${(Q==null?void 0:Q.name)||""}-${E}`,z=(Q==null?void 0:Q.bosses)||[],A=[...z].sort((F,ee)=>{try{const x=f(F.name,F.difficulty)/(F.partySize||1);return f(ee.name,ee.difficulty)/(ee.partySize||1)-x}catch(x){return d.error("WeeklyTracker: Error sorting bosses",x),P(`Error sorting bosses: ${x.message}`),0}}),V=t.reduce((F,ee,x)=>{const p=`${(ee==null?void 0:ee.name)||""}-${x}`;return F+(ee.bosses||[]).reduce(($,H)=>{var K;return(K=r[p])!=null&&K[H.name+"-"+H.difficulty]?$+f(H.name,H.difficulty)/(H.partySize||1):$},0)},0),J=t.reduce((F,ee)=>F+(ee.bosses||[]).reduce((x,p)=>x+f(p.name,p.difficulty)/(p.partySize||1),0),0),X=t.map((F,ee)=>{const x=`${(F==null?void 0:F.name)||""}-${ee}`,p=(F==null?void 0:F.bosses)||[],$=p.filter(G=>{var B;return(B=r[x])==null?void 0:B[G.name+"-"+G.difficulty]}).length,H=p.length,K=p.reduce((G,B)=>{var O;return(O=r[x])!=null&&O[B.name+"-"+B.difficulty]?G+Math.ceil(f(B.name,B.difficulty)/(B.partySize||1)):G},0);return{name:F.name,cleared:$,total:H,allCleared:H>0&&$===H,left:H-$,idx:ee,totalMeso:K}}),T=m?X.filter(F=>!F.allCleared):X,oe=z.length>0,ne=async F=>{var ee,x;if(!u){d.error("WeeklyTracker: No userCode available for pitched item interaction");return}if(!t.length){d.error("WeeklyTracker: No characters available");return}d.debug("WeeklyTracker: Pitched item clicked",F);try{const{bossName:p,itemName:$,characterName:H,weekKey:K,isChecked:G,isHistorical:B,itemImage:O}=F;if(!H){d.error("WeeklyTracker: No character name provided");return}if(!t.some(q=>q.name===H)){d.error("WeeklyTracker: Character not found in character list",{characterName:H});return}if(G)await R(H,p,$,B?De(K):null),d.info("WeeklyTracker: Pitched item removed",{characterName:H,bossName:p,itemName:$});else{if(B){const q=(await re(async()=>{const{getBossPitchedItems:se}=await import("./bossRegistryService-DvalQhf8.js");return{getBossPitchedItems:se}},__vite__mapDeps([8,4,3,0,1,2,5]))).getBossPitchedItems,Z=(q(p)||[]).find(se=>se.name===$);if(Z){const se={bossName:p,itemName:$,itemImage:O||Z.image,weekKey:K,character:H};U.setHistoricalPitchedData(se),U.setShowHistoricalPitchedModal(!0)}return}if(await L(H,p,$,B?De(K):null),d.info("WeeklyTracker: Pitched item added",{characterName:H,bossName:p,itemName:$}),!B){if(n.current){d.info("WeeklyTracker: Skipping auto-check because boss unchecking is in progress");return}try{d.info("WeeklyTracker: Starting automatic boss check process",{characterName:H,bossName:p,totalCharacters:t.length,characterNames:t.map(Z=>Z.name)});const q=t.findIndex(Z=>Z.name===H),ie=t[q];if(ie&&q!==-1){const Z=ie.bosses.find(se=>se.name===p);if(Z){const se=`${ie.name}-${q}`,me=`${Z.name}-${Z.difficulty}`,fe=(ee=r[se])==null?void 0:ee[me];if(d.info("WeeklyTracker: Boss check status verification",{charKey:se,bossKey:me,isAlreadyCleared:fe,shouldAutoCheck:!fe}),fe)d.info("WeeklyTracker: Boss already cleared, skipping auto-check",{characterName:H,bossName:Z.name});else{d.info("WeeklyTracker: Auto-checking boss since pitched item was obtained",{characterName:H,characterIndex:q,bossName:Z.name,difficulty:Z.difficulty});const{getBossRegistryId:Ne}=await re(async()=>{const{getBossRegistryId:he}=await import("./bossCodeMapping-Cii3oUax.js");return{getBossRegistryId:he}},__vite__mapDeps([9,4,3])),{toggleBossClearStatus:He}=await re(async()=>{const{toggleBossClearStatus:he}=await import("./userWeeklyDataService-ZqJ-EB27.js");return{toggleBossClearStatus:he}},__vite__mapDeps([6,4,3,7,0,1,2,5])),{getCurrentMapleWeekStartDate:Be}=await re(async()=>{const{getCurrentMapleWeekStartDate:he}=await import("./mapleWeekUtils-Bm65Nri8.js");return{getCurrentMapleWeekStartDate:he}},[]),Ae=await Ne(Z.name,Z.difficulty),Fe=Be(),_e=await He(u,Fe,ie.index.toString(),Ae,!0);_e.success?(s(he=>{const ge={...he};return ge[se]||(ge[se]={}),ge[se]={...ge[se]},ge[se][me]=!0,ge}),d.info("WeeklyTracker: Auto-check boss completed successfully",{bossName:Z.name,difficulty:Z.difficulty})):d.error("WeeklyTracker: Auto-check boss failed",{error:_e.error,bossName:Z.name})}}else d.warn("WeeklyTracker: Boss not found in character configuration",{characterName:H,bossName:p,characterBosses:((x=ie.bosses)==null?void 0:x.map(se=>se.name))||[]})}else d.warn("WeeklyTracker: Character not found in character selections",{characterName:H,availableCharacters:t.map(Z=>Z.name)})}catch(q){d.error("WeeklyTracker: Failed to auto-check boss after pitched item",{error:q.message,characterName:H,bossName:p})}}}}catch(p){d.error("WeeklyTracker: Error handling pitched item click",p)}};return _?e.jsxs("div",{className:"weekly-tracker-error",children:[e.jsx("div",{className:"weekly-tracker-error-message",children:_}),e.jsx("button",{onClick:()=>P(null),children:"Try Again"})]}):t.length?e.jsx("div",{className:"weekly-tracker",children:e.jsxs("div",{className:"weekly-tracker-container",children:[e.jsx(pt,{sidebarVisible:v,setSidebarVisible:W,isHistoricalWeek:l.isHistoricalWeek,totalMeso:V,obtainableMeso:J,selectedWeekKey:l.selectedWeekKey,hideCompleted:m,setHideCompleted:k,visibleCharSummaries:T,selectedCharIdx:E,setSelectedCharIdx:S,setPurgeTargetCharacter:U.setPurgeTargetCharacter,setShowCharacterPurgeConfirm:U.setShowCharacterPurgeConfirm,setShowCharacterPitchedModal:U.setShowCharacterPitchedModal,onShowTreasureAnalytics:()=>U.setShowStats(!0),characterBossSelections:t,showOnboardingIndicators:b,onReorderCharacters:C}),e.jsx(kt,{sidebarVisible:v,setSidebarVisible:W}),e.jsx("div",{className:"weekly-tracker-main fade-in",children:e.jsxs("div",{className:"weekly-tracker-content",children:[e.jsx("div",{className:"weekly-tracker-header",children:e.jsx("h2",{className:"weekly-tracker-title",children:l.isHistoricalWeek?"Historical Week View":"Weekly Boss Tracker"})}),e.jsx("div",{className:"weekly-tracker-navigator-wrapper",children:e.jsx(mt,{appWeekKey:g,selectedWeekKey:l.selectedWeekKey,onWeekChange:ae,isHistoricalWeek:l.isHistoricalWeek,historicalAnalysis:l.historicalAnalysis})}),oe&&e.jsx("div",{className:"weekly-tracker-table-transition-container",children:l.isHistoricalWeek?e.jsx("div",{className:"table-content-wrapper fade-in-content",children:e.jsx(wt,{bossData:o,characterKey:te,selectedWeekKey:l.selectedWeekKey,selectedCharIdx:E,pitchedChecked:j,onPitchedItemClick:ne,userCode:u,cloudPitchedItems:N,characterBossSelections:t})},"historical"):e.jsx("div",{className:"table-content-wrapper fade-in-content",children:e.jsx(xt,{bosses:A,bossData:o,checked:r,characterKey:te,onBossCheck:M.handleCheck,getBossPrice:f,showTickAll:!0,onTickAll:M.handleTickAll,allTicked:z.every(F=>{var ee;return(ee=r[te])==null?void 0:ee[F.name+"-"+F.difficulty]})&&z.length>0,pitchedChecked:j,onPitchedItemClick:ne,isHistoricalWeek:!1,userCode:u,selectedWeekKey:l.selectedWeekKey,selectedCharIdx:E,userInteractionRef:D,cloudPitchedItems:N,characterBossSelections:t})},"current")})]})}),e.jsx(Dt,{statsManagement:U,weekNavigation:l,pitchedChecked:j,setPitchedChecked:y,userInteractionRef:D,setError:P,characterBossSelections:t,selectedCharIdx:E,cloudPitchedItems:N})]})}):e.jsx("div",{className:"weekly-tracker-no-characters",children:e.jsx("div",{className:`weekly-tracker-no-characters-message ${h?"visible":""}`,children:"No characters found. Go back and add a character first."})})}function Rt({show:t,onComplete:o,onSkip:r}){const[s,u]=i.useState(0),[g,b]=i.useState(!1),[w,C]=i.useState(!1),[c,f]=i.useState({}),v=[{id:"welcome",title:"Welcome to Weekly Tracker! 🎉",content:e.jsxs("div",{children:[e.jsx("p",{children:"Track weekly boss completions and rare item drops efficiently."}),e.jsx("p",{children:"Let me show you the key interactive features."})]}),highlight:null,position:"center",offset:{x:0,y:0}},{id:"characters-title",title:"Analytics Hub 📊",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:'Click "Characters"'})," to access account-wide analytics."]}),e.jsx("p",{children:"View all pitched items and drops across characters and years."})]}),highlight:".sidebar-title",position:"right",arrow:"left",offset:{x:24,y:0}},{id:"weekly-progress",title:"Progress Toggle 🔄",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Click progress bar"})," to toggle views:"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Account Total:"})," Overall weekly progress",e.jsx("br",{}),"• ",e.jsx("strong",{children:"Selected Character:"})," Individual progress"]})]}),highlight:".sidebar-progress-section",position:"right",arrow:"left",offset:{x:24,y:0}},{id:"boss-table",title:"Boss Management 🗡️",content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Check off bosses"})," as you complete them."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Click pitched item icons"})," to track rare drops."]})]}),highlight:".weekly-tracker-main .weekly-tracker-content",position:"left",arrow:"right",offset:{x:-24,y:0}},{id:"week-navigation",title:"Week Navigation 📅",content:e.jsx("div",{children:e.jsx("p",{children:"Navigate between weeks to view historical data and track progress patterns."})}),highlight:".weekly-tracker-navigator-wrapper",position:"bottom",arrow:"top",offset:{x:0,y:16}},{id:"final",title:"Ready to Boss! ✅",content:e.jsxs("div",{children:[e.jsx("p",{children:"You're all set! Start tracking your weekly progress."}),e.jsxs("div",{className:"onboarding-reset-tip",children:[e.jsx("strong",{children:"💡 Tip:"})," To replay this guide, clear localStorage key 'ms-weekly-onboarding-seen'"]})]}),highlight:null,position:"center",offset:{x:0,y:0}}],W=i.useCallback(a=>{if(!a.highlight)return{};const n=document.querySelector(a.highlight);if(!n)return console.warn(`Onboarding: Element not found for selector: ${a.highlight}`),{};const m=n.getBoundingClientRect(),k=420,{x:l=0,y:j=0}=a.offset||{},y={width:window.innerWidth,height:window.innerHeight};let N={};switch(a.position){case"right":N={position:"fixed",left:`${Math.min(m.right+l,y.width-k-16)}px`,top:`${Math.max(16,m.top+m.height/2-90)}px`,transform:"none"};break;case"left":N={position:"fixed",left:`${Math.max(16,m.left+l-k)}px`,top:`${Math.max(16,m.top+m.height/2-90)}px`,transform:"none"};break;case"bottom":N={position:"fixed",left:`${Math.max(16,Math.min(m.left+m.width/2+l-k/2,y.width-k-16))}px`,top:`${m.bottom+j}px`,transform:"none"};break;case"top":N={position:"fixed",left:`${Math.max(16,Math.min(m.left+m.width/2+l-k/2,y.width-k-16))}px`,bottom:`${y.height-m.top+j}px`,transform:"none"};break;default:return{}}return N},[]);i.useEffect(()=>{if(g&&s<v.length){const a=v[s],n=W(a);f(n)}},[s,g,W]),i.useEffect(()=>{const a=()=>{if(g&&s<v.length){const n=v[s],m=W(n);f(m)}};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[s,g,W]),i.useEffect(()=>(t?(b(!0),u(0),document.body.classList.add("onboarding-active")):(b(!1),document.body.classList.remove("onboarding-active")),()=>{document.body.classList.remove("onboarding-active")}),[t]);const E=()=>{s<v.length-1?(C(!0),setTimeout(()=>{u(s+1),setTimeout(()=>C(!1),50)},200)):_()},S=()=>{s>0&&(C(!0),setTimeout(()=>{u(s-1),setTimeout(()=>C(!1),50)},200))},_=()=>{b(!1),document.body.classList.remove("onboarding-active"),setTimeout(()=>{o()},300)},P=()=>{b(!1),document.body.classList.remove("onboarding-active"),setTimeout(()=>{r()},300)};if(!t)return null;const h=v[s];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`onboarding-overlay ${g?"visible":""}`}),h.highlight&&e.jsx("div",{className:"onboarding-spotlight","data-highlight":h.highlight}),e.jsxs("div",{className:`onboarding-modal ${g?"visible":""} ${w?"transitioning":""} position-${h.position}`,style:c,"data-step":h.id,children:[h.arrow&&e.jsx("div",{className:`onboarding-arrow arrow-${h.arrow}`}),e.jsxs("div",{className:"onboarding-content",children:[e.jsxs("div",{className:"onboarding-header",children:[e.jsx("h2",{className:"onboarding-title",children:h.title}),e.jsx("button",{className:"onboarding-skip",onClick:P,title:"Skip tutorial",children:"Skip Tour"})]}),e.jsx("div",{className:"onboarding-body",children:h.content}),e.jsxs("div",{className:"onboarding-footer",children:[e.jsxs("div",{className:"onboarding-progress",children:[e.jsxs("span",{className:"onboarding-step-counter",children:[s+1," of ",v.length]}),e.jsx("div",{className:"onboarding-progress-bar",children:e.jsx("div",{className:"onboarding-progress-fill","data-progress":`${(s+1)/v.length*100}`})})]}),e.jsxs("div",{className:"onboarding-actions",children:[s>0&&e.jsx("button",{className:"onboarding-btn secondary",onClick:S,children:"Previous"}),e.jsx("button",{className:"onboarding-btn primary",onClick:E,children:s===v.length-1?"Get Started!":"Next"})]})]})]})]})]})}function zt(){Ve();const{userCode:t,isLoggedIn:o,handleDeleteAccount:r}=Pe(),{characterBossSelections:s,checked:u,setChecked:g,fullUserData:b,weekKey:w,preservingCheckedStateRef:C,sortedBossData:c,isLoading:f,hasDataLoaded:v}=We(),[W,E]=i.useState(!1),[S,_]=i.useState(!1),[P,h]=i.useState(""),[a,n]=i.useState(!1),[m,k]=i.useState(!1);i.useEffect(()=>{if(v&&s.length>0&&!localStorage.getItem(ue.WEEKLY_ONBOARDING_SEEN)){const N=setTimeout(()=>{k(!0)},500);return()=>clearTimeout(N)}},[v,s.length]);const l=()=>{localStorage.setItem(ue.WEEKLY_ONBOARDING_SEEN,"true"),k(!1)};if(!o)return null;const j=async()=>{n(!0),h("");try{const y=await r();y.success?_(!1):h(y.error)}catch(y){h("Failed to delete account. Try again."),console.error("Delete error:",y)}finally{n(!1)}};return f||!v?e.jsxs("div",{className:"page-container",children:[e.jsx(Ee,{currentPage:"weeklytracker",onShowHelp:()=>E(!0),onShowDeleteConfirm:()=>_(!0)}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",color:"#e6e0ff",fontSize:"1.2rem"},children:"Loading data..."})]}):e.jsxs("div",{className:"page-container",children:[e.jsx(Ee,{currentPage:"weeklytracker",onShowHelp:()=>E(!0),onShowDeleteConfirm:()=>_(!0)}),e.jsx(ze,{children:e.jsx($t,{characterBossSelections:s,bossData:c,checked:u,setChecked:g,userCode:t,fullUserData:b,appWeekKey:w,preservingCheckedStateRef:C,showOnboardingIndicators:m})}),e.jsx(Rt,{show:m,onComplete:l,onSkip:l}),e.jsx(qe,{showHelp:W,onClose:()=>E(!1),children:e.jsx(Ze,{})}),e.jsx(Je,{showDeleteConfirm:S,onClose:()=>_(!1),onConfirm:j,showDeleteLoading:a,deleteError:P})]})}export{zt as default};
