const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BOPki7CY.js","assets/vendor-ui-aK89YfOw.js","assets/vendor-router-Cg8TMqY4.js","assets/vendor-react-eWEExxYH.js","assets/vendor-supabase-B7S7y5aO.js","assets/index-o9PZVm3f.css"])))=>i.map(i=>d[i]);
import{_ as w}from"./vendor-supabase-B7S7y5aO.js";import{s as u,i as E,l as I}from"./index-BOPki7CY.js";import"./vendor-react-eWEExxYH.js";import"./vendor-ui-aK89YfOw.js";import"./vendor-router-Cg8TMqY4.js";async function S(t){try{if(!t)return console.log("No user code provided for getHistoricalWeekAnalysis"),{success:!1,error:"No user code provided"};const{getCurrentWeekKey:e}=await w(async()=>{const{getCurrentWeekKey:n}=await import("./index-BOPki7CY.js").then(d=>d.w);return{getCurrentWeekKey:n}},__vite__mapDeps([0,1,2,3,4,5])),r=e(),a=new Set,{data:o,error:s}=await u.from("user_boss_data").select("maple_week_start, weekly_clears").eq("user_id",t);if(s&&s.code!=="PGRST116")return console.error("Error fetching user_boss_data for historical analysis:",s),{success:!1,error:s.message};const{data:i,error:c}=await u.from("user_data").select("pitched_items").eq("id",t).single();c&&c.code!=="PGRST116"&&console.error("Error fetching user_data for historical analysis:",c),i!=null&&i.pitched_items&&Array.isArray(i.pitched_items)&&i.pitched_items.forEach(n=>{if(n.date){const d=E(n.date);d&&d!==r&&a.add(d)}}),o&&Array.isArray(o)&&o.forEach(n=>{if(n.maple_week_start&&n.weekly_clears&&Object.keys(n.weekly_clears).length>0){const d=E(n.maple_week_start);d&&d!==r&&a.add(d)}});const l=Array.from(a).sort((n,d)=>{const m=D=>{const h=D.split("-");return h.length===2?{year:parseInt(h[0]),week:parseInt(h[1])}:h.length===3?{year:parseInt(h[0]),week:parseInt(h[1])}:{year:0,week:0}},p=m(n),g=m(d);return p.year!==g.year?p.year-g.year:p.week-g.week}),f=l.length>0;let _=null,y="new",k=8;if(f){_=l[0];const{getWeekOffset:n}=await w(async()=>{const{getWeekOffset:p}=await import("./index-BOPki7CY.js").then(g=>g.w);return{getWeekOffset:p}},__vite__mapDeps([0,1,2,3,4,5])),d=n(_),m=Math.abs(d);m>8&&(y="existing",k=m)}return{success:!0,hasHistoricalData:f,oldestHistoricalWeek:_,historicalWeeks:l,totalHistoricalWeeks:l.length,userType:y,adaptiveWeekLimit:k,currentWeek:r,analysis:{pitchedItemsCount:i!=null&&i.pitched_items?i.pitched_items.length:0,userBossDataCount:o?o.length:0,weeksWithData:l.length+1}}}catch(e){return console.error("Error in getHistoricalWeekAnalysis:",e),{success:!1,error:e.message}}}function q(t,e,r,a){const o={...t};return Object.keys(o).forEach(s=>{s.startsWith(`${e}-${r}__`)&&s.endsWith(`__${a}`)&&delete o[s]}),o}async function T(t){var e;try{if(!t)return{success:!1,error:"User code is required"};const{data:r,error:a}=await u.from("user_data").select("data").eq("id",t).single();if(a)throw console.error("Error fetching audit history:",a),a;const s=(((e=r.data)==null?void 0:e.pitched_reset_history)||[]).sort((i,c)=>new Date(c.timestamp)-new Date(i.timestamp));return{success:!0,history:s,totalResets:s.length}}catch(r){return console.error("Error getting pitched reset audit history:",r),{success:!1,error:r.message||"Unknown error occurred"}}}async function H(t){try{if(!t)return console.error("Missing required field: userCode"),{success:!1,error:"Missing required field: userCode"};let e=0,r=0;const{data:a,error:o}=await u.from("user_data").select("data, pitched_items").eq("id",t).single();if(o&&o.code!=="PGRST116")throw console.error("Error fetching user data:",o),o;if(a){const c=a.data||{};e=(a.pitched_items||[]).length;const f=new Date().toISOString(),_={timestamp:f,action:"complete_stats_reset",itemsRemoved:e,userAgent:typeof navigator<"u"?navigator.userAgent:"Server"},y={...c,lastUpdated:f,pitched_reset_history:[...c.pitched_reset_history||[],_].slice(-50)};await u.from("user_data").update({pitched_items:[],data:y}).eq("id",t)}const{data:s,error:i}=await u.from("user_boss_data").select("id").eq("user_id",t);if(i&&i.code!=="PGRST116")console.warn("Error fetching user_boss_data:",i);else if(s&&s.length>0){r=s.length;const{error:c}=await u.from("user_boss_data").delete().eq("user_id",t);if(c)throw console.error("Error clearing user_boss_data:",c),c}return{success:!0,itemsRemoved:e,userBossDataRemoved:r,totalEntriesRemoved:e+r}}catch(e){return console.error("Error in complete stats reset:",e),{success:!1,error:e.message||"Unknown error occurred"}}}async function U(t,e,r){try{if(!t||!e)return{success:!1,error:"Missing required parameters"};const a=await v(),{data:o,error:s}=await a.from("user_data").select("pitched_items").eq("id",t).single();if(s&&s.code!=="PGRST116")throw s;const i=(o==null?void 0:o.pitched_items)||[],c=i.filter(f=>f.charId!==e),l=i.length-c.length;return await a.from("user_data").update({pitched_items:c}).eq("id",t),{success:!0,removedCount:l,message:`Removed ${l} pitched items for character ${e}`}}catch(a){return I.error("Error purging pitched records:",a),{success:!1,error:a.message||"Unknown error occurred"}}}async function x(t){try{const{data:e,error:r}=await u.from("user_boss_data").select("*").eq("user_id",t);if(r&&r.code!=="PGRST116")throw r;const{data:a,error:o}=await u.from("user_data").select("pitched_items").eq("id",t).single();return o&&o.code!=="PGRST116"&&console.warn("Could not fetch pitched items:",o),{success:!0,data:{user_boss_data:e||[],pitched_items:(a==null?void 0:a.pitched_items)||[],exportDate:new Date().toISOString(),dataVersion:"3.0"}}}catch(e){return console.error("Error exporting user data:",e),{success:!1,error:e}}}async function O(t,e){try{if(!e||typeof e!="object")throw new Error("Invalid import object");if(e.dataVersion!=="3.0")throw new Error("Unsupported data format. Please export from a newer version.");const{user_boss_data:r,pitched_items:a}=e;if(await u.from("user_boss_data").delete().eq("user_id",t),r&&Array.isArray(r)&&r.length>0){const o=r.map(s=>({...s,user_id:t}));await u.from("user_boss_data").insert(o)}if(a&&Array.isArray(a)){const o=a.filter(s=>s&&typeof s=="object"&&s.charId&&s.item&&s.date);await u.from("user_data").upsert({id:t,pitched_items:o})}return console.log(`[Import] Successfully imported v3.0 data for user '${t}'`),{success:!0,message:"Data imported successfully"}}catch(r){return console.error("Error importing user data:",r),{success:!1,error:r.message||"Import failed"}}}async function v(){const{supabase:t}=await w(async()=>{const{supabase:e}=await import("./index-BOPki7CY.js").then(r=>r.t);return{supabase:e}},__vite__mapDeps([0,1,2,3,4,5]));return t}export{q as clearCharacterPitchedUI,x as exportUserData,S as getHistoricalWeekAnalysis,T as getPitchedResetAuditHistory,O as importUserData,H as purgeAllStatsData,U as purgePitchedRecords};
