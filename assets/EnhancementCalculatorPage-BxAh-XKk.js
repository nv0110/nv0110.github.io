import{j as e}from"./vendor-ui-aK89YfOw.js";import{r as h}from"./vendor-router-Cg8TMqY4.js";import{l as x,u as le,V as ce}from"./index-CsR83Gvh.js";import"./vendor-react-eWEExxYH.js";import"./vendor-supabase-B7S7y5aO.js";const re={0:{success:95,maintain:5,decrease:0,destroy:0},1:{success:90,maintain:10,decrease:0,destroy:0},2:{success:85,maintain:15,decrease:0,destroy:0},3:{success:85,maintain:15,decrease:0,destroy:0},4:{success:80,maintain:20,decrease:0,destroy:0},5:{success:75,maintain:25,decrease:0,destroy:0},6:{success:70,maintain:30,decrease:0,destroy:0},7:{success:65,maintain:35,decrease:0,destroy:0},8:{success:60,maintain:40,decrease:0,destroy:0},9:{success:55,maintain:45,decrease:0,destroy:0},10:{success:50,maintain:50,decrease:0,destroy:0},11:{success:45,maintain:55,decrease:0,destroy:0},12:{success:40,maintain:60,decrease:0,destroy:0},13:{success:35,maintain:65,decrease:0,destroy:0},14:{success:30,maintain:70,decrease:0,destroy:0},15:{success:30,maintain:67.9,decrease:0,destroy:2.1},16:{success:30,maintain:0,decrease:67.9,destroy:2.1},17:{success:30,maintain:0,decrease:67.9,destroy:2.1},18:{success:30,maintain:0,decrease:67.2,destroy:2.8},19:{success:30,maintain:0,decrease:67.2,destroy:2.8},20:{success:30,maintain:63,decrease:0,destroy:7},21:{success:30,maintain:0,decrease:63,destroy:7},22:{success:3,maintain:0,decrease:77.6,destroy:19.4},23:{success:2,maintain:0,decrease:68.6,destroy:29.4},24:{success:1,maintain:0,decrease:59.4,destroy:39.6}};function F(s,t=2.7,i=1){return(v,o)=>{const m=i*Math.pow(o,3)*Math.pow(v+1,t)/s+10;return 100*Math.round(m)}}function ie(s){switch(s){case 11:return F(22e3);case 12:return F(15e3);case 13:return F(11e3);case 14:return F(7500);default:return s>=0&&s<=9?F(2500,1):s===10?F(4e4):(s>=15&&s<=24,F(2e4))}}function oe(s,t){return ie(s)(s,t)}function de(s){return s===2}function I(s,t,i,v={},o=1e4){try{if(x.info("Starting starforce simulation",{equipLevel:s,currentStar:t,targetStar:i,options:v,simulations:o}),!s||s<1||s>300)return{success:!1,error:"Invalid equipment level. Must be between 1-300."};if(t<0||t>25||i<0||i>25)return{success:!1,error:"Invalid star levels. Must be between 0-25."};if(t>=i)return{success:!1,error:"Target star must be higher than current star."};const{eventType:m="none",mvpLevel:l="none",hasPremium:c=!1,isZeroWeapon:N=!1,useSafeguard:f=!1,useStarCatch:M=!1}=v,u=[],b=performance.now();for(let L=0;L<o;L++){const k=ue(s,t,i,{eventType:m,mvpLevel:l,hasPremium:c,isZeroWeapon:N,useSafeguard:f,useStarCatch:M});u.push(k)}const C=performance.now(),R=ge(u);return x.info("Starforce simulation completed",{simulations:o,duration:`${(C-b).toFixed(2)}ms`,averageCost:R.averageCost,averageAttempts:R.averageAttempts}),{success:!0,...R,equipLevel:s,currentStar:t,targetStar:i,options:{eventType:m,mvpLevel:l,hasPremium:c,isZeroWeapon:N,useSafeguard:f,useStarCatch:M},simulationCount:o,duration:C-b}}catch(m){return x.error("Error in starforce simulation",m),{success:!1,error:"Failed to simulate starforce enhancement. Please try again."}}}function ue(s,t,i,v){let o=t,m=0,l=0,c=0,N=0,f=0,M=0;const u=fe(s,v.isZeroWeapon);for(;o<i;){l++;const b=de(c),C=ve(u,o,v,s,b);if(m+=C,b){o++,M++,c=0;continue}if((v.eventType==="51015"||v.eventType==="ssf")&&(o===5||o===10||o===15)){o++,M++,c=0;continue}const L=me(o,v),k=he(L);if(k==="success"?(o++,M++,c=0):k==="decrease"?(o=Math.max(0,o-1),f++,c++):k==="maintain"?c=0:k==="destroy"&&(o=12,N++,c=0),l>1e4){x.warn("Simulation exceeded 10000 attempts, terminating");break}}return{totalCost:m,attempts:l,successes:M,decreases:f,booms:N,chanceTimeUsed:M>i-t}}function me(s,t){const i=re[s];let v=i.success/100,o=i.maintain/100,m=i.decrease/100,l=i.destroy/100;if(t.useSafeguard&&s>=15&&s<=16&&(m>0?m+=l:o+=l,l=0),t.useStarCatch){v*=1.05;const N=1-v;if(m===0){const f=o+l;f>0&&(o=o*N/f,l=N-o)}else{const f=m+l;f>0&&(m=m*N/f,l=N-m)}}return{success:v*100,maintain:o*100,decrease:m*100,destroy:l*100}}function he(s){const t=Math.random()*100;return t<s.success?"success":t<s.success+s.maintain?"maintain":t<s.success+s.maintain+s.decrease?"decrease":"destroy"}function ve(s,t,i,v,o=!1){let m=0;const l=je(v,t);return l!==null?m=l:m=oe(t,s),pe(m,i,t,o)}function pe(s,t,i,v=!1){let o=1;i<=15&&(t.mvpLevel==="silver"?o-=.03:t.mvpLevel==="gold"?o-=.05:t.mvpLevel==="diamond"&&(o-=.1)),(t.eventType==="30off"||t.eventType==="ssf")&&(o-=.3);const l=t.eventType==="51015"||t.eventType==="ssf";t.useSafeguard&&!v&&!(l&&i===15)&&i>=15&&i<=16&&(o+=1);const N=s*o;return Math.round(N)}function ge(s){const t=s.map(l=>l.totalCost).sort((l,c)=>l-c),i=s.map(l=>l.attempts).sort((l,c)=>l-c),v=s.reduce((l,c)=>l+c.successes,0),o=s.reduce((l,c)=>l+c.decreases,0),m=s.reduce((l,c)=>l+c.booms,0);return{averageCost:Math.round(t.reduce((l,c)=>l+c,0)/t.length),medianCost:t[Math.floor(t.length*.5)],percentile25Cost:t[Math.floor(t.length*.25)],percentile75Cost:t[Math.floor(t.length*.75)],percentile90Cost:t[Math.floor(t.length*.9)],percentile99Cost:t[Math.floor(t.length*.99)],minCost:t[0],maxCost:t[t.length-1],averageAttempts:Math.round(i.reduce((l,c)=>l+c,0)/i.length),medianAttempts:i[Math.floor(i.length*.5)],percentile90Attempts:i[Math.floor(i.length*.9)],minAttempts:i[0],maxAttempts:i[i.length-1],averageSuccesses:Math.round(v/s.length),averageDecreases:Math.round(o/s.length),averageBooms:m/s.length,chanceTimeUsageRate:Math.round(s.filter(l=>l.chanceTimeUsed).length/s.length*100),costDistribution:xe(t)}}function xe(s){const i=s[0],o=(s[s.length-1]-i)/20,m=[];for(let l=0;l<20;l++){const c=i+l*o,N=i+(l+1)*o,f=s.filter(M=>M>=c&&M<N).length;m.push({range:`${T(c)} - ${T(N)}`,count:f,percentage:Math.round(f/s.length*100)})}return m}function fe(s,t=!1){return t&&s>150?150:s}function je(s,t){return(s===108||s===109)&&t===7?321e3:(s===118||s===119)&&t===9?533400:(s===128||s===129)&&t===14?6471400:null}function Ne(){return[{value:"none",name:"None",discount:"0%"},{value:"silver",name:"Silver",discount:"3%"},{value:"gold",name:"Gold",discount:"5%"},{value:"diamond",name:"Diamond",discount:"10%"}]}function T(s){return s>=1e9?`${(s/1e9).toFixed(2)}B`:s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}K`:s.toLocaleString()}function Te(){const{isLoggedIn:s}=le();h.useEffect(()=>{const a=document.body.style.overflowY,n=document.documentElement.style.overflowY;return document.body.style.overflowY="auto",document.documentElement.style.overflowY="auto",()=>{document.body.style.overflowY=a,document.documentElement.style.overflowY=n}},[]);const[t,i]=h.useState("calculator"),[v,o]=h.useState(200),[m,l]=h.useState(0),[c,N]=h.useState(17),[f,M]=h.useState("none"),[u,b]=h.useState("none"),[C,R]=h.useState(!1),[L,k]=h.useState(!1),[w,U]=h.useState(!1),[g,P]=h.useState(null),[_,Y]=h.useState(!1),[S,Z]=h.useState({eventType:"none",mvpLevel:"none",useStarCatch:!1,useMedianCost:!1}),[E,A]=h.useState({characters:[]}),[q,J]=h.useState(""),[V,O]=h.useState(new Set);h.useEffect(()=>{try{const a=localStorage.getItem("enhancementPlannerData");if(a){const r=JSON.parse(a);A(r),x.info("Loaded planner data from localStorage")}const n=localStorage.getItem("enhancementCalculator_mode");n&&(i(n),x.info("Loaded mode from localStorage:",n));const d=localStorage.getItem("enhancementCalculator_calculatorSettings");if(d){const r=JSON.parse(d);o(r.equipLevel||200),l(r.currentStar||0),N(r.targetStar||17),M(r.eventType||"none"),b(r.mvpLevel||"none"),R(r.isZeroWeapon||!1),k(r.useSafeguard||!1),U(r.useStarCatch||!1),x.info("Loaded calculator settings from localStorage")}const p=localStorage.getItem("enhancementCalculator_globalSettings");if(p){const r=JSON.parse(p);Z({eventType:r.eventType||"none",mvpLevel:r.mvpLevel||"none",useStarCatch:r.useStarCatch||!1,useMedianCost:r.useMedianCost||!1}),x.info("Loaded global settings from localStorage:",r)}}catch(a){x.error("Failed to load saved settings:",a)}},[]),h.useEffect(()=>{E.characters.length>0&&(localStorage.setItem("enhancementPlannerData",JSON.stringify(E)),x.info("Saved planner data to localStorage"))},[E]),h.useEffect(()=>{localStorage.setItem("enhancementCalculator_mode",t),x.info("Saved mode to localStorage:",t)},[t]),h.useEffect(()=>{const a={equipLevel:v,currentStar:m,targetStar:c,eventType:f,mvpLevel:u,isZeroWeapon:C,useSafeguard:L,useStarCatch:w};localStorage.setItem("enhancementCalculator_calculatorSettings",JSON.stringify(a)),x.info("Saved calculator settings to localStorage")},[v,m,c,f,u,C,L,w]),h.useEffect(()=>{localStorage.setItem("enhancementCalculator_globalSettings",JSON.stringify(S)),x.info("Saved global settings to localStorage:",S)},[S]);const z=h.useCallback(()=>{if(!q.trim())return;const a={id:Date.now().toString(),name:q.trim(),items:[]};A(n=>({...n,characters:[...n.characters,a]})),J(""),O(n=>new Set([...n,a.id])),x.info("Added character:",a.name)},[q]),H=h.useCallback(a=>{A(n=>({...n,characters:n.characters.filter(d=>d.id!==a)})),O(n=>{const d=new Set(n);return d.delete(a),d}),x.info("Removed character:",a)},[]),K=h.useCallback(a=>{O(n=>{const d=new Set(n);return d.has(a)?d.delete(a):d.add(a),d})},[]),Q=[{value:"hat",name:"Hat",icon:"⛑️"},{value:"face_accessory",name:"Face Accessory",icon:"🎭"},{value:"eye_accessory",name:"Eye Accessory",icon:"🥽"},{value:"earrings",name:"Earrings",icon:"💎"},{value:"pendant",name:"Pendant",icon:"🏺"},{value:"ring",name:"Ring",icon:"💍"},{value:"overall",name:"Overall",icon:"🛡️"},{value:"top",name:"Top",icon:"🎽"},{value:"bottom",name:"Bottom",icon:"👖"},{value:"shoes",name:"Shoes",icon:"🥾"},{value:"gloves",name:"Gloves",icon:"🧤"},{value:"cape",name:"Cape",icon:"🧥"},{value:"belt",name:"Belt",icon:"⚜️"},{value:"shoulder",name:"Shoulder",icon:"🏛️"},{value:"weapon",name:"Weapon",icon:"⚔️"},{value:"shield",name:"Shield",icon:"🛡️"}],X=h.useCallback(a=>{const n={id:Date.now().toString(),type:"weapon",name:"Weapon",equipLevel:200,currentStar:0,targetStar:17,isZeroWeapon:!1,useSafeguard:!1,calculationResult:null};A(d=>({...d,characters:d.characters.map(p=>p.id===a?{...p,items:[...p.items,n]}:p)})),x.info("Added item to character:",a)},[]),ee=h.useCallback((a,n)=>{A(d=>({...d,characters:d.characters.map(p=>p.id===a?{...p,items:p.items.filter(r=>r.id!==n)}:p)})),x.info("Removed item:",n,"from character:",a)},[]),se=h.useCallback((a,n,d)=>{A(p=>({...p,characters:p.characters.map(j=>j.id===a?{...j,items:j.items.map(y=>y.id===n?{...y,...d,...d.calculationResult?{}:{calculationResult:null}}:y)}:j)}))},[]),B=h.useCallback(()=>{x.info("Starting bulk calculation for all items"),A(a=>{let n={...a};return a.characters.forEach(d=>{d.items.forEach(p=>{if(p.equipLevel&&p.currentStar!==null&&p.targetStar!==null&&p.currentStar<p.targetStar)try{const r=I(p.equipLevel,p.currentStar,p.targetStar,{eventType:S.eventType,mvpLevel:S.mvpLevel,hasPremium:!1,isZeroWeapon:p.isZeroWeapon,useSafeguard:p.useSafeguard,useStarCatch:S.useStarCatch});n={...n,characters:n.characters.map(j=>j.id===d.id?{...j,items:j.items.map(y=>y.id===p.id?{...y,calculationResult:r}:y)}:j)}}catch(r){x.error("Calculation failed for item:",p.name,r),n={...n,characters:n.characters.map(j=>j.id===d.id?{...j,items:j.items.map(y=>y.id===p.id?{...y,calculationResult:{success:!1,error:"Calculation failed. Please try again."}}:y)}:j)}}})}),n})},[S]);h.useEffect(()=>{if(E.characters.length>0){const a=setTimeout(()=>{B()},500);return()=>clearTimeout(a)}},[S,B]);const ae=h.useCallback((a,n)=>{x.info("calculateItemCost called with:",{characterId:a,itemId:n}),A(d=>{const p=d.characters.find(j=>j.id===a);if(!p)return x.error("Character not found:",a),d;const r=p.items.find(j=>j.id===n);if(!r)return x.error("Item not found:",n),d;if(x.info("Found item for calculation:",r),!r.equipLevel||r.currentStar===null||r.targetStar===null||r.currentStar>=r.targetStar)return x.error("Invalid item parameters:",{equipLevel:r.equipLevel,currentStar:r.currentStar,targetStar:r.targetStar}),{...d,characters:d.characters.map(j=>j.id===a?{...j,items:j.items.map(y=>y.id===n?{...y,calculationResult:{success:!1,error:"Please enter valid equipment level and star range."}}:y)}:j)};try{x.info("Calculating cost for item:",r.name,"with params:",{equipLevel:r.equipLevel,currentStar:r.currentStar,targetStar:r.targetStar,eventType:S.eventType,mvpLevel:S.mvpLevel,isZeroWeapon:r.isZeroWeapon,useSafeguard:r.useSafeguard,useStarCatch:S.useStarCatch});const j=I(r.equipLevel,r.currentStar,r.targetStar,{eventType:S.eventType,mvpLevel:S.mvpLevel,hasPremium:!1,isZeroWeapon:r.isZeroWeapon,useSafeguard:r.useSafeguard,useStarCatch:S.useStarCatch});return x.info("Calculation result:",j),x.info("Calculation completed for item:",r.name),{...d,characters:d.characters.map(y=>y.id===a?{...y,items:y.items.map(W=>W.id===n?{...W,calculationResult:j}:W)}:y)}}catch(j){return x.error("Calculation failed for item:",r.name,j),{...d,characters:d.characters.map(y=>y.id===a?{...y,items:y.items.map(W=>W.id===n?{...W,calculationResult:{success:!1,error:"Calculation failed. Please try again."}}:W)}:y)}}})},[S]),D=h.useCallback(a=>a.items.reduce((n,d)=>{var p;if((p=d.calculationResult)!=null&&p.success){const r=S.useMedianCost?d.calculationResult.medianCost:d.calculationResult.averageCost;return n+r}return n},0),[S.useMedianCost]),te=h.useCallback(()=>E.characters.reduce((a,n)=>a+D(n),0),[E.characters,D]),ne=h.useCallback(()=>{if(!v||m===null||c===null||m>=c){P({success:!1,error:"Please enter valid equipment level and star range."});return}Y(!0),setTimeout(()=>{try{x.info("Starting calculation with params:",{equipLevel:v,currentStar:m,targetStar:c,eventType:f,mvpLevel:u,isZeroWeapon:C,useSafeguard:L,useStarCatch:w});const a=I(v,m,c,{eventType:f,mvpLevel:u,hasPremium:!1,isZeroWeapon:C,useSafeguard:L,useStarCatch:w});x.info("Calculation completed:",a),P(a)}catch(a){x.error("Calculation failed:",a),P({success:!1,error:"Calculation failed. Please try again."})}finally{Y(!1)}},100)},[v,m,c,f,u,C,L,w]);if(h.useEffect(()=>{g&&P(null)},[v,m,c,f,u,C,L,w]),!s)return null;const G=Ne(),$=f==="51015"||f==="ssf";return h.useEffect(()=>{C&&v>150&&(o(150),x.info("Equipment level capped at 150 due to Zero weapon setting"))},[C,v]),h.useEffect(()=>{try{localStorage.setItem("enhancementCalculator_mode",t),x.info("Saved mode to localStorage:",t)}catch(a){x.error("Failed to save mode to localStorage:",a)}},[t]),e.jsx("div",{className:"enhancement-calculator-page-wrapper",children:e.jsx("div",{className:"enhancement-calculator-page",children:e.jsx(ce,{children:e.jsxs("div",{className:"enhancement-calculator-main fade-in",children:[e.jsxs("div",{className:"enhancement-header",children:[e.jsx("h2",{className:"enhancement-title",children:"Enhancement Calculator"}),e.jsx("p",{className:"enhancement-subtitle",children:"Calculate meso costs for starforcing equipment"}),e.jsxs("div",{className:"mode-toggle",children:[e.jsx("button",{className:`mode-button ${t==="calculator"?"active":""}`,onClick:()=>i("calculator"),children:"Single Calculator"}),e.jsx("button",{className:`mode-button ${t==="planner"?"active":""}`,onClick:()=>i("planner"),children:"Multi-Character Planner"})]})]}),t==="calculator"?e.jsxs("div",{className:"enhancement-container",children:[e.jsxs("div",{className:"enhancement-inputs",children:[e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Equipment Settings"}),e.jsxs("div",{className:"input-group",children:[e.jsxs("label",{htmlFor:"equip-level",children:["Equipment Level:",C&&e.jsx("span",{className:"level-cap-info",children:" (Max 150 for Zero weapons)"})]}),e.jsx("input",{id:"equip-level",type:"number",min:"1",max:C?"150":"300",value:v,onChange:a=>{const n=parseInt(a.target.value)||1;o(Math.min(n,C?150:300))},className:"level-input"})]}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:a=>R(a.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-text",children:"Zero Weapon (Capped at Level 150)"})]})})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Star Range"}),e.jsxs("div",{className:"star-range-inputs",children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"current-star",children:"Current Stars:"}),e.jsx("select",{id:"current-star",value:m,onChange:a=>l(parseInt(a.target.value)),className:"star-select",children:Array.from({length:25},(a,n)=>e.jsxs("option",{value:n,children:[n,"★"]},n))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"target-star",children:"Target Stars:"}),e.jsx("select",{id:"target-star",value:c,onChange:a=>N(parseInt(a.target.value)),className:"star-select",children:Array.from({length:25},(a,n)=>n+1).map(a=>e.jsxs("option",{value:a,disabled:a<=m,children:[a,"★"]},a))})]})]})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Discounts & Events"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"mvp-level",children:"MVP Level:"}),e.jsx("select",{id:"mvp-level",value:u,onChange:a=>b(a.target.value),className:"mvp-select",children:G.map(a=>e.jsxs("option",{value:a.value,children:[a.name," (",a.discount,")"]},a.value))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"event-type",children:"Active Event:"}),e.jsxs("select",{id:"event-type",value:f,onChange:a=>M(a.target.value),className:"event-select",children:[e.jsx("option",{value:"none",children:"No Event"}),e.jsx("option",{value:"30off",children:"30% Cost Reduction"}),e.jsx("option",{value:"51015",children:"5/10/15 Guaranteed Success"}),e.jsx("option",{value:"ssf",children:"Shiny Star Force (30% + 5/10/15)"})]})]}),f!=="none"&&e.jsxs("div",{className:"event-info",children:[f==="30off"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge",children:"30% Off"}),"All starforce costs reduced by 30%"]}),f==="51015"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge guaranteed",children:"5/10/15"}),"Guaranteed success for 5★→6★, 10★→11★, and 15★→16★ upgrades"]}),f==="ssf"&&e.jsxs("p",{className:"info-text",children:[e.jsx("span",{className:"event-badge",children:"SSF"}),"30% cost reduction + guaranteed success for 5★→6★, 10★→11★, and 15★→16★"]})]})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Star Catch Minigame"}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:a=>U(a.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsx("span",{className:"toggle-text",children:"Use Star Catch (+5% Success Rate)"})]})}),w&&e.jsx("div",{className:"starcatch-info",children:e.jsx("p",{className:"info-text",children:"Star Catch minigame increases success rate by 5% multiplicatively when successful. Does not appear during guaranteed upgrades (5/10/15 events, Chance Time)."})})]}),e.jsxs("div",{className:"enhancement-section",children:[e.jsx("h3",{className:"section-title",children:"Safeguard Options"}),e.jsx("div",{className:"toggle-group",children:e.jsxs("label",{className:"toggle-label",children:[e.jsx("input",{type:"checkbox",checked:L,onChange:a=>k(a.target.checked),className:"toggle-checkbox"}),e.jsx("span",{className:"toggle-slider"}),e.jsxs("span",{className:"toggle-text",children:[$?"Safeguard 16★ → 17★":"Safeguard 15★ → 16★ & 16★ → 17★",$&&e.jsx("span",{className:"event-clarification",children:" (15★→16★ guaranteed by event)"})]})]})}),L&&e.jsx("div",{className:"safeguard-info",children:e.jsx("p",{className:"info-text",children:$?"Safeguard doubles the cost but prevents equipment destruction for 16★→17★. The 15★→16★ upgrade is guaranteed by the event and doesn't need safeguarding.":"Safeguard doubles the cost but prevents equipment destruction for both 15★→16★ and 16★→17★."})})]}),e.jsx("div",{className:"enhancement-section",children:e.jsxs("div",{className:"calculate-section",children:[e.jsx("button",{onClick:ne,disabled:_||!v||m>=c,className:`calculate-button ${_?"calculating":""}`,children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"button-spinner"}),e.jsx("span",{children:"Running Simulation..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"🎲"}),e.jsx("span",{children:"Calculate Starforce Cost"})]})}),e.jsx("div",{className:"calculate-info",children:e.jsx("p",{className:"info-text",children:"Runs 10,000 simulations to provide realistic cost estimates and risk analysis."})})]})})]}),e.jsx("div",{className:"enhancement-results",children:_?e.jsxs("div",{className:"calculating-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Calculating..."})]}):g?g.success?e.jsxs("div",{className:"results-content",children:[e.jsxs("div",{className:"simulation-header",children:[e.jsx("h3",{className:"results-title",children:"Simulation Results"}),e.jsxs("div",{className:"simulation-info",children:[e.jsxs("span",{className:"simulation-count",children:[g.simulationCount.toLocaleString()," simulations"]}),e.jsxs("span",{className:"simulation-time",children:["(",g.duration.toFixed(0),"ms)"]})]})]}),e.jsxs("div",{className:"statistics-grid",children:[e.jsxs("div",{className:"stat-card primary",children:[e.jsx("h4",{children:"Average Cost"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:T(g.averageCost)}),e.jsxs("div",{className:"stat-tooltip",children:[g.averageCost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Median Cost"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:T(g.medianCost)}),e.jsxs("div",{className:"stat-tooltip",children:[g.medianCost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"Average Booms"}),e.jsx("div",{className:"stat-value",children:g.averageBooms.toFixed(2)}),e.jsx("div",{className:"stat-unit",children:"booms"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h4",{children:"90th Percentile"}),e.jsxs("div",{className:"stat-value-container",children:[e.jsx("div",{className:"stat-value",children:T(g.percentile90Cost)}),e.jsxs("div",{className:"stat-tooltip",children:[g.percentile90Cost.toLocaleString()," mesos"]})]}),e.jsx("div",{className:"stat-unit",children:"mesos"})]})]}),e.jsxs("div",{className:"risk-analysis",children:[e.jsx("h4",{children:"Cost Range Analysis"}),e.jsxs("div",{className:"range-stats",children:[e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"Best Case:"}),e.jsx("span",{className:"range-value",children:T(g.minCost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"25th Percentile:"}),e.jsx("span",{className:"range-value",children:T(g.percentile25Cost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"75th Percentile:"}),e.jsx("span",{className:"range-value",children:T(g.percentile75Cost)})]}),e.jsxs("div",{className:"range-item",children:[e.jsx("span",{className:"range-label",children:"99th Percentile:"}),e.jsx("span",{className:"range-value",children:T(g.percentile99Cost)})]}),e.jsxs("div",{className:"range-item worst-case",children:[e.jsx("span",{className:"range-label",children:"Worst Case:"}),e.jsx("span",{className:"range-value",children:T(g.maxCost)})]})]})]}),e.jsxs("div",{className:"outcome-analysis",children:[e.jsx("h4",{children:"Enhancement Outcomes"}),e.jsxs("div",{className:"outcome-stats",children:[e.jsxs("div",{className:"outcome-item success",children:[e.jsx("span",{className:"outcome-label",children:"Avg Successes:"}),e.jsx("span",{className:"outcome-value",children:g.averageSuccesses})]}),e.jsxs("div",{className:"outcome-item decrease",children:[e.jsx("span",{className:"outcome-label",children:"Avg Decreases:"}),e.jsx("span",{className:"outcome-value",children:g.averageDecreases})]}),e.jsxs("div",{className:"outcome-item boom",children:[e.jsx("span",{className:"outcome-label",children:"Avg Booms:"}),e.jsx("span",{className:"outcome-value",children:g.averageBooms})]}),e.jsxs("div",{className:"outcome-item chance-time",children:[e.jsx("span",{className:"outcome-label",children:"Chance Time Usage:"}),e.jsxs("span",{className:"outcome-value",children:[g.chanceTimeUsageRate,"%"]})]})]})]}),e.jsxs("div",{className:"simulation-summary",children:[e.jsx("h4",{children:"Simulation Parameters"}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Equipment Level:"}),e.jsx("span",{className:"summary-value",children:g.equipLevel})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Star Range:"}),e.jsxs("span",{className:"summary-value",children:[g.currentStar,"★ → ",g.targetStar,"★"]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Event:"}),e.jsxs("span",{className:"summary-value",children:[g.options.eventType==="none"&&"None",g.options.eventType==="30off"&&"30% Cost Reduction",g.options.eventType==="51015"&&"5/10/15 Guaranteed",g.options.eventType==="ssf"&&"Shiny Star Force"]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"MVP Level:"}),e.jsx("span",{className:"summary-value",children:g.options.mvpLevel==="none"?"None":g.options.mvpLevel.toUpperCase()})]}),g.options.useStarCatch&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Star Catch:"}),e.jsx("span",{className:"summary-value",children:"Enabled (+5% Success)"})]}),g.options.useSafeguard&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Safeguard:"}),e.jsx("span",{className:"summary-value",children:"15★→16★ & 16★→17★"})]}),g.options.isZeroWeapon&&e.jsxs("div",{className:"summary-item",children:[e.jsx("span",{className:"summary-label",children:"Zero Weapon:"}),e.jsx("span",{className:"summary-value",children:"Yes (Capped at 150)"})]})]})]})]}):e.jsxs("div",{className:"error-message",children:[e.jsx("span",{className:"error-icon",children:"⚠️"}),e.jsx("span",{children:g.error})]}):e.jsx("div",{className:"no-results",children:e.jsx("span",{children:'Click the "Calculate Starforce Cost" button to run simulation'})})})]}):e.jsxs("div",{className:"planner-container",children:[e.jsxs("div",{className:"global-settings-panel",children:[e.jsx("h3",{className:"section-title",children:"Global Settings"}),e.jsxs("div",{className:"global-settings-grid",children:[e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"Event Type:"}),e.jsxs("select",{value:S.eventType,onChange:a=>Z(n=>({...n,eventType:a.target.value})),className:"setting-select",children:[e.jsx("option",{value:"none",children:"No Event"}),e.jsx("option",{value:"30off",children:"30% Cost Reduction"}),e.jsx("option",{value:"51015",children:"5/10/15 Guaranteed Success"}),e.jsx("option",{value:"ssf",children:"Shiny Star Force (30% + 5/10/15)"})]})]}),e.jsxs("div",{className:"setting-group",children:[e.jsx("label",{children:"MVP Level:"}),e.jsx("select",{value:S.mvpLevel,onChange:a=>Z(n=>({...n,mvpLevel:a.target.value})),className:"setting-select",children:G.map(a=>e.jsxs("option",{value:a.value,children:[a.name," (",a.discount,")"]},a.value))})]}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{type:"button",className:`toggle-button ${S.useStarCatch?"active":""}`,onClick:()=>Z(a=>({...a,useStarCatch:!a.useStarCatch})),children:[e.jsx("span",{className:"toggle-icon",children:"⭐"}),e.jsx("span",{className:"toggle-text",children:"Star Catch (+5%)"})]})}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{type:"button",className:`toggle-button ${S.useMedianCost?"active":""}`,onClick:()=>Z(a=>({...a,useMedianCost:!a.useMedianCost})),title:S.useMedianCost?"Using median cost (50th percentile)":"Using average cost (mean)",children:[e.jsx("span",{className:"toggle-icon",children:"📊"}),e.jsx("span",{className:"toggle-text",children:S.useMedianCost?"Median Cost":"Average Cost"})]})}),e.jsx("div",{className:"setting-group",children:e.jsxs("button",{onClick:B,className:"calculate-all-button",disabled:E.characters.length===0,children:[e.jsx("span",{children:"🎲"}),e.jsx("span",{children:"Re-run All Simulations"})]})})]})]}),e.jsxs("div",{className:"planner-header",children:[e.jsxs("div",{className:"add-character-section",children:[e.jsx("h3",{className:"section-title",children:"Add Character"}),e.jsxs("div",{className:"add-character-form",children:[e.jsx("input",{type:"text",value:q,onChange:a=>J(a.target.value),placeholder:"Enter character name...",className:"character-name-input",onKeyPress:a=>a.key==="Enter"&&z()}),e.jsx("button",{onClick:z,disabled:!q.trim(),className:"add-character-button",children:"Add Character"})]})]}),e.jsxs("div",{className:"overall-total",children:[e.jsxs("h3",{className:"section-title",children:["Total Costs",e.jsx("span",{className:"cost-type-indicator",children:S.useMedianCost?"Median":"Average"})]}),e.jsx("div",{className:"total-cost-display",children:E.characters.length>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"total-amount",children:T(te())}),e.jsx("span",{className:"total-unit",children:"mesos"})]}):e.jsx("span",{className:"total-amount",children:"0 mesos"})})]})]}),e.jsx("div",{className:"characters-list",children:E.characters.length===0?e.jsx("div",{className:"no-characters",children:e.jsx("span",{children:"No characters added yet. Add a character to start planning!"})}):E.characters.map(a=>e.jsxs("div",{className:"character-card",children:[e.jsxs("div",{className:"character-header",children:[e.jsxs("div",{className:"character-info",children:[e.jsx("div",{className:"character-name-row",children:e.jsx("h4",{className:"character-name",children:a.name})}),e.jsxs("div",{className:"character-stats",children:[e.jsxs("span",{className:"item-count",children:[a.items.length," items"]}),e.jsxs("span",{className:"calculated-items",children:[a.items.filter(n=>{var d;return(d=n.calculationResult)==null?void 0:d.success}).length," calculated"]})]})]}),e.jsx("span",{className:"character-total-badge",children:T(D(a))}),e.jsxs("div",{className:"character-actions",children:[e.jsx("button",{onClick:()=>K(a.id),className:"expand-button",children:V.has(a.id)?"▲":"▼"}),e.jsx("button",{onClick:()=>H(a.id),className:"remove-character-button",children:"✕"})]})]}),V.has(a.id)&&e.jsx("div",{className:"character-content",children:e.jsxs("div",{className:"items-section",children:[e.jsxs("div",{className:"items-header",children:[e.jsx("h5",{children:"Items"}),e.jsx("button",{onClick:()=>X(a.id),className:"add-item-button",children:"+ Add Item"})]}),a.items.length===0?e.jsx("div",{className:"no-items",children:e.jsx("span",{children:"No items added yet."})}):e.jsx("div",{className:"items-list",children:a.items.map(n=>e.jsx(Ce,{item:n,characterId:a.id,onUpdateItem:se,onRemoveItem:ee,onCalculate:ae,mvpOptions:G,equipmentTypes:Q,globalSettings:S},n.id))})]})})]},a.id))})]})]})})})})}function Ce({item:s,characterId:t,onUpdateItem:i,onRemoveItem:v,onCalculate:o,mvpOptions:m,equipmentTypes:l,globalSettings:c}){var M;const N=(u,b)=>{if(u==="type"){const C=l.find(R=>R.value===b);i(t,s.id,{[u]:b,name:C?C.name:b})}else if(u==="equipLevel"){const C=s.isZeroWeapon?150:300,R=Math.min(b,C);i(t,s.id,{[u]:R})}else if(u==="isZeroWeapon"){const C={[u]:b};b&&s.equipLevel>150&&(C.equipLevel=150),i(t,s.id,C)}else i(t,s.id,{[u]:b})};h.useEffect(()=>{if(s.equipLevel&&s.currentStar!==null&&s.targetStar!==null&&s.currentStar<s.targetStar){const u=setTimeout(()=>{o(t,s.id)},300);return()=>clearTimeout(u)}},[s.equipLevel,s.currentStar,s.targetStar,s.isZeroWeapon,s.useSafeguard,t,s.id,o]),c.eventType==="51015"||c.eventType;const f=()=>c.eventType==="51015"||c.eventType==="ssf"?"Safeguard 16★→17★ (15★→16★ guaranteed by event)":"Safeguard 15★→16★ & 16★→17★ (prevents equipment destruction)";return e.jsxs("div",{className:"item-card",children:[e.jsxs("div",{className:"item-header",children:[e.jsx("div",{className:"item-info",children:e.jsxs("div",{className:"item-header-row-inline",children:[e.jsx("div",{className:"item-type-selector",children:e.jsx("select",{value:s.type||"weapon",onChange:u=>N("type",u.target.value),className:"item-type-select",children:l.map(u=>e.jsxs("option",{value:u.value,children:[u.icon," ",u.name]},u.value))})}),e.jsxs("div",{className:"summary-control-inline",children:[e.jsxs("label",{children:["Lv.",s.isZeroWeapon&&e.jsx("span",{className:"level-cap-hint",title:"Zero weapons capped at 150",children:"(≤150)"})]}),e.jsx("input",{type:"number",min:"1",max:s.isZeroWeapon?"150":"300",value:s.equipLevel,onChange:u=>N("equipLevel",parseInt(u.target.value)||1),className:"level-input-inline"})]}),e.jsxs("div",{className:"star-range-inline",children:[e.jsx("select",{value:s.currentStar,onChange:u=>N("currentStar",parseInt(u.target.value)),className:"star-select-inline",children:Array.from({length:25},(u,b)=>e.jsxs("option",{value:b,children:[b,"★"]},b))}),e.jsx("span",{className:"star-arrow",children:"→"}),e.jsx("select",{value:s.targetStar,onChange:u=>N("targetStar",parseInt(u.target.value)),className:"star-select-inline",children:Array.from({length:25},(u,b)=>b+1).map(u=>e.jsxs("option",{value:u,disabled:u<=s.currentStar,children:[u,"★"]},u))})]}),e.jsxs("div",{className:"toggle-controls-inline",children:[e.jsxs("button",{type:"button",className:`toggle-btn-inline ${s.isZeroWeapon?"active":""}`,onClick:()=>N("isZeroWeapon",!s.isZeroWeapon),title:"Zero Weapon",children:[e.jsx("span",{className:"toggle-icon",children:"⚔️"}),e.jsx("span",{className:"toggle-text",children:"Zero Weapon"})]}),e.jsxs("button",{type:"button",className:`toggle-btn-inline ${s.useSafeguard?"active":""}`,onClick:()=>N("useSafeguard",!s.useSafeguard),title:f(),children:[e.jsx("span",{className:"toggle-icon",children:"🛡️"}),e.jsx("span",{className:"toggle-text",children:"Safeguard"})]})]}),(M=s.calculationResult)!=null&&M.success?e.jsxs("div",{className:"item-cost-badge",children:[e.jsxs("div",{className:"meso-part",children:["💰 ",T(c.useMedianCost?s.calculationResult.medianCost:s.calculationResult.averageCost),e.jsxs("div",{className:"cost-tooltip meso-tooltip",children:[c.useMedianCost?"Median":"Average"," Cost: ",(c.useMedianCost?s.calculationResult.medianCost:s.calculationResult.averageCost).toLocaleString()," mesos"]})]}),e.jsxs("div",{className:"boom-part",children:["💥",s.calculationResult.averageBooms.toFixed(1),e.jsxs("div",{className:"cost-tooltip boom-tooltip",children:["Expected Booms: ",s.calculationResult.averageBooms.toFixed(2)]})]})]}):e.jsx("div",{className:"item-cost-pending-badge",children:s.equipLevel&&s.currentStar<s.targetStar?"Calculating...":"Not calculated"})]})}),e.jsx("div",{className:"item-actions",children:e.jsx("button",{onClick:()=>v(t,s.id),className:"remove-item-button",children:"✕"})})]}),s.calculationResult&&!s.calculationResult.success&&e.jsxs("div",{className:"item-error-inline",children:["⚠️ ",s.calculationResult.error]})]})}export{Te as default};
